import{r as p,j as e,z as ze}from"./ui-core-D0pDhx0h.js";import{c as ds,u as ke,a as ps,M as Bt,b as Os,d as Ps,e as Vs,f as Be,g as Lt,S as zt,l as Wt,m as qt,n as We,o as qe,a4 as Ms,aN as Ht,Y as Yt,s as ne,t as oe,v as re,w as le,x as f,aO as Jt,as as us,az as R,aP as Kt,aQ as Ce,aa as Xt,ab as Re,ac as Oe,B as H,V as Gt,ae as Pe,E as Zt,O as Qt,aJ as ea,Z as sa,aD as ta,av as aa,aw as Us,ax as Se,ay as os,aR as As,aS as na,aT as oa,aU as Ve,H as ra,J as la,aV as ia,G as $s,I as ca,am as Me,a0 as da,aW as rs,aX as ls,aY as pa,aZ as ua,a_ as ma,a$ as ha,b0 as Fs}from"./index-BxS3VOwZ.js";import{g as ga,L as Bs}from"./LoginDialog-C5RW6JD2.js";import{M as fa,S as xa,L as ya}from"./LogoutDialog-DgbJFeKp.js";import{r as Ws,s as ja}from"./ui-form-Bg85K0S3.js";import{P as va}from"./plus-BNqhTAaD.js";import{Starfield as ba}from"./Starfield-rwOvK6ju.js";import{Pipes as wa}from"./Pipes-BKogRFM9.js";import{Maze as Sa}from"./Maze-C1TqwjbP.js";import{u as Ca}from"./useAuth-_DNnPYJD.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./motion-DC7C-474.js";import"./tiptap-CPHiBm_b.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Na=ds("MessageCircle",ka);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]],Da=ds("MousePointerClick",_a);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=[["path",{d:"M8.8 20v-4.1l1.9.2a2.3 2.3 0 0 0 2.164-2.1V8.3A5.37 5.37 0 0 0 2 8.25c0 2.8.656 3.054 1 4.55a5.77 5.77 0 0 1 .029 2.758L2 20",key:"11atix"}],["path",{d:"M19.8 17.8a7.5 7.5 0 0 0 .003-10.603",key:"yol142"}],["path",{d:"M17 15a3.5 3.5 0 0 0-.025-4.975",key:"ssbmkc"}]],Ia=ds("Speech",Ea);function Ta({onClose:d,onShowHelp:o,onShowAbout:k}){var r;const{t:m}=ke(),[y,T]=p.useState(!1),N="control-panels",O=(r=qt[N])==null?void 0:r.name,_=ps(u=>u.current),n=_==="xp"||_==="win98";return e.jsxs(Bt,{inWindowFrame:n,children:[e.jsxs(Os,{children:[e.jsx(Ps,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:m("common.menu.file")}),e.jsx(Vs,{align:"start",sideOffset:1,className:"px-0",children:e.jsx(Be,{onClick:d,className:"text-md h-6 px-3",children:m("common.menu.close")})})]}),e.jsxs(Os,{children:[e.jsx(Ps,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:m("common.menu.help")}),e.jsxs(Vs,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(Be,{onClick:o,className:"text-md h-6 px-3",children:m("apps.control-panels.menu.controlPanelsHelp")}),e.jsx(Be,{onSelect:()=>T(!0),className:"text-md h-6 px-3",children:m("common.menu.shareApp")}),e.jsx(Lt,{className:"h-[2px] bg-black my-1"}),e.jsx(Be,{onClick:k,className:"text-md h-6 px-3",children:m("apps.control-panels.menu.aboutControlPanels")})]})]}),e.jsx(zt,{isOpen:y,onClose:()=>T(!1),itemType:m("apps.control-panels.menu.app"),itemIdentifier:N,title:O,generateShareUrl:Wt})]})}const ye=p.forwardRef(({className:d,onCheckedChange:o,...k},m)=>{const{play:y}=We(qe.BUTTON_CLICK,.3),N=ps(u=>u.current)==="macosx",[O,_]=p.useState(k.checked||k.defaultChecked||!1),n=u=>{y(),_(u),o==null||o(u)},r=N?void 0:{backgroundColor:O?"#111827":"#9ca3af",borderRadius:"9999px",border:"none",boxShadow:"none"};return e.jsx(Ws,{className:Ms("peer os-switch inline-flex h-[16px] w-7 shrink-0 cursor-pointer items-center transition-colors focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",!N&&"px-[2px]",d),style:r,onCheckedChange:n,...k,ref:m,children:e.jsx(ja,{className:Ms("os-switch-thumb pointer-events-none block h-[14px] w-[14px] rounded-full bg-white transition-transform will-change-transform",N&&"data-[state=unchecked]:translate-x-[-2px]","data-[state=checked]:translate-x-[10px]")})})});ye.displayName=Ws.displayName;let is=null,cs=null;async function Ra(){return is||(cs||(cs=fetch("/wallpapers/manifest.json",{cache:"no-store"}).then(d=>{if(!d.ok)throw new Error(`Failed to load wallpaper manifest: ${d.status}`);return d.json()}).then(d=>is=d)),cs)}function Le({path:d,isSelected:o,onClick:k,isTile:m=!1,isVideo:y=!1,previewUrl:T}){const{play:N}=We(qe.BUTTON_CLICK,.3),O=p.useRef(null),[_,n]=p.useState(y),r=T||d,u=()=>{N(),k()};p.useEffect(()=>{y&&O.current&&(o?O.current.play().catch(l=>console.error("Error playing video:",l)):O.current.pause(),O.current.readyState>=3&&n(!1))},[o,y]);const D=()=>{n(!1)},Q=()=>{n(!1)};return y?e.jsxs("button",{type:"button",className:`w-full aspect-video cursor-pointer hover:opacity-90 ${o?"border-2 ring-2 ring-black border-white":"border-0"} relative overflow-hidden`,onClick:u,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),u())},children:[_&&e.jsx("div",{className:"absolute inset-0 bg-gray-700/30",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent opacity-50",style:{backgroundSize:"200% 100%",animation:"shimmer 2.5s infinite ease-in-out"}})}),e.jsx("video",{ref:O,className:"absolute inset-0 w-full h-full object-cover",src:r,loop:!0,muted:!0,playsInline:!0,onLoadedData:D,onCanPlayThrough:Q,style:{objectPosition:"center center",opacity:_?0:1,transition:"opacity 0.5s ease-in-out"}})]}):e.jsx("button",{type:"button",className:`w-full ${m?"aspect-square":"aspect-video"} cursor-pointer hover:opacity-90 ${o?"border-2 ring-2 ring-black border-white":"border-0"}`,style:{backgroundImage:`url(${r})`,backgroundSize:m?"64px 64px":"cover",backgroundPosition:m?void 0:"center",backgroundRepeat:m?"repeat":void 0},onClick:u,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),u())}})}function Oa({onSelect:d}){const{currentWallpaper:o,setWallpaper:k,INDEXEDDB_PREFIX:m,loadCustomWallpapers:y,getWallpaperData:T}=Ht(),{play:N}=We(qe.BUTTON_CLICK,.3),{displayMode:O,setDisplayMode:_}=Yt(),{t:n}=ke(),[r,u]=p.useState([]),[D,Q]=p.useState({}),l=p.useRef(null),[j,B]=p.useState(null);p.useEffect(()=>{Ra().then(B).catch(a=>console.error("Failed to load wallpaper manifest",a))},[]);const Y=p.useMemo(()=>j?j.tiles.map(a=>`/wallpapers/${a}`):[],[j]),me=p.useMemo(()=>j?j.videos.map(a=>`/wallpapers/${a}`):[],[j]),he=p.useMemo(()=>{if(!j)return{};const a={};for(const[U,W]of Object.entries(j.photos))a[U]=W.map(Z=>`/wallpapers/${Z}`);return a},[j]),V=Object.keys(he),ie=p.useMemo(()=>V.filter(a=>a!=="custom"&&a!=="videos").sort((a,U)=>a.localeCompare(U)),[V]),[M,E]=p.useState(()=>{if(o.includes("/wallpapers/tiles/"))return"tiles";if(o.startsWith(m))return"custom";if(o.includes("/wallpapers/videos/"))return"videos";const a=o.match(/\/wallpapers\/photos\/([^/]+)\//);return a?a[1]:"tiles"});p.useEffect(()=>{(async()=>{try{const U=await y();u(U);const W={};for(const Z of U){const pe=await T(Z);pe&&(W[Z]=pe)}Q(W)}catch(U){console.error("Error fetching custom wallpapers:",U)}})()},[y,T,m]);const ge=a=>{k(a),N(),d&&d(a)},He=async a=>{if(!a.target.files||a.target.files.length===0)return;const U=a.target.files[0];if(!U.type.startsWith("image/")){alert("Please select an image file. Videos are not supported.");return}try{await k(U);const Z=await y();u(Z);for(const pe of Z)if(!D[pe]){const Ue=await T(pe);Ue&&Q(fe=>({...fe,[pe]:Ue}))}E("custom")}catch(Z){console.error("Error uploading wallpaper:",Z),alert("Error uploading wallpaper. Please try again with a smaller file.")}l.current&&(l.current.value="")};p.useEffect(()=>{if(o.includes("/wallpapers/tiles/"))E("tiles");else if(o.startsWith(m))E("custom");else if(o.includes("/wallpapers/videos/"))E("videos");else{const a=o.match(/\/wallpapers\/photos\/([^/]+)\//);a&&E(a[1])}},[o,m]);const Ye=a=>a.split("_").map(U=>U.charAt(0).toUpperCase()+U.slice(1)).join(" "),Je=(a,U)=>{const W=U||a;return W.endsWith(".mp4")||W.includes("video/")||W.startsWith("https://")&&/\.(mp4|webm|ogg)($|\?)/.test(W)};return e.jsxs("div",{className:"space-y-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-[3]",children:e.jsxs(ne,{value:M,onValueChange:a=>E(a),children:[e.jsx(oe,{children:e.jsx(re,{placeholder:n("apps.control-panels.selectACategory")})}),e.jsxs(le,{children:[e.jsx(f,{value:"videos",children:n("common.menu.videos")}),e.jsx(f,{value:"tiles",children:n("apps.control-panels.patterns")}),e.jsx(f,{value:"custom",children:n("apps.control-panels.custom")}),e.jsx(Jt,{className:"-mx-1 my-1 h-px",style:{backgroundColor:"rgba(0, 0, 0, 0.15)",border:"none",margin:"4px 0",height:"1px"}}),ie.map(a=>e.jsx(f,{value:a,children:Ye(a)},a))]})]})}),e.jsxs(ne,{value:O,onValueChange:a=>_(a),children:[e.jsx(oe,{className:"w-[120px] flex-shrink-0",children:e.jsx(re,{placeholder:n("apps.control-panels.displayMode")})}),e.jsxs(le,{children:[e.jsx(f,{value:"color",children:n("apps.control-panels.color")}),e.jsx(f,{value:"monotone",children:n("apps.control-panels.mono")}),e.jsx(f,{value:"crt",children:n("apps.control-panels.crt")}),e.jsx(f,{value:"sepia",children:n("apps.control-panels.sepia")}),e.jsx(f,{value:"high-contrast",children:n("apps.control-panels.highContrast")}),e.jsx(f,{value:"dream",children:n("apps.control-panels.dream")}),e.jsx(f,{value:"invert",children:n("apps.control-panels.invert")})]})]})]}),M==="custom"&&e.jsx("input",{type:"file",ref:l,accept:"image/*",onChange:He,className:"hidden"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:`grid gap-2 p-1 ${M==="tiles"?"grid-cols-8":"grid-cols-3"}`,children:M==="tiles"?Y.map(a=>e.jsx(Le,{path:a,isSelected:o===a,onClick:()=>ge(a),isTile:!0},a)):M==="videos"?me.map(a=>e.jsx(Le,{path:a,isSelected:o===a,onClick:()=>ge(a),isVideo:!0},a)):M==="custom"?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"w-full aspect-video border-[2px] border-dotted border-gray-400 cursor-pointer hover:opacity-90 flex items-center justify-center",onClick:()=>{var a;return(a=l.current)==null?void 0:a.click()},onKeyDown:a=>{var U;(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),(U=l.current)==null||U.click())},children:e.jsx(va,{className:"h-5 w-5 text-gray-500"})}),r.length>0?r.map(a=>e.jsx(Le,{path:a,previewUrl:D[a],isSelected:o===a,onClick:()=>ge(a),isVideo:Je(a,D[a])},a)):e.jsx(e.Fragment,{})]}):he[M]?he[M].map(a=>e.jsx(Le,{path:a,isSelected:o===a,onClick:()=>ge(a)},a)):e.jsx("div",{className:"col-span-4 text-center py-8 text-gray-500",children:"No wallpapers"})})})]})}const Pa=[{id:"starfield",name:"Starfield",description:"Classic star warp effect"},{id:"flying-toasters",name:"Flying Toasters",description:"After Dark classic"},{id:"matrix",name:"Matrix",description:"Digital rain effect"},{id:"bouncing-logo",name:"Bouncing Logo",description:"DVD-style bouncing"},{id:"pipes",name:"3D Pipes",description:"Windows 3D pipes"},{id:"maze",name:"3D Maze",description:"First-person maze walker"}],Ls={starfield:"starfield","flying-toasters":"flyingToasters",matrix:"matrix","bouncing-logo":"bouncingLogo",pipes:"pipes",maze:"maze"};function Va({type:d,onClick:o,disabled:k,label:m}){const y=p.useRef(null),T=p.useRef(null),[N,O]=p.useState({width:0,height:0}),_=d==="starfield"||d==="pipes"||d==="maze";return p.useEffect(()=>{if(!_)return;const n=T.current;if(!n)return;const r=()=>{const D=n.getBoundingClientRect();O({width:Math.floor(D.width),height:Math.floor(D.height)})};if(r(),typeof ResizeObserver>"u")return;const u=new ResizeObserver(()=>r());return u.observe(n),()=>u.disconnect()},[_]),p.useEffect(()=>{if(_)return;const n=y.current;if(!n)return;const r=n.getContext("2d");if(!r)return;let u,D=0;const Q=()=>{switch(r.fillStyle="black",r.fillRect(0,0,n.width,n.height),d){case"starfield":{r.fillStyle="white";for(let l=0;l<20;l++){const j=(l*13+D)%n.width,B=l*7%n.height,Y=1+(D+l)%3;r.fillRect(j,B,Y,Y)}break}case"flying-toasters":{r.fillStyle="#000020",r.fillRect(0,0,n.width,n.height),r.fillStyle="#C0C0C0";for(let l=0;l<3;l++){const j=n.width+20-(D*2+l*40)%(n.width+40)-20,B=(D+l*30)%n.height;r.fillRect(j,B,15,10),r.fillStyle="#FFFFFF";const Y=D%10<5?B-3:B+3;r.fillRect(j-5,Y,5,3),r.fillRect(j+15,Y,5,3),r.fillStyle="#C0C0C0"}break}case"matrix":{r.fillStyle="#0F0",r.font="8px monospace";for(let l=0;l<8;l++){const j=l*12,B=(D*2+l*10)%(n.height+20)-10;r.fillText(String.fromCharCode(12448+Math.random()*96),j,B)}break}case"bouncing-logo":{const l=Math.abs(D*2%(n.width*2)-n.width),j=Math.abs(D*1.5%(n.height*2)-n.height);r.fillStyle=`hsl(${D*5%360}, 100%, 50%)`,r.font="bold 12px sans-serif",r.fillText("ryOS",l-15,j+5);break}case"pipes":{const l=["#FF4444","#44FF44","#4444FF","#FFFF44"];for(let j=0;j<3;j++)r.strokeStyle=l[j%l.length],r.lineWidth=3,r.beginPath(),r.moveTo(10+j*20,(D+j*20)%n.height),r.lineTo(30+j*20,(D+20+j*20)%n.height),r.lineTo(50+j*10,(D+40+j*20)%n.height),r.stroke();break}case"maze":{r.strokeStyle="#3366FF",r.lineWidth=1;const l=5;for(let j=0;j<l;j++){const B=1-j*.15,Y=(1-B)/2;r.strokeRect(n.width*Y,n.height*Y,n.width*B,n.height*B)}break}}D++,u=requestAnimationFrame(Q)};return Q(),()=>{cancelAnimationFrame(u)}},[d,_]),e.jsxs("button",{type:"button",onClick:o,disabled:k,className:"py-2 relative group cursor-pointer disabled:cursor-not-allowed disabled:opacity-70",children:[_?e.jsxs("div",{ref:T,className:"relative overflow-hidden rounded border border-gray-600 group-hover:border-gray-400 transition-colors bg-black",style:{width:120,height:85},children:[d==="starfield"&&e.jsx(ba,{width:N.width,height:N.height,position:"absolute"}),d==="pipes"&&e.jsx(wa,{width:N.width,height:N.height,position:"absolute"}),d==="maze"&&e.jsx(Sa,{width:N.width,height:N.height,position:"absolute"})]}):e.jsx("canvas",{ref:y,width:120,height:85,className:"rounded border border-gray-600 group-hover:border-gray-400 transition-colors",style:{imageRendering:"pixelated"}}),m&&e.jsx("span",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-[11px] font-medium drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:m})]})}function Ma({onPreview:d}){const{t:o}=ke(),{screenSaverEnabled:k,setScreenSaverEnabled:m,screenSaverType:y,setScreenSaverType:T,screenSaverIdleTime:N,setScreenSaverIdleTime:O}=us(u=>({screenSaverEnabled:u.screenSaverEnabled,setScreenSaverEnabled:u.setScreenSaverEnabled,screenSaverType:u.screenSaverType,setScreenSaverType:u.setScreenSaverType,screenSaverIdleTime:u.screenSaverIdleTime,setScreenSaverIdleTime:u.setScreenSaverIdleTime})),[_,n]=p.useState(!1),r=p.useCallback(()=>{window.dispatchEvent(new CustomEvent("screenSaverPreview",{detail:{type:y}})),n(!0),d&&d()},[y,d]);return p.useEffect(()=>{const u=()=>n(!1);return window.addEventListener("screenSaverDismiss",u),()=>window.removeEventListener("screenSaverDismiss",u)},[]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:o("apps.control-panels.screenSaver")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:o("apps.control-panels.screenSaverDescription")})]}),e.jsx(ye,{checked:k,onCheckedChange:m,className:"data-[state=checked]:bg-[#000000]"})]}),k&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-shrink-0 flex flex-col",children:e.jsx(Va,{type:y,onClick:r,disabled:_,label:o("apps.control-panels.preview")})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-[11px] mb-1 block",children:o("apps.control-panels.screenSaverType")}),e.jsxs(ne,{value:y,onValueChange:T,children:[e.jsx(oe,{className:"w-full",children:e.jsx(re,{placeholder:o("apps.control-panels.selectScreenSaver")})}),e.jsx(le,{children:Pa.map(u=>e.jsx(Kt,{value:u.id,description:o(`apps.control-panels.screenSaverOptions.${Ls[u.id]}.description`),children:o(`apps.control-panels.screenSaverOptions.${Ls[u.id]}.name`)},u.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{className:"text-[11px]",children:o("apps.control-panels.startAfter")}),e.jsxs("span",{className:"text-[11px] text-gray-600 font-geneva-12",children:[N," ",o(N===1?"apps.control-panels.minute":"apps.control-panels.minutes")]})]}),e.jsx(Ce,{value:[N],onValueChange:([u])=>O(u),min:1,max:30,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 font-geneva-12 os-slider-labels",children:[e.jsxs("span",{children:["1 ",o("apps.control-panels.min")]}),e.jsxs("span",{children:["30 ",o("apps.control-panels.min")]})]})]})]})]})})]})}function Ua({masterVolume:d,setMasterVolume:o,setPrevMasterVolume:k,handleMasterMuteToggle:m,uiVolume:y,setUiVolume:T,setPrevUiVolume:N,handleUiMuteToggle:O,speechVolume:_,setSpeechVolume:n,setPrevSpeechVolume:r,handleSpeechMuteToggle:u,chatSynthVolume:D,setChatSynthVolume:Q,setPrevChatSynthVolume:l,handleChatSynthMuteToggle:j,ipodVolume:B,setIpodVolume:Y,setPrevIpodVolume:me,handleIpodMuteToggle:he,isIOS:V}){const{play:ie}=We(qe.VOLUME_CHANGE),{t:M}=ke();return e.jsxs(Xt,{children:[e.jsxs("div",{className:"flex justify-around items-end py-2",children:[e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx(Ce,{orientation:"vertical",min:0,max:1,step:.05,value:[d],onValueChange:E=>{o(E[0]),E[0]>0&&k(E[0])},onValueCommit:()=>{ie()},className:"h-18 w-5"}),e.jsxs(Re,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon",onClick:m,className:`h-8 w-8 ${d===0?"opacity-40":""}`,children:e.jsx(Gt,{size:20})})}),e.jsx(Pe,{side:"bottom",children:e.jsx("p",{children:M("apps.control-panels.masterVolume")})})]}),e.jsx("p",{className:"text-[10px] font-geneva-12 text-gray-600",children:M("apps.control-panels.master")})]}),e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx(Ce,{orientation:"vertical",min:0,max:1,step:.05,value:[y],onValueChange:E=>{T(E[0]),E[0]>0&&N(E[0])},onValueCommit:()=>{ie()},className:"h-18 w-5"}),e.jsxs(Re,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon",onClick:O,className:`h-8 w-8 ${y===0?"opacity-40":""}`,children:e.jsx(Da,{size:20})})}),e.jsx(Pe,{side:"bottom",children:e.jsx("p",{children:M("apps.control-panels.uiVolume")})})]}),e.jsx("p",{className:"text-[10px] font-geneva-12 text-gray-600",children:M("apps.control-panels.ui")})]}),e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx(Ce,{orientation:"vertical",min:0,max:2,step:.1,value:[_],onValueChange:E=>{n(E[0]),E[0]>0&&r(E[0])},onValueCommit:()=>{ie()},className:"h-18 w-5"}),e.jsxs(Re,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon",onClick:u,className:`h-8 w-8 ${_===0?"opacity-40":""}`,children:e.jsx(Ia,{size:20})})}),e.jsx(Pe,{side:"bottom",children:e.jsx("p",{children:M("apps.control-panels.speechVolume")})})]}),e.jsx("p",{className:"text-[10px] font-geneva-12 text-gray-600",children:M("apps.control-panels.speech")})]}),e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx(Ce,{orientation:"vertical",min:0,max:2,step:.1,value:[D],onValueChange:E=>{Q(E[0]),E[0]>0&&l(E[0])},onValueCommit:()=>{ie()},className:"h-18 w-5"}),e.jsxs(Re,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon",onClick:j,className:`h-8 w-8 ${D===0?"opacity-40":""}`,children:e.jsx(Na,{size:20})})}),e.jsx(Pe,{side:"bottom",children:e.jsx("p",{children:M("apps.control-panels.chatSynthVolume")})})]}),e.jsx("p",{className:"text-[10px] font-geneva-12 text-gray-600",children:M("apps.control-panels.synth")})]}),e.jsxs("div",{className:"flex flex-col items-center gap-0",children:[e.jsx(Ce,{orientation:"vertical",min:0,max:1,step:.05,value:[V?1:B],onValueChange:V?void 0:E=>{Y(E[0]),E[0]>0&&me(E[0])},onValueCommit:V?void 0:()=>{ie()},disabled:V,className:`h-18 w-5 ${V?"opacity-40":""}`}),e.jsxs(Re,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(H,{variant:"ghost",size:"icon",onClick:he,disabled:V,className:`h-8 w-8 ${V?"opacity-40":""} ${!V&&B===0?"opacity-40":""}`,children:e.jsx(fa,{size:20})})}),e.jsx(Pe,{side:"bottom",children:e.jsx("p",{children:M("apps.control-panels.ipodVolume")})})]}),e.jsx("p",{className:"text-[10px] font-geneva-12 text-gray-600",children:M("apps.control-panels.ipod")})]})]}),V&&e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"text-[10px] text-center text-gray-600 font-geneva-12",children:"On iOS, use hardware buttons to control media volume."})})]})}const zs={"3d_graphics":["capsule","capsule_azul","capsule_pistachio","tub","tub_azul","tub_bondi","ufo_1","ufo_2","ufo_3"],convergency:Array.from({length:15},(d,o)=>`convergence_${o+1}`),foliage:["blue_flowers","cactus","golden_poppy","red_cyclamens","red_tulips","rose","spider_lily","waterdrops_on_leaf","yellow_tulips"],landscapes:["beach","clouds","french_alps","ganges_river","golden_gate_at_dusk","mono_lake","palace_on_lake_in_jaipur","rain_god_mesa","refuge-col_de_la_grasse-alps","zabriskie_point"],nostalgia:["acropolis","beach_on_ko_samui","birds_in_flight","cancun_sunset","cliffs_of_moher","fish_eagle","galway_bay","glacier_national_park","highway_395","hong_kong_at_night","islamorada_sunrise","lily_pad","long_island_sound","mac_os_background","midsummer_night","moraine_lake","oasis_in_baja","red_clouds","toronto_skyline","tuolumne_meadows","yosemite_valley","yucatan"],objects:["alpine_granite","bicycles","bottles","burmese_claypots","burning_candle","chairs","faucet_handle","neon","salt_shaker_top","shamus"],structures:["gate","gate_lock","glass_door_knob","padlock","rusty_lock","shutters","stone_wall","wall_of_stones"]};Object.entries(zs).forEach(([d,o])=>{zs[d]=o.map(k=>`/wallpapers/photos/${d}/${k}.jpg`)});const Aa=oa,$a=d=>new Promise((o,k)=>{const m=new FileReader;m.onloadend=()=>{const y=m.result;o(y)},m.onerror=y=>{console.error("Error converting blob to base64:",y),k(y)},m.readAsDataURL(d)}),Fa=d=>{const[o,k]=d.split(","),m=o.match(/data:(.*);base64/),y=m?m[1]:"application/octet-stream",T=atob(k),N=Uint8Array.from(T,O=>O.charCodeAt(0));return new Blob([N],{type:y})};function Ba(){const{t:d}=ke(),{ryOSVersion:o,ryOSBuildNumber:k}=us(_=>({ryOSVersion:_.ryOSVersion,ryOSBuildNumber:_.ryOSBuildNumber})),[m,y]=ze.useState(null),T=ze.useMemo(()=>typeof navigator<"u"&&navigator.platform.toLowerCase().includes("mac"),[]);ze.useEffect(()=>{T&&fetch("/version.json",{cache:"no-store"}).then(_=>_.json()).then(_=>y(_.desktopVersion)).catch(()=>y("1.0.1"))},[T]);const N=o||"...",O=k?` (Build ${k})`:"";return e.jsxs("p",{className:"text-[11px] text-gray-600 font-geneva-12",children:[rs().name," ",N,O,T&&m&&e.jsxs(e.Fragment,{children:[" Â· ",e.jsx("a",{href:`${rs().githubUrl}/releases/download/v${m}/${rs().name}_${m}_aarch64.dmg`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:d("apps.control-panels.downloadMacApp")})]})]})}function cn({isWindowOpen:d,onClose:o,isForeground:k,skipInitialSound:m,initialData:y,instanceId:T,onNavigateNext:N,onNavigatePrevious:O}){var Rs;const _=Zt("control-panels",pa),[n,r]=p.useState(!1),[u,D]=p.useState(!1),[Q,l]=p.useState(!1),[j,B]=p.useState(!1),Y=p.useRef(null),me=p.useRef(null),{formatFileSystem:he}=Qt(),{debugMode:V,setDebugMode:ie,shaderEffectEnabled:M,setShaderEffectEnabled:E,aiModel:ge,setAiModel:He,terminalSoundsEnabled:Ye,setTerminalSoundsEnabled:Je,uiSoundsEnabled:a,setUiSoundsEnabled:U,uiVolume:W,setUiVolume:Z,speechEnabled:pe,setSpeechEnabled:Ue,chatSynthVolume:fe,setChatSynthVolume:Ke,speechVolume:Ne,setSpeechVolume:Xe,ttsModel:_e,setTtsModel:qs,ttsVoice:je,setTtsVoice:ms,synthPreset:Hs,setSynthPreset:Ys,ipodVolume:De,setIpodVolume:Ge,masterVolume:Ee,setMasterVolume:Ze,setCurrentWallpaper:Js}=us(s=>({debugMode:s.debugMode,setDebugMode:s.setDebugMode,shaderEffectEnabled:s.shaderEffectEnabled,setShaderEffectEnabled:s.setShaderEffectEnabled,aiModel:s.aiModel,setAiModel:s.setAiModel,terminalSoundsEnabled:s.terminalSoundsEnabled,setTerminalSoundsEnabled:s.setTerminalSoundsEnabled,uiSoundsEnabled:s.uiSoundsEnabled,setUiSoundsEnabled:s.setUiSoundsEnabled,uiVolume:s.uiVolume,setUiVolume:s.setUiVolume,speechEnabled:s.speechEnabled,setSpeechEnabled:s.setSpeechEnabled,chatSynthVolume:s.chatSynthVolume,setChatSynthVolume:s.setChatSynthVolume,speechVolume:s.speechVolume,setSpeechVolume:s.setSpeechVolume,ttsModel:s.ttsModel,setTtsModel:s.setTtsModel,ttsVoice:s.ttsVoice,setTtsVoice:s.setTtsVoice,synthPreset:s.synthPreset,setSynthPreset:s.setSynthPreset,ipodVolume:s.ipodVolume,setIpodVolume:s.setIpodVolume,masterVolume:s.masterVolume,setMasterVolume:s.setMasterVolume,setCurrentWallpaper:s.setCurrentWallpaper})),{current:xe,setTheme:Ks}=ps(),{current:se,setLanguage:Xs}=ea(),{t}=ke(),{username:Ae,authToken:hs,promptSetUsername:gs,isUsernameDialogOpen:Gs,setIsUsernameDialogOpen:Zs,newUsername:Qs,setNewUsername:et,newPassword:st,setNewPassword:tt,isSettingUsername:at,usernameError:nt,submitUsernameDialog:ot,promptVerifyToken:rt,isVerifyDialogOpen:lt,setVerifyDialogOpen:fs,verifyPasswordInput:Ie,setVerifyPasswordInput:Qe,verifyUsernameInput:es,setVerifyUsernameInput:ss,hasPassword:Te,setPassword:it,logout:ct,confirmLogout:xs,isLogoutConfirmDialogOpen:dt,setIsLogoutConfirmDialogOpen:pt,isVerifyingToken:ys,verifyError:js,handleVerifyTokenSubmit:vs}=Ca(),[ut,$e]=p.useState(!1),[mt,Fe]=p.useState(""),[ht,ts]=p.useState(!1),[gt,ve]=p.useState(null),[bs,ws]=p.useState(!1);ze.useEffect(()=>{console.log("[ControlPanel] hasPassword value:",Te,"type:",typeof Te)},[Te]);const ft=async s=>{if(ts(!0),ve(null),!s||s.length<8){ve("Password must be at least 8 characters"),ts(!1);return}const A=await it(s);A.ok?(Me.success("Password Set",{description:"You can now use your password to recover your account"}),$e(!1),Fe("")):ve(A.error||"Failed to set password"),ts(!1)},xt=async()=>{ws(!0);try{if(!hs||!Ae){Me.error("Authentication Error",{description:"No authentication token found"});return}const s=await fetch(da("/api/chat-rooms?action=logoutAllDevices"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${hs}`,"X-Username":Ae}}),A=await s.json();s.ok?(Me.success("Logged Out",{description:A.message||"Logged out from all devices"}),xs()):Me.error("Logout Failed",{description:A.error||"Failed to logout from all devices"})}catch(s){console.error("Error logging out all devices:",s),Me.error("Network Error",{description:"Failed to connect to server"})}finally{ws(!1)}},[yt,Ss]=p.useState(Ee>0?Ee:1),[jt,Cs]=p.useState(W>0?W:1),[vt,ks]=p.useState(Ne>0?Ne:1),[bt,Ns]=p.useState(fe>0?fe:1),[wt,_s]=p.useState(De>0?De:1),Ds=typeof navigator<"u"&&/iP(hone|od|ad)/.test(navigator.userAgent),St=s=>{U(s)},Ct=s=>{Ue(s)},kt=s=>{Ys(s)},Nt=()=>{Ee>0?(Ss(Ee),Ze(0)):Ze(yt)},_t=()=>{W>0?(Cs(W),Z(0)):Z(jt)},Dt=()=>{Ne>0?(ks(Ne),Xe(0)):Xe(vt)},Et=()=>{fe>0?(Ns(fe),Ke(0)):Ke(bt)},It=()=>{Ds||(De>0?(_s(De),Ge(0)):Ge(wt))},Tt=()=>{l(!0)},Rt=()=>{l(!1),Ve(t("common.system.resettingSystem")),Ot()},Ot=()=>{const s=localStorage.getItem("ryos:files"),A=localStorage.getItem("_usr_recovery_key_"),P=localStorage.getItem("_auth_recovery_key_");ha(),Fs(),s&&localStorage.setItem("ryos:files",s),A&&localStorage.setItem("_usr_recovery_key_",A),P&&localStorage.setItem("_auth_recovery_key_",P),window.location.reload()},Pt=async()=>{const s={localStorage:{},indexedDB:{documents:[],images:[],trash:[],custom_wallpapers:[],applets:[]},timestamp:new Date().toISOString(),version:3};for(let P=0;P<localStorage.length;P++){const J=localStorage.key(P);J&&(s.localStorage[J]=localStorage.getItem(J))}try{const P=await ls(),J=async b=>new Promise((x,i)=>{try{const $=P.transaction(b,"readonly").objectStore(b),X=[],L=$.openCursor();L.onsuccess=z=>{const S=z.target.result;S?(X.push({key:S.key,value:S.value}),S.continue()):x(X)},L.onerror=()=>i(L.error)}catch(g){console.error(`Error accessing store ${b}:`,g),x([])}}),[be,K,v,ce,de]=await Promise.all([J("documents"),J("images"),J("trash"),J("custom_wallpapers"),J("applets")]),h=async b=>Promise.all(b.map(async x=>{const i={...x.value};for(const g of Object.keys(x.value))if(x.value[g]instanceof Blob){const $=await $a(x.value[g]);i[g]=$,i[`_isBlob_${g}`]=!0}return{key:x.key,value:i}}));s.indexedDB.documents=await h(be),s.indexedDB.images=await h(K),s.indexedDB.trash=await h(v),s.indexedDB.custom_wallpapers=await h(ce),s.indexedDB.applets=await h(de),P.close()}catch(P){console.error("Error backing up IndexedDB:",P),alert("Failed to backup file system data. Only settings will be backed up.")}const A=JSON.stringify(s);try{if(typeof CompressionStream>"u")throw new Error("CompressionStream API not available in this browser");const J=new TextEncoder().encode(A),be=new ReadableStream({start(g){g.enqueue(J),g.close()}}),K=new CompressionStream("gzip"),v=be.pipeThrough(K),ce=[],de=v.getReader();for(;;){const{done:g,value:$}=await de.read();if(g)break;ce.push($)}const h=new Blob(ce,{type:"application/gzip"}),b=URL.createObjectURL(h),x=document.createElement("a");x.href=b;const i=new Date().toISOString().replace(/[:.]/g,"-").split("T").join("-").slice(0,-5);x.download=`ryOS-backup-${i}.gz`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(b)}catch(P){console.error("Compression failed:",P),alert(`Failed to create compressed backup: ${P instanceof Error?P.message:"Unknown error"}`)}},Vt=s=>{var P;const A=(P=s.target.files)==null?void 0:P[0];A&&(me.current=A,Mt())},Mt=async()=>{const s=me.current;if(!s)return;const A=new FileReader;A.onload=async P=>{var J,be;try{let K;if(s.name.endsWith(".gz"))try{const h=(J=P.target)==null?void 0:J.result,x=new Response(h).body;if(!x)throw new Error("Failed to create stream from compressed data");const i=new DecompressionStream("gzip"),g=x.pipeThrough(i);K=await new Response(g).text()}catch(h){throw console.error("Decompression failed:",h),new Error(`Failed to decompress backup file: ${h instanceof Error?h.message:"Unknown error"}`)}else K=(be=P.target)==null?void 0:be.result;let v;try{v=JSON.parse(K)}catch(h){throw console.error("JSON parse error:",h),console.error("Data preview:",K.substring(0,200)),new Error("Invalid backup file format - not valid JSON")}if(!v||typeof v!="object")throw new Error("Invalid backup structure - expected an object");console.log("Backup loaded successfully:",{hasLocalStorage:!!v.localStorage,hasIndexedDB:!!v.indexedDB,version:v.version,timestamp:v.timestamp});let ce=!1;if(!v.version||v.version<2)ce=!0,console.log("[Restore] Detected old backup format (no version or version < 2)");else if(v.localStorage&&v.localStorage["ryos:files"])try{const h=v.localStorage["ryos:files"],b=h?JSON.parse(h):{};if(b.state&&b.state.items){const x=Object.values(b.state.items).filter(i=>!i.isDirectory);ce=x.length>0&&x.every(i=>!i.uuid),ce&&console.log("[Restore] Detected old backup format (files lack UUIDs)")}}catch(h){console.error("[Restore] Error checking backup format:",h)}if(v.localStorage){console.log("Restoring localStorage items...");let h=0;Object.entries(v.localStorage).forEach(([b,x])=>{if(x!==null)try{localStorage.setItem(b,x),h++}catch(i){console.error(`Failed to restore localStorage item ${b}:`,i)}}),console.log(`Restored ${h} localStorage items`)}const de=new Map;if(v.indexedDB){console.log("Restoring IndexedDB data...");try{const h=await ls(),b=async(x,i)=>(console.log(`Restoring ${i.length} items to ${x}...`),new Promise((g,$)=>{try{const L=h.transaction(x,"readwrite").objectStore(x),z=L.clear();z.onsuccess=async()=>{try{for(const S of i){let F,c;if("value"in S){const C=S;c=C.key,F={...C.value}}else{const C=S;F={...C},C.name&&typeof C.name=="string"&&(c=C.name)}for(const C of Object.keys(F))if(C.startsWith("_isBlob_")){const I=C.substring(8);F[I]&&typeof F[I]=="string"&&(F[I]=Fa(F[I])),delete F[C]}if(!c){console.warn(`[Restore] Skipping item without a valid key in ${x}:`,F);continue}await new Promise((C,I)=>{const w=L.put(F,c);w.onsuccess=()=>C(),w.onerror=()=>{console.error(`Error adding item to ${x} with key ${c}:`,w.error),I(w.error)}})}g()}catch(S){$(S)}},z.onerror=()=>$(z.error)}catch(X){console.error(`Error accessing store ${x}:`,X),g()}}));v.indexedDB.documents&&await b("documents",v.indexedDB.documents),v.indexedDB.images&&await b("images",v.indexedDB.images),v.indexedDB.trash&&await b("trash",v.indexedDB.trash),v.indexedDB.custom_wallpapers&&await b("custom_wallpapers",v.indexedDB.custom_wallpapers),v.indexedDB.applets&&await b("applets",v.indexedDB.applets),h.close()}catch(h){console.error("Error restoring IndexedDB:",h),alert("Failed to restore file system data. Only settings were restored.")}try{const h=await ls(),b="ryos:files";let x=localStorage.getItem(b);if(!x){const $=h.transaction("documents","readonly").objectStore("documents").count(),z=h.transaction("images","readonly").objectStore("images").count(),[S,F]=await Promise.all([new Promise(I=>{$.onsuccess=()=>I($.result),$.onerror=()=>I(0)}),new Promise(I=>{z.onsuccess=()=>I(z.result),z.onerror=()=>I(0)})]),c=S>0||F>0,C={state:{items:{},libraryState:c?"loaded":"uninitialized"},version:5};localStorage.setItem(b,JSON.stringify(C)),x=localStorage.getItem(b),console.log(`[Restore] Created files store with libraryState: ${C.state.libraryState}, docs: ${S}, images: ${F}`)}if(x){const i=JSON.parse(x);if(i&&i.state){const g=i.state.items||{};let $=!1;const X=(c,C,I,w,te)=>{let q=te;g[c]&&(q=q||g[c].uuid),q||(q=ua()),g[c]?g[c].uuid||(g[c].uuid=q,$=!0,console.log(`[Restore] Added UUID ${q} to existing metadata for ${c}`)):(g[c]={path:c,name:C,isDirectory:!1,type:I,icon:w,status:"active",uuid:q},$=!0,console.log(`[Restore] Created metadata for ${c} with UUID ${q}`)),q&&de.set(C,q)},L=[{path:"/",name:"/",type:"directory",icon:void 0},{path:"/Documents",name:"Documents",type:"directory",icon:"/icons/default/documents.png"},{path:"/Images",name:"Images",type:"directory",icon:"/icons/default/images.png"},{path:"/Applications",name:"Applications",type:"directory-virtual",icon:"/icons/default/applications.png"},{path:"/Music",name:"Music",type:"directory-virtual",icon:"/icons/default/sounds.png"},{path:"/Videos",name:"Videos",type:"directory-virtual",icon:"/icons/default/movies.png"},{path:"/Sites",name:"Sites",type:"directory-virtual",icon:"/icons/default/sites.png"},{path:"/Applets",name:"Applets",type:"directory",icon:"/icons/default/applets.png"},{path:"/Desktop",name:"Desktop",type:"directory",icon:"/icons/default/desktop.png"},{path:"/Trash",name:"Trash",type:"directory",icon:"/icons/default/trash-empty.png"}];for(const c of L)g[c.path]||(g[c.path]={path:c.path,name:c.name,isDirectory:!0,type:c.type,icon:c.icon,status:"active"},$=!0,console.log(`[Restore] Created missing directory: ${c.path}`));await new Promise(c=>{const w=h.transaction("documents","readonly").objectStore("documents").openCursor();let te=0;w.onsuccess=q=>{const G=q.target.result;if(G){const we=G.key,ae=G.value;if(ae.name){const ue=`/Documents/${ae.name}`,ns=ae.name.endsWith(".md")?"markdown":"text";X(ue,ae.name,ns,"/icons/default/file-text.png",we),te++}G.continue()}else console.log(`[Restore] Found ${te} documents in IndexedDB`),c()},w.onerror=()=>{console.warn("[Restore] Failed to scan documents store"),c()}}),await new Promise(c=>{const w=h.transaction("images","readonly").objectStore("images").openCursor();let te=0;w.onsuccess=q=>{var we;const G=q.target.result;if(G){const ae=G.key,ue=G.value;if(ue.name){const ns=`/Images/${ue.name}`,Ft=((we=ue.name.split(".").pop())==null?void 0:we.toLowerCase())||"png";X(ns,ue.name,Ft,"/icons/default/image.png",ae),te++}G.continue()}else console.log(`[Restore] Found ${te} images in IndexedDB`),c()},w.onerror=()=>{console.warn("[Restore] Failed to scan images store"),c()}}),await new Promise(c=>{const w=h.transaction("applets","readonly").objectStore("applets").openCursor();let te=0;w.onsuccess=q=>{const G=q.target.result;if(G){const we=G.key,ae=G.value;if(ae.name){const ue=`/Applets/${ae.name}`;X(ue,ae.name,"html","/icons/default/app.png",we),te++}G.continue()}else console.log(`[Restore] Found ${te} applets in IndexedDB`),c()},w.onerror=()=>{console.warn("[Restore] Failed to scan applets store"),c()}});const z=Object.keys(g).some(c=>!g[c].isDirectory),S=i.state.libraryState;(!S||S==="uninitialized"&&z)&&(i.state.libraryState="loaded",$=!0,console.log(`[Restore] Setting libraryState to "loaded" (was: ${S}, hasFiles: ${z})`)),(!i.version||i.version<5)&&(i.version=5,$=!0),($||!S)&&(i.state.items=g,localStorage.setItem(b,JSON.stringify(i)),console.log(`[Restore] Updated files store with ${Object.keys(g).length} items, libraryState: ${i.state.libraryState}`));const F=Object.keys(g).filter(c=>!g[c].isDirectory).length;console.log(`[ControlPanels] Synchronized files store: ${F} files, libraryState: ${i.state.libraryState}`)}}if(ce&&de.size>0){console.log(`[Restore] Migrating ${de.size} files from filename to UUID keys...`);const g=h.transaction("documents","readwrite").objectStore("documents");for(const[L,z]of de)try{const S=g.get(L);await new Promise(F=>{S.onsuccess=async()=>{const c=S.result;c&&(await new Promise((C,I)=>{const w=g.put(c,z);w.onsuccess=()=>C(),w.onerror=()=>I(w.error)}),await new Promise((C,I)=>{const w=g.delete(L);w.onsuccess=()=>C(),w.onerror=()=>I(w.error)}),console.log(`[Restore] Migrated document ${L} to UUID ${z}`)),F()},S.onerror=()=>F()})}catch(S){console.error(`[Restore] Failed to migrate document ${L}:`,S)}const X=h.transaction("images","readwrite").objectStore("images");for(const[L,z]of de)try{const S=X.get(L);await new Promise(F=>{S.onsuccess=async()=>{const c=S.result;c&&(await new Promise((C,I)=>{const w=X.put(c,z);w.onsuccess=()=>C(),w.onerror=()=>I(w.error)}),await new Promise((C,I)=>{const w=X.delete(L);w.onsuccess=()=>C(),w.onerror=()=>I(w.error)}),console.log(`[Restore] Migrated image ${L} to UUID ${z}`)),F()},S.onerror=()=>F()})}catch(S){console.error(`[Restore] Failed to migrate image ${L}:`,S)}localStorage.setItem("ryos:indexeddb-uuid-migration-v1","completed"),console.log("[Restore] UUID migration completed during restore")}h.close()}catch(h){console.error("[ControlPanels] Failed to synchronize files store with IndexedDB after restore:",h);try{const b="ryos:files",x=localStorage.getItem(b);if(x){const i=JSON.parse(x);if(i&&i.state){const g=i.state.items&&Object.keys(i.state.items).length>0;i.state.libraryState=g?"loaded":"uninitialized",i.version=5,localStorage.setItem(b,JSON.stringify(i)),console.log(`[ControlPanels] Emergency: Set libraryState to ${i.state.libraryState} to handle restore properly`)}}else{const i={state:{items:{},libraryState:"loaded"},version:5};localStorage.setItem(b,JSON.stringify(i)),console.log("[ControlPanels] Emergency: Created files store with libraryState: loaded")}}catch(b){console.error("[ControlPanels] Emergency fallback failed:",b)}}}Ve(t("common.system.restoringSystem")),window.location.reload()}catch(K){console.error("Backup restore failed:",K);let v="Failed to restore backup: ";K instanceof Error?v+=K.message:typeof K=="string"?v+=K:v+="Unknown error occurred",alert(v),ma()}},s.name.endsWith(".gz")?A.readAsArrayBuffer(s):A.readAsText(s),me.current=null},Ut=async()=>{Js("/wallpapers/photos/aqua/water.jpg"),await he(),Fs(),Ve(t("common.system.formattingFileSystem")),window.location.reload()},At=()=>{B(!1),Ve(t("common.system.formattingFileSystem")),Ut()},as=xe==="xp"||xe==="win98",Es=xe==="macosx",$t=Es||xe==="system7",Is=as,ee=ga(xe),Ts=e.jsx(Ta,{onClose:o,onShowHelp:()=>r(!0),onShowAbout:()=>D(!0)});return d?e.jsxs(e.Fragment,{children:[!as&&k&&Ts,e.jsxs(sa,{title:ta("control-panels"),onClose:o,isForeground:k,appId:"control-panels",skipInitialSound:m,instanceId:T,onNavigateNext:N,onNavigatePrevious:O,menuBar:as?Ts:void 0,children:[e.jsx("div",{className:`flex flex-col h-full w-full ${Is?"pt-0 pb-2 px-2":""} ${$t?Es?"p-4 pt-2":"p-4 bg-[#E3E3E3]":""}`,children:e.jsxs(aa,{defaultValue:(y==null?void 0:y.defaultTab)||"appearance",className:"w-full h-full",children:[Is?e.jsx(Us,{asChild:!0,children:e.jsxs("menu",{role:"tablist",className:"h-7! flex justify-start! p-0 -mt-1 -mb-[2px] bg-transparent shadow-none /* Windows XP/98 tab strip */",children:[e.jsx(Se,{value:"appearance",children:t("apps.control-panels.appearance")}),e.jsx(Se,{value:"sound",children:t("apps.control-panels.sound")}),e.jsx(Se,{value:"system",children:t("apps.control-panels.system")})]})}):e.jsxs(Us,{className:ee.tabListClasses,children:[e.jsx(Se,{value:"appearance",className:ee.tabTriggerClasses,children:t("apps.control-panels.appearance")}),e.jsx(Se,{value:"sound",className:ee.tabTriggerClasses,children:t("apps.control-panels.sound")}),e.jsx(Se,{value:"system",className:ee.tabTriggerClasses,children:t("apps.control-panels.system")})]}),e.jsx(os,{value:"appearance",className:ee.tabContentClasses,children:e.jsxs("div",{className:"space-y-4 h-full overflow-y-auto p-4 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.theme")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.themeDescription")})]}),e.jsxs(ne,{value:xe,onValueChange:s=>Ks(s),children:[e.jsx(oe,{className:"w-[120px] flex-shrink-0",children:e.jsx(re,{placeholder:t("apps.control-panels.select"),children:((Rs=As[xe])==null?void 0:Rs.name)||t("apps.control-panels.select")})}),e.jsx(le,{children:Object.entries(As).map(([s,A])=>e.jsx(f,{value:s,children:A.name},s))})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("settings.language.title")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("settings.language.description")})]}),e.jsxs(ne,{value:se,onValueChange:s=>Xs(s),children:[e.jsx(oe,{className:"w-[120px] flex-shrink-0",children:e.jsx(re,{children:t(`settings.language.${se==="zh-TW"?"chineseTraditional":se==="ja"?"japanese":se==="ko"?"korean":se==="es"?"spanish":se==="fr"?"french":se==="de"?"german":se==="pt"?"portuguese":se==="it"?"italian":se==="ru"?"russian":"english"}`)})}),e.jsxs(le,{children:[e.jsx(f,{value:"en",children:t("settings.language.english")}),e.jsx(f,{value:"zh-TW",children:t("settings.language.chineseTraditional")}),e.jsx(f,{value:"ja",children:t("settings.language.japanese")}),e.jsx(f,{value:"ko",children:t("settings.language.korean")}),e.jsx(f,{value:"es",children:t("settings.language.spanish")}),e.jsx(f,{value:"fr",children:t("settings.language.french")}),e.jsx(f,{value:"de",children:t("settings.language.german")}),e.jsx(f,{value:"pt",children:t("settings.language.portuguese")}),e.jsx(f,{value:"it",children:t("settings.language.italian")}),e.jsx(f,{value:"ru",children:t("settings.language.russian")})]})]})]}),e.jsx(Ma,{}),e.jsx("div",{className:"border-t my-4",style:ee.separatorStyle}),e.jsx(Oa,{})]})}),e.jsx(os,{value:"sound",className:ee.tabContentClasses,children:e.jsxs("div",{className:"space-y-4 h-full overflow-y-auto p-4 pt-6",children:[e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:t("apps.control-panels.uiSounds")}),e.jsx(ye,{checked:a,onCheckedChange:St,className:"data-[state=checked]:bg-[#000000]"})]})}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:t("apps.control-panels.speech")}),e.jsx(ye,{checked:pe,onCheckedChange:Ct,className:"data-[state=checked]:bg-[#000000]"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex flex-col gap-1",children:e.jsx(R,{children:t("apps.control-panels.terminalIeAmbientSynth")})}),e.jsx(ye,{checked:Ye,onCheckedChange:Je,className:"data-[state=checked]:bg-[#000000]"})]}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{children:t("apps.control-panels.chatSynth")}),e.jsxs(ne,{value:Hs,onValueChange:kt,children:[e.jsx(oe,{className:"w-[120px]",children:e.jsx(re,{placeholder:t("apps.control-panels.selectAPreset")})}),e.jsx(le,{children:Object.entries(xa).map(([s,A])=>e.jsx(f,{value:s,children:A.name},s))})]})]})}),e.jsx("hr",{className:"my-3 border-t",style:ee.separatorStyle}),e.jsx(Ua,{masterVolume:Ee,setMasterVolume:Ze,setPrevMasterVolume:Ss,handleMasterMuteToggle:Nt,uiVolume:W,setUiVolume:Z,setPrevUiVolume:Cs,handleUiMuteToggle:_t,speechVolume:Ne,setSpeechVolume:Xe,setPrevSpeechVolume:ks,handleSpeechMuteToggle:Dt,chatSynthVolume:fe,setChatSynthVolume:Ke,setPrevChatSynthVolume:Ns,handleChatSynthMuteToggle:Et,ipodVolume:De,setIpodVolume:Ge,setPrevIpodVolume:_s,handleIpodMuteToggle:It,isIOS:Ds})]})}),e.jsx(os,{value:"system",className:ee.tabContentClasses,children:e.jsxs("div",{className:"space-y-4 h-full overflow-y-auto p-4",children:[e.jsx("div",{className:"space-y-2",children:Ae?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-[13px] font-geneva-12 font-medium",children:["@",Ae]}),e.jsx("span",{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.loggedInToRyOS")})]}),e.jsxs("div",{className:"flex gap-2",children:[V&&e.jsx(H,{variant:"retro",onClick:rt,className:"h-7",children:t("apps.control-panels.logIn")}),Te===!1?e.jsx(H,{variant:"retro",onClick:()=>{Fe(""),ve(null),$e(!0)},className:"h-7",children:t("apps.control-panels.setPassword")}):e.jsx(H,{variant:"retro",onClick:ct,className:"h-7",children:t("apps.control-panels.logOut")})]})]}),V&&e.jsx("div",{className:"flex",children:e.jsx(H,{variant:"retro",onClick:xt,disabled:bs,className:"w-full",children:t(bs?"apps.control-panels.loggingOut":"apps.control-panels.logOutOfAllDevices")})})]}):e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[13px] font-geneva-12 font-medium",children:t("apps.control-panels.ryOSAccount")}),e.jsx("span",{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.loginToSendMessages")})]}),e.jsx(H,{variant:"retro",onClick:gs,className:"h-7",children:t("apps.control-panels.login")})]})})}),e.jsx("hr",{className:"my-4 border-t",style:ee.separatorStyle}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{variant:"retro",onClick:()=>{na()},className:"w-full",children:t("apps.control-panels.checkForUpdates")}),e.jsx(Ba,{})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{variant:"retro",onClick:Pt,className:"flex-1",children:t("apps.control-panels.backup")}),e.jsx(H,{variant:"retro",onClick:()=>{var s;return(s=Y.current)==null?void 0:s.click()},className:"flex-1",children:t("apps.control-panels.restore")}),e.jsx("input",{type:"file",ref:Y,onChange:Vt,accept:".json,.gz",className:"hidden"})]}),e.jsx("p",{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.backupRestoreDescription")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{variant:"retro",onClick:Tt,className:"w-full",children:t("apps.control-panels.resetAllSettings")}),e.jsx("p",{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.resetAllSettingsDescription")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{variant:"retro",onClick:()=>{B(!0)},className:"w-full",children:t("apps.control-panels.formatFileSystem")}),e.jsx("p",{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.formatFileSystemDescription")})]}),e.jsx("hr",{className:"my-4 border-t",style:ee.separatorStyle}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.debugMode")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.debugModeDescription")})]}),e.jsx(ye,{checked:V,onCheckedChange:ie,className:"data-[state=checked]:bg-[#000000]"})]}),V&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.shaderEffect")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.shaderEffectDescription")})]}),e.jsx(ye,{checked:M,onCheckedChange:E,className:"data-[state=checked]:bg-[#000000]"})]}),V&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.aiModel")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.aiModelDescription")})]}),e.jsxs(ne,{value:ge||"__null__",onValueChange:s=>He(s==="__null__"?null:s),children:[e.jsx(oe,{className:"w-[120px]",children:e.jsx(re,{placeholder:t("apps.control-panels.select"),children:ge||t("apps.control-panels.select")})}),e.jsxs(le,{children:[e.jsx(f,{value:"__null__",children:t("apps.control-panels.default")}),Aa.map(s=>e.jsx(f,{value:s.id,children:s.name},s.id))]})]})]}),V&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.ttsModel")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.ttsModelDescription")})]}),e.jsxs(ne,{value:_e||"__null__",onValueChange:s=>qs(s==="__null__"?null:s),children:[e.jsx(oe,{className:"w-[120px]",children:e.jsx(re,{placeholder:t("apps.control-panels.select"),children:_e||t("apps.control-panels.select")})}),e.jsxs(le,{children:[e.jsx(f,{value:"__null__",children:t("apps.control-panels.default")}),e.jsx(f,{value:"openai",children:t("apps.control-panels.openai")}),e.jsx(f,{value:"elevenlabs",children:t("apps.control-panels.elevenlabs")})]})]})]}),V&&_e&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.ttsVoice")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t(_e==="elevenlabs"?"apps.control-panels.elevenlabsVoiceId":"apps.control-panels.openaiVoice")})]}),_e==="elevenlabs"?e.jsxs(ne,{value:je||"__null__",onValueChange:s=>ms(s==="__null__"?null:s),children:[e.jsx(oe,{className:"w-[120px]",children:e.jsx(re,{placeholder:t("apps.control-panels.select"),children:je==="YC3iw27qriLq7UUaqAyi"?"Ryo v3":je==="kAyjEabBEu68HYYYRAHR"?"Ryo v2":je==="G0mlS0y8ByHjGAOxBgvV"?"Ryo":t("apps.control-panels.select")})}),e.jsxs(le,{children:[e.jsx(f,{value:"__null__",children:t("apps.control-panels.select")}),e.jsx(f,{value:"YC3iw27qriLq7UUaqAyi",children:"Ryo v3"}),e.jsx(f,{value:"kAyjEabBEu68HYYYRAHR",children:"Ryo v2"}),e.jsx(f,{value:"G0mlS0y8ByHjGAOxBgvV",children:"Ryo"})]})]}):e.jsxs(ne,{value:je||"__null__",onValueChange:s=>ms(s==="__null__"?null:s),children:[e.jsx(oe,{className:"w-[120px]",children:e.jsx(re,{placeholder:t("apps.control-panels.select"),children:je||t("apps.control-panels.select")})}),e.jsxs(le,{children:[e.jsx(f,{value:"__null__",children:t("apps.control-panels.select")}),e.jsx(f,{value:"alloy",children:"Alloy"}),e.jsx(f,{value:"echo",children:"Echo"}),e.jsx(f,{value:"fable",children:"Fable"}),e.jsx(f,{value:"onyx",children:"Onyx"}),e.jsx(f,{value:"nova",children:"Nova"}),e.jsx(f,{value:"shimmer",children:"Shimmer"})]})]})]}),V&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(R,{children:t("apps.control-panels.bootScreen")}),e.jsx(R,{className:"text-[11px] text-gray-600 font-geneva-12",children:t("apps.control-panels.bootScreenDescription")})]}),e.jsx(H,{variant:"retro",onClick:()=>{Ve(t("common.system.debugBootScreenTest")),window.location.reload()},className:"w-fit",children:t("apps.control-panels.show")})]})]})})]})}),e.jsx(ra,{isOpen:n,onOpenChange:r,helpItems:_,appId:"control-panels"}),e.jsx(la,{isOpen:u,onOpenChange:D,metadata:ia,appId:"control-panels"}),e.jsx($s,{isOpen:Q,onOpenChange:l,onConfirm:Rt,title:t("common.system.resetAllSettings"),description:t("common.system.resetAllSettingsDesc")}),e.jsx($s,{isOpen:j,onOpenChange:B,onConfirm:At,title:t("common.system.formatFileSystem"),description:t("common.system.formatFileSystemDesc")}),e.jsx(Bs,{initialTab:"signup",isOpen:Gs,onOpenChange:Zs,usernameInput:es,onUsernameInputChange:ss,passwordInput:Ie,onPasswordInputChange:Qe,onLoginSubmit:async()=>{await vs(Ie,!0)},isLoginLoading:ys,loginError:js,newUsername:Qs,onNewUsernameChange:et,newPassword:st,onNewPasswordChange:tt,onSignUpSubmit:ot,isSignUpLoading:at,signUpError:nt}),e.jsx(Bs,{isOpen:lt,onOpenChange:fs,usernameInput:es,onUsernameInputChange:ss,passwordInput:Ie,onPasswordInputChange:Qe,onLoginSubmit:async()=>{await vs(Ie,!0)},isLoginLoading:ys,loginError:js,newUsername:es,onNewUsernameChange:ss,newPassword:Ie,onNewPasswordChange:Qe,onSignUpSubmit:async()=>{fs(!1),gs()},isSignUpLoading:!1,signUpError:null}),e.jsx(ca,{isOpen:ut,onOpenChange:$e,onSubmit:ft,title:"Set Password",description:"Set a password to enable account recovery. You can use this password to get a new token if you lose access.",value:mt,onChange:s=>{Fe(s),ve(null)},isLoading:ht,errorMessage:gt,submitLabel:"Set Password"}),e.jsx(ya,{isOpen:dt,onOpenChange:pt,onConfirm:xs,hasPassword:Te,onSetPassword:()=>{Fe(""),ve(null),$e(!0)}})]})]}):null}export{cn as ControlPanelsAppComponent};
