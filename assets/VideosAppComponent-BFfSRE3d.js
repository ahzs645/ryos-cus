import{r as a,j as e}from"./ui-core-D0pDhx0h.js";import{R as Lt}from"./index-B2E7WcJr.js";import{u as at,a as nt,M as Ft,b as ce,d as de,e as ue,f as E,g as ee,k as we,h as Je,i as Ke,j as Ze,a4 as $,S as it,l as qt,m as Ht,E as Bt,n as Qe,o as et,aH as I,Y as tt,am as pe,Z as Ut,aD as _t,B as H,H as Xt,J as zt,bi as Yt,G as st,bj as fe,I as Gt,bk as Wt,a0 as Jt}from"./index-BxS3VOwZ.js";import{m as K,A as he}from"./motion-DC7C-474.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";function Kt({onClose:l,onShowHelp:S,onShowAbout:f,videos:h,currentVideoId:c,onPlayVideo:d,onClearPlaylist:P,onShufflePlaylist:L,onToggleLoopAll:s,onToggleLoopCurrent:o,onTogglePlay:v,onNext:w,onPrevious:i,onAddVideo:F,onOpenVideo:V,onResetPlaylist:_,isLoopAll:D,isLoopCurrent:O,isPlaying:x,isShuffled:g,onFullScreen:B,onShareVideo:C}){var R;const{t:u}=at(),[M,Y]=a.useState(!1),m="videos",te=(R=Ht[m])==null?void 0:R.name,j=nt(p=>p.current),b=j==="xp"||j==="win98",N=h.reduce((p,q)=>{const se=q.artist||u("apps.videos.menu.unknownArtist");return p[se]||(p[se]=[]),p[se].push(q),p},{}),A=Object.keys(N).sort();return e.jsxs(Ft,{inWindowFrame:b,children:[e.jsxs(ce,{children:[e.jsx(de,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:u("common.menu.file")}),e.jsxs(ue,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(E,{onClick:V,className:"text-md h-6 px-3",children:u("apps.videos.menu.openVideo")}),e.jsx(E,{onClick:C,className:"text-md h-6 px-3",disabled:h.length===0,children:u("apps.videos.menu.shareVideo")}),e.jsx(ee,{className:"h-[2px] bg-black my-1"}),e.jsx(E,{onClick:l,className:"text-md h-6 px-3",children:u("common.menu.close")})]})]}),e.jsxs(ce,{children:[e.jsx(de,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("apps.videos.menu.controls")}),e.jsxs(ue,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(E,{onClick:v,className:"text-md h-6 px-3",disabled:h.length===0,children:u(x?"apps.videos.menu.pause":"apps.videos.menu.play")}),e.jsx(E,{onClick:i,className:"text-md h-6 px-3",disabled:h.length===0,children:u("apps.videos.menu.previous")}),e.jsx(E,{onClick:w,className:"text-md h-6 px-3",disabled:h.length===0,children:u("apps.videos.menu.next")}),e.jsx(ee,{className:"h-[2px] bg-black my-1"}),e.jsx(E,{onClick:B,className:"text-md h-6 px-3",children:u("apps.videos.menu.fullScreen")}),e.jsx(ee,{className:"h-[2px] bg-black my-1"}),e.jsx(we,{checked:g,onCheckedChange:p=>{p!==g&&L()},className:"text-md h-6 px-3",children:u("apps.videos.menu.shuffle")}),e.jsx(we,{checked:D,onCheckedChange:p=>{p!==D&&s()},className:"text-md h-6 px-3",children:u("apps.videos.menu.repeatAll")}),e.jsx(we,{checked:O,onCheckedChange:p=>{p!==O&&o()},className:"text-md h-6 px-3",children:u("apps.videos.menu.repeatOne")})]})]}),e.jsxs(ce,{children:[e.jsx(de,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("apps.videos.menu.library")}),e.jsxs(ue,{align:"start",sideOffset:1,className:"px-0 max-w-[180px] sm:max-w-[220px]",children:[e.jsx(E,{onClick:F,className:"text-md h-6 px-3",children:u("apps.videos.menu.addToLibrary")}),h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-[2px] bg-black my-1"}),e.jsxs(Je,{children:[e.jsx(Ke,{className:"text-md h-6 px-3",children:e.jsx("div",{className:"flex justify-between w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate min-w-0",children:u("apps.videos.menu.allVideos")})})}),e.jsx(Ze,{className:"px-0 max-w-[180px] sm:max-w-[220px]",children:h.map(p=>e.jsx(E,{onClick:()=>d(p.id),className:$("text-md h-6 px-3 max-w-[220px] truncate",p.id===c&&"bg-gray-200"),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:$("flex-none whitespace-nowrap",p.id===c?"mr-1":"pl-5"),children:p.id===c?"♪ ":""}),e.jsx("span",{className:"truncate min-w-0",children:p.title})]})},`all-${p.id}`))})]}),A.map(p=>e.jsxs(Je,{children:[e.jsx(Ke,{className:"text-md h-6 px-3",children:e.jsx("div",{className:"flex justify-between w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate min-w-0",children:p})})}),e.jsx(Ze,{className:"px-0 max-w-[180px] sm:max-w-[220px]",children:N[p].map(q=>e.jsx(E,{onClick:()=>d(q.id),className:$("text-md h-6 px-3 max-w-[160px] sm:max-w-[200px] truncate",q.id===c&&"bg-gray-200"),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:$("flex-none whitespace-nowrap",q.id===c?"mr-1":"pl-5"),children:q.id===c?"♪ ":""}),e.jsx("span",{className:"truncate min-w-0",children:q.title})]})},`${p}-${q.id}`))})]},p)),e.jsx(ee,{className:"h-[2px] bg-black my-1"})]}),e.jsx(E,{onClick:P,className:"text-md h-6 px-3",children:u("apps.videos.menu.clearLibrary")}),e.jsx(E,{onClick:_,className:"text-md h-6 px-3",children:u("apps.videos.menu.resetLibrary")})]})]}),e.jsxs(ce,{children:[e.jsx(de,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("common.menu.help")}),e.jsxs(ue,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(E,{onClick:S,className:"text-md h-6 px-3",children:u("apps.videos.menu.videosHelp")}),e.jsx(E,{onSelect:()=>Y(!0),className:"text-md h-6 px-3",children:u("common.menu.shareApp")}),e.jsx(ee,{className:"h-[2px] bg-black my-1"}),e.jsx(E,{onClick:f,className:"text-md h-6 px-3",children:u("apps.videos.menu.aboutVideos")})]})]}),e.jsx(it,{isOpen:M,onClose:()=>Y(!1),itemType:"App",itemIdentifier:m,title:te,generateShareUrl:qt})]})}function Zt({duration:l,currentTime:S,onSeek:f,isPlaying:h,isHovered:c,onDragChange:d,autoDismissTimeout:P=3e3}){const[L,s]=a.useState(!1),[o,v]=a.useState(!1),[w,i]=a.useState(0),[F,V]=a.useState(!1),_=a.useRef(null),D=a.useRef(null),O=S/l*100;a.useEffect(()=>{o||i(O)},[S,l,o,O]);const x=a.useCallback(()=>{D.current&&clearTimeout(D.current),h&&!o&&(D.current=setTimeout(()=>{V(!1)},P))},[h,o,P]),g=a.useCallback(()=>{D.current&&(clearTimeout(D.current),D.current=null)},[]),B=a.useCallback(()=>{V(!0),g(),x()},[g,x]);a.useEffect(()=>{h&&(c||L||o)?(V(!0),g(),o||x()):h||(V(!1),g())},[h,c,L,o,g,x]),a.useEffect(()=>{F&&!o&&h&&(g(),x())},[F,o,h,g,x]),a.useEffect(()=>()=>{g()},[g]);const C=a.useCallback(b=>{if(!_.current)return 0;const N=_.current.getBoundingClientRect(),A=(b-N.left)/N.width*100;return Math.max(0,Math.min(100,A))},[]),u=b=>{if(!o)return;const N=C(b.clientX);i(N)},M=b=>{b.stopPropagation(),v(!0),B();const N=C(b.clientX);if(i(N),d){const A=N/100*l;d(!0,A)}},Y=a.useCallback(()=>{o&&(f(w/100*l),v(!1),d&&d(!1),x())},[o,f,w,l,d,x]),m=b=>{b.preventDefault(),b.stopPropagation(),v(!0),B();const N=b.touches[0],A=C(N.clientX);if(i(A),d){const R=A/100*l;d(!0,R)}},te=b=>{if(!o)return;b.preventDefault();const N=b.touches[0],A=C(N.clientX);if(i(A),d){const R=A/100*l;d(!0,R)}},j=()=>{o&&(f(w/100*l),v(!1),d&&d(!1),x())};return a.useEffect(()=>{if(o){const b=()=>{Y()},N=A=>{if(!o)return;const R=C(A.clientX);if(i(R),d){const p=R/100*l;d(!0,p)}};return document.addEventListener("mouseup",b),document.addEventListener("mousemove",N),()=>{document.removeEventListener("mouseup",b),document.removeEventListener("mousemove",N)}}},[o,l,f,d,C,Y]),h?e.jsx(K.div,{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent h-48 pointer-events-none",initial:{opacity:0,y:20},animate:{opacity:F?1:0,y:F?0:20},transition:{duration:.2,ease:"easeOut"},onMouseEnter:()=>{s(!0),B()},onMouseLeave:()=>{s(!1),o||x()},children:e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-4 py-3",children:e.jsx("div",{ref:_,className:`relative h-[8px] rounded-full cursor-pointer pointer-events-auto overflow-hidden transition-all duration-150 ${o?"border border-white/80 bg-white/25":"border border-white/50 bg-white/15"}`,onMouseDown:M,onMouseMove:o?void 0:u,onTouchStart:m,onTouchMove:te,onTouchEnd:j,style:{touchAction:"none"},children:e.jsx("div",{className:`absolute left-0 top-0 h-full transition-colors duration-150 ${o?"bg-white/80":"bg-white/50"}`,style:{width:`${o?w:O}%`}})})})}):null}function Qt({digit:l,direction:S}){const f=S==="next"?30:-30;return e.jsx("div",{className:"relative w-[0.6em] h-[28px] overflow-hidden inline-block",children:e.jsx(he,{mode:"popLayout",initial:!1,children:e.jsx(K.div,{initial:{y:f,opacity:0},animate:{y:0,opacity:1},exit:{y:f,opacity:0},transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},className:"absolute inset-0 flex justify-center",children:l},l)})})}function es({number:l}){const[S,f]=a.useState(l),h=l>S?"next":"prev";a.useEffect(()=>{f(l)},[l]);const c=String(l).padStart(2,"0").split("");return e.jsx("div",{className:"flex",children:c.map((d,P)=>e.jsx(Qt,{digit:d,direction:h},P))})}function ts({title:l,direction:S,isPlaying:f}){const h=S==="next"?30:-30;return e.jsx("div",{className:"relative h-[22px] mb-[3px] overflow-hidden",children:e.jsx(he,{mode:"popLayout",initial:!1,children:e.jsxs(K.div,{initial:{y:h,opacity:0},animate:{y:0,opacity:1},exit:{y:h,opacity:0},transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},className:"absolute inset-0 flex whitespace-nowrap",children:[e.jsx(K.div,{initial:{x:"0%"},animate:{x:f?"-100%":"0%"},transition:f?{duration:20,ease:"linear",repeat:1/0,repeatType:"loop"}:{duration:.3},className:$("shrink-0 font-geneva-12 text-xl px-2 transition-colors duration-300 -mt-1 animated-title-text",f?"text-[#ff00ff]":"text-gray-600",!f&&"opacity-50"),children:l}),e.jsx(K.div,{initial:{x:"0%"},animate:{x:f?"-100%":"0%"},transition:f?{duration:20,ease:"linear",repeat:1/0,repeatType:"loop"}:{duration:.3},className:$("shrink-0 font-geneva-12 text-xl px-2 transition-colors duration-300 -mt-1 animated-title-text",f?"text-[#ff00ff]":"text-gray-600",!f&&"opacity-50"),"aria-hidden":!0,children:l})]},l)})})}function ss(){const l=a.useRef(null),S=a.useRef(null),[f,h]=a.useState(0);return a.useEffect(()=>{const c=l.current;if(!c)return;const d=c.getContext("2d");if(!d)return;const P=()=>{const s=d.createImageData(c.width,c.height),o=s.data;for(let v=0;v<o.length;v+=4){const w=Math.random()*255*f;o[v]=w,o[v+1]=w,o[v+2]=w,o[v+3]=255}for(let v=0;v<c.height;v+=2)for(let w=0;w<c.width;w++){const i=(v*c.width+w)*4;o[i]*=.8,o[i+1]*=.8,o[i+2]*=.8}d.putImageData(s,0,0),S.current=requestAnimationFrame(P)},L=()=>{c.width=c.offsetWidth,c.height=c.offsetHeight};return L(),window.addEventListener("resize",L),P(),()=>{window.removeEventListener("resize",L),S.current!==null&&(cancelAnimationFrame(S.current),S.current=null)}},[f]),a.useEffect(()=>{const d=Date.now(),P=f,L=1,s=()=>{const o=Date.now()-d,v=Math.min(o/1e3,1),w=1-Math.pow(1-v,3);h(P+(L-P)*w),v<1&&requestAnimationFrame(s)};s()},[]),e.jsx("canvas",{ref:l,className:"pointer-events-none",style:{position:"absolute",top:0,left:0,right:"-1px",bottom:"-1px",width:"calc(100% + 1px)",height:"calc(100% + 1px)"}})}function as({message:l}){return e.jsxs("div",{className:"relative videos-status",children:[e.jsx("div",{className:"font-geneva-12 text-white text-xl relative z-10",children:l}),e.jsx("div",{className:"font-geneva-12 text-black text-xl absolute inset-0",style:{WebkitTextStroke:"3px black",textShadow:"none"},children:l})]})}function gs({isWindowOpen:l,onClose:S,isForeground:f,skipInitialSound:h,initialData:c,instanceId:d,onNavigateNext:P,onNavigatePrevious:L}){var qe,He,Be,Ue,_e,Xe,ze,Ye;const{t:s}=at(),o=Bt("videos",Wt),{play:v}=Qe(et.VIDEO_TAPE),{play:w}=Qe(et.BUTTON_CLICK),i=I(t=>t.videos),F=I(t=>t.setVideos),V=I(t=>t.currentVideoId),_=I(t=>t.setCurrentVideoId),D=I(t=>t.getCurrentIndex),O=I(t=>t.getCurrentVideo),x=t=>{const n=I.getState().videos;if(console.log(`[Videos] safeSetCurrentVideoId called with: ${t}. Videos in store: ${n.length}`),!t||n.length===0){const k=n.length>0?n[0].id:null;console.log(`[Videos] No videoId or empty videos, setting to fallback: ${k}`),_(k);return}const r=n.find(k=>k.id===t),y=r?t:n.length>0?n[0].id:null;console.log(`[Videos] Video ${t} ${r?"found":"NOT FOUND"} in store. Setting currentVideoId to: ${y}`),_(y)},g=I(t=>t.loopCurrent),B=I(t=>t.setLoopCurrent),C=I(t=>t.loopAll),u=I(t=>t.setLoopAll),M=I(t=>t.isShuffled),Y=I(t=>t.setIsShuffled),m=I(t=>t.isPlaying),te=I(t=>t.togglePlay),j=I(t=>t.setIsPlaying),[b,N]=a.useState("next"),[A,R]=a.useState(i),[p,q]=a.useState(""),[se,G]=a.useState(!1),[ot,Ne]=a.useState(!1),[rt,Se]=a.useState(!1),[lt,me]=a.useState(!1),[ct,xe]=a.useState(!1),[dt,ke]=a.useState(!1),Z=a.useRef(null),[ut,Ie]=a.useState(0),[Ce,Te]=a.useState(null),W=a.useRef(null),[pt,Ve]=a.useState(!1),[ft,ht]=a.useState(0),[mt,xt]=a.useState(0),[gt,X]=a.useState(!1),[vt,yt]=a.useState(!1),[jt,bt]=a.useState(0),Oe=a.useRef(m),Q=a.useRef(null);a.useEffect(()=>(!Oe.current&&m&&(X(!0),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{X(!1)},150)),Oe.current=m,()=>{Q.current&&(clearTimeout(Q.current),Q.current=null)}),[m]);const U=a.useRef(null),Ae=10,wt=t=>{t.pointerType==="touch"&&(U.current={startX:t.clientX,startY:t.clientY,moved:!1,pointerId:t.pointerId},X(!0))},Nt=t=>{if(t.pointerType!=="touch"||!U.current)return;const n=Math.abs(t.clientX-U.current.startX),r=Math.abs(t.clientY-U.current.startY);!U.current.moved&&(n>Ae||r>Ae)&&(U.current.moved=!0,X(!0))},St=t=>{var n;if(t.pointerType==="touch"){t.preventDefault(),t.stopPropagation();const r=(n=U.current)==null?void 0:n.moved;U.current=null,X(!1),r||ae();return}ae()},kt=()=>{U.current=null,X(!1)},Ee=tt(t=>t.bringToForeground),Pe=tt(t=>t.clearInstanceInitialData),Me=a.useRef(!1),ie=a.useRef(null);a.useEffect(()=>{if(Me.current)return;const t=navigator.userAgent,n=/iP(hone|od|ad)/.test(t),r=/Safari/.test(t)&&!/Chrome/.test(t)&&!/CriOS/.test(t);m&&(n||r)&&j(!1),Me.current=!0},[m,j]),a.useEffect(()=>{i.length>0&&V&&!i.find(t=>t.id===V)?(console.warn(`[Videos] currentVideoId ${V} not found in videos, resetting to first video`),x(i[0].id)):i.length>0&&!V&&x(i[0].id)},[i,V,x]);const T=t=>{Te(t),W.current&&(clearTimeout(W.current),W.current=null),W.current=setTimeout(()=>{Te(null)},2e3)},oe=(t,n)=>{N(n),x(t)},re=()=>{if(i.length===0)return;w();const t=D();t===i.length-1?C&&(T(s("apps.videos.status.repeatingPlaylist")),oe(i[0].id,"next")):(T(s("apps.videos.status.next")),oe(i[t+1].id,"next")),j(!0)},ge=()=>{if(i.length===0)return;w();const t=D();t===0?C&&(T(s("apps.videos.status.repeatingPlaylist")),oe(i[i.length-1].id,"prev")):(T(s("apps.videos.status.prev")),oe(i[t-1].id,"prev")),j(!0)};a.useEffect(()=>{Ie(0)},[V]),a.useEffect(()=>{if(M){const t=[...i].sort(()=>Math.random()-.5);F(t)}else F([...A])},[M]),a.useEffect(()=>{M||R(i)},[i,M]);const It=t=>{const n=Math.floor(t/60),r=t%60;return`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}`},Ct=t=>{const n=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,r=t.match(n);return r&&r[7].length===11?r[7]:null},De=async t=>{ke(!0);try{const n=Ct(t);if(!n)throw new Error("Invalid YouTube URL");const r=await fetch(`https://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=${n}&format=json`);if(!r.ok)throw new Error(`Failed to fetch video info (${r.status}). Please check the YouTube URL.`);const y=await r.json(),k=y.title||`Video ID: ${n}`,je=y.author_name,J={title:k,artist:void 0};try{const ne=await fetch(Jt("/api/parse-title"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:k,author_name:je})});if(ne.ok){const We=await ne.json();J.title=We.title||k,J.artist=We.artist}else console.warn("Failed to parse title with AI, using raw title:",await ne.text())}catch(ne){console.warn("Error calling parse-title API, using raw title:",ne)}const z={id:n,url:t,title:J.title,artist:J.artist},Ge=I.getState().videos,be=[...Ge,z];console.log(`[Videos] Adding video ${z.id} (${z.title}). Videos count: ${Ge.length} -> ${be.length}`),F(be),M||R(be),console.log(`[Videos] Setting current video to newly added: ${z.id}`),x(z.id),j(!0),console.log(`[Videos] Video added successfully. Current video should be: ${z.id}`),T(s("apps.videos.status.videoAdded")),q(""),G(!1)}catch(n){console.error("Failed to add video:",n),T(s("apps.videos.status.errorAdding",{error:n instanceof Error?n.message:s("apps.videos.status.unknownError")})),i.length>0&&x(i[i.length-1].id),j(!1)}finally{ke(!1)}},Re=async t=>{const n=`https://www.youtube.com/watch?v=${t}`;try{await De(n);const r=navigator.userAgent,y=/iP(hone|od|ad)/.test(r),k=/Safari/.test(r)&&!/Chrome/.test(r)&&!/CriOS/.test(r);y&&k&&T(s("apps.videos.status.pressToPlay"))}catch(r){throw console.error(`[Videos] Error adding video for videoId ${t}:`,r),T(s("apps.videos.status.failedToAddVideo")),r}},le=a.useCallback(async t=>{try{if(!t||typeof t!="string"||t.length!==11)throw new Error(`Invalid video ID format: ${t}`);const n=I.getState().videos,r=n.findIndex(z=>z.id===t),y=navigator.userAgent,k=/iP(hone|od|ad)/.test(y),je=/Safari/.test(y)&&!/Chrome/.test(y)&&!/CriOS/.test(y),J=!(k||je);r!==-1?(console.log(`[Videos] Video ID ${t} found in playlist. Playing.`),x(t),J&&j(!0),T(s("apps.videos.status.playing",{title:n[r].title}))):(console.log(`[Videos] Video ID ${t} not found. Adding and playing.`),await Re(t),J||j(!1))}catch(n){throw console.error(`[Videos] Error processing video ID ${t}:`,n),T(s("apps.videos.status.failedToProcessVideo",{videoId:t})),n}},[x,j,Re,T,s]);a.useEffect(()=>{if(l&&(c!=null&&c.videoId)&&typeof c.videoId=="string"){if(ie.current===c.videoId)return;const t=c.videoId;console.log(`[Videos] Processing initialData.videoId on mount: ${t}`),pe.info(e.jsxs(e.Fragment,{children:[s("apps.videos.dialogs.openedSharedVideo")," ",e.jsx("span",{className:"font-chicago",children:"⏯"})," ",s("apps.videos.dialogs.toStartPlaying")]})),le(t).then(()=>{d&&Pe(d),console.log(`[Videos] Successfully processed and cleared initialData for ${t}`)}).catch(n=>{console.error(`[Videos] Error processing initial videoId ${t}:`,n),pe.error(s("apps.videos.dialogs.failedToLoadSharedVideo"),{description:s("apps.videos.dialogs.videoId",{videoId:t})})}),ie.current=c.videoId}},[l,c,le,Pe,d]),a.useEffect(()=>{const t=n=>{var r;if(n.detail.appId==="videos"&&((r=n.detail.initialData)!=null&&r.videoId)){if(ie.current===n.detail.initialData.videoId)return;const y=n.detail.initialData.videoId;console.log(`[Videos] Received updateApp event with videoId: ${y}`),Ee("videos"),pe.info(e.jsxs(e.Fragment,{children:[s("apps.videos.dialogs.openedSharedVideo")," ",e.jsx("span",{className:"font-chicago",children:"⏯"})," ",s("apps.videos.dialogs.toStartPlaying")]})),le(y).catch(k=>{console.error(`[Videos] Error processing videoId ${y} from updateApp event:`,k),pe.error(s("apps.videos.dialogs.failedToLoadSharedVideo"),{description:s("apps.videos.dialogs.videoId",{videoId:y})})}),ie.current=n.detail.initialData.videoId}};return window.addEventListener("updateApp",t),()=>{window.removeEventListener("updateApp",t)}},[le,Ee]);const ae=()=>{te(),T(s(m?"apps.videos.status.paused":"apps.videos.status.play")),v()},ve=()=>{Y(!M),T(s(M?"apps.videos.status.shuffleOff":"apps.videos.status.shuffleOn"))},Tt=()=>{var t;g?((t=Z.current)==null||t.seekTo(0),j(!0)):re()},Vt=t=>{xt(t.playedSeconds),Ie(Math.floor(t.playedSeconds))},Ot=t=>{ht(t)},At=t=>{Z.current&&Z.current.seekTo(t,"seconds")},Et=()=>{j(!0)},Pt=()=>{j(!1)},Mt=()=>{var t;(t=Z.current)==null||t.seekTo(0)},Dt=()=>{var t;try{const n=(t=Z.current)==null?void 0:t.getInternalPlayer();if(n){const k=n.getIframe?n.getIframe():n;if(k&&k.requestFullscreen){k.requestFullscreen(),T(s("apps.videos.status.fullscreen"));return}}const r=document.querySelector(".react-player iframe");if(r&&r.requestFullscreen){r.requestFullscreen(),T(s("apps.videos.status.fullscreen"));return}const y=document.querySelector(".react-player");y&&y.requestFullscreen&&(y.requestFullscreen(),T(s("apps.videos.status.fullscreen")))}catch(n){console.error("Fullscreen error:",n)}},Rt=()=>{i.length>0&&V&&Ve(!0)},$t=t=>`${window.location.origin}/videos/${t}`;a.useEffect(()=>()=>{W.current&&(clearTimeout(W.current),W.current=null)},[]);const ye=nt(t=>t.current),$e=ye==="xp"||ye==="win98",Le=ye==="macosx",Fe=e.jsx(Kt,{onClose:S,onShowHelp:()=>Ne(!0),onShowAbout:()=>Se(!0),videos:i,currentVideoId:V,onPlayVideo:t=>{x(t),j(!0)},onClearPlaylist:()=>{me(!0)},onResetPlaylist:()=>{xe(!0)},onShufflePlaylist:ve,onToggleLoopAll:()=>u(!C),onToggleLoopCurrent:()=>B(!g),onTogglePlay:()=>{ae()},onNext:re,onPrevious:ge,onAddVideo:()=>G(!0),onOpenVideo:()=>{G(!0)},isPlaying:m,isLoopAll:C,isLoopCurrent:g,isShuffled:M,onFullScreen:Dt,onShareVideo:Rt});return l?e.jsxs(e.Fragment,{children:[!$e&&f&&Fe,e.jsxs(Ut,{title:_t("videos"),onClose:S,isForeground:f,appId:"videos",skipInitialSound:h,instanceId:d,onNavigateNext:P,onNavigatePrevious:L,menuBar:$e?Fe:void 0,children:[e.jsxs("div",{className:"flex flex-col w-full h-full bg-[#1a1a1a] text-white",children:[e.jsx("div",{className:"flex-1 relative overflow-hidden",children:i.length>0?e.jsxs("div",{className:"w-full h-full overflow-hidden relative",onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),children:[e.jsxs("div",{className:"w-full h-[calc(100%+120px)] mt-[-60px] relative",children:[e.jsx(Lt,{ref:Z,url:((qe=O())==null?void 0:qe.url)||"",playing:m,controls:!1,width:"calc(100% + 1px)",height:"calc(100% + 1px)",onEnded:Tt,onProgress:Vt,onDuration:Ot,onPlay:Et,onPause:Pt,onReady:Mt,loop:g,playsinline:!0,config:{youtube:{playerVars:{modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,fs:0,disablekb:1,playsinline:1,autoplay:0,enablejsapi:1,origin:window.location.origin},embedOptions:{referrerPolicy:"strict-origin-when-cross-origin"}}}}),e.jsx(he,{children:!m&&e.jsx(K.div,{initial:{opacity:0,scale:1.15},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.15},transition:{duration:.2,delay:.1,ease:[.4,0,.2,1]},className:"absolute z-10",style:{top:0,left:0,right:"-1px",bottom:"-1px",width:"calc(100% + 1px)",height:"calc(100% + 1px)"},children:e.jsx(ss,{})})}),e.jsx("div",{className:"absolute inset-0 cursor-pointer z-20","aria-label":s(m?"apps.videos.menu.pause":"apps.videos.menu.play"),onPointerDown:wt,onPointerMove:Nt,onPointerUp:St,onPointerCancel:kt})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-30",children:e.jsx(Zt,{duration:ft,currentTime:mt,onSeek:At,isPlaying:m,isHovered:gt,onDragChange:(t,n)=>{yt(t),n!==void 0&&bt(n)}})}),e.jsx(he,{children:Ce&&e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"absolute top-4 left-4 z-40",children:e.jsx(as,{message:Ce})})})]}):e.jsxs("div",{className:"flex items-center justify-center h-full text-gray-400 font-geneva-12 text-sm",children:[e.jsx("a",{onClick:()=>G(!0),className:"text-[#ff00ff] hover:underline cursor-pointer",children:s("apps.videos.status.addVideos")})," ",s("apps.videos.status.toGetStarted")]})}),e.jsxs("div",{className:$("p-4 bg-[#2a2a2a] border-t border-[#3a3a3a] flex flex-col gap-4","os-toolbar-texture"),children:[e.jsxs("div",{className:"videos-lcd bg-black py-2 px-4 flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsxs("div",{className:$("font-geneva-12 text-[10px] transition-colors duration-300",m?"text-[#ff00ff]":"text-gray-600"),children:[e.jsx("div",{children:s("apps.videos.status.track")}),e.jsx("div",{className:"text-xl",children:e.jsx(es,{number:D()+1})})]}),e.jsxs("div",{className:$("font-geneva-12 text-[10px] transition-colors duration-300",m?"text-[#ff00ff]":"text-gray-600"),children:[e.jsx("div",{children:s("apps.videos.status.time")}),e.jsx("div",{className:"text-xl",children:It(vt?Math.floor(jt):ut)})]})]}),e.jsxs("div",{className:"relative overflow-hidden flex-1 px-2",children:[e.jsx("div",{className:$("font-geneva-12 text-[10px] transition-colors duration-300 mb-[3px] pl-2",m?"text-[#ff00ff]":"text-gray-600"),children:s("apps.videos.status.title")}),i.length>0&&e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx(ts,{title:(He=O())!=null&&He.artist?`${(Be=O())==null?void 0:Be.title} - ${(Ue=O())==null?void 0:Ue.artist}`:((_e=O())==null?void 0:_e.title)||"",direction:b,isPlaying:m}),m&&e.jsx("div",{className:"absolute left-0 top-0 h-full w-4 bg-gradient-to-r from-black to-transparent videos-lcd-fade-left"}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-4 bg-gradient-to-l from-black to-transparent videos-lcd-fade-right"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between videos-player-controls",children:[e.jsx("div",{className:"flex items-center gap-2",children:Le?e.jsxs("div",{className:"flex gap-0 aqua-select-group",children:[e.jsx(H,{onClick:ge,variant:"aqua_select",disabled:i.length===0,className:"aqua-compact font-chicago",children:e.jsx("span",{className:"translate-y-[2px] inline-block",children:"⏮"})}),e.jsx(H,{onClick:ae,variant:"aqua_select",disabled:i.length===0,className:"aqua-compact-wide font-chicago",children:e.jsx("span",{className:"translate-y-[2px] inline-block",children:m?"⏸":"▶"})}),e.jsx(H,{onClick:re,variant:"aqua_select",disabled:i.length===0,className:"aqua-compact font-chicago",children:e.jsx("span",{className:"translate-y-[2px] inline-block",children:"⏭"})})]}):e.jsxs("div",{className:"flex gap-0",children:[e.jsx("button",{onClick:ge,className:$("flex items-center justify-center disabled:opacity-50 focus:outline-none","hover:brightness-75 active:brightness-50"),disabled:i.length===0,children:e.jsx("img",{src:"/assets/videos/prev.png",alt:s("apps.videos.menu.previous"),width:32,height:22,className:"pointer-events-none"})}),e.jsx("button",{onClick:ae,className:$("flex items-center justify-center disabled:opacity-50 focus:outline-none","hover:brightness-75 active:brightness-50"),disabled:i.length===0,children:e.jsx("img",{src:m?"/assets/videos/pause.png":"/assets/videos/play.png",alt:s(m?"apps.videos.menu.pause":"apps.videos.menu.play"),width:50,height:22,className:"pointer-events-none"})}),e.jsx("button",{onClick:re,className:$("flex items-center justify-center disabled:opacity-50 focus:outline-none","hover:brightness-75 active:brightness-50"),disabled:i.length===0,children:e.jsx("img",{src:"/assets/videos/next.png",alt:s("apps.videos.menu.next"),width:32,height:22,className:"pointer-events-none"})})]})}),e.jsx("div",{className:"flex items-center gap-2",children:Le?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-0 aqua-select-group",children:[e.jsx(H,{onClick:ve,variant:"aqua_select","data-state":M?"on":"off",className:"px-2 aqua-compact font-geneva-12 !text-[11px]",children:s("apps.videos.status.shuffle")}),e.jsx(H,{onClick:()=>u(!C),variant:"aqua_select","data-state":C?"on":"off",className:"px-2 aqua-compact font-geneva-12 !text-[11px]",children:s("apps.videos.status.repeat")}),e.jsx(H,{onClick:()=>B(!g),variant:"aqua_select","data-state":g?"on":"off",className:"px-2 aqua-compact font-geneva-12 !text-[11px]",children:g?"↺":"→"})]}),e.jsx(H,{onClick:()=>G(!0),variant:"aqua_select",className:"px-2 aqua-compact font-geneva-12 !text-[11px]",children:s("apps.videos.status.add")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-0",children:[e.jsx(H,{onClick:ve,variant:"player","data-state":M?"on":"off",className:"h-[22px] px-2",children:s("apps.videos.status.shuffle")}),e.jsx(H,{onClick:()=>u(!C),variant:"player","data-state":C?"on":"off",className:"h-[22px] px-2",children:s("apps.videos.status.repeat")}),e.jsx(H,{onClick:()=>B(!g),variant:"player","data-state":g?"on":"off",className:"h-[22px] px-2",children:g?"↺":"→"})]}),e.jsx(H,{onClick:()=>G(!0),variant:"player",className:"h-[22px] px-2",children:s("apps.videos.status.add")})]})})]})]})]}),e.jsx(Xt,{isOpen:ot,onOpenChange:Ne,helpItems:o,appId:"videos"}),e.jsx(zt,{isOpen:rt,onOpenChange:Se,metadata:Yt,appId:"videos"}),e.jsx(st,{isOpen:lt,onOpenChange:me,onConfirm:()=>{F([]),x(null),j(!1),me(!1)},title:s("apps.videos.dialogs.clearPlaylistTitle"),description:s("apps.videos.dialogs.clearPlaylistDescription")}),e.jsx(st,{isOpen:ct,onOpenChange:xe,onConfirm:()=>{F(fe),x(fe.length>0?fe[0].id:null),j(!1),R(fe),xe(!1),T(s("apps.videos.status.playlistReset"))},title:s("apps.videos.dialogs.resetPlaylistTitle"),description:s("apps.videos.dialogs.resetPlaylistDescription")}),e.jsx(Gt,{isOpen:se,onOpenChange:G,onSubmit:De,title:s("apps.videos.dialogs.addVideoTitle"),description:s("apps.videos.dialogs.addVideoDescription"),value:p,onChange:q,isLoading:dt}),e.jsx(it,{isOpen:pt,onClose:()=>Ve(!1),itemType:s("apps.videos.dialogs.videoItemType"),itemIdentifier:((Xe=O())==null?void 0:Xe.id)||"",title:(ze=O())==null?void 0:ze.title,details:(Ye=O())==null?void 0:Ye.artist,generateShareUrl:$t})]})]}):null}export{gs as VideosAppComponent};
