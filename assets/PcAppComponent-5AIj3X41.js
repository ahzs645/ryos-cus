import{r as a,j as e}from"./ui-core-BpsHYXg8.js";import{u as Y,a as ee,bh as D,M as pe,b as B,d as _,e as $,h as V,i as q,j as J,f as l,g as b,S as de,l as ue,m as me,E as xe,Z as he,aD as ge,H as fe,J as be,bi as je,G as Se,bj as ye}from"./index-o--Dc4yZ.js";import{m as ve}from"./motion-CEuZ4rxa.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-B8BJfZ-c.js";import"./tiptap-C4n5NkG5.js";import"./ui-form-Ch9CMzqg.js";import"./audio-BlpnjJKR.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";function Ne({onClose:d,onShowHelp:x,onShowAbout:c,onSaveState:j,onLoadState:R,onReset:T,onLoadGame:I,selectedGame:L,onSetMouseCapture:v,onSetFullScreen:A,onSetRenderAspect:N,onSetMouseSensitivity:O,isMouseCaptured:S,isFullScreen:H,currentRenderAspect:h,mouseSensitivity:p}){var y;const{t:n}=Y(),[G,u]=a.useState(!1),g="pc",w=(y=me[g])==null?void 0:y.name,m=ee(o=>o.current),C=m==="xp"||m==="win98",E=D(),F=["AsIs","1/1","5/4","4/3","16/10","16/9","Fit"],P=[.25,.5,.75,1,1.25,1.5,2];return e.jsxs(pe,{inWindowFrame:C,children:[e.jsxs(B,{children:[e.jsx(_,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:n("common.menu.file")}),e.jsxs($,{align:"start",sideOffset:1,className:"px-0",children:[e.jsxs(V,{children:[e.jsx(q,{className:"text-md h-6 px-3",children:n("apps.pc.menu.loadGame")}),e.jsx(J,{className:"px-0",children:E.map(o=>e.jsx(l,{onClick:()=>I(o),className:`text-md h-6 px-3 ${L.id===o.id?"bg-gray-100":""}`,children:o.name},o.id))})]}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsx(l,{onClick:j,className:"text-md h-6 px-3",children:n("apps.pc.menu.saveState")}),e.jsx(l,{onClick:R,className:"text-md h-6 px-3",children:n("apps.pc.menu.loadState")}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsx(l,{onClick:T,className:"text-md h-6 px-3",children:n("apps.pc.menu.reset")}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsx(l,{onClick:d,className:"text-md h-6 px-3",children:n("common.menu.close")})]})]}),e.jsxs(B,{children:[e.jsx(_,{className:"px-2 py-1 text-md focus-visible:ring-0",children:n("apps.pc.menu.controls")}),e.jsxs($,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(l,{onClick:()=>A(!H),className:"text-md h-6 px-3",children:n("apps.pc.menu.fullScreen")}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsx(l,{onClick:()=>v(!S),className:"text-md h-6 px-3",children:n("apps.pc.menu.toggleMouseCapture")}),e.jsxs(V,{children:[e.jsx(q,{className:"text-md h-6 px-3",children:n("apps.pc.menu.mouseSensitivity")}),e.jsx(J,{className:"px-0",children:P.map(o=>e.jsxs(l,{onClick:()=>O(o),className:`text-md h-6 px-3 ${p===o?"bg-gray-100":""}`,children:[o,"x"]},o))})]}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsxs(V,{children:[e.jsx(q,{className:"text-md h-6 px-3",children:n("apps.pc.menu.aspectRatio")}),e.jsx(J,{className:"px-0",children:F.map(o=>e.jsx(l,{onClick:()=>N(o),className:`text-md h-6 px-3 ${h===o?"bg-gray-100":""}`,children:o},o))})]})]})]}),e.jsxs(B,{children:[e.jsx(_,{className:"px-2 py-1 text-md focus-visible:ring-0",children:n("common.menu.help")}),e.jsxs($,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(l,{onClick:x,className:"text-md h-6 px-3",children:n("apps.pc.menu.virtualPcHelp")}),e.jsx(l,{onSelect:()=>u(!0),className:"text-md h-6 px-3",children:n("common.menu.shareApp")}),e.jsx(b,{className:"h-[2px] bg-black my-1"}),e.jsx(l,{onClick:c,className:"text-md h-6 px-3",children:n("apps.pc.menu.aboutVirtualPc")})]})]}),e.jsx(de,{isOpen:G,onClose:()=>u(!1),itemType:"App",itemIdentifier:g,title:w,generateShareUrl:ue})]})}let K=null,Q=!1;function we(){const[d,x]=a.useState(Q);return a.useEffect(()=>{if(!K&&!window.Dos){console.log("Loading js-dos script...");const c=document.createElement("script");c.src="https://v8.js-dos.com/latest/js-dos.js",c.async=!0,c.onload=()=>{console.log("js-dos script loaded successfully"),setTimeout(()=>{console.log("Checking if Dos function is available:",!!window.Dos),Q=!0,x(!0)},1e3)},c.onerror=j=>{console.error("Failed to load js-dos script:",j)},K=c,document.body.appendChild(c)}return()=>{}},[]),{isScriptLoaded:d}}function Ee({isWindowOpen:d,onClose:x,isForeground:c,skipInitialSound:j,instanceId:R,onNavigateNext:T,onNavigatePrevious:I}){const[L,v]=a.useState(!1),[A,N]=a.useState(!1),[O,S]=a.useState(!1),[H,h]=a.useState(!1),{isScriptLoaded:p}=we(),[n,G]=a.useState(()=>D()[0]),[u,g]=a.useState(null),[w,m]=a.useState(!1),[C,E]=a.useState(!1),[F,P]=a.useState(!1),[y,o]=a.useState("4/3"),[U,se]=a.useState(1),r=a.useRef(null),t=a.useRef(null),{t:f}=Y(),X=ee(s=>s.current),z=X==="xp"||X==="win98",te=xe("pc",ye);a.useEffect(()=>{!d&&t.current&&(console.log("Stopping dosbox instance..."),t.current.stop().then(()=>{console.log("Dosbox instance stopped"),t.current=null,m(!1),r.current&&(r.current.innerHTML="")}).catch(s=>{console.error("Error stopping dosbox:",s),t.current=null,m(!1),r.current&&(r.current.innerHTML="")}))},[d]),a.useEffect(()=>()=>{t.current&&(console.log("Cleaning up dosbox instance on unmount..."),t.current.stop().catch(console.error),t.current=null,r.current&&(r.current.innerHTML=""))},[]),a.useEffect(()=>{p&&u&&(console.log("Loading pending game:",u),k(u),g(null))},[p,u]);const ne=s=>{E(s),t.current&&t.current.setMouseCapture(s)},ae=s=>{P(s),t.current&&t.current.setFullScreen(s)},oe=s=>{o(s),t.current&&t.current.setRenderAspect(s)},re=s=>{se(s),t.current&&t.current.setMouseSensitivity(s)},k=async s=>{if(G(s),m(!0),!r.current){console.error("Container ref is null");return}if(!window.Dos){if(console.error("Dos function is not available"),!p){console.log("Script not loaded yet, queuing game load..."),g(s);return}return}if(!p){console.log("Script not fully loaded yet, queuing game load..."),g(s);return}try{console.log("Starting game load..."),console.log("Selected game:",s),console.log("Container dimensions:",{width:r.current.offsetWidth,height:r.current.offsetHeight}),h(!0),t.current&&(console.log("Stopping existing instance..."),await t.current.stop(),t.current=null),r.current.innerHTML="",await new Promise(i=>setTimeout(i,100)),console.log("Creating new Dos instance...");const M={url:s.path,theme:"dark",renderAspect:y,renderBackend:"webgl",imageRendering:"pixelated",mouseCapture:C,mouseSensitivity:U,workerThread:!0,autoStart:!0,kiosk:!0,onEvent:(i,Z)=>{console.log("js-dos event:",i,Z),i==="emu-ready"?console.log("Emulator is ready"):i==="ci-ready"?(console.log("Command interface is ready"),h(!1)):i==="bnd-play"?console.log("Play button clicked"):i==="exit"&&(console.log("Program terminated:",Z),r.current&&(r.current.innerHTML="",k(n)))},onload:()=>{console.log("Game bundle loaded successfully")},onerror:i=>{console.error("Failed to load game:",i),h(!1)}};console.log("Dos options:",M),t.current=window.Dos(r.current,M),console.log("Dos instance created:",!!t.current)}catch(M){console.error("Failed to start DOSBox:",M),h(!1)}},le=()=>{console.log("Save state not available in v8")},ce=()=>{console.log("Load state not available in v8")},ie=async()=>{r.current&&(t.current&&(console.log("Stopping dosbox instance before reset..."),await t.current.stop(),t.current=null),r.current.innerHTML="",m(!1)),S(!1)},W=e.jsx(Ne,{onClose:x,onShowHelp:()=>v(!0),onShowAbout:()=>N(!0),onSaveState:le,onLoadState:ce,onReset:()=>S(!0),onLoadGame:k,selectedGame:n,onSetMouseCapture:ne,onSetFullScreen:ae,onSetRenderAspect:oe,onSetMouseSensitivity:re,isMouseCaptured:C,isFullScreen:F,currentRenderAspect:y,mouseSensitivity:U});return d?e.jsxs(e.Fragment,{children:[!z&&c&&W,e.jsxs(he,{title:ge("pc"),onClose:x,isForeground:c,appId:"pc",skipInitialSound:j,instanceId:R,onNavigateNext:T,onNavigatePrevious:I,menuBar:z?W:void 0,children:[e.jsx("div",{className:"flex flex-col h-full w-full bg-[#1a1a1a]",children:e.jsxs("div",{className:"flex-1 relative h-full",children:[e.jsx("div",{id:"dosbox",ref:r,className:`w-full h-full ${w?"block":"hidden"}`,style:{minHeight:"400px",position:"relative"}}),H&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"px-4 py-2 rounded bg-black/50 backdrop-blur-sm",children:e.jsx("div",{className:"font-geneva-12 text-sm shimmer",children:f("apps.pc.loadingGame",{gameName:n.name})})})}),!w&&e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"bg-black px-4 py-2 border-b border-[#3a3a3a]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-apple-garamond text-white text-lg",children:f("apps.pc.virtualPc")}),e.jsx("div",{className:"font-geneva-12 text-gray-400 text-[12px] flex items-center gap-2",children:p?f("apps.pc.programsAvailable",{count:D().length}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),f("apps.pc.loadingEmulator")]})})]})}),e.jsx("div",{className:"flex-1 p-4 overflow-y-auto flex justify-start md:justify-center w-full",children:e.jsx("div",{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 transition-opacity duration-300 w-full ${p?"opacity-100":"opacity-50 pointer-events-none"}`,children:D().map(s=>e.jsx(ve.button,{onClick:()=>k(s),className:"group relative aspect-video rounded overflow-hidden bg-[#2a2a2a] hover:bg-[#3a3a3a] transition-all duration-200 shadow-[0_4px_12px_rgba(0,0,0,0.5)] hover:shadow-[0_8px_24px_rgba(0,0,0,0.7)] border border-[#3a3a3a] hover:border-[#4a4a4a] w-full h-full",style:{aspectRatio:"16/9"},whileHover:{scale:1.05,y:-2,transition:{duration:.08,ease:"linear"}},whileTap:{scale:.95,y:0,transition:{type:"spring",duration:.15}},children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover",width:320,height:180,loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-3",children:e.jsx("span",{className:"text-white font-geneva-12 text-[12px]",children:s.name})})]})},s.id))})})]})]})}),e.jsx(fe,{isOpen:L,onOpenChange:v,helpItems:te,appId:"pc"}),e.jsx(be,{isOpen:A,onOpenChange:N,metadata:je,appId:"pc"}),e.jsx(Se,{isOpen:O,onOpenChange:S,onConfirm:ie,title:f("apps.pc.dialogs.resetVirtualPcTitle"),description:f("apps.pc.dialogs.resetVirtualPcDescription")})]})]}):null}export{Ee as PcAppComponent};
