const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CdY3Xrkk.js","assets/ui-core-D0pDhx0h.js","assets/react-CyQK0IK8.js","assets/media-player-Dfptv93o.js","assets/zustand-CwjPl1Tm.js","assets/motion-DC7C-474.js","assets/tiptap-CPHiBm_b.js","assets/ui-form-Bg85K0S3.js","assets/audio-DxkJfdUY.js","assets/pusher-BvD42uFZ.js","assets/hangul-CIZ_Rl7P.js","assets/three-BOJBN814.js","assets/index-DnCOueI1.css"])))=>i.map(i=>d[i]);
import{r as p,z as we,j as t}from"./ui-core-D0pDhx0h.js";import{c as U,u as ee,a as ye,M as Re,b as Y,d as X,e as K,f as S,g as F,h as Pe,i as qe,j as Ve,k as D,S as Ye,l as Xe,m as Ke,n as Ze,o as Qe,D as ue,p as fe,C as ge,q as de,r as $,A as Ce,L as je,V as ve,B as O,s as Ge,t as et,v as tt,w as st,x as Z,y as Ae,z as be,E as nt,F as at,I as ke,G as lt,H as ct,J as it,K as ot,N as H,O as rt,P as Q,Q as V,R as ht,T as pt,U as xt,W as mt,X as ut,Y as G,Z as ft}from"./index-CdY3Xrkk.js";import{m as gt}from"./motion-DC7C-474.js";import{f as dt}from"./tiptap-CPHiBm_b.js";import{u as Ct}from"./useTtsQueue-BS1uDaRq.js";import{_ as jt}from"./media-player-Dfptv93o.js";import"./react-CyQK0IK8.js";import"./zustand-CwjPl1Tm.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],bt=U("AlignCenter",vt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],Nt=U("AlignLeft",kt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]],yt=U("AlignRight",wt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],St=U("Bold",At);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],Et=U("Italic",Tt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]],Mt=U("ListOrdered",Dt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],Ot=U("List",Lt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],Ft=U("Underline",Ht);function _t({editor:e,onClose:m,onShowHelp:v,onShowAbout:d,onNewFile:u,onImportFile:r,onExportFile:b,onSave:w,currentFilePath:N,handleFileSelect:n}){var a;const{t:s}=ee(),[f,j]=p.useState(!1),i="textedit",l=(a=Ke[i])==null?void 0:a.name,c=ye(C=>C.current),x=c==="xp"||c==="win98",g=we.useRef(null);return t.jsxs(Re,{inWindowFrame:x,children:[t.jsx("input",{type:"file",ref:g,onChange:n,accept:".txt,.html,.md",className:"hidden"}),t.jsxs(Y,{children:[t.jsx(X,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:s("common.menu.file")}),t.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(S,{onClick:u,className:"text-md h-6 px-3",children:s("apps.textedit.menu.newFile")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:r,className:"text-md h-6 px-3",children:s("apps.textedit.menu.open")}),t.jsx(S,{onClick:w,className:"text-md h-6 px-3",children:s(N?"apps.textedit.menu.save":"apps.textedit.menu.saveEllipsis")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:()=>{var C;return(C=g.current)==null?void 0:C.click()},className:"text-md h-6 px-3",children:s("apps.textedit.menu.importFromDevice")}),t.jsxs(Pe,{children:[t.jsx(qe,{className:"text-md h-6 px-3",children:s("apps.textedit.menu.exportAs")}),t.jsxs(Ve,{children:[t.jsx(S,{onClick:()=>b("html"),className:"text-md h-6 px-3",children:s("apps.textedit.menu.html")}),t.jsx(S,{onClick:()=>b("md"),className:"text-md h-6 px-3",children:s("apps.textedit.menu.markdown")}),t.jsx(S,{onClick:()=>b("txt"),className:"text-md h-6 px-3",children:s("apps.textedit.menu.plainText")})]})]}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:m,className:"text-md h-6 px-3",children:s("common.menu.close")})]})]}),t.jsxs(Y,{children:[t.jsx(X,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:s("common.menu.edit")}),t.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(S,{onClick:()=>e==null?void 0:e.chain().focus().undo().run(),className:"text-md h-6 px-3",children:s("common.menu.undo")}),t.jsx(S,{onClick:()=>e==null?void 0:e.chain().focus().redo().run(),className:"text-md h-6 px-3",children:s("common.menu.redo")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:()=>{var C;(C=window.getSelection())!=null&&C.toString()&&document.execCommand("copy")},className:"text-md h-6 px-3",children:s("common.menu.copy")}),t.jsx(S,{onClick:()=>{var C;(C=window.getSelection())!=null&&C.toString()&&document.execCommand("cut")},className:"text-md h-6 px-3",children:s("common.menu.cut")}),t.jsx(S,{onClick:()=>document.execCommand("paste"),className:"text-md h-6 px-3",children:s("common.menu.paste")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:()=>e==null?void 0:e.chain().focus().selectAll().run(),className:"text-md h-6 px-3",children:s("common.menu.selectAll")})]})]}),t.jsxs(Y,{children:[t.jsx(X,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:s("apps.textedit.menu.format")}),t.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(D,{checked:(e==null?void 0:e.isActive("bold"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleBold().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.bold")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("italic"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleItalic().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.italic")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("underline"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleUnderline().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.underline")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(D,{checked:(e==null?void 0:e.isActive("paragraph"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().setParagraph().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.text")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("heading",{level:1}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleHeading({level:1}).run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.heading1")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("heading",{level:2}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleHeading({level:2}).run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.heading2")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("heading",{level:3}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleHeading({level:3}).run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.heading3")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(D,{checked:(e==null?void 0:e.isActive({textAlign:"left"}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().setTextAlign("left").run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.alignLeft")}),t.jsx(D,{checked:(e==null?void 0:e.isActive({textAlign:"center"}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().setTextAlign("center").run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.alignCenter")}),t.jsx(D,{checked:(e==null?void 0:e.isActive({textAlign:"right"}))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().setTextAlign("right").run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.alignRight")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(D,{checked:(e==null?void 0:e.isActive("bulletList"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleBulletList().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.bulletList")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("orderedList"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleOrderedList().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.numberedList")}),t.jsx(D,{checked:(e==null?void 0:e.isActive("taskList"))??!1,onCheckedChange:()=>e==null?void 0:e.chain().focus().toggleTaskList().run(),className:"text-md h-6 px-3",children:s("apps.textedit.menu.taskList")})]})]}),t.jsxs(Y,{children:[t.jsx(X,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:s("common.menu.help")}),t.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(S,{onClick:v,className:"text-md h-6 px-3",children:s("apps.textedit.menu.texteditHelp")}),t.jsx(S,{onSelect:()=>j(!0),className:"text-md h-6 px-3",children:s("common.menu.shareApp")}),t.jsx(F,{className:"h-[2px] bg-black my-1"}),t.jsx(S,{onClick:d,className:"text-md h-6 px-3",children:s("apps.textedit.menu.aboutTextEdit")})]})]}),t.jsx(Ye,{isOpen:f,onClose:()=>j(!1),itemType:"App",itemIdentifier:i,title:l,generateShareUrl:Xe})]})}function Ne({className:e="",color:m="white",barCount:v=5}){const[u,r]=p.useState([]),[b,w]=p.useState([]);return p.useEffect(()=>{const N=Array.from({length:v}).map(()=>{const s=Math.floor(Math.random()*3)+3;return Array.from({length:s}).map(()=>.2+Math.random()*.8)}),n=Array.from({length:v}).map(()=>.7+Math.random()*.6);r(N),w(n)},[v]),t.jsx("div",{className:`flex gap-[2px] items-center justify-center h-full ${e}`,children:Array.from({length:v}).map((N,n)=>t.jsx(gt.div,{className:`w-[2px] rounded-full ${m==="white"?"bg-white":"bg-black"}`,initial:{scaleY:.2},animate:{scaleY:u[n]||[.2,.7,.2]},transition:{duration:b[n]||.9,repeat:1/0,repeatType:"reverse",ease:"easeInOut",delay:Math.random()*.5},style:{height:12}},n))})}function $t({editor:e,currentTheme:m,speechEnabled:v,isTranscribing:d,isTtsLoading:u,isSpeaking:r,onTranscriptionComplete:b,onTranscriptionStart:w,onSpeak:N}){const{t:n}=ee(),{play:s}=Ze(Qe.BUTTON_CLICK),f=m==="xp"||m==="win98",j=f||m==="system7",i=m==="macosx",l=()=>e!=null&&e.isActive("heading",{level:1})?"h1":e!=null&&e.isActive("heading",{level:2})?"h2":e!=null&&e.isActive("heading",{level:3})?"h3":"text",c=x=>{if(!e)return;const g=e.chain().focus();if(x==="text"){g.setParagraph().run();return}const a=x==="h1"?1:x==="h2"?2:3;e.isActive("heading",{level:a})||g.toggleHeading({level:a}).run()};return j?t.jsx("div",{className:"flex bg-[#c0c0c0] border-b border-black w-full flex-shrink-0",children:t.jsxs("div",{className:"flex px-1 py-1 gap-x-1",children:[t.jsxs("div",{className:"flex",children:[t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().toggleBold().run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/bold-${e!=null&&e.isActive("bold")?"depressed":"off"}.png`,alt:n("apps.textedit.bold"),className:"w-[26px] h-[22px]"})}),t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().toggleItalic().run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/italic-${e!=null&&e.isActive("italic")?"depressed":"off"}.png`,alt:n("apps.textedit.italic"),className:"w-[26px] h-[22px]"})}),t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().toggleUnderline().run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/underline-${e!=null&&e.isActive("underline")?"depressed":"off"}.png`,alt:n("apps.textedit.underline"),className:"w-[26px] h-[22px]"})})]}),t.jsx("div",{className:"w-[1px] h-[22px] bg-[#808080] shadow-[1px_0_0_#ffffff]"}),t.jsx("div",{className:"flex",children:t.jsxs(ue,{children:[t.jsx(fe,{asChild:!0,children:t.jsxs("button",{className:"w-[80px] h-[22px] flex items-center justify-between px-2 bg-white border border-[#808080] text-sm",children:[l()==="h1"?"H1":l()==="h2"?"H2":l()==="h3"?"H3":n("apps.textedit.text"),t.jsx(ge,{className:"ml-1 h-3 w-3"})]})}),t.jsxs(de,{align:"start",className:"w-[80px]",children:[t.jsx($,{onClick:()=>c("text"),className:"text-sm h-6 px-2",children:n("apps.textedit.text")}),t.jsx($,{onClick:()=>c("h1"),className:"text-sm h-6 px-2",children:"H1"}),t.jsx($,{onClick:()=>c("h2"),className:"text-sm h-6 px-2",children:"H2"}),t.jsx($,{onClick:()=>c("h3"),className:"text-sm h-6 px-2",children:"H3"})]})]})}),t.jsx("div",{className:"w-[1px] h-[22px] bg-[#808080] shadow-[1px_0_0_#ffffff]"}),t.jsxs("div",{className:"flex",children:[t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().setTextAlign("left").run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/align-left-${e!=null&&e.isActive({textAlign:"left"})?"depressed":"off"}.png`,alt:n("apps.textedit.alignLeft"),className:"w-[26px] h-[22px]"})}),t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().setTextAlign("center").run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/align-center-${e!=null&&e.isActive({textAlign:"center"})?"depressed":"off"}.png`,alt:n("apps.textedit.alignCenter"),className:"w-[26px] h-[22px]"})}),t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().setTextAlign("right").run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/align-right-${e!=null&&e.isActive({textAlign:"right"})?"depressed":"off"}.png`,alt:n("apps.textedit.alignRight"),className:"w-[26px] h-[22px]"})})]}),t.jsx("div",{className:"w-[1px] h-[22px] bg-[#808080] shadow-[1px_0_0_#ffffff]"}),t.jsxs("div",{className:"flex",children:[t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().toggleBulletList().run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/unordered-list-${e!=null&&e.isActive("bulletList")?"depressed":"off"}.png`,alt:n("apps.textedit.bulletList"),className:"w-[26px] h-[22px]"})}),t.jsx("button",{onClick:()=>{s(),e==null||e.chain().focus().toggleOrderedList().run()},className:"w-[26px] h-[22px] flex items-center justify-center",children:t.jsx("img",{src:`/icons/default/text-editor/ordered-list-${e!=null&&e.isActive("orderedList")?"depressed":"off"}.png`,alt:n("apps.textedit.numberedList"),className:"w-[26px] h-[22px]"})})]}),t.jsx("div",{className:"w-[1px] h-[22px] bg-[#808080] shadow-[1px_0_0_#ffffff]"}),t.jsxs("div",{className:"flex",children:[t.jsx(Ce,{onTranscriptionComplete:b,onTranscriptionStart:w,isLoading:d,className:"w-[26px] h-[22px] flex items-center justify-center",silenceThreshold:1e4}),v&&t.jsx("button",{onClick:()=>{s(),N()},className:"w-[26px] h-[22px] flex items-center justify-center","aria-label":n(r?"apps.textedit.stopSpeech":"apps.textedit.speak"),children:u?t.jsx(je,{className:"h-4 w-4 animate-spin"}):r?t.jsx(Ne,{color:"black"}):t.jsx(ve,{className:"h-4 w-4"})})]})]})}):t.jsxs("div",{className:`flex items-center gap-1 p-1 ${f?"border-b border-[#919b9c]":i?"bg-transparent":m==="system7"?"bg-gray-100 border-b border-black":"bg-gray-100 border-b border-gray-300"}`,style:{borderBottom:i?"var(--os-metrics-titlebar-border-width, 1px) solid var(--os-color-titlebar-border-inactive, rgba(0, 0, 0, 0.2))":void 0},children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().toggleBold().run(),"aria-label":n("apps.textedit.bold"),children:t.jsx(St,{className:`h-4 w-4 ${e!=null&&e.isActive("bold")?"text-black":"text-neutral-500"}`})}),t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().toggleItalic().run(),"aria-label":n("apps.textedit.italic"),children:t.jsx(Et,{className:`h-4 w-4 ${e!=null&&e.isActive("italic")?"text-black":"text-neutral-500"}`})}),t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().toggleUnderline().run(),"aria-label":n("apps.textedit.underline"),children:t.jsx(Ft,{className:`h-4 w-4 ${e!=null&&e.isActive("underline")?"text-black":"text-neutral-500"}`})})]}),t.jsx("div",{className:"flex items-center mx-1",children:i?t.jsxs(Ge,{value:l(),onValueChange:c,children:[t.jsx(et,{className:"h-7 px-2 !min-w-[92px] !text-[12px]",children:t.jsx(tt,{placeholder:n("apps.textedit.text")})}),t.jsxs(st,{align:"start",className:"px-0",children:[t.jsx(Z,{value:"text",children:n("apps.textedit.text")}),t.jsx(Z,{value:"h1",children:n("apps.textedit.heading1")}),t.jsx(Z,{value:"h2",children:n("apps.textedit.heading2")}),t.jsx(Z,{value:"h3",children:n("apps.textedit.heading3")})]})]}):t.jsxs(ue,{children:[t.jsx(fe,{asChild:!0,children:t.jsxs(O,{variant:"outline",className:"h-7 px-2 min-w-[120px] justify-between",children:[l()==="h1"?"H1":l()==="h2"?"H2":l()==="h3"?"H3":n("apps.textedit.text"),t.jsx(ge,{className:"ml-1 h-3 w-3"})]})}),t.jsxs(de,{align:"start",className:"w-[120px]",children:[t.jsx($,{onClick:()=>c("text"),children:n("apps.textedit.text")}),t.jsx($,{onClick:()=>c("h1"),children:n("apps.textedit.heading1")}),t.jsx($,{onClick:()=>c("h2"),children:n("apps.textedit.heading2")}),t.jsx($,{onClick:()=>c("h3"),children:n("apps.textedit.heading3")})]})]})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().setTextAlign("left").run(),"aria-label":n("apps.textedit.alignLeft"),children:t.jsx(Nt,{className:`h-4 w-4 ${e!=null&&e.isActive({textAlign:"left"})?"text-black":"text-neutral-500"}`})}),t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().setTextAlign("center").run(),"aria-label":n("apps.textedit.alignCenter"),children:t.jsx(bt,{className:`h-4 w-4 ${e!=null&&e.isActive({textAlign:"center"})?"text-black":"text-neutral-500"}`})}),t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().setTextAlign("right").run(),"aria-label":n("apps.textedit.alignRight"),children:t.jsx(yt,{className:`h-4 w-4 ${e!=null&&e.isActive({textAlign:"right"})?"text-black":"text-neutral-500"}`})})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().toggleBulletList().run(),"aria-label":n("apps.textedit.bulletList"),children:t.jsx(Ot,{className:`h-4 w-4 ${e!=null&&e.isActive("bulletList")?"text-black":"text-neutral-500"}`})}),t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>e==null?void 0:e.chain().focus().toggleOrderedList().run(),"aria-label":n("apps.textedit.numberedList"),children:t.jsx(Mt,{className:`h-4 w-4 ${e!=null&&e.isActive("orderedList")?"text-black":"text-neutral-500"}`})})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ce,{onTranscriptionComplete:b,onTranscriptionStart:w,isLoading:d,className:"h-7 w-7 inline-flex items-center justify-center text-neutral-500 hover:text-black",silenceThreshold:1e4}),v&&t.jsx(O,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:N,"aria-label":n(r?"apps.textedit.stopSpeech":"apps.textedit.speak"),children:u?t.jsx(je,{className:"h-4 w-4 animate-spin text-black"}):r?t.jsx(Ne,{color:"black"}):t.jsx(ve,{className:"h-4 w-4 text-neutral-500"})})]})]})}function Ut({className:e}){const m=Ae();return t.jsx(dt,{editor:m,className:e||"flex-1 overflow-y-auto w-full min-h-0 bg-white"})}function Bt({editor:e,speechEnabled:m,children:v}){const{speak:d,stop:u,isSpeaking:r}=Ct(),[b,w]=p.useState(!1);p.useEffect(()=>{r&&w(!1)},[r]);const N=p.useCallback(()=>{if(!e||!m)return;const n=(l,c)=>{const{state:x,view:g}=e,a=x.tr.setMeta(be,{range:{from:l,to:c}});g.dispatch(a)},s=()=>{const{state:l,view:c}=e,x=l.tr.setMeta(be,{clear:!0});c.dispatch(x)};if(r){u(),s();return}if(b){u(),w(!1);return}const{from:f,to:j,empty:i}=e.state.selection;if(i){const l=[];if(e.state.doc.descendants((g,a)=>{if(g.isTextblock&&g.textContent.trim()){const C=a+1,M=a+g.nodeSize-1;l.push({text:g.textContent.trim(),from:C,to:M})}}),l.length===0)return;w(!0),l.forEach(({text:g},a)=>{d(g,()=>{const C=a+1;if(C<l.length){const M=l[C];s(),n(M.from,M.to)}else s()})});const{from:c,to:x}=l[0];n(c,x)}else{const l=e.state.doc.textBetween(f,j,`
`).trim();l&&(w(!0),n(f,j),d(l,()=>{s()}))}},[e,m,r,b,d,u]);return t.jsx(t.Fragment,{children:v({isSpeaking:r,isTtsLoading:b,handleSpeak:N})})}function It({saveFileName:e,setSaveFileName:m,closeSaveFileName:v,setCloseSaveFileName:d,onSaveSubmit:u,onCloseSave:r,onCloseDelete:b,onConfirmNew:w,onControlsReady:N,isUntitledForClose:n=!1}){const{t:s}=ee(),f=nt("textedit",at),[j,i]=p.useState(!1),[l,c]=p.useState(!1),[x,g]=p.useState(!1),[a,C]=p.useState(!1),[M,L]=p.useState(!1),z=p.useMemo(()=>({openHelpDialog:()=>i(!0),closeHelpDialog:()=>i(!1),openAboutDialog:()=>c(!0),closeAboutDialog:()=>c(!1),openSaveDialog:()=>g(!0),closeSaveDialog:()=>g(!1),openConfirmNewDialog:()=>C(!0),closeConfirmNewDialog:()=>C(!1),openCloseSaveDialog:()=>L(!0),closeCloseSaveDialog:()=>L(!1)}),[]);return we.useEffect(()=>{N==null||N(z)},[N,z]),t.jsxs(t.Fragment,{children:[t.jsx(ke,{isOpen:x,onOpenChange:g,onSubmit:u,title:s("apps.textedit.dialogs.saveFile"),description:s("apps.textedit.dialogs.enterANameForYourFile"),value:e,onChange:m}),t.jsx(lt,{isOpen:a,onOpenChange:C,onConfirm:()=>{w(),C(!1)},title:s("apps.textedit.dialogs.discardChanges"),description:s("apps.textedit.dialogs.doYouWantToDiscardYourChangesAndCreateANewFile")}),t.jsx(ke,{isOpen:M,onOpenChange:L,onSubmit:r,title:s(n?"apps.textedit.dialogs.keepNewDocument":"apps.textedit.dialogs.saveChanges"),description:s(n?"apps.textedit.dialogs.enterFilenameToSaveOrDeleteItBeforeClosing":"apps.textedit.dialogs.saveYourChangesBeforeClosing"),value:v,onChange:d,submitLabel:s("common.dialog.save"),additionalActions:[{label:s(n?"common.dialog.delete":"apps.textedit.dialogs.discardChanges"),onClick:b,variant:"retro",position:"left"}]}),t.jsx(ct,{isOpen:j,onOpenChange:i,helpItems:f,appId:"textedit"}),t.jsx(it,{isOpen:l,onOpenChange:c,metadata:ot,appId:"textedit"})]})}function Jt({instanceId:e}){const m=H(a=>a.createInstance),v=H(a=>a.removeInstance),d=H(a=>a.updateInstance),u=H(a=>a.instances),r=H(a=>a.setLastFilePath),b=H(a=>a.setContentJson),w=H(a=>a.setHasUnsavedChanges),N=H(a=>a.lastFilePath),n=H(a=>a.contentJson),s=H(a=>a.hasUnsavedChanges);p.useEffect(()=>{e&&m(e)},[e,m]),p.useEffect(()=>{if(e)return()=>{v(e)}},[e,v]);const f=e?u[e]:null,j=e?(f==null?void 0:f.filePath)||null:N,i=e?(f==null?void 0:f.contentJson)||null:n,l=e?(f==null?void 0:f.hasUnsavedChanges)||!1:s,c=p.useCallback(a=>{e?d(e,{filePath:a}):r(a)},[e,d,r]),x=p.useCallback(a=>{e?d(e,{contentJson:a}):b(a)},[e,d,b]),g=p.useCallback(a=>{e?d(e,{hasUnsavedChanges:a}):w(a)},[e,d,w]);return{currentFilePath:j,contentJson:i,hasUnsavedChanges:l,currentInstance:f,setCurrentFilePath:c,setContentJson:x,setHasUnsavedChanges:g,instanceId:e,legacyFilePath:N,legacyContentJson:n,legacyHasUnsavedChanges:s}}const Se=e=>e.replace(/\.[^/.]+$/,""),Wt=async e=>e?e instanceof Blob?await e.text():e:"",zt=(e,m)=>e&&e.trim()&&e!=="Untitled"?e.split(/\s+/).filter(Boolean).slice(0,7).join("-").replace(/[^a-zA-Z0-9-]/g,"").substring(0,50)||"Untitled":m&&m.getHTML().split(`
`)[0].replace(/<[^>]+>/g,"").trim().split(/\s+/).filter(Boolean).slice(0,7).join("-").replace(/[^a-zA-Z0-9-]/g,"").substring(0,50)||"Untitled";function Rt({editor:e,currentFilePath:m,customTitle:v,onSaveSuccess:d,onLoadSuccess:u}){const{saveFile:r}=rt("/Documents"),b=p.useCallback(async()=>{if(e){if(!m)throw new Error("No file path provided - use handleSaveAs instead");try{const i=e.getHTML(),l=Q(i);await r({name:m.split("/").pop()||"Untitled.md",path:m,content:l}),d==null||d(m),console.log("[TextEdit] File saved successfully:",m)}catch(i){throw console.error("[TextEdit] Failed to save file:",i),i}}},[e,m,r,d]),w=p.useCallback(async i=>{if(!e)throw new Error("Editor not available");const l=`/Documents/${i}${i.endsWith(".md")?"":".md"}`;try{const c=e.getHTML(),x=Q(c);return await r({name:i.endsWith(".md")?i:`${i}.md`,path:l,content:x}),d==null||d(l),console.log("[TextEdit] File saved successfully:",l),l}catch(c){throw console.error("[TextEdit] Failed to save file:",c),c}},[e,r,d]),N=p.useCallback(async i=>{if(!e)throw new Error("Editor not available");const l=`/Documents/${i.name}`,c=await i.text();let x;i.name.endsWith(".html")?x=c:i.name.endsWith(".md")?x=V(c):x=`<p>${c}</p>`,e.commands.setContent(x);const g=i.name.endsWith(".md")?c:Q(e.getHTML());try{return await r({name:i.name,path:l,content:g}),u==null||u(l),console.log("[TextEdit] File imported successfully:",l),l}catch(a){throw console.error("[TextEdit] Failed to import file:",a),a}},[e,r,u]),n=p.useCallback(i=>{if(!e)return;const l=e.getHTML();let c,x,g;switch(i){case"md":c=Q(l),x="text/markdown",g="md";break;case"txt":c=ht(l),x="text/plain",g="txt";break;case"html":default:c=l,x="text/html",g="html";break}const a=m?Se(m.split("/").pop()||""):"Untitled",C=new Blob([c],{type:x}),M=URL.createObjectURL(C),L=document.createElement("a");L.href=M,L.download=`${a}.${g}`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(M)},[e,m]),s=p.useCallback(async(i,l)=>{if(!e)return;const c=typeof l=="string"?l:"";let x;if(i.endsWith(".md"))x=V(c);else try{x=JSON.parse(c)}catch{x=`<p>${c}</p>`}e.commands.setContent(x,!1),u==null||u(i)},[e,u]),f=p.useCallback(async i=>{if(!e||!i.startsWith("/Documents/"))return!1;try{const{useFilesStore:l}=await jt(async()=>{const{useFilesStore:g}=await import("./index-CdY3Xrkk.js").then(a=>a.c9);return{useFilesStore:g}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),x=l.getState().getItem(i);if(x&&x.uuid){const g=await pt.get(xt.DOCUMENTS,x.uuid);if(g!=null&&g.content){const a=await Wt(g.content);let C;if(i.endsWith(".md"))C=V(a);else try{C=JSON.parse(a)}catch{C=`<p>${a}</p>`}if(C)return e.commands.setContent(C,!1),u==null||u(i),console.log("Loaded content from file:",i),!0}else console.warn("Document not found or empty:",i)}else console.warn("File metadata or UUID not found for:",i)}catch(l){console.error("Error loading file content from DB:",l)}return!1},[e,u]),j=p.useCallback(()=>zt(v,e),[v,e]);return{handleSave:b,handleSaveAs:w,handleImportFile:N,handleExportFile:n,handleLoadFromPath:s,handleLoadFromDatabase:f,generateSuggestedFileName:j}}function Pt({hasUnsavedChanges:e,onFileDropped:m,onConfirmOverwrite:v}){const[d,u]=p.useState(!1),r=p.useCallback(f=>{f.preventDefault(),f.stopPropagation(),d||u(!0)},[d]),b=p.useCallback(f=>{f.preventDefault(),f.stopPropagation();const j=f.relatedTarget;f.currentTarget.contains(j)||u(!1)},[]),w=p.useCallback(()=>{u(!1)},[]),N=p.useCallback(()=>{u(!1)},[]),n=p.useCallback(async f=>{f.preventDefault(),f.stopPropagation(),u(!1);const j=f.dataTransfer.files[0];if(!j||!j.type.startsWith("text/")&&!j.name.endsWith(".md"))return;const i=`/Documents/${j.name}`,l=await j.text();let c;j.name.endsWith(".html")?c=l:j.name.endsWith(".md")?c=V(l):c=`<p>${l}</p>`,e?(localStorage.setItem("pending_file_open",JSON.stringify({path:i,content:c})),v()):await m(j)},[e,m,v]);return{isDraggingOver:d,dragHandlers:{onDragOver:r,onDragLeave:b,onDragEnd:w,onMouseLeave:N,onDrop:n}}}function qt({isWindowOpen:e,onClose:m,isForeground:v,skipInitialSound:d,initialData:u,instanceId:r,title:b,onNavigateNext:w,onNavigatePrevious:N}){const{t:n}=ee(),s=Ae(),[f,j]=p.useState(!1),i=p.useRef(null),l=ut(),c=G(o=>o.clearInitialData),x=G(o=>o.clearInstanceInitialData),g=G(o=>o.launchApp),a=ye(o=>o.current),C=G(o=>o.speechEnabled),M=a==="xp"||a==="win98",[L,z]=p.useState(""),[Te,te]=p.useState(""),[k,Ee]=p.useState(null),{currentFilePath:A,contentJson:J,hasUnsavedChanges:B,setCurrentFilePath:W,setContentJson:_,setHasUnsavedChanges:T,legacyFilePath:se,legacyContentJson:R,legacyHasUnsavedChanges:ae}=Jt({instanceId:r}),{handleSave:le,handleSaveAs:ce,handleImportFile:ie,handleExportFile:De,handleLoadFromPath:oe,handleLoadFromDatabase:P,generateSuggestedFileName:re}=Rt({editor:s,currentFilePath:A,customTitle:b,onSaveSuccess:p.useCallback(o=>{W(o),_((s==null?void 0:s.getJSON())||null),T(!1)},[s,W,_,T]),onLoadSuccess:p.useCallback(o=>{W(o),T(!1),_((s==null?void 0:s.getJSON())||null)},[s,W,T,_])}),{isDraggingOver:Me,dragHandlers:Le}=Pt({hasUnsavedChanges:B,onFileDropped:async o=>{try{await ie(o)}catch(h){console.error("Failed to handle dropped file:",h)}},onConfirmOverwrite:()=>{k==null||k.openConfirmNewDialog()}});p.useEffect(()=>{if(!s)return;const o=()=>{const h=s.getJSON();_(h),B||(T(!0),console.log("[TextEdit] Content changed, marked as unsaved. Instance ID:",r,"Has path:",!!A))};return s.on("update",o),()=>{s.off("update",o)}},[s,B,_,T,r,A]),p.useEffect(()=>{if(!s)return;(async()=>{const h=u;if(h!=null&&h.path&&(h==null?void 0:h.content)!==void 0){console.log("[TextEdit] Loading content from initialData:",h.path),await oe(h.path,h.content),r?x(r):c("textedit");return}else if(h!=null&&h.path&&(h==null?void 0:h.content)===void 0){console.log("[TextEdit] Loading content from database via initialData path:",h.path),await P(h.path),r?x(r):c("textedit");return}if(r)return;let y=!1;if(ae&&R)try{s.commands.setContent(R,!1),y=!0,console.log("Restored unsaved TextEdit content from store")}catch(E){console.warn("Failed to restore unsaved TextEdit content:",E)}if(!y&&se&&await P(se)&&(y=!0),!y&&R)try{s.commands.setContent(R,!1),T(!1),console.log("Loaded content from store JSON (fallback)")}catch(E){console.warn("Failed to restore stored TextEdit content:",E)}})()},[s,u,r,se,R,ae,oe,P,c,x,T]),p.useEffect(()=>{!s||!r||!J&&A&&(console.log("[TextEdit] Restoring instance content from DB for path:",A),P(A))},[s,r,J,A,P]),p.useEffect(()=>{const o=y=>{var E,q;if(s&&((E=y.detail)==null?void 0:E.path)===A&&((q=y.detail)!=null&&q.content))try{const I=JSON.parse(y.detail.content),{from:ne,to:me}=s.state.selection;if(s.commands.setContent(I),ne&&me&&ne===me)try{s.commands.setTextSelection(Math.min(ne,s.state.doc.content.size))}catch(ze){console.log("Could not restore cursor position",ze)}T(!1),console.log("Editor content updated from external source")}catch(I){console.error("Failed to update editor content:",I)}},h=y=>{var E,q;if(s&&((E=y.detail)==null?void 0:E.path)===A&&((q=y.detail)!=null&&q.content))try{const I=JSON.parse(y.detail.content);s.commands.setContent(I),T(!1),console.log("Editor content updated after document updated event")}catch(I){console.error(n("apps.textedit.failedToUpdateEditorWithDocumentUpdatedEvent"),I)}};return window.addEventListener("updateEditorContent",o),window.addEventListener("documentUpdated",h),()=>{window.removeEventListener("updateEditorContent",o),window.removeEventListener("documentUpdated",h)}},[s,A,T]),p.useEffect(()=>{if(!s||!J)return;const o=s.getJSON();if(JSON.stringify(o)!==JSON.stringify(J))try{s.commands.setContent(J,!1),T(!1),console.log("[TextEdit] Editor content synced from store change")}catch(h){console.error("[TextEdit] Failed to sync editor content:",h)}},[J,s,T]);const Oe=o=>{j(!1),s&&(s.isFocused||s.commands.focus(),s.state.selection.empty&&s.state.selection.anchor===0&&(s.commands.setTextSelection(s.state.doc.content.size),s.commands.insertContent(`
`)),s.commands.insertContent(o))},He=()=>{j(!0)},Fe=()=>{const o=g("textedit",null,n("apps.textedit.untitled"),!0);console.log(`Created new TextEdit file in instance: ${o}`)},_e=()=>{if(s){s.commands.clearContent(),_(null),W(null),T(!1);const o=localStorage.getItem("pending_file_open");if(o)try{const{path:h,content:y}=JSON.parse(o);if(h.startsWith("/Documents/")){const E=h.endsWith(".md")?V(y):y;s.commands.setContent(E),W(h),T(!1),_(s.getJSON())}}catch(h){console.error("Failed to parse pending file open data:",h)}finally{localStorage.removeItem("pending_file_open")}}},$e=async()=>{if(A)try{await le()}catch(o){console.error("Save failed:",o)}else{const o=re();z(`${o}.md`),k==null||k.openSaveDialog()}},Ue=async o=>{try{await ce(o),k==null||k.closeSaveDialog()}catch(h){console.error("Save failed:",h)}},he=async o=>{var y;const h=(y=o.target.files)==null?void 0:y[0];if(h)try{await ie(h)}catch(E){console.error("Import failed:",E)}i.current&&(i.current.value="")},Be=()=>{l("finder",{initialPath:"/Documents"})},pe=()=>{const o=!A,h=s&&(!s.isEmpty||s.getText().trim().length>0||s.getHTML()!=="<p></p>");if(B||o&&h){if(o&&s){const y=re();te(`${y}.md`)}else te((A==null?void 0:A.split("/").pop())||`${n("apps.textedit.untitled")}.md`);k==null||k.openCloseSaveDialog()}else window.dispatchEvent(new CustomEvent(`closeWindow-${r||"textedit"}`,{detail:{onComplete:m}}))},Ie=()=>{k==null||k.closeCloseSaveDialog(),window.dispatchEvent(new CustomEvent(`closeWindow-${r||"textedit"}`,{detail:{onComplete:m}}))},Je=async o=>{try{A?await le():await ce(o),k==null||k.closeCloseSaveDialog(),window.dispatchEvent(new CustomEvent(`closeWindow-${r||"textedit"}`,{detail:{onComplete:m}}))}catch(h){console.error("Save before close failed:",h)}},We=B||!A&&s&&(!s.isEmpty||s.getText().trim().length>0||s.getHTML()!=="<p></p>"),xe=t.jsx(_t,{editor:s,onClose:pe,isWindowOpen:e,onShowHelp:()=>k==null?void 0:k.openHelpDialog(),onShowAbout:()=>k==null?void 0:k.openAboutDialog(),onNewFile:Fe,onImportFile:Be,onExportFile:De,onSave:$e,hasUnsavedChanges:B,currentFilePath:A,handleFileSelect:he});return e?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"file",ref:i,onChange:he,accept:".txt,.html,.md,.rtf,.doc,.docx",className:"hidden"}),!M&&v&&xe,t.jsx(ft,{title:b||(A?`${Se(A.split("/").pop()||"")}${B?" •":""}`:`${n("apps.textedit.untitled")}${We?" •":""}`),onClose:pe,isForeground:v,appId:"textedit",skipInitialSound:d,instanceId:r,interceptClose:!0,onNavigateNext:w,onNavigatePrevious:N,menuBar:M?xe:void 0,children:t.jsxs("div",{className:"flex flex-col h-full w-full",children:[t.jsx("div",{className:`flex-1 flex flex-col relative min-h-0 ${Me?"after:absolute after:inset-0 after:bg-black/20":""}`,...Le,children:t.jsx(Bt,{editor:s,speechEnabled:C,children:({isSpeaking:o,isTtsLoading:h,handleSpeak:y})=>t.jsxs(t.Fragment,{children:[t.jsx($t,{editor:s,currentTheme:a,speechEnabled:C,isTranscribing:f,isTtsLoading:h,isSpeaking:o,onTranscriptionComplete:Oe,onTranscriptionStart:He,onSpeak:y}),t.jsx(Ut,{className:"flex-1 overflow-y-auto w-full min-h-0 bg-white"})]})})}),t.jsx(It,{saveFileName:L,setSaveFileName:z,closeSaveFileName:Te,setCloseSaveFileName:te,onSaveSubmit:Ue,onCloseSave:Je,onCloseDelete:Ie,onConfirmNew:_e,onControlsReady:Ee,isUntitledForClose:!A})]})})]}):null}function cs(e){return t.jsx(mt,{children:t.jsx(qt,{...e})})}export{cs as TextEditAppComponent};
