import{r as s,j as e,k as Ps}from"./ui-core-D0pDhx0h.js";import{R as is}from"./index-B2E7WcJr.js";import{u as Ve,bw as ls,bx as Ee,by as Ze,bz as G,a as cs,M as $s,b as st,d as nt,e as at,f as de,g as Ie,k as he,h as mt,i as gt,j as xt,bA as Ds,bB as Fs,a4 as be,S as ds,l as Vs,m as Bs,am as fe,bC as Us,Y as us,aI as w,bD as Zt,a0 as Qt,n as es,o as ts,b1 as _s,an as ps,bE as zs,E as Ws,as as ss,ai as Ys,bF as Hs,Z as Xs,aD as Ks,H as qs,J as Gs,bG as Js,G as Zs,I as Qs,bH as en,bI as tn}from"./index-BxS3VOwZ.js";import{C as sn}from"./opencc-DdAalh07.js";import{m as Fe,A as rt}from"./motion-DC7C-474.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";function nn({onClose:i,onShowHelp:r,onShowAbout:p,onClearLibrary:C,onSyncLibrary:k,onAddTrack:g,onShareSong:L}){var Qe;const{t:l}=Ve(),[d,x]=s.useState(!1),I="ipod",N=(Qe=Bs[I])==null?void 0:Qe.name,f=[{label:l("apps.ipod.translationLanguages.original"),code:null},{label:"English",code:"en"},{label:"中文",code:"zh-TW"},{label:"日本語",code:"ja"},{label:"한국어",code:"ko"},{label:"Español",code:"es"},{label:"Français",code:"fr"},{label:"Deutsch",code:"de"},{label:"Português",code:"pt"},{label:"Italiano",code:"it"},{label:"Русский",code:"ru"}],{tracks:b,currentIndex:P,isLoopAll:Z,isLoopCurrent:Y,isPlaying:D,isShuffled:B,isBacklightOn:v,isVideoOn:H,isLcdFilterOn:J,currentTheme:Q,showLyrics:ee,isFullScreen:U,lyricsAlignment:S,chineseVariant:m,koreanDisplay:u,lyricsTranslationLanguage:E,setCurrentIndex:T,setIsPlaying:X,toggleLoopAll:j,toggleLoopCurrent:y,toggleShuffle:F,togglePlay:R,nextTrack:z,previousTrack:se,toggleBacklight:Se,toggleVideo:Ce,toggleLcdFilter:ye,toggleFullScreen:h,setTheme:n,toggleLyrics:V,setLyricsAlignment:te,refreshLyrics:q,setChineseVariant:ce,setKoreanDisplay:oe,setLyricsTranslationLanguage:_,importLibrary:K,exportLibrary:ie}=ls(a=>({tracks:a.tracks,currentIndex:a.currentIndex,isLoopAll:a.loopAll,isLoopCurrent:a.loopCurrent,isPlaying:a.isPlaying,isShuffled:a.isShuffled,isBacklightOn:a.backlightOn,isVideoOn:a.showVideo,isLcdFilterOn:a.lcdFilterOn,currentTheme:a.theme,showLyrics:a.showLyrics,isFullScreen:a.isFullScreen,lyricsAlignment:a.lyricsAlignment??G.FocusThree,chineseVariant:a.chineseVariant??Ze.Traditional,koreanDisplay:a.koreanDisplay??Ee.Original,lyricsTranslationLanguage:a.lyricsTranslationLanguage,setCurrentIndex:a.setCurrentIndex,setIsPlaying:a.setIsPlaying,toggleLoopAll:a.toggleLoopAll,toggleLoopCurrent:a.toggleLoopCurrent,toggleShuffle:a.toggleShuffle,togglePlay:a.togglePlay,nextTrack:a.nextTrack,previousTrack:a.previousTrack,toggleBacklight:a.toggleBacklight,toggleVideo:a.toggleVideo,toggleLcdFilter:a.toggleLcdFilter,toggleFullScreen:a.toggleFullScreen,setTheme:a.setTheme,toggleLyrics:a.toggleLyrics,setLyricsAlignment:a.setLyricsAlignment,refreshLyrics:a.refreshLyrics,setChineseVariant:a.setChineseVariant,setKoreanDisplay:a.setKoreanDisplay,setLyricsTranslationLanguage:a.setLyricsTranslationLanguage,importLibrary:a.importLibrary,exportLibrary:a.exportLibrary})),me=cs(a=>a.current),ae=me==="xp"||me==="win98",ue=a=>{T(a),X(!0)},Oe=b.reduce((a,re,ke)=>{const ge=re.artist||l("apps.ipod.menu.unknownArtist");return a[ge]||(a[ge]=[]),a[ge].push({track:re,index:ke}),a},{}),Me=Object.keys(Oe).sort((a,re)=>a.localeCompare(re,void 0,{sensitivity:"base"})),Be=()=>{try{const a=ie(),re=new Blob([a],{type:"application/json"}),ke=URL.createObjectURL(re),ge=document.createElement("a");ge.href=ke,ge.download="ipod-library.json",document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(ke),fe.success(l("apps.ipod.dialogs.libraryExportedSuccessfully"))}catch(a){console.error("Failed to export library:",a),fe.error(l("apps.ipod.dialogs.failedToExportLibrary"))}},we=()=>{const a=document.createElement("input");a.type="file",a.accept=".json",a.onchange=re=>{var ot;const ke=(ot=re.target.files)==null?void 0:ot[0];if(!ke)return;const ge=new FileReader;ge.onload=ze=>{var it;try{const We=(it=ze.target)==null?void 0:it.result;K(We),fe.success(l("apps.ipod.dialogs.libraryImportedSuccessfully"))}catch(We){console.error("Failed to import library:",We),fe.error(l("apps.ipod.dialogs.failedToImportLibrary"))}},ge.readAsText(ke)},a.click()};return e.jsxs($s,{inWindowFrame:ae,children:[e.jsxs(st,{children:[e.jsx(nt,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:l("apps.ipod.menu.file")}),e.jsxs(at,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(de,{onClick:g,className:"text-md h-6 px-3",children:l("apps.ipod.menu.addSong")}),e.jsx(de,{onClick:L,className:"text-md h-6 px-3",disabled:b.length===0||P===-1,children:l("apps.ipod.menu.shareSong")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(de,{onClick:Be,className:"text-md h-6 px-3",disabled:b.length===0,children:l("apps.ipod.menu.exportLibrary")}),e.jsx(de,{onClick:we,className:"text-md h-6 px-3",children:l("apps.ipod.menu.importLibrary")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(de,{onClick:i,className:"text-md h-6 px-3",children:l("common.menu.close")})]})]}),e.jsxs(st,{children:[e.jsx(nt,{className:"px-2 py-1 text-md focus-visible:ring-0",children:l("apps.ipod.menu.controls")}),e.jsxs(at,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(de,{onClick:R,className:"text-md h-6 px-3",disabled:b.length===0,children:l(D?"apps.ipod.menu.pause":"apps.ipod.menu.play")}),e.jsx(de,{onClick:se,className:"text-md h-6 px-3",disabled:b.length===0,children:l("apps.ipod.menu.previous")}),e.jsx(de,{onClick:z,className:"text-md h-6 px-3",disabled:b.length===0,children:l("apps.ipod.menu.next")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:B,onCheckedChange:()=>F(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.shuffle")}),e.jsx(he,{checked:Z,onCheckedChange:()=>j(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.repeatAll")}),e.jsx(he,{checked:Y,onCheckedChange:()=>y(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.repeatOne")})]})]}),e.jsxs(st,{children:[e.jsx(nt,{className:"px-2 py-1 text-md focus-visible:ring-0",children:l("apps.ipod.menu.view")}),e.jsxs(at,{align:"start",sideOffset:1,className:"px-0",children:[e.jsxs(mt,{children:[e.jsx(gt,{className:"text-md h-6 px-3",children:l("apps.ipod.menu.lyrics")}),e.jsxs(xt,{className:"px-0",children:[e.jsx(he,{checked:ee,onCheckedChange:()=>V(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.showLyrics")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:m===Ze.Traditional,onCheckedChange:a=>ce(a?Ze.Traditional:Ze.Original),className:"text-md h-6 px-3",children:l("apps.ipod.menu.traditionalChinese")}),e.jsx(he,{checked:u===Ee.Original,onCheckedChange:a=>oe(a?Ee.Original:Ee.Romanized),className:"text-md h-6 px-3",children:l("apps.ipod.menu.korean")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:S===G.FocusThree,onCheckedChange:a=>{a&&te(G.FocusThree)},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.multi")}),e.jsx(he,{checked:S===G.Center,onCheckedChange:a=>{a&&te(G.Center)},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.single")}),e.jsx(he,{checked:S===G.Alternating,onCheckedChange:a=>{a&&te(G.Alternating)},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.alternating")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(de,{onClick:q,className:"text-md h-6 px-3",disabled:b.length===0||P===-1,children:l("apps.ipod.menu.refreshLyrics")})]})]}),e.jsxs(mt,{children:[e.jsx(gt,{className:"text-md h-6 px-3",children:l("apps.ipod.menu.translate")}),e.jsx(xt,{className:"px-0 max-h-[400px] overflow-y-auto",children:e.jsx(Ds,{value:E||"off",onValueChange:a=>{_(a==="off"?null:a)},children:f.map(a=>{const re=a.code||"off";return e.jsx(Fs,{value:re,className:"text-md h-6 pr-3",children:a.label},re)})})})]}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:v,onCheckedChange:()=>Se(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.backlight")}),e.jsx(he,{checked:J,onCheckedChange:()=>ye(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.lcdFilter")}),e.jsx(he,{checked:H,onCheckedChange:()=>Ce(),className:"text-md h-6 px-3",disabled:!D,children:l("apps.ipod.menu.video")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:Q==="classic",onCheckedChange:a=>{a&&n("classic")},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.classic")}),e.jsx(he,{checked:Q==="black",onCheckedChange:a=>{a&&n("black")},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.black")}),e.jsx(he,{checked:Q==="u2",onCheckedChange:a=>{a&&n("u2")},className:"text-md h-6 pr-3",children:l("apps.ipod.menu.u2")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(he,{checked:U,onCheckedChange:()=>h(),className:"text-md h-6 px-3",children:l("apps.ipod.menu.fullScreen")})]})]}),e.jsxs(st,{children:[e.jsx(nt,{className:"px-2 py-1 text-md focus-visible:ring-0",children:l("apps.ipod.menu.library")}),e.jsxs(at,{align:"start",sideOffset:1,className:"px-0 max-w-[180px] sm:max-w-[220px]",children:[e.jsx(de,{onClick:g,className:"text-md h-6 px-3",children:l("apps.ipod.menu.addToLibrary")}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsxs(mt,{children:[e.jsx(gt,{className:"text-md h-6 px-3",children:e.jsx("div",{className:"flex justify-between w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate min-w-0",children:l("apps.ipod.menu.allSongs")})})}),e.jsx(xt,{className:"px-0 max-w-[180px] sm:max-w-[220px] max-h-[400px] overflow-y-auto",children:b.map((a,re)=>e.jsx(de,{onClick:()=>ue(re),className:be("text-md h-6 px-3 max-w-[220px] truncate",re===P&&"bg-gray-200"),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:be("flex-none whitespace-nowrap",re===P?"mr-1":"pl-5"),children:re===P?"♪ ":""}),e.jsx("span",{className:"truncate min-w-0",children:a.title})]})},`all-${a.id}`))})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:Me.map(a=>e.jsxs(mt,{children:[e.jsx(gt,{className:"text-md h-6 px-3",children:e.jsx("div",{className:"flex justify-between w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate min-w-0",children:a})})}),e.jsx(xt,{className:"px-0 max-w-[180px] sm:max-w-[220px] max-h-[200px] overflow-y-auto",children:Oe[a].map(({track:re,index:ke})=>e.jsx(de,{onClick:()=>ue(ke),className:be("text-md h-6 px-3 max-w-[160px] sm:max-w-[200px] truncate",ke===P&&"bg-gray-200"),children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:be("flex-none whitespace-nowrap",ke===P?"mr-1":"pl-5"),children:ke===P?"♪ ":""}),e.jsx("span",{className:"truncate min-w-0",children:re.title})]})},`${a}-${re.id}`))})]},a))}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"})]}),e.jsx(de,{onClick:C,className:"text-md h-6 px-3",children:l("apps.ipod.menu.clearLibrary")}),e.jsx(de,{onClick:k,className:"text-md h-6 px-3",children:l("apps.ipod.menu.syncLibrary")})]})]}),e.jsxs(st,{children:[e.jsx(nt,{className:"px-2 py-1 text-md focus-visible:ring-0",children:l("common.menu.help")}),e.jsxs(at,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(de,{onClick:r,className:"text-md h-6 px-3",children:l("apps.ipod.menu.ipodHelp")}),e.jsx(de,{onSelect:()=>x(!0),className:"text-md h-6 px-3",children:l("apps.ipod.menu.shareApp")}),e.jsx(Ie,{className:"h-[2px] bg-black my-1"}),e.jsx(de,{onClick:p,className:"text-md h-6 px-3",children:l("apps.ipod.menu.aboutIpod")})]})]}),e.jsx(ds,{isOpen:d,onClose:()=>x(!1),itemType:"App",itemIdentifier:I,title:N,generateShareUrl:Vs})]})}const bt={spring:{type:"spring",stiffness:200,damping:30,mass:1},fade:{duration:.2}},an=({bottomPaddingClass:i="pb-5",textSizeClass:r="text-[12px]",fontClassName:p="font-geneva-12"})=>{const{t:C}=Ve();return e.jsx("div",{className:`absolute inset-x-0 top-0 left-0 right-0 bottom-0 pointer-events-none flex items-end justify-center z-40 ${i}`,children:e.jsx("div",{className:`${r} ${p} shimmer opacity-60`,children:C("apps.ipod.status.loadingLyrics")})})},rn=({bottomPaddingClass:i="pb-5",textSizeClass:r="text-[12px]",fontClassName:p="font-geneva-12"})=>{const{t:C}=Ve();return e.jsx("div",{className:`absolute inset-x-0 top-0 left-0 right-0 bottom-0 pointer-events-none flex items-end justify-center z-40 ${i}`,children:e.jsx("div",{className:`${r} ${p} shimmer opacity-60`,children:C("apps.ipod.status.translatingLyrics")})})},ns=({bottomPaddingClass:i="pb-5",textSizeClass:r="text-[12px]",fontClassName:p="font-geneva-12"})=>e.jsx("div",{className:`absolute inset-x-0 top-0 left-0 right-0 bottom-0 pointer-events-none flex items-end justify-center z-40 ${i}`,children:e.jsx("div",{className:`text-white/70 ${r} ${p}`})}),on=(i,r,p)=>({initial:{opacity:0,scale:.93,filter:"none",y:10,textShadow:"0 0 2px black, 0 0 2px black, 0 0 2px black, 0 0 0px rgba(255,255,255,0)"},animate:{opacity:r?p?1:.5:p?1:i===1||i===-1?.5:.1,scale:r||p||i===1||i===-1?1:.9,filter:"none",y:0,textShadow:p?"0 0 8px rgba(255,255,255,0.9), 0 0 2px black, 0 0 2px black, 0 0 2px black":"0 0 2px black, 0 0 2px black, 0 0 2px black"},exit:{opacity:0,scale:.9,filter:"none",y:-10,textShadow:"0 0 2px black, 0 0 2px black, 0 0 2px black, 0 0 0px rgba(255,255,255,0)"}});function hs({lines:i,currentLine:r,isLoading:p,error:C,visible:k=!0,videoVisible:g=!0,alignment:L=G.FocusThree,chineseVariant:l=Ze.Traditional,koreanDisplay:d=Ee.Original,onAdjustOffset:x,isTranslating:I=!1,textSizeClass:N="text-[12px]",lineHeightClass:f="leading-[1.1]",interactive:b=!0,bottomPaddingClass:P="pb-5",gapClass:Z="gap-2",fontClassName:Y="font-geneva-12",containerStyle:D}){const B=s.useMemo(()=>sn({from:"cn",to:"tw"}),[]),v=j=>{const y=/[\u4E00-\u9FFF]/,F=/[\u3040-\u309F\u30A0-\u30FF]/;return y.test(j)&&!F.test(j)},H=j=>{let y=j;return l===Ze.Traditional&&v(y)&&(y=B(y)),d===Ee.Romanized&&/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/.test(y)&&(y=Us.convert(y)),y},J=(j,y,F)=>j===G.Center||j===G.FocusThree?"center":j===G.Alternating?F===1?"center":y===0?"left":"right":F===1?"center":F===2?y===0?"left":"right":y===0?"left":y===1?"center":y===2?"right":"center",Q=(j,y)=>{if(!j.length)return[];if(y<0)return j.slice(0,2).filter(Boolean);const F=Math.min(y,j.length-1),R=j[F+1];return F%2===0?[j[F],R].filter(Boolean):[R,j[F]].filter(Boolean)},[ee,U]=s.useState(()=>Q(i,r));s.useEffect(()=>{if(L!==G.Alternating)return;const j=Math.min(Math.max(0,r),i.length-1),y=j>=0&&i[j]?parseInt(i[j].startTimeMs):null,F=j+1<i.length&&i[j+1]?parseInt(i[j+1].startTimeMs):null,R=y!==null&&F!==null?F-y:0,z=Math.max(20,Math.floor(R*.2)),se=setTimeout(()=>{U(Q(i,r))},z);return()=>clearTimeout(se)},[L,i,r]);const S=s.useMemo(()=>{if(!i.length)return[];if(r<0)return i.slice(0,1).filter(Boolean);if(L===G.Center){const j=Math.min(Math.max(0,r),i.length-1),y=i[j];return y?[y]:[]}return i.slice(Math.max(0,r-1),r+2)},[i,r,L]),m=L===G.Alternating?ee:S,u=s.useRef(null),E=j=>{if(!b||!x||!g)return;const R=j.deltaY>0?50:-50;x(R)},T=j=>{b&&j.touches.length===1&&(u.current=j.touches[0].clientY)},X=j=>{if(!b||u.current===null||!x||!g)return;const y=j.touches[0].clientY,F=y-u.current;if(Math.abs(F)>10){const z=F>0?50:-50;x(z),u.current=y}};return k?p?e.jsx(an,{bottomPaddingClass:P,textSizeClass:N,fontClassName:Y}):I?e.jsx(rn,{bottomPaddingClass:P,textSizeClass:N,fontClassName:Y}):C?e.jsx(ns,{bottomPaddingClass:P,textSizeClass:N,fontClassName:Y}):!i.length&&!p&&!I?e.jsx(ns,{bottomPaddingClass:P,textSizeClass:N,fontClassName:Y}):e.jsx(Fe.div,{layout:L===G.Alternating,transition:bt.spring,className:`absolute inset-x-0 mx-auto top-0 left-0 right-0 bottom-0 w-full h-full overflow-hidden flex flex-col items-center justify-end ${Z} z-40 select-none px-0 ${P}`,style:{...D||{},pointerEvents:b?"auto":"none"},onWheel:E,onTouchStart:T,onTouchMove:X,children:e.jsx(rt,{mode:"popLayout",children:m.map((j,y)=>{const F=j===i[r];let R=0;if(L===G.Alternating)R=F?0:1;else{const Ce=i.indexOf(i[r]);R=i.indexOf(j)-Ce}const z=on(R,L===G.Alternating,F),se={...bt.spring,opacity:bt.fade,filter:bt.fade,duration:.15},Se=J(L,y,m.length);return e.jsx(Fe.div,{layoutId:`${j.startTimeMs}-${j.words.substring(0,10)}`,initial:"initial",animate:"animate",exit:"exit",variants:z,transition:se,className:`px-2 md:px-6 ${N} ${Y} ${f} whitespace-pre-wrap break-words max-w-full text-white`,style:{textAlign:Se,width:"100%",paddingLeft:L===G.Alternating&&y===0&&m.length>1?"5%":void 0,paddingRight:L===G.Alternating&&y===1&&m.length>1?"5%":void 0},children:H(j.words)},j.startTimeMs)})})}):null}function ln({backlightOn:i}){const[r,p]=s.useState(null),[C,k]=s.useState(!1),[g,L]=s.useState(1);s.useEffect(()=>{(async()=>{try{if("getBattery"in navigator){const I=await navigator.getBattery();p(I.level),k(I.charging);const N=()=>p(I.level),f=()=>k(I.charging);return I.addEventListener("levelchange",N),I.addEventListener("chargingchange",f),()=>{I.removeEventListener("levelchange",N),I.removeEventListener("chargingchange",f)}}}catch{p(1),k(!1)}})()},[]),s.useEffect(()=>{if(!C)return;const x=setInterval(()=>{L(I=>I%4+1)},500);return()=>clearInterval(x)},[C]);const d=C?g:Math.ceil((r??1)*4);return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"relative w-[19px] h-[10px] border border-[#0a3667] bg-transparent",children:e.jsx("div",{className:"absolute inset-[1px] flex gap-[1px]",children:[1,2,3,4].map(x=>e.jsx("div",{className:`flex-1 h-full transition-colors duration-200 ${x<=d?"bg-[#0a3667]":"bg-transparent"}`},x))})}),e.jsx("div",{className:"w-[2px] h-[4px] bg-[#0a3667] relative",children:e.jsx("div",{className:`w-[2px] h-[2px] absolute top-[1px] left-[-2px] right-[0px] mx-auto ${i?"bg-[#c5e0f5]":"bg-[#8a9da9]"}`})})]})}function cn({containerRef:i,backlightOn:r,menuMode:p}){const C=s.useRef(null),k=s.useRef(null);return s.useLayoutEffect(()=>{const g=i.current,L=C.current,l=k.current;if(!g||!L||!l||!p)return;const d=()=>{const{scrollTop:I,scrollHeight:N,clientHeight:f}=g;if(N>f){l.style.opacity="1",L.style.display="block";const P=f+3,Z=Math.max(f/N*P,20),Y=N-f,D=P-Z,B=Y>0?I/Y*D:0;L.style.height=`${Z-4}px`,L.style.top=`${B+2}px`}else l.style.opacity="0",L.style.display="none"};d(),g.addEventListener("scroll",d,{passive:!0});const x=new ResizeObserver(d);return x.observe(g),()=>{g.removeEventListener("scroll",d),x.disconnect()}},[i,p]),p?e.jsxs("div",{className:"absolute right-0 top-[-1px] bottom-[-2px] w-2 z-20",children:[e.jsx("div",{ref:k,className:be("w-full h-full border border-[#0a3667] transition-all duration-500",r?"bg-[#c5e0f5] bg-gradient-to-b from-[#d1e8fa] to-[#e0f0fc]":"bg-[#8a9da9]"),style:{opacity:0}}),e.jsx("div",{ref:C,className:"absolute right-0 bg-[#0a3667]",style:{marginLeft:"2px",marginRight:"2px",width:"calc(100% - 4px)",display:"none"}})]}):null}function dn({text:i,isSelected:r,onClick:p,backlightOn:C=!0,showChevron:k=!0,value:g}){return e.jsxs("div",{onClick:p,className:be("pl-2 cursor-pointer font-chicago text-[16px] flex justify-between items-center",k||g?"pr-4":"pr-2",r?C?"bg-[#0a3667] text-[#c5e0f5] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]":"bg-[#0a3667] text-[#8a9da9] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]":"text-[#0a3667] hover:bg-[#c0d8f0] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]"),children:[e.jsx("span",{className:"whitespace-nowrap overflow-hidden text-ellipsis flex-1 mr-2",children:i}),g?e.jsx("span",{className:"flex-shrink-0",children:g}):k&&e.jsx("span",{className:"flex-shrink-0",children:">"})]})}function as({text:i,className:r,isPlaying:p=!0}){const C=s.useRef(null),k=s.useRef(null),[g,L]=s.useState(!1),[l,d]=s.useState(0),x=20;return s.useEffect(()=>{if(C.current&&k.current){const I=C.current.clientWidth,N=k.current.scrollWidth;d(N),L(N>I)}},[i,C,k]),e.jsx("div",{ref:C,className:be("relative overflow-hidden",!g&&"flex justify-center",r),children:g?e.jsx("div",{className:"inline-block whitespace-nowrap",children:e.jsxs(Fe.div,{animate:{x:p?[0,-(l+x)]:0},transition:p?{duration:Math.max(i.length*.15,8),ease:"linear",repeat:1/0}:{duration:.3},style:{display:"inline-flex"},children:[e.jsx("span",{ref:k,style:{paddingRight:`${x}px`},children:i}),e.jsx("span",{style:{paddingRight:`${x}px`},"aria-hidden":!0,children:i})]})}):e.jsx("div",{ref:k,className:"whitespace-nowrap text-center",children:i})})}function un({message:i}){return e.jsx("div",{className:"absolute top-4 left-4 pointer-events-none",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"font-chicago text-white text-xl relative z-10",children:i}),e.jsx("div",{className:"font-chicago text-black text-xl absolute inset-0",style:{WebkitTextStroke:"3px black",textShadow:"none"},children:i})]})})}function pn({currentTrack:i,isPlaying:r,elapsedTime:p,totalTime:C,menuMode:k,menuHistory:g,selectedMenuItem:L,onSelectMenuItem:l,currentIndex:d,tracksLength:x,backlightOn:I,menuDirection:N,onMenuItemAction:f,showVideo:b,playerRef:P,handleTrackEnd:Z,handleProgress:Y,handleDuration:D,handlePlay:B,handlePause:v,handleReady:H,loopCurrent:J,statusMessage:Q,onToggleVideo:ee,lcdFilterOn:U,ipodVolume:S,showStatusCallback:m,showLyrics:u,lyricsAlignment:E,chineseVariant:T,koreanDisplay:X,lyricOffset:j,adjustLyricOffset:y,registerActivity:F,isFullScreen:R,lyricsControls:z}){const{t:se}=Ve(),Se={enter:_=>({x:_==="forward"?"100%":"-100%"}),center:{x:0},exit:_=>({x:_==="forward"?"-100%":"100%"})},Ce=k?g.length>0?g[g.length-1].title:se("apps.ipod.menuItems.ipod"):se("apps.ipod.menuItems.nowPlaying"),ye=s.useRef(null),h=s.useRef([]),n=s.useRef(!1),V=us(_=>_.masterVolume),te=S*V,q=_=>{h.current=Array(_).fill(null)},ce=()=>{if(!k||g.length===0)return;const _=document.querySelector(".ipod-menu-container");if(!_)return;const K=Array.from(_.querySelectorAll(".ipod-menu-item"));if(!K.length||L<0||L>=K.length)return;const ie=K[L];if(!ie)return;const me=_.clientHeight,ae=ie.offsetTop,ue=ie.offsetHeight,Oe=_.scrollTop,Me=2;ae+ue>Oe+me-Me?_.scrollTo({top:ae+ue-me+Me,behavior:"instant"}):ae<Oe+Me&&_.scrollTo({top:Math.max(0,ae-Me),behavior:"instant"}),L===0&&_.scrollTo({top:0,behavior:"instant"}),L===K.length-1&&_.scrollTo({top:Math.max(0,ae-(me-ue)+Me),behavior:"instant"}),n.current=!1};s.useEffect(()=>{k&&g.length>0&&(n.current=!0,ce(),[50,100,250,500,1e3].forEach(K=>{setTimeout(()=>{n.current&&ce()},K)}))},[k,L,g.length]),s.useEffect(()=>{if(k&&g.length>0){const _=g[g.length-1];q(_.items.length)}},[k,g.length]);const oe=u;return e.jsxs("div",{className:be("relative w-full h-[150px] border border-black border-2 rounded-[2px] overflow-hidden transition-all duration-500 select-none",U?"lcd-screen":"",I?"bg-[#c5e0f5] bg-gradient-to-b from-[#d1e8fa] to-[#e0f0fc]":"bg-[#8a9da9] contrast-65 saturate-50",U&&I&&"shadow-[0_0_10px_2px_rgba(197,224,245,0.05)]"),style:{minWidth:"100%",minHeight:"150px",maxWidth:"100%",maxHeight:"150px",position:"relative",contain:"layout style paint"},children:[U&&e.jsx("div",{className:"absolute inset-0 pointer-events-none z-25 lcd-scan-lines"}),U&&e.jsx("div",{className:"absolute inset-0 pointer-events-none z-25 lcd-reflection"}),i&&e.jsx("div",{className:be("absolute inset-0 transition-opacity duration-300 overflow-hidden",k?"z-0":"z-20",k||!b?"opacity-0 pointer-events-none":"opacity-100"),children:e.jsxs("div",{className:"w-full h-[calc(100%+120px)] mt-[-60px]",onClick:_=>{_.stopPropagation(),F(),r?ee():b?B():(ee(),setTimeout(()=>{B()},100))},children:[e.jsx(is,{ref:P,url:i.url,playing:r,controls:b,width:"100%",height:"100%",onEnded:R?void 0:Z,onProgress:R?void 0:Y,onDuration:R?void 0:D,onPlay:R?void 0:B,onPause:R?void 0:v,onReady:R?void 0:H,loop:J,volume:te,playsinline:!0,config:{youtube:{playerVars:{modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,fs:0,disablekb:1,playsinline:1,enablejsapi:1,origin:window.location.origin},embedOptions:{referrerPolicy:"strict-origin-when-cross-origin"}}}}),b&&oe&&e.jsx("div",{className:"absolute inset-0 bg-black/30 z-25"}),b&&e.jsx("div",{className:"absolute inset-0 z-30",onClick:_=>{_.stopPropagation(),r?ee():B()}}),e.jsx(rt,{children:Q&&e.jsx(Fe.div,{className:"absolute inset-0 z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(un,{message:Q})})}),e.jsx(hs,{lines:z.lines,currentLine:z.currentLine,isLoading:z.isLoading,error:z.error,visible:oe,videoVisible:b,alignment:E,chineseVariant:T,koreanDisplay:X,isTranslating:z.isTranslating,onAdjustOffset:_=>{y(_);const K=j+_,ie=K>0?"+":(K<0,"");m(`${se("apps.ipod.status.offset")} ${ie}${(K/1e3).toFixed(2)}s`);const me=p+K/1e3;z.updateCurrentTimeManually(me)}})]})}),e.jsxs("div",{className:"border-b border-[#0a3667] py-0 px-2 font-chicago text-[16px] flex items-center sticky top-0 z-10 text-[#0a3667] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]",children:[e.jsx("div",{className:`w-6 flex items-center justify-start font-chicago ${r?"text-xs":"text-[18px]"}`,children:e.jsx("div",{className:"w-4 h-4 mt-0.5 flex items-center justify-center",children:r?"▶":"⏸︎"})}),e.jsx("div",{className:"flex-1 truncate text-center",children:Ce}),e.jsx("div",{className:"w-6 flex items-center justify-end",children:e.jsx(ln,{backlightOn:I})})]}),e.jsx("div",{className:"relative h-[calc(100%-26px)]",children:e.jsx(rt,{initial:!1,custom:N,mode:"sync",children:k?e.jsx(Fe.div,{className:"absolute inset-0 flex flex-col h-full",initial:"enter",animate:"center",exit:"exit",variants:Se,transition:{duration:.2,ease:"easeInOut"},custom:N,onAnimationComplete:()=>{n.current=!0,ce()},children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{ref:ye,className:"absolute inset-0 overflow-auto ipod-menu-container",children:g.length>0&&g[g.length-1].items.map((_,K)=>e.jsx("div",{ref:ie=>{h.current[K]=ie},className:`ipod-menu-item ${K===L?"selected":""}`,children:e.jsx(dn,{text:_.label,isSelected:K===L,backlightOn:I,onClick:()=>{l(K),f(_.action)},showChevron:_.showChevron!==!1,value:_.value})},K))}),e.jsx(cn,{containerRef:ye,backlightOn:I,menuMode:k})]})},`menu-${g.length}-${Ce}`):e.jsx(Fe.div,{className:"absolute inset-0 flex flex-col h-full",initial:"enter",animate:"center",exit:"exit",variants:Se,transition:{duration:.2,ease:"easeInOut"},custom:N,onClick:()=>{!k&&i&&(F(),r?ee():b?B():(ee(),setTimeout(()=>{B()},100)))},children:e.jsx("div",{className:"flex-1 flex flex-col p-1 px-2 overflow-auto",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-chicago text-[12px] mb-1 text-[#0a3667] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]",children:[d+1," of ",x]}),e.jsxs("div",{className:"font-chicago text-[16px] text-center text-[#0a3667] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]",children:[e.jsx(as,{text:i.title,isPlaying:r}),e.jsx(as,{text:i.artist||"",isPlaying:r})]}),e.jsx("div",{className:"mt-auto w-full h-[8px] rounded-full border border-[#0a3667] overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0a3667]",style:{width:`${C>0?p/C*100:0}%`}})}),e.jsxs("div",{className:"font-chicago text-[16px] w-full h-[22px] flex justify-between text-[#0a3667] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)]",children:[e.jsxs("span",{children:[Math.floor(p/60),":",String(Math.floor(p%60)).padStart(2,"0")]}),e.jsxs("span",{children:["-",Math.floor((C-p)/60),":",String(Math.floor((C-p)%60)).padStart(2,"0")]})]})]}):e.jsxs("div",{className:"text-center font-geneva-12 text-[12px] text-[#0a3667] [text-shadow:1px_1px_0_rgba(0,0,0,0.15)] h-full flex flex-col justify-center items-center",children:[e.jsx("p",{children:"Don't steal music"}),e.jsx("p",{children:"Ne volez pas la musique"}),e.jsx("p",{children:"Bitte keine Musik stehlen"}),e.jsx("p",{children:"音楽を盗用しないでください"})]})})},"nowplaying")})})]})}const rs=15;function hn({theme:i,onWheelClick:r,onWheelRotation:p,onMenuButton:C}){const{t:k}=Ve(),g=s.useRef(null),[L,l]=s.useState(0),d=s.useRef(null),x=s.useRef(0),I=s.useRef(!1),N=s.useRef(!1),f=s.useRef(null),b=s.useRef(!1),P=s.useRef(!1),Z=s.useRef(!1),Y=(S,m)=>{if(!g.current)return 0;const u=g.current.getBoundingClientRect(),E=u.left+u.width/2,T=u.top+u.height/2;return Math.atan2(m-T,S-E)*180/Math.PI},D=(S,m)=>{if(!g.current)return 0;const u=g.current.getBoundingClientRect(),E=u.left+u.width/2,T=u.top+u.height/2;return Math.atan2(m-T,S-E)},B=S=>{const m=S*Math.PI/180;return m>=-Math.PI/4&&m<Math.PI/4?"right":m>=Math.PI/4&&m<3*Math.PI/4?"bottom":m>=3*Math.PI/4||m<-3*Math.PI/4?"left":"top"},v=(S,m)=>{if(!g.current)return!1;const u=g.current.getBoundingClientRect(),E=u.left+u.width/2,T=u.top+u.height/2;return Math.sqrt((S-E)**2+(m-T)**2)<=32},H=S=>{S.preventDefault();const m=S.touches[0];if(v(m.clientX,m.clientY))return;const u=D(m.clientX,m.clientY);d.current=u,x.current=0,N.current=!1,f.current={x:m.clientX,y:m.clientY}},J=S=>{if(S.preventDefault(),d.current===null)return;const m=S.touches[0],u=D(m.clientX,m.clientY);let E=u-d.current;E>Math.PI&&(E-=2*Math.PI),E<-Math.PI&&(E+=2*Math.PI),x.current+=E,d.current=u;const T=rs*Math.PI/180;for(!N.current&&Math.abs(x.current)>T&&(N.current=!0,Z.current=!0);x.current>T;)p("clockwise"),x.current-=T;for(;x.current<-T;)p("counterclockwise"),x.current+=T},Q=()=>{if(!N.current&&f.current){const S=Y(f.current.x,f.current.y),m=B(S);r(m),b.current=!0,setTimeout(()=>{b.current=!1},500)}d.current=null,x.current=0,N.current=!1,f.current=null,Z.current&&setTimeout(()=>{Z.current=!1},100)},ee=S=>{const m=L+Math.abs(S.deltaY);l(m),m>=50&&(S.deltaY<0?p("counterclockwise"):p("clockwise"),l(0))},U=S=>{if(b.current)return;P.current=S.target&&S.target.classList.contains("menu-button"),S.preventDefault();const m=D(S.clientX,S.clientY);d.current=m,x.current=0,I.current=!1;const u=rs*Math.PI/180,E=X=>{if(d.current===null)return;const j=D(X.clientX,X.clientY);let y=j-d.current;for(y>Math.PI&&(y-=2*Math.PI),y<-Math.PI&&(y+=2*Math.PI),x.current+=y,d.current=j,!I.current&&Math.abs(x.current)>u&&(I.current=!0);x.current>u;)p("clockwise"),x.current-=u;for(;x.current<-u;)p("counterclockwise"),x.current+=u},T=X=>{if(window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",T),!I.current&&!P.current){const j=Y(X.clientX,X.clientY),y=B(j);r(y)}d.current=null,x.current=0,I.current=!1,P.current=!1};window.addEventListener("mousemove",E),window.addEventListener("mouseup",T)};return e.jsxs("div",{className:be("mt-6 relative w-[180px] h-[180px] rounded-full flex items-center justify-center select-none",i==="classic"?"bg-gray-300/60":i==="u2"?"bg-red-700/60":"bg-neutral-800/50"),children:[e.jsx("div",{role:"button",tabIndex:0,"aria-label":k("apps.ipod.ariaLabels.select"),onClick:()=>{b.current||Z.current||r("center")},onKeyDown:S=>{b.current||Z.current||(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),r("center"))},className:be("ipod-wheel-center absolute w-16 h-16 rounded-full z-10 flex items-center justify-center outline-none focus:outline-none focus-visible:outline-none",i==="classic"?"bg-white/30":i==="u2"?"bg-black/70":"bg-black/30")}),e.jsxs("div",{ref:g,className:"absolute w-full h-full rounded-full touch-none select-none",onMouseDown:U,onTouchStart:H,onTouchMove:J,onTouchEnd:Q,onWheel:ee,children:[e.jsx("div",{className:"absolute top-1.5 text-center left-1/2 transform -translate-x-1/2 font-chicago text-xs text-white menu-button cursor-default select-none",onClick:S=>{b.current||Z.current||(S.stopPropagation(),C())},children:"MENU"}),e.jsx("div",{className:"absolute right-2 text-right top-1/2 transform -translate-y-1/2 font-chicago text-[12px] text-white cursor-default select-none",children:"⏭"}),e.jsx("div",{className:"absolute bottom-1 text-center left-1/2 transform -translate-x-1/2 font-chicago text-[12px] text-white cursor-default select-none",children:"⏯"}),e.jsx("div",{className:"absolute left-2 text-left top-1/2 transform -translate-y-1/2 font-chicago text-[12px] text-white cursor-default select-none",children:"⏮"})]})]})}const fn=["作词","作曲","编曲","制作","发行","出品","监制","策划","统筹","录音","混音","母带","和声","版权","吉他","贝斯","鼓","键盘","企划","词","詞：","曲","OP","SP","Produced","Composed","Arranged","Mixed","Lyrics","Keyboard","Guitar","Bass","Drum","Vocal","Original Publisher","Sub-publisher","Electric Piano","Synth by","Recorded by","Mixed by","Mastered by","Produced by","Composed by","Digital Editing by","Mix Assisted by","Mix by","Mix Engineer","Background vocals","Background vocals by","Chorus by","Percussion by","String by","Harp by","Piano by","Piano Arranged by","Written by","Additional Production by","Synthesizer","Programming","Background Vocals","Recording Engineer","Digital Editing"],os=(i,r,p)=>{const C=[...fn,`${r} - ${p}`,`${p} - ${r}`];return i.split(`
`).map(k=>{const g=k.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.+)/);if(!g)return null;const[,L,l,d,x]=g,I=x.trim();return C.some(f=>I.startsWith(f))?null:{startTimeMs:(parseInt(L)*6e4+parseInt(l)*1e3+parseInt(d.padEnd(3,"0"))).toString(),words:I}}).filter(k=>k!==null)};function mn({title:i="",artist:r="",album:p="",currentTime:C,translateTo:k}){const[g,L]=s.useState([]),[l,d]=s.useState(null),[x,I]=s.useState(-1),[N,f]=s.useState(!1),[b,P]=s.useState(!1),[Z,Y]=s.useState(),D=s.useRef(null),B=s.useRef(C),v=w(U=>U.lyricsRefreshNonce),H=s.useRef(0);s.useEffect(()=>{if(L([]),d(null),I(-1),f(!0),P(!1),Y(void 0),!i&&!r&&!p){f(!1);return}if(Zt()){f(!1),Y("iPod requires an internet connection");return}const U=`${i}__${r}__${p}`,S=H.current!==v;if(!S&&U===D.current){f(!1),H.current=v;return}let m=!1;const u=new AbortController,E=setTimeout(()=>{u.abort(),console.warn("Lyrics fetch timed out")},15e3);return fetch(Qt("/api/lyrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,artist:r,album:p,force:S}),signal:u.signal}).then(async T=>{if(clearTimeout(E),!T.ok){if(T.status===404||u.signal.aborted)return null;throw new Error(`Failed to fetch lyrics (status ${T.status})`)}return T.json()}).then(T=>{if(m)return;if(!T)throw new Error("No lyrics found or fetch timed out");const X=T==null?void 0:T.lyrics;if(!X)throw new Error("No lyrics found");const j=X.replace(/\u200b/g,""),y=os(j,(T==null?void 0:T.title)??i,(T==null?void 0:T.artist)??r);L(y),D.current=U,w.setState({currentLyrics:{lines:y}})}).catch(T=>{m||(console.error("useLyrics original fetch error",T),T instanceof DOMException&&T.name==="AbortError"?Y("Lyrics search timed out."):Y(T instanceof Error?T.message:"Unknown error fetching lyrics"),L([]),I(-1),w.setState({currentLyrics:null}))}).finally(()=>{m||f(!1),H.current=v,clearTimeout(E)}),()=>{m=!0,u.abort(),clearTimeout(E)}},[i,r,p,v]),s.useEffect(()=>{if(!k||g.length===0){d(null),P(!1),k&&g.length>0;return}if(N){P(!1);return}if(Zt()){P(!1),Y("iPod requires an internet connection");return}let U=!1;P(!0),Y(void 0);const S=new AbortController,m=setTimeout(()=>{S.abort(),console.warn("Lyrics translation timed out")},12e4);return fetch(Qt("/api/translate-lyrics"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lines:g,targetLanguage:k}),signal:S.signal}).then(async u=>{clearTimeout(m);const E=await u.text();if(!u.ok){const T=E.startsWith("Error: ")?E.substring(7):E;throw new Error(T||`Translation request failed with status ${u.status}`)}return E}).then(u=>{if(!U)if(u){const E=os(u,i,r);d(E)}else d([])}).catch(u=>{U||(console.error("useLyrics translation error",u),u instanceof DOMException&&u.name==="AbortError"?Y("Lyrics translation timed out."):Y(u instanceof Error?u.message:"Unknown error during translation"),d(null))}).finally(()=>{U||P(!1),clearTimeout(m)}),()=>{U=!0,S.abort(),clearTimeout(m)}},[g,k,N,i,r]);const J=l||g,Q=s.useCallback(U=>{if(!J.length)return-1;const S=U*1e3;let m=J.findIndex((u,E)=>{const T=E+1<J.length?parseInt(J[E+1].startTimeMs):1/0;return S>=parseInt(u.startTimeMs)&&S<T});return m===-1&&J.length>0&&S>=parseInt(J[J.length-1].startTimeMs)&&(m=J.length-1),m},[J]);s.useEffect(()=>{B.current=C,I(Q(C))},[C,Q]);const ee=s.useCallback(U=>{B.current=U,I(Q(U))},[Q]);return{lines:J,currentLine:x,isLoading:N,isTranslating:b,error:Z,updateCurrentTimeManually:ee}}const gn=5*60*1e3;function xn(i){const{t:r}=Ve(),p=w(l=>l.syncLibrary),C=s.useRef(null),k=s.useRef(0);return s.useEffect(()=>{if(!i){C.current&&(clearInterval(C.current),C.current=null);return}const l=async()=>{try{const x=w.getState().tracks,I=x.length===0,f=await(await fetch("/data/ipod-videos.json")).json(),b=(f.videos||f).map(v=>({id:v.id,url:v.url,title:v.title,artist:v.artist,album:v.album??"",lyricOffset:v.lyricOffset})),P=f.version||1,Z=new Set(x.map(v=>v.id)),Y=b.filter(v=>!Z.has(v.id)).length;let D=0;const B=new Map(b.map(v=>[v.id,v]));if(x.forEach(v=>{const H=B.get(v.id);H&&(v.title!==H.title||v.artist!==H.artist||v.album!==H.album||v.url!==H.url||v.lyricOffset!==H.lyricOffset)&&D++}),console.log("[iPod] Auto update check:",{newTracksCount:Y,tracksUpdated:D,currentTracksCount:x.length,serverTracksCount:b.length,serverVersion:P,currentLastKnownVersion:w.getState().lastKnownVersion}),Y>0||D>0)try{const v=await p(),H=I&&v.newTracksAdded>0?r("apps.ipod.dialogs.addedSongsToTop",{count:v.newTracksAdded,plural:v.newTracksAdded===1?"":"s"}):v.newTracksAdded>0?r("apps.ipod.dialogs.autoUpdatedLibraryAddedSongs",{newCount:v.newTracksAdded,newPlural:v.newTracksAdded===1?"":"s",updatedText:v.tracksUpdated>0?r("apps.ipod.dialogs.andUpdated",{count:v.tracksUpdated,plural:v.tracksUpdated===1?"":"s"}):""}):r("apps.ipod.dialogs.autoUpdatedTrackMetadata",{count:v.tracksUpdated});fe.success(r("apps.ipod.dialogs.libraryAutoUpdated"),{description:H,duration:4e3}),console.log(`[iPod] Auto-updated: ${v.newTracksAdded} new tracks, ${v.tracksUpdated} updated tracks`)}catch(v){console.error("Error auto-updating library:",v),fe.error(r("apps.ipod.dialogs.autoUpdateFailed"),{description:r("apps.ipod.dialogs.failedToAutoUpdateLibrary"),duration:4e3})}}catch(x){console.error("Error checking for library updates:",x)}},d=setTimeout(()=>{console.log("[iPod] Running immediate library update check on app activation"),l(),k.current=Date.now()},100);return C.current=setInterval(()=>{l(),k.current=Date.now()},gn),()=>{clearTimeout(d),C.current&&(clearInterval(C.current),C.current=null)}},[i,p]),{manualCheck:async()=>{try{const l=w.getState().tracks.length===0,d=await p();if(d.newTracksAdded>0||d.tracksUpdated>0){const x=l&&d.newTracksAdded>0?r("apps.ipod.dialogs.addedSongsToTop",{count:d.newTracksAdded,plural:d.newTracksAdded===1?"":"s"}):r("apps.ipod.dialogs.addedNewSongsToTop",{newCount:d.newTracksAdded,newPlural:d.newTracksAdded===1?"":"s",updatedText:d.tracksUpdated>0?r("apps.ipod.dialogs.andUpdated",{count:d.tracksUpdated,plural:d.tracksUpdated===1?"":"s"}):"",total:d.totalTracks});return fe.success(r("apps.ipod.dialogs.libraryUpdated"),{description:x}),!0}else return fe.info(r("apps.ipod.dialogs.noUpdates"),{description:r("apps.ipod.dialogs.libraryAlreadyUpToDate")}),!1}catch(l){return console.error("Error during manual library update check:",l),fe.error(r("apps.ipod.dialogs.updateCheckFailed"),{description:r("apps.ipod.dialogs.failedToCheckForLibraryUpdates")}),!1}},manualSync:async()=>{try{const l=w.getState().tracks.length===0,d=await p();if(d.newTracksAdded>0||d.tracksUpdated>0){const x=l&&d.newTracksAdded>0?r("apps.ipod.dialogs.addedSongsToTop",{count:d.newTracksAdded,plural:d.newTracksAdded===1?"":"s"}):r("apps.ipod.dialogs.addedNewSongsToTop",{newCount:d.newTracksAdded,newPlural:d.newTracksAdded===1?"":"s",updatedText:d.tracksUpdated>0?r("apps.ipod.dialogs.andUpdated",{count:d.tracksUpdated,plural:d.tracksUpdated===1?"":"s"}):"",total:d.totalTracks});fe.success(r("apps.ipod.dialogs.librarySynced"),{description:x})}else fe.info(r("apps.ipod.dialogs.librarySynced"),{description:r("apps.ipod.dialogs.libraryUpToDateWithSongs",{count:d.totalTracks})});return!0}catch(l){return console.error("Error during library sync:",l),fe.error(r("apps.ipod.dialogs.syncFailed"),{description:r("apps.ipod.dialogs.failedToSyncWithServerLibrary")}),!1}}}}function bn({children:i,onClose:r,togglePlay:p,nextTrack:C,previousTrack:k,seekTime:g,showStatus:L,showOfflineStatus:l,registerActivity:d,isPlaying:x,statusMessage:I,currentTranslationCode:N,onSelectTranslation:f,currentAlignment:b,onCycleAlignment:P,currentKoreanDisplay:Z,onToggleKoreanDisplay:Y,fullScreenPlayerRef:D}){const{t:B}=Ve(),v=s.useRef(null),[H,J]=s.useState(!1),[Q,ee]=s.useState(!0),U=s.useRef(null),S=ps(),[m,u]=s.useState(!1),E=s.useMemo(()=>en(),[]),T=s.useMemo(()=>[{label:B("apps.ipod.translationLanguages.original"),code:null},{label:"English",code:"en"},{label:"中文",code:"zh-TW"},{label:"日本語",code:"ja"},{label:"한국어",code:"ko"},{label:"Español",code:"es"},{label:"Français",code:"fr"},{label:"Deutsch",code:"de"},{label:"Português",code:"pt"},{label:"Italiano",code:"it"},{label:"Русский",code:"ru"}],[B]),X=s.useCallback(()=>{var n,V;const h=(V=(n=D==null?void 0:D.current)==null?void 0:n.getInternalPlayer)==null?void 0:V.call(n);return h&&typeof h.getPlayerState=="function"?h.getPlayerState()===1:!1},[D]),j=s.useCallback(()=>{ee(!0),U.current&&clearTimeout(U.current),X()&&!H&&(U.current=window.setTimeout(()=>{ee(!1)},2e3))},[X,H]),y=s.useRef({onClose:r,togglePlay:p,nextTrack:C,previousTrack:k,seekTime:g,showStatus:L,registerActivity:d,onSelectTranslation:f,onCycleAlignment:P,onToggleKoreanDisplay:Y,setIsLangMenuOpen:J});s.useEffect(()=>{y.current={onClose:r,togglePlay:p,nextTrack:C,previousTrack:k,seekTime:g,showStatus:L,registerActivity:d,onSelectTranslation:f,onCycleAlignment:P,onToggleKoreanDisplay:Y,setIsLangMenuOpen:J}},[r,p,C,k,g,L,d,f,P,Y]);const F=s.useRef(null),R=80,z=500,se=100,Se=s.useCallback(h=>{if(h.target.closest("[data-toolbar]"))return;m||u(!0);const V=h.touches[0];F.current={x:V.clientX,y:V.clientY,time:Date.now()}},[m]),Ce=s.useCallback(h=>{if(!F.current)return;if(h.target.closest("[data-toolbar]")){F.current=null;return}if(E&&!x&&m){F.current=null;return}const te=h.changedTouches[0],q=te.clientX-F.current.x,ce=te.clientY-F.current.y,oe=Date.now()-F.current.time,_=Math.abs(q)>R&&Math.abs(ce)<se&&oe<z,K=ce>R&&Math.abs(q)<se&&oe<z;if(_){h.preventDefault();const ie=y.current;ie.registerActivity(),q>0?(ie.previousTrack(),setTimeout(()=>{const me=w.getState().currentIndex,ae=w.getState().tracks[me];if(ae){const ue=ae.artist?` - ${ae.artist}`:"";ie.showStatus(`⏮ ${ae.title}${ue}`)}},100)):(ie.nextTrack(),setTimeout(()=>{const me=w.getState().currentIndex,ae=w.getState().tracks[me];if(ae){const ue=ae.artist?` - ${ae.artist}`:"";ie.showStatus(`⏭ ${ae.title}${ue}`)}},100))}else K&&(h.preventDefault(),y.current.onClose());F.current=null},[E,x,m]);s.useEffect(()=>{const h=setTimeout(()=>{v.current&&v.current.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})},100);return()=>clearTimeout(h)},[]);const ye=s.useMemo(()=>{var h;if(!N)return null;switch(N){case"zh-TW":return"中";case"en":return"En";case"ja":return"日";case"ko":return"한";case"es":return"Es";case"fr":return"Fr";case"de":return"De";case"pt":return"Pt";case"it":return"It";case"ru":return"Ru";default:return((h=N[0])==null?void 0:h.toUpperCase())??"?"}},[N]);return s.useEffect(()=>{const h=v.current;if(h)return h.addEventListener("touchstart",Se),h.addEventListener("touchend",Ce),()=>{h.removeEventListener("touchstart",Se),h.removeEventListener("touchend",Ce)}},[]),s.useEffect(()=>{const h=()=>{m||u(!0);const te=X();E&&!te&&m||y.current.registerActivity(),ee(!0),U.current&&clearTimeout(U.current),te&&!H&&(U.current=window.setTimeout(()=>{ee(!1)},2e3))},n=X();return(H||!n)&&ee(!0),window.addEventListener("mousemove",h,{passive:!0}),window.addEventListener("keydown",h),window.addEventListener("touchstart",h,{passive:!0}),window.addEventListener("click",h,{passive:!0}),X()?h():ee(!0),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("keydown",h),window.removeEventListener("touchstart",h),window.removeEventListener("click",h),U.current&&(clearTimeout(U.current),U.current=null)}},[H,x,m,E,X]),s.useEffect(()=>{const h=n=>{const V=y.current;V.registerActivity(),n.key==="Escape"?V.onClose():n.key===" "?(n.preventDefault(),S?l():(V.togglePlay(),V.showStatus(x?"⏸":"▶"))):n.key==="ArrowLeft"?V.seekTime(-5):n.key==="ArrowRight"?V.seekTime(5):n.key==="ArrowUp"?(V.previousTrack(),setTimeout(()=>{const te=w.getState().currentIndex,q=w.getState().tracks[te];if(q){const ce=q.artist?` - ${q.artist}`:"";V.showStatus(`⏮ ${q.title}${ce}`)}},800)):n.key==="ArrowDown"&&(V.nextTrack(),setTimeout(()=>{const te=w.getState().currentIndex,q=w.getState().tracks[te];if(q){const ce=q.artist?` - ${q.artist}`:"";V.showStatus(`⏭ ${q.title}${ce}`)}},800))};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[x]),Ps.createPortal(e.jsxs("div",{ref:v,className:"ipod-force-font fixed inset-0 z-[9999] bg-black select-none flex flex-col",onClick:h=>{var q,ce;if(h.target.closest("[data-toolbar]"))return;m||u(!0);const V=X();if(!(E&&!V&&m)&&!V){const oe=y.current;oe.registerActivity(),S?l():(oe.togglePlay(),oe.showStatus("▶"))}if(E&&x&&m){const oe=(ce=(q=D==null?void 0:D.current)==null?void 0:q.getInternalPlayer)==null?void 0:ce.call(q);if(oe&&typeof oe.getPlayerState=="function"&&oe.getPlayerState()!==1){const K=y.current;K.registerActivity(),typeof oe.playVideo=="function"&&(oe.playVideo(),K.showStatus("▶"))}}},children:[e.jsx(rt,{children:I&&e.jsx(Fe.div,{className:"absolute inset-0 z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx("div",{className:"absolute pointer-events-none",style:{top:"calc(max(env(safe-area-inset-top), 0.75rem) + clamp(1rem, 6dvh, 3rem))",left:"calc(max(env(safe-area-inset-left), 0.75rem) + clamp(1rem, 6dvw, 4rem))"},children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"font-chicago text-white text-[min(5vw,5vh)] relative z-10",children:I}),e.jsx("div",{className:"font-chicago text-black text-[min(5vw,5vh)] absolute inset-0",style:{WebkitTextStroke:"5px black",textShadow:"none"},children:I})]})})})}),e.jsx("div",{className:"flex-1 min-h-0",children:typeof i=="function"?i({controlsVisible:Q||H||!X(),isLangMenuOpen:H}):i}),e.jsx("div",{"data-toolbar":!0,className:be("w-full flex justify-center z-[10001] transition-opacity duration-200",Q||H||!X()?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),style:{paddingBottom:"calc(max(env(safe-area-inset-bottom), 0.75rem) + clamp(1rem, 6dvh, 4rem))"},onClick:h=>{h.stopPropagation(),j()},children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-neutral-800/35 border border-white/10 backdrop-blur-sm rounded-full shadow-lg flex items-center gap-1 md:gap-2 px-2 py-1 font-geneva-12",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),d(),k(),setTimeout(()=>{const n=w.getState().currentIndex,V=w.getState().tracks[n];if(V){const te=V.artist?` - ${V.artist}`:"";L(`⏮ ${V.title}${te}`)}},100)},"aria-label":B("apps.ipod.ariaLabels.previousTrack"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",title:B("apps.ipod.menu.previous"),children:e.jsx("span",{className:"text-[18px] md:text-[22px]",children:"⏮"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),d();const n=X();if(S)l();else{p();const V=X();L(V?"⏸":"▶"),n||setTimeout(()=>j(),100)}},"aria-label":B("apps.ipod.ariaLabels.playPause"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",title:B("apps.ipod.ariaLabels.playPause"),children:e.jsx("span",{className:"text-[18px] md:text-[22px]",children:X()?"⏸":"▶"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),d(),C(),setTimeout(()=>{const n=w.getState().currentIndex,V=w.getState().tracks[n];if(V){const te=V.artist?` - ${V.artist}`:"";L(`⏭ ${V.title}${te}`)}},100)},"aria-label":B("apps.ipod.ariaLabels.nextTrack"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",title:B("apps.ipod.menu.next"),children:e.jsx("span",{className:"text-[18px] md:text-[22px]",children:"⏭"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),d(),P()},"aria-label":B("apps.ipod.ariaLabels.cycleLyricLayout"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",title:b,children:b==="focusThree"?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"md:w-[26px] md:h-[26px]",children:[e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"6"}),e.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),e.jsx("line",{x1:"6",y1:"18",x2:"18",y2:"18"})]}):b==="center"?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"md:w-[26px] md:h-[26px]",children:e.jsx("line",{x1:"6",y1:"12",x2:"18",y2:"12"})}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"md:w-[26px] md:h-[26px]",children:[e.jsx("line",{x1:"4",y1:"8",x2:"13",y2:"8"}),e.jsx("line",{x1:"11",y1:"16",x2:"20",y2:"16"})]})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),d(),Y()},"aria-label":B("apps.ipod.ariaLabels.toggleHangulRomanization"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",children:e.jsx("span",{className:"text-[16px] md:text-[18px]",children:Z==="romanized"?"Ko":"한"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),J(n=>!n),d()},"aria-label":B("apps.ipod.ariaLabels.translateLyrics"),className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none",children:ye?e.jsx("span",{className:"inline-flex items-center justify-center w-[24px] h-[24px] md:w-[28px] md:h-[28px] leading-none text-[16px] md:text-[18px]",children:ye}):e.jsx("span",{className:"inline-flex items-center justify-center w-[24px] h-[24px] md:w-[28px] md:h-[28px] leading-none text-[16px] md:text-[18px]",children:"Aa"})}),e.jsx("button",{onClick:r,className:"w-9 h-9 md:w-12 md:h-12 flex items-center justify-center rounded-full text-white/70 hover:text-white hover:bg-white/10 transition-colors focus:outline-none","aria-label":B("apps.ipod.ariaLabels.closeFullscreen"),title:B("common.dialog.close"),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",className:"md:w-[26px] md:h-[26px]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsx(rt,{children:H&&e.jsx(Fe.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.15},className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 max-h-[50vh] overflow-y-auto rounded-lg border border-white/10 bg-neutral-900/80 backdrop-blur-md shadow-xl",onClick:h=>h.stopPropagation(),children:e.jsx("div",{className:"py-2",children:T.map(h=>{const n=N===h.code||!h.code&&!N;return e.jsxs("button",{onClick:()=>{y.current.onSelectTranslation(h.code),y.current.setIsLangMenuOpen(!1),y.current.registerActivity()},className:be("w-full text-left px-4 py-2 text-[16px] font-geneva-12 transition-colors",n?"text-white bg-white/10":"text-white/80 hover:text-white hover:bg-white/10"),children:[e.jsx("span",{className:"inline-block w-4",children:n?"✓":""}),e.jsx("span",{children:h.label})]},h.code||"off")})})})})]})})]}),document.body)}function Rn({isWindowOpen:i,onClose:r,isForeground:p,skipInitialSound:C,initialData:k,instanceId:g,onNavigateNext:L,onNavigatePrevious:l}){var zt,Wt,Yt,Ht,Xt,Kt,qt,Gt;const{play:d}=es(ts.BUTTON_CLICK),{play:x}=es(ts.IPOD_CLICK_WHEEL),I=_s(100,50),N=ps(),{tracks:f,currentIndex:b,loopCurrent:P,loopAll:Z,isShuffled:Y,isPlaying:D,showVideo:B,backlightOn:v}=w(zs(t=>({tracks:t.tracks,currentIndex:t.currentIndex,loopCurrent:t.loopCurrent,loopAll:t.loopAll,isShuffled:t.isShuffled,isPlaying:t.isPlaying,showVideo:t.showVideo,backlightOn:t.backlightOn}))),{theme:H,lcdFilterOn:J,showLyrics:Q,lyricsAlignment:ee,chineseVariant:U,koreanDisplay:S,lyricsTranslationLanguage:m,isFullScreen:u,toggleFullScreen:E,setCurrentIndex:T,toggleLoopAll:X,toggleLoopCurrent:j,toggleShuffle:y,togglePlay:F,setIsPlaying:R,toggleVideo:z,toggleBacklight:se,setTheme:Se,clearLibrary:Ce,nextTrack:ye,previousTrack:h}=ls(t=>({theme:t.theme,lcdFilterOn:t.lcdFilterOn,showLyrics:t.showLyrics,lyricsAlignment:t.lyricsAlignment,chineseVariant:t.chineseVariant,koreanDisplay:t.koreanDisplay,lyricsTranslationLanguage:t.lyricsTranslationLanguage,isFullScreen:t.isFullScreen,toggleFullScreen:t.toggleFullScreen,setCurrentIndex:t.setCurrentIndex,toggleLoopAll:t.toggleLoopAll,toggleLoopCurrent:t.toggleLoopCurrent,toggleShuffle:t.toggleShuffle,togglePlay:t.togglePlay,setIsPlaying:t.setIsPlaying,toggleVideo:t.toggleVideo,toggleBacklight:t.toggleBacklight,setTheme:t.setTheme,clearLibrary:t.clearLibrary,nextTrack:t.nextTrack,previousTrack:t.previousTrack})),{t:n}=Ve(),V=Ws("ipod",tn),te=w(t=>{var o;return((o=t.tracks[t.currentIndex])==null?void 0:o.lyricOffset)??0}),q=s.useRef(p),{bringToForeground:ce,clearIpodInitialData:oe,instances:_}=ss(t=>({bringToForeground:t.bringToForeground,clearIpodInitialData:t.clearInstanceInitialData,instances:t.instances})),K=g?((zt=_[g])==null?void 0:zt.isMinimized)??!1:!1,ie=s.useRef(null),[me,ae]=s.useState(Date.now()),ue=s.useRef(null),[Oe,Me]=s.useState(null),Be=s.useRef(null),[we,Qe]=s.useState(0),[a,re]=s.useState(0),[ke,ge]=s.useState(""),[ot,ze]=s.useState(!1),[it,We]=s.useState(!1),[fs,vt]=s.useState(!1),[ms,yt]=s.useState(!1),[gs,Tt]=s.useState(!1),[xs,St]=s.useState(!1),bs=s.useMemo(()=>{const t=w.getState();return!(t.tracks.length>0&&t.currentIndex>=0&&t.currentIndex<t.tracks.length)},[]),[Ue,Le]=s.useState(bs),[lt,Ne]=s.useState(0),[ys,Te]=s.useState("forward"),[pe,je]=s.useState([]),[jt,Pe]=s.useState(!1),Ye=s.useRef(null),Ae=s.useRef(null),It=s.useRef(null),He=s.useRef(!1),ct=s.useRef(!1),{manualSync:ws}=xn(i&&(p??!1)),dt=navigator.userAgent,ks=/iP(hone|od|ad)/.test(dt),vs=/Safari/.test(dt)&&!/Chrome/.test(dt)&&!/CriOS/.test(dt),et=ks&&vs,O=s.useCallback(t=>{Me(t),Be.current&&clearTimeout(Be.current),Be.current=setTimeout(()=>{Me(null)},2e3)},[]),Re=s.useCallback(()=>{fe.error(n("apps.ipod.dialogs.youreOffline"),{id:"ipod-offline",description:n("apps.ipod.dialogs.ipodRequiresInternet")}),O("🚫")},[O,n]),W=s.useCallback(()=>{ae(Date.now()),ct.current=!0,w.getState().backlightOn||se()},[se]),ut=s.useCallback(()=>{y(),O(w.getState().isShuffled?n("apps.ipod.status.shuffleOn"):n("apps.ipod.status.shuffleOff")),W()},[y,O,W,n]),Xe=s.useCallback(()=>{se();const t=w.getState().backlightOn;O(n(t?"apps.ipod.status.lightOn":"apps.ipod.status.lightOff")),t?W():(ae(Date.now()),ct.current=!0)},[se,O,W,ae,n]),Ct=s.useCallback(t=>{Se(t),O(n(t==="classic"?"apps.ipod.status.themeClassic":t==="black"?"apps.ipod.status.themeBlack":"apps.ipod.status.themeU2")),W()},[Se,O,W,n]),Ts=s.useCallback(t=>{t===Xe||W(),t()},[W,Xe]),Lt=s.useCallback(()=>{W();const t=w.getState().loopAll;w.getState().loopCurrent?(j(),O(n("apps.ipod.status.repeatOff"))):t?(X(),j(),O(n("apps.ipod.status.repeatOne"))):(X(),O(n("apps.ipod.status.repeatAll")))},[W,X,j,O,n]),Nt=s.useCallback(()=>{const t=w.getState().theme;Ct(t==="classic"?"black":t==="black"?"u2":"classic")},[Ct]);s.useEffect(()=>(ue.current&&clearTimeout(ue.current),v&&(ue.current=setTimeout(()=>{const t=w.getState().showVideo,o=w.getState().isPlaying;Date.now()-me>=5e3&&!(t&&o)&&se()},5e3)),()=>{ue.current&&clearTimeout(ue.current)}),[v,me,se]),s.useEffect(()=>{p&&!q.current?(w.getState().backlightOn||se(),W()):!p&&q.current&&w.getState().backlightOn&&se(),q.current=p},[p,se,W]),s.useEffect(()=>{Qe(0),w.setState({currentLyrics:null})},[b]),s.useEffect(()=>()=>{Be.current&&clearTimeout(Be.current)},[]);const[pt,Ke]=s.useState([]),qe=s.useMemo(()=>{const t=f.reduce((c,A,M)=>{const $=A.artist||n("apps.ipod.menu.unknownArtist");return c[$]||(c[$]=[]),c[$].push({track:A,index:M}),c},{}),o=Object.keys(t).sort((c,A)=>c.localeCompare(A,void 0,{sensitivity:"base"}));return[{label:n("apps.ipod.menuItems.allSongs"),action:()=>{W(),Te("forward");const c=n("apps.ipod.menuItems.allSongs"),A=n("apps.ipod.menuItems.music"),M=f.map(($,ne)=>({label:$.title,action:()=>{if(W(),N){Re();return}T(ne),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([A,c]),w.getState().showVideo&&z()},showChevron:!1}));je($=>[...$,{title:c,items:M,selectedIndex:0}]),Ne(0)},showChevron:!0},...o.map(c=>({label:c,action:()=>{W(),Te("forward");const A=t[c].map(({track:M,index:$})=>({label:M.title,action:()=>{W(),T($),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([n("apps.ipod.menuItems.music"),c]),w.getState().showVideo&&z()},showChevron:!1}));je(M=>[...M,{title:c,items:A,selectedIndex:0}]),Ne(0)},showChevron:!0}))]},[f,W,T,R,z,O,n]),ht=s.useMemo(()=>{const t=P,o=Z,c=Y,A=v,M=H;return[{label:n("apps.ipod.menuItems.repeat"),action:Lt,showChevron:!1,value:n(t?"apps.ipod.menuItems.one":o?"apps.ipod.menuItems.all":"apps.ipod.menuItems.off")},{label:n("apps.ipod.menuItems.shuffle"),action:ut,showChevron:!1,value:n(c?"apps.ipod.menuItems.on":"apps.ipod.menuItems.off")},{label:n("apps.ipod.menuItems.backlight"),action:Xe,showChevron:!1,value:n(A?"apps.ipod.menuItems.on":"apps.ipod.menuItems.off")},{label:n("apps.ipod.menuItems.theme"),action:Nt,showChevron:!1,value:n(M==="classic"?"apps.ipod.menu.classic":M==="black"?"apps.ipod.menu.black":"apps.ipod.menu.u2")}]},[P,Z,Y,v,H,Lt,ut,Xe,Nt,n]),Ge=s.useMemo(()=>{const t=n("apps.ipod.menuItems.music"),o=n("apps.ipod.menuItems.settings");return[{label:t,action:()=>{W(),w.getState().showVideo&&z(),Te("forward"),je(c=>[...c,{title:t,items:qe,selectedIndex:0}]),Ne(0)},showChevron:!0},{label:n("apps.ipod.menuItems.extras"),action:()=>{W(),w.getState().showVideo&&z(),ze(!0)},showChevron:!0},{label:o,action:()=>{W(),w.getState().showVideo&&z(),Te("forward"),je(c=>[...c,{title:o,items:ht,selectedIndex:0}]),Ne(0)},showChevron:!0},{label:n("apps.ipod.menuItems.shuffleSongs"),action:()=>{W(),w.getState().showVideo&&z(),ut(),Le(!1)},showChevron:!1},{label:n("apps.ipod.menuItems.backlight"),action:()=>{Xe()},showChevron:!1},{label:n("apps.ipod.menuItems.nowPlaying"),action:()=>{W(),Te("forward"),Le(!1),Pe(!0)},showChevron:!0}]},[W,z,qe,ht,ut,Xe,O,n]);s.useEffect(()=>{pe.length===0&&je([{title:n("apps.ipod.menuItems.ipod"),items:Ge,selectedIndex:0}])},[n,Ge,pe.length]),s.useEffect(()=>{je(t=>{if(t.length===0)return t;const o=t.length-1,c=t[o];let A=null;const M=n("apps.ipod.menuItems.ipod"),$=n("apps.ipod.menuItems.music"),ne=n("apps.ipod.menuItems.settings"),ve=n("apps.ipod.menuItems.allSongs");if(c.title===M)A=Ge;else if(c.title===$)A=qe;else if(c.title===ne)A=ht;else if(c.title===ve)A=f.map((le,xe)=>({label:le.title,action:()=>{W(),T(xe),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([n("apps.ipod.menuItems.music"),n("apps.ipod.menuItems.allSongs")]),w.getState().showVideo&&z()},showChevron:!1}));else{const le=f.reduce((xe,De,tt)=>{const Je=De.artist||n("apps.ipod.menu.unknownArtist");return xe[Je]||(xe[Je]=[]),xe[Je].push({track:De,index:tt}),xe},{});le[c.title]&&(A=le[c.title].map(({track:De,index:tt})=>({label:De.title,action:()=>{W(),T(tt),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([n("apps.ipod.menuItems.music"),c.title]),w.getState().showVideo&&z()},showChevron:!1})))}if(A&&c.items!==A){const le=[...t];return le[o]={...c,items:A},le}return t})},[Ge,qe,ht,pe.length,f,W,T,R,z,n]);const wt=s.useCallback(async t=>{Tt(!0);try{if(await w.getState().addTrackFromVideoId(t))O(n("apps.ipod.status.added")),ge(""),ze(!1);else throw new Error("Failed to add track")}catch(o){console.error("Failed to add track:",o),O(`❌ Error adding: ${o instanceof Error?o.message:"Unknown error"}`)}finally{Tt(!1)}},[O]),At=s.useCallback(async t=>{const o=`https://www.youtube.com/watch?v=${t}`;try{await wt(o)}catch(c){console.error(`[iPod] Error adding track for videoId ${t}:`,c),O(`❌ Error adding ${t}`)}},[wt,O]),ft=s.useCallback(async t=>{const c=w.getState().tracks.findIndex(ve=>ve.id===t),A=navigator.userAgent,M=/iP(hone|od|ad)/.test(A),$=/Safari/.test(A)&&!/Chrome/.test(A)&&!/CriOS/.test(A),ne=!(M||$);if(c!==-1)fe.info(n("apps.ipod.dialogs.openedSharedTrack")),console.log(`[iPod] Video ID ${t} found in tracks. Playing.`),T(c),ne&&R(!0),Le(!1);else if(fe.info(n("apps.ipod.dialogs.addingNewTrack")),console.log(`[iPod] Video ID ${t} not found. Adding and playing.`),await At(t),ne&&!N){const ve=w.getState().currentIndex,le=w.getState().tracks[ve];(le==null?void 0:le.id)===t?R(!0):console.warn("[iPod] Index mismatch after adding track, autoplay skipped.")}else N&&Re()},[T,R,Le,At]);s.useEffect(()=>{if(i&&(k!=null&&k.videoId)&&typeof k.videoId=="string"){if(ie.current===k)return;const t=k.videoId;console.log(`[iPod] Processing initialData.videoId on mount: ${t}`),setTimeout(()=>{ft(t).then(()=>{g&&oe(g),console.log(`[iPod] Cleared initialData after processing ${t}`)}).catch(o=>{console.error(`[iPod] Error processing initial videoId ${t}:`,o)})},100),ie.current=k}},[i,k,ft,oe,g]),s.useEffect(()=>{const t=o=>{var c;if(o.detail.appId==="ipod"&&((c=o.detail.initialData)!=null&&c.videoId)){if(ie.current===o.detail.initialData)return;const A=o.detail.initialData.videoId;console.log(`[iPod] Received updateApp event with videoId: ${A}`),ce("ipod"),ft(A).catch(M=>{console.error(`[iPod] Error processing videoId ${A} from updateApp event:`,M),fe.error("Failed to load shared track",{description:`Video ID: ${A}`})}),ie.current=o.detail.initialData}};return window.addEventListener("updateApp",t),()=>{window.removeEventListener("updateApp",t)}},[ft,ce]);const Mt=s.useCallback(()=>{if(P){const t=u?Ae.current:Ye.current;t==null||t.seekTo(0),R(!0)}else ye()},[P,ye,R,u]),Et=s.useCallback(t=>{Qe(Math.floor(t.playedSeconds))},[]),Rt=s.useCallback(t=>{re(t)},[]),Ot=s.useCallback(()=>{R(!0),He.current||O("▶"),He.current=!1;const t=f[b];if(t){const o=It.current,c=!o||o.trackId!==t.id,A=we<1;(c||A)&&(Ys(Hs.SONG_PLAY,{trackId:t.id,title:t.title,artist:t.artist||""}),It.current={trackId:t.id,elapsedTime:we})}},[R,O,f,b,we]),Pt=s.useCallback(()=>{R(!1),O("⏸︎")},[R,O]),$t=s.useCallback(()=>{},[]);s.useEffect(()=>{if(!D||!et||ct.current)return;const t=we,o=setTimeout(()=>{w.getState().isPlaying&&we===t&&(R(!1),O("⏸"))},1200);return()=>clearTimeout(o)},[D,we,R,O,et]);const kt=s.useCallback(()=>{if(d(),I(),W(),B&&z(),Ue)if(pe.length>1){Te("backward"),je(o=>o.slice(0,-1));const t=pe[pe.length-2];t&&Ne(t.selectedIndex)}else d();else{Te("backward");const t=w.getState().currentIndex,o=pe.length>0?pe[0]:{title:n("apps.ipod.menuItems.ipod"),items:Ge,selectedIndex:0},c=qe;if(jt)je([o]),Ne((o==null?void 0:o.selectedIndex)||0),Pe(!1);else{const A=f.reduce(($,ne,ve)=>{const le=ne.artist||n("apps.ipod.menu.unknownArtist");return $[le]||($[le]=[]),$[le].push({track:ne,index:ve}),$},{}),M={title:n("apps.ipod.menuItems.allSongs"),items:f.map(($,ne)=>({label:$.title,action:()=>{W(),T(ne),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([n("apps.ipod.menuItems.music"),n("apps.ipod.menuItems.allSongs")]),w.getState().showVideo&&z()},showChevron:!1})),selectedIndex:t};if(pt.length>0&&pt[1]!==n("apps.ipod.menuItems.allSongs")){const $=pt[1];if(A[$]){const ne=A[$],ve=ne.findIndex(xe=>xe.index===t),le={title:$,items:ne.map(({track:xe,index:De})=>({label:xe.title,action:()=>{W(),T(De),R(!0),Te("forward"),Le(!1),Pe(!1),Ke([n("apps.ipod.menuItems.music"),$]),w.getState().showVideo&&z()},showChevron:!1})),selectedIndex:ve!==-1?ve:0};je([o,{title:n("apps.ipod.menuItems.music"),items:c,selectedIndex:c.findIndex(xe=>xe.label===$)},le]),Ne(ve!==-1?ve:0)}else je([o,{title:n("apps.ipod.menuItems.music"),items:c,selectedIndex:0},M]),Ne(t)}else je([o,{title:n("apps.ipod.menuItems.music"),items:c,selectedIndex:0},M]),Ne(t)}Le(!0)}},[d,I,W,B,z,Ue,pe,Ge,qe,f,jt,pt,n]),Ss=s.useCallback(t=>{switch(d(),I(),W(),t){case"top":kt();break;case"right":N?Re():(He.current=!0,ye(),O("⏭"));break;case"bottom":N?Re():(F(),O(w.getState().isPlaying?"▶":"⏸"));break;case"left":N?Re():(He.current=!0,h(),O("⏮"));break;case"center":if(Ue){const o=pe[pe.length-1];o&&o.items[lt]&&o.items[lt].action()}else f[b]&&(D?N?Re():z():N?Re():(F(),O("▶"),setTimeout(()=>{w.getState().showVideo||z()},200)));break}},[d,I,W,ye,O,F,h,Ue,pe,lt,f,b,D,z,kt,N,Re]),js=s.useCallback(t=>{if(x(),W(),Ue){const o=pe[pe.length-1];if(!o)return;const c=o.items.length;if(c===0)return;let A=null;Ne(M=>{let $=M;return t==="clockwise"?$=Math.min(c-1,M+1):$=Math.max(0,M-1),A=$,$}),A!==null&&je(M=>{const $=M.length-1,ne=[...M];return ne[$]={...M[$],selectedIndex:A},ne})}else{const o=u?Ae.current:Ye.current,c=(o==null?void 0:o.getCurrentTime())||0,A=5;let M=c;t==="clockwise"?(M=c+A,o==null||o.seekTo(M),O(`⏩︎ ${Math.floor(M/60)}:${String(Math.floor(M%60)).padStart(2,"0")}`)):(M=Math.max(0,c-A),o==null||o.seekTo(M),O(`⏪︎ ${Math.floor(M/60)}:${String(Math.floor(M%60)).padStart(2,"0")}`))}},[x,W,Ue,pe,O,u]),_e=s.useRef(null),[Is,Cs]=s.useState(1),Dt=s.useRef(K);s.useEffect(()=>{let t;const o=()=>{_e.current&&requestAnimationFrame(()=>{if(!_e.current)return;const A=_e.current.clientWidth,M=_e.current.clientHeight,$=250,ne=400,ve=A-50,le=M-50,xe=ve/$,De=le/ne,tt=Math.min(xe,De,2),Je=Math.max(1,tt);Cs(Jt=>Math.abs(Jt-Je)>.01?Je:Jt)})};t=window.setTimeout(o,10),Dt.current&&!K&&[50,100,200,300,500].forEach(M=>{window.setTimeout(o,M)}),Dt.current=K;const c=new ResizeObserver(()=>{clearTimeout(t),t=window.setTimeout(o,10)});return _e.current&&c.observe(_e.current),()=>{clearTimeout(t),c.disconnect()}},[i,K]);const Ls=s.useCallback(()=>{f.length>0&&b>=0&&St(!0)},[f,b]),Ns=t=>`${window.location.origin}/ipod/${t}`,{ipodVolume:Ft}=ss(t=>({ipodVolume:t.ipodVolume})),$e=mn({title:((Wt=f[b])==null?void 0:Wt.title)??"",artist:((Yt=f[b])==null?void 0:Yt.artist)??"",album:((Ht=f[b])==null?void 0:Ht.album)??"",currentTime:we+(((Xt=f[b])==null?void 0:Xt.lyricOffset)??0)/1e3,translateTo:m}),Vt=s.useRef(u);s.useEffect(()=>{var t,o;if(u!==Vt.current){if(u){const c=((t=Ye.current)==null?void 0:t.getCurrentTime())||we,A=D;setTimeout(()=>{Ae.current&&(Ae.current.seekTo(c),A&&et&&ct.current&&setTimeout(()=>{var $,ne;const M=(ne=($=Ae.current)==null?void 0:$.getInternalPlayer)==null?void 0:ne.call($);M&&typeof M.playVideo=="function"&&M.playVideo()},200))},100)}else{const c=((o=Ae.current)==null?void 0:o.getCurrentTime())||we,A=D;setTimeout(()=>{Ye.current&&(Ye.current.seekTo(c),setTimeout(()=>{A&&!w.getState().isPlaying&&R(!0)},50))},200)}Vt.current=u}},[u,we,D,R,et]);const As=s.useCallback(t=>{if(Ae.current){const o=Ae.current.getCurrentTime()||0,c=Math.max(0,o+t);Ae.current.seekTo(c),O(`${t>0?"⏩︎":"⏪︎"} ${Math.floor(c/60)}:${String(Math.floor(c%60)).padStart(2,"0")}`)}},[O]),Ms=m,Es=s.useCallback(t=>{const o=w.getState().setLyricsTranslationLanguage;o(t)},[]),Rs=s.useCallback(()=>{const t=w.getState(),o=t.lyricsAlignment;let c;o===G.FocusThree?c=G.Center:o===G.Center?c=G.Alternating:c=G.FocusThree,t.setLyricsAlignment(c),O(c===G.FocusThree?n("apps.ipod.status.layoutFocus"):c===G.Center?n("apps.ipod.status.layoutCenter"):n("apps.ipod.status.layoutAlternating"))},[O,n]),Os=s.useCallback(()=>{const t=w.getState(),c=t.koreanDisplay===Ee.Original?Ee.Romanized:Ee.Original;t.setKoreanDisplay(c),O(c===Ee.Romanized?n("apps.ipod.status.romanizationOn"):n("apps.ipod.status.hangulOn"))},[O,n]);s.useEffect(()=>{const t=()=>{!document.fullscreenElement&&u&&E()};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[u,E]);const Bt=cs(t=>t.current),Ut=Bt==="xp"||Bt==="win98",_t=e.jsx(nn,{onClose:r,onShowHelp:()=>We(!0),onShowAbout:()=>vt(!0),onClearLibrary:()=>{yt(!0)},onSyncLibrary:ws,onAddTrack:()=>ze(!0),onShareSong:Ls});return i?e.jsxs(e.Fragment,{children:[!Ut&&p&&_t,e.jsxs(Xs,{title:Ks("ipod"),onClose:r,isForeground:p,appId:"ipod",transparentBackground:!0,skipInitialSound:C,instanceId:g,onNavigateNext:L,onNavigatePrevious:l,menuBar:Ut?_t:void 0,keepMountedWhenMinimized:!0,children:[e.jsx("div",{ref:_e,className:"ipod-force-font flex flex-col items-center justify-center w-full h-full bg-gradient-to-b from-gray-100/20 to-gray-300/20 backdrop-blur-lg p-4 select-none",style:{position:"relative",overflow:"hidden",contain:"layout style paint"},children:e.jsxs("div",{className:be("ipod-force-font w-[250px] h-[400px] rounded-2xl shadow-xl border border-black/40 flex flex-col items-center p-4 pb-8",H==="classic"?"bg-white/85":"bg-black/85"),style:{transform:`scale(${Is})`,transformOrigin:"center",transition:"transform 0.2s ease",minWidth:"250px",minHeight:"400px",maxWidth:"250px",maxHeight:"400px",contain:"layout style paint",willChange:"transform",backfaceVisibility:"hidden"},children:[e.jsx(pn,{currentTrack:f[b]||null,isPlaying:D&&!u,elapsedTime:we,totalTime:a,menuMode:Ue,menuHistory:pe,selectedMenuItem:lt,onSelectMenuItem:Ne,currentIndex:b,tracksLength:f.length,backlightOn:v,menuDirection:ys,onMenuItemAction:Ts,showVideo:B,playerRef:Ye,handleTrackEnd:Mt,handleProgress:Et,handleDuration:Rt,handlePlay:Ot,handlePause:Pt,handleReady:$t,loopCurrent:P,statusMessage:Oe,onToggleVideo:z,lcdFilterOn:J,ipodVolume:Ft,showStatusCallback:O,showLyrics:Q,lyricsAlignment:ee,chineseVariant:U,koreanDisplay:S,lyricOffset:te??0,adjustLyricOffset:t=>w.getState().adjustLyricOffset(b,t),registerActivity:W,isFullScreen:u,lyricsControls:$e}),e.jsx(hn,{theme:H,onWheelClick:Ss,onWheelRotation:js,onMenuButton:kt})]})}),u&&e.jsx(bn,{onClose:()=>{E()},togglePlay:F,nextTrack:()=>{He.current=!0,ye(),setTimeout(()=>{const t=f[w.getState().currentIndex];if(t){const o=t.artist?` - ${t.artist}`:"";O(`⏭ ${t.title}${o}`)}},100)},previousTrack:()=>{He.current=!0,h(),setTimeout(()=>{const t=f[w.getState().currentIndex];if(t){const o=t.artist?` - ${t.artist}`:"";O(`⏮ ${t.title}${o}`)}},100)},seekTime:As,showStatus:O,showOfflineStatus:Re,registerActivity:W,isPlaying:D,statusMessage:Oe,currentTranslationCode:Ms,onSelectTranslation:Es,currentAlignment:ee,onCycleAlignment:Rs,currentKoreanDisplay:S,onToggleKoreanDisplay:Os,fullScreenPlayerRef:Ae,children:({controlsVisible:t})=>e.jsx("div",{className:"flex flex-col w-full h-full",children:e.jsx("div",{className:"relative w-full h-full overflow-visible",children:e.jsx("div",{className:"w-full relative",style:{height:"calc(100% + clamp(200px, 30dvh, 360px))",transform:"translateY(-100px)"},children:f[b]&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full h-full pointer-events-none",children:e.jsx(is,{ref:Ae,url:f[b].url,playing:D&&u,controls:!0,width:"100%",height:"100%",volume:Ft*us.getState().masterVolume,loop:P,onEnded:Mt,onProgress:Et,onDuration:Rt,onPlay:Ot,onPause:Pt,onReady:$t,config:{youtube:{playerVars:{modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,cc_load_policy:0,fs:1,playsinline:1,enablejsapi:1,origin:window.location.origin},embedOptions:{referrerPolicy:"strict-origin-when-cross-origin"}}}})}),Q&&f[b]&&e.jsx("div",{className:"absolute inset-0 bg-black/50 z-10 pointer-events-none"}),Q&&e.jsx("div",{className:"absolute bottom-0 inset-0 pointer-events-none z-20",style:{transform:t?"translateY(-3rem)":"translateY(clamp(1rem, 4dvh, 5rem))",transition:"transform 200ms ease"},children:e.jsx(hs,{lines:$e.lines,currentLine:$e.currentLine,isLoading:$e.isLoading,error:$e.error,visible:!0,videoVisible:!0,alignment:ee,chineseVariant:U,koreanDisplay:S,fontClassName:"font-lyrics-rounded",onAdjustOffset:o=>{var $;w.getState().adjustLyricOffset(b,o);const c=((($=f[b])==null?void 0:$.lyricOffset)??0)+o,A=c>0?"+":(c<0,"");O(`${n("apps.ipod.status.offset")} ${A}${(c/1e3).toFixed(2)}s`);const M=we+c/1e3;$e.updateCurrentTimeManually(M)},isTranslating:$e.isTranslating,textSizeClass:"text-[min(10vw,10vh)]",gapClass:"gap-0",containerStyle:{gap:"clamp(0.25rem, calc(min(10vw,10vh) * 0.12), 2.5rem)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"},interactive:et?!1:D,bottomPaddingClass:"pb-[calc(max(env(safe-area-inset-bottom),1.5rem)+clamp(5rem,16dvh,12rem))]"})}),$e.isTranslating&&!Q&&e.jsx("div",{className:"absolute inset-0 pointer-events-none z-20 flex items-end justify-center pb-[calc(max(env(safe-area-inset-bottom),1.5rem)+clamp(5rem,16dvh,12rem))]",style:{transform:t?"translateY(0)":"translateY(clamp(2rem, 8dvh, 10rem))",transition:"transform 200ms ease"},children:e.jsx("div",{className:be("shimmer opacity-60 text-[min(10vw,10vh)]","font-lyrics-rounded"),children:n("apps.ipod.status.translatingLyrics")})})]})})})})}),e.jsx(qs,{isOpen:it,onOpenChange:We,helpItems:V,appId:"ipod"}),e.jsx(Gs,{isOpen:fs,onOpenChange:vt,metadata:Js,appId:"ipod"}),e.jsx(Zs,{isOpen:ms,onOpenChange:yt,onConfirm:()=>{Ce(),yt(!1),O(n("apps.ipod.status.libraryCleared"))},title:n("apps.ipod.dialogs.clearLibraryTitle"),description:n("apps.ipod.dialogs.clearLibraryDescription")}),e.jsx(Qs,{isOpen:ot,onOpenChange:ze,onSubmit:wt,title:n("apps.ipod.dialogs.addSongTitle"),description:n("apps.ipod.dialogs.addSongDescription"),value:ke,onChange:ge,isLoading:gs}),e.jsx(ds,{isOpen:xs,onClose:()=>St(!1),itemType:"Song",itemIdentifier:((Kt=f[b])==null?void 0:Kt.id)||"",title:(qt=f[b])==null?void 0:qt.title,details:(Gt=f[b])==null?void 0:Gt.artist,generateShareUrl:Ns})]})]}):null}export{Rn as IpodAppComponent};
