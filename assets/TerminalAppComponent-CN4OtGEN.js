import{r as b,j as a}from"./ui-core-BpsHYXg8.js";import{u as Ne,a as Le,M as sn,b as At,d as jt,e as It,f as X,g as gt,k as an,S as rn,l as on,m as ln,ba as cn,bb as un,a3 as _,ai as yt,bF as wt,aC as lt,bG as St,U as nt,T as ct,bH as ye,at as pn,L as mn,aD as Te,E as dn,O as hn,X as fn,bI as gn,Z as xn,H as yn,J as wn,bJ as Sn,Y as Cn,$ as kn,aH as bn,aI as vn,N as An,P as we,bK as jn,n as Se,o as Ce}from"./index-o--Dc4yZ.js";import{c as In}from"./zustand-B8BJfZ-c.js";import{u as Mn,E as En}from"./EmojiAquarium-CXcfvczE.js";import{u as Nn,e as Ln,i as ke,H as Tn}from"./useTerminalSounds-Bvtj4myc.js";import{h as Pn,S as $n,U as Dn,T as Fn,a as On,b as Hn}from"./tiptap-C4n5NkG5.js";import{m as zt,A as Wn}from"./motion-CEuZ4rxa.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./ui-form-Ch9CMzqg.js";import"./audio-BlpnjJKR.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";import"./ai-sdk-CzPalbIq.js";import"./useTtsQueue-D868Ck6t.js";import"./appletAuthBridge-gdg5QSWM.js";import"./plus-BoiJuXfb.js";function _n({onClose:n,onShowHelp:s,onShowAbout:e,onClear:p,onIncreaseFontSize:c,onDecreaseFontSize:r,onResetFontSize:i,onToggleMute:d,isMuted:g=!1}){var Z;const{t:w}=Ne(),[y,E]=b.useState(!1),T="terminal",D=(Z=ln[T])==null?void 0:Z.name,v=Le(z=>z.current),F=v==="xp"||v==="win98";return a.jsxs(sn,{inWindowFrame:F,children:[a.jsxs(At,{children:[a.jsx(jt,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:w("common.menu.file")}),a.jsxs(It,{align:"start",sideOffset:1,className:"px-0",children:[a.jsx(X,{onClick:p,className:"text-md h-6 px-3",children:w("apps.terminal.menu.clearTerminal")}),a.jsx(gt,{className:"h-[2px] bg-black my-1"}),a.jsx(X,{onClick:n,className:"text-md h-6 px-3",children:w("common.menu.close")})]})]}),a.jsxs(At,{children:[a.jsx(jt,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:w("common.menu.edit")}),a.jsxs(It,{align:"start",sideOffset:1,className:"px-0",children:[a.jsx(X,{className:"text-md h-6 px-3",children:w("common.menu.copy")}),a.jsx(X,{className:"text-md h-6 px-3",children:w("common.menu.paste")}),a.jsx(gt,{className:"h-[2px] bg-black my-1"}),a.jsx(X,{className:"text-md h-6 px-3",children:w("common.menu.selectAll")})]})]}),a.jsxs(At,{children:[a.jsx(jt,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:w("common.menu.view")}),a.jsxs(It,{align:"start",sideOffset:1,className:"px-0",children:[a.jsx(X,{onClick:c,className:"text-md h-6 px-3",children:w("apps.terminal.menu.increaseFontSize")}),a.jsx(X,{onClick:r,className:"text-md h-6 px-3",children:w("apps.terminal.menu.decreaseFontSize")}),a.jsx(gt,{className:"h-[2px] bg-black my-1"}),a.jsx(X,{onClick:i,className:"text-md h-6 px-3",children:w("apps.terminal.menu.resetFontSize")}),d&&a.jsxs(a.Fragment,{children:[a.jsx(gt,{className:"h-[2px] bg-black my-1"}),a.jsx(an,{checked:g,onCheckedChange:z=>{z!==g&&d()},className:"text-md h-6 px-3",children:w("apps.terminal.menu.muteSounds")})]})]})]}),a.jsxs(At,{children:[a.jsx(jt,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:w("common.menu.help")}),a.jsxs(It,{align:"start",sideOffset:1,className:"px-0",children:[a.jsx(X,{onClick:s,className:"text-md h-6 px-3",children:w("apps.terminal.menu.terminalHelp")}),a.jsx(X,{onSelect:()=>E(!0),className:"text-md h-6 px-3",children:w("common.menu.shareApp")}),a.jsx(gt,{className:"h-[2px] bg-black my-1"}),a.jsx(X,{onClick:e,className:"text-md h-6 px-3",children:w("apps.terminal.menu.aboutTerminal")})]})]}),a.jsx(rn,{isOpen:y,onClose:()=>E(!1),itemType:"App",itemIdentifier:T,title:D,generateShareUrl:on})]})}const be=1,Rn="ryos:terminal",Y=In()(cn(n=>({commandHistory:[],currentPath:"/",setCommandHistory:s=>n(e=>({commandHistory:typeof s=="function"?s(e.commandHistory):s})),addCommand:s=>n(e=>({commandHistory:[...e.commandHistory,{command:s,timestamp:Date.now()}].slice(-500)})),setCurrentPath:s=>n({currentPath:s}),reset:()=>n({commandHistory:[],currentPath:"/"}),isInAiMode:!1,setIsInAiMode:s=>n({isInAiMode:s}),initialAiPrompt:void 0,setInitialAiPrompt:s=>n({initialAiPrompt:s}),isInVimMode:!1,setIsInVimMode:s=>n({isInVimMode:s}),vimFile:null,setVimFile:s=>n({vimFile:s}),vimPosition:0,setVimPosition:s=>n(e=>({vimPosition:typeof s=="function"?s(e.vimPosition):s})),vimCursorLine:0,setVimCursorLine:s=>n(e=>({vimCursorLine:typeof s=="function"?s(e.vimCursorLine):s})),vimCursorColumn:0,setVimCursorColumn:s=>n(e=>({vimCursorColumn:typeof s=="function"?s(e.vimCursorColumn):s})),vimMode:"normal",setVimMode:s=>n({vimMode:s}),vimClipboard:"",setVimClipboard:s=>n({vimClipboard:s})}),{name:Rn,version:be,storage:un(()=>localStorage),partialize:n=>({commandHistory:n.commandHistory,currentPath:n.currentPath}),migrate:(n,s)=>{if(!n||s<be)try{const e=localStorage.getItem("terminal:commandHistory"),p=localStorage.getItem("terminal:currentPath"),c=e?JSON.parse(e):[],r=p||"/";return e&&localStorage.removeItem("terminal:commandHistory"),p&&localStorage.removeItem("terminal:currentPath"),{commandHistory:c,currentPath:r}}catch(e){console.warn("[TerminalStore] Migration failed",e)}return n}})),ve=n=>{var r;const s=n.trim();if(!s)return{cmd:"",args:[]};const e=/[^\s"']+|"([^"]*)"|'([^']*)'/g,p=[];let c;for(;(c=e.exec(s))!==null;)c[1]?p.push(c[1]):c[2]?p.push(c[2]):p.push(c[0]);return{cmd:((r=p[0])==null?void 0:r.toLowerCase())||"",args:p.slice(1)}},Vn={name:"help",description:"apps.terminal.commands.help",handler:()=>{const n=s=>_.t(s);return{output:`
navigation & files
  pwd              ${n("apps.terminal.commands.pwd")}
  ls               ${n("apps.terminal.commands.ls")}
  cd <dir>         ${n("apps.terminal.commands.cd")}
  cat <file>       ${n("apps.terminal.commands.cat")}
  touch <file>     ${n("apps.terminal.commands.touch")}
  mkdir <dir>      ${n("apps.terminal.commands.mkdir")}
  rm <file>        ${n("apps.terminal.commands.rm")}
  open <target>    ${n("apps.terminal.commands.open")}
  edit <file>      ${n("apps.terminal.commands.edit")}
  vim <file>       ${n("apps.terminal.commands.vim")}

terminal
  clear            ${n("apps.terminal.commands.clear")}
  help             ${n("apps.terminal.commands.help")}
  history          ${n("apps.terminal.commands.history")}
  about            ${n("apps.terminal.commands.about")}
  echo <text>      ${n("apps.terminal.commands.echo")}
  whoami           ${n("apps.terminal.commands.whoami")}
  su <user> [pass] ${n("apps.terminal.commands.su")}
  logout           ${n("apps.terminal.commands.logout")}
  date             ${n("apps.terminal.commands.date")}
  cowsay <text>    ${n("apps.terminal.commands.cowsay")}

assistant
  ryo <prompt>     ${n("apps.terminal.commands.ryo")}
  ai <prompt>      ${n("apps.terminal.commands.ai")}
  chat <prompt>    ${n("apps.terminal.commands.chat")}

`,isError:!1}}},Bn={name:"clear",description:"apps.terminal.commands.clear",handler:()=>({output:"",isError:!1})},Un={name:"pwd",description:"apps.terminal.commands.pwd",handler:(n,s)=>({output:s.currentPath,isError:!1})},zn={name:"ls",description:"apps.terminal.commands.ls",handler:(n,s)=>s.files.length===0?{output:_.t("apps.terminal.output.noFilesFound"),isError:!1,isSystemMessage:!0}:{output:s.files.map(e=>(e.isDirectory,e.name)).join(`
`),isError:!1}},Gn={name:"cd",description:"apps.terminal.commands.cd",usage:"cd <dir>",handler:(n,s)=>{if(n.length===0)return s.navigateToPath("/"),{output:"",isError:!1};if(n[0]===".."){const w=s.currentPath.split("/").filter(Boolean),y=w.length>0?"/"+w.slice(0,-1).join("/"):"/";return s.navigateToPath(y),{output:"",isError:!1}}let e=n[0];e.startsWith("/")||(e=`${s.currentPath==="/"?"":s.currentPath}/${e}`);const p=e.endsWith("/")&&e!=="/"?e.slice(0,-1):e,c=p.split("/").filter(Boolean),r=c.pop(),i=c.length>0?"/"+c.join("/"):"/";return p==="/"?(s.navigateToPath("/"),{output:"",isError:!1}):s.files.filter(w=>{const y=i.endsWith("/")?i:i+"/";return w.path.startsWith(y)&&!w.path.replace(y,"").includes("/")}).some(w=>w.name===r&&w.isDirectory)?(s.navigateToPath(p),{output:"",isError:!1}):{output:_.t("apps.terminal.output.noSuchDirectory",{dir:n[0]}),isError:!0}}},Kn={name:"touch",description:"apps.terminal.commands.touch",usage:"touch <filename>",handler:async(n,s)=>{if(n.length===0)return{output:"usage: touch <filename>",isError:!0};const e=n[0];return s.files.find(p=>p.name===e)?{output:`file already exists: ${e}`,isError:!0}:(await s.saveFile({name:e,path:`${s.currentPath}/${e}`,content:"",type:"text",icon:"/icons/file-text.png"}),{output:`created file: ${e}`,isError:!1})}},qn={name:"rm",description:"apps.terminal.commands.rm",usage:"rm <filename>",handler:(n,s)=>{if(n.length===0)return{output:"usage: rm <filename>",isError:!0};const e=n[0],p=s.files.find(c=>c.name===e);return p?(s.moveToTrash(p),{output:`moved to trash: ${e}`,isError:!1}):{output:`file not found: ${e}`,isError:!0}}},Jn={name:"mkdir",description:"apps.terminal.commands.mkdir",usage:"mkdir <dir>",handler:()=>({output:"command not implemented: mkdir requires filesystem write access",isError:!0})},Zn={name:"echo",description:"apps.terminal.commands.echo",usage:"echo <text>",handler:n=>({output:n.join(" "),isError:!1})},Xn={name:"whoami",description:"apps.terminal.commands.whoami",handler:(n,s)=>({output:s.username||"you",isError:!1})},Yn={name:"date",description:"apps.terminal.commands.date",handler:()=>{const n=new Date,s={weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",year:"numeric",timeZoneName:"short"};return{output:n.toLocaleString("en-US",s),isError:!1}}},Qn=n=>{const s=n.length,e=` ${"_".repeat(s+2)} `,p=` ${"-".repeat(s+2)} `;return`${e}
< ${n} >
${p}
        \\   ^__^
         \\  (oo)\\_______
            (__)\\       )\\/\\
                ||----w |
                ||     ||`},ts={name:"cowsay",description:"apps.terminal.commands.cowsay",usage:"cowsay <text>",handler:(n,s)=>{const e=n.join(" ")||"Moo!";return s.playMooSound&&s.playMooSound(),{output:Qn(e),isError:!1}}},es={name:"about",description:"apps.terminal.commands.about",handler:(n,s)=>(setTimeout(()=>s.setIsAboutDialogOpen(!0),100),{output:"opening about dialog...",isError:!1})},Kt={name:"ai",description:"apps.terminal.commands.ai",usage:"ai [initial prompt]",handler:n=>{const s=Y.getState();if(s.setIsInAiMode(!0),yt(wt.CHAT_START),lt.getState().setAiMessages([]),n.length>0){const p=n.join(" ");return yt(wt.AI_COMMAND,{prompt:p}),s.setInitialAiPrompt(p),{output:_.t("apps.terminal.output.askRyoWithPrompt",{prompt:p}),isError:!1,isSystemMessage:!0}}return{output:_.t("apps.terminal.output.askRyoAnything"),isError:!1,isSystemMessage:!0}}},ns={...Kt,name:"chat"},ss={...Kt,name:"ryo"},as={name:"vim",description:"apps.terminal.commands.vim",usage:"vim <filename>",handler:async(n,s)=>{if(n.length===0)return{output:"usage: vim <filename>",isError:!0};const e=n[0],p=s.files.find(i=>i.name===e);if(!p)return{output:`file not found: ${e}`,isError:!0};if(p.isDirectory)return{output:`${e} is a directory, not a file`,isError:!0};const c=Y.getState();let r="";try{if(p.path.startsWith("/Documents/")||p.path.startsWith("/Images/")){const d=St.getState().getItem(p.path);if(d&&d.uuid){const g=p.path.startsWith("/Documents/")?nt.DOCUMENTS:nt.IMAGES,w=await ct.get(g,d.uuid);w&&w.content&&(w.content instanceof Blob?r=await w.content.text():typeof w.content=="string"&&(r=w.content))}}}catch(i){console.error("Error reading file for vim:",i)}return c.setIsInVimMode(!0),c.setVimFile({name:e,content:r||""}),c.setVimPosition(0),c.setVimCursorLine(0),c.setVimCursorColumn(0),c.setVimMode("normal"),{output:`opening ${e} in vim...`,isError:!1}}},Ae={ie:"internet-explorer",browser:"internet-explorer",explorer:"internet-explorer",chat:"chats",text:"textedit",edit:"textedit",editor:"textedit",music:"ipod",player:"ipod",video:"videos",movie:"videos",settings:"control-panels",preferences:"control-panels",prefs:"control-panels",applets:"applet-viewer",store:"applet-viewer",vm:"pc",virtualpc:"pc",cam:"photo-booth",camera:"photo-booth",photos:"photo-booth",mine:"minesweeper",mines:"minesweeper",sound:"soundboard",sounds:"soundboard",synth:"synth",synthesizer:"synth",keyboard:"synth",term:"terminal",cli:"terminal",shell:"terminal",files:"finder",file:"finder"};function rs(n){const s=n.toLowerCase();if(ye.includes(s))return s;if(Ae[s])return Ae[s];const e=ye.find(p=>p.includes(s)||s.includes(p.replace("-","")));return e||null}const os={name:"open",description:"apps.terminal.commands.open",usage:"open <app|file|path>",handler:async(n,s)=>{if(n.length===0)return{output:`usage: open <app|file|path>

${_.t("apps.terminal.output.openExamples")}:
  open finder
  open textedit
  open myfile.txt
  open /Applets/my-applet.app`,isError:!0};const e=n.join(" "),p=rs(e);if(p)return s.launchApp(p),s.playCommandSound(),{output:_.t("apps.terminal.output.openedApp",{app:p}),isError:!1};const c=s.files.find(i=>i.name.toLowerCase()===e.toLowerCase());if(c)return c.isDirectory?(s.launchApp("finder",{initialPath:c.path}),s.playCommandSound(),{output:_.t("apps.terminal.output.openedFolder",{folder:c.name}),isError:!1}):await Bt(c.path,c.name,s);if(e.startsWith("/")){const d=St.getState().getItem(e);if(d)return d.isDirectory?(s.launchApp("finder",{initialPath:e}),s.playCommandSound(),{output:_.t("apps.terminal.output.openedFolder",{folder:d.name}),isError:!1}):await Bt(e,d.name,s)}const r=s.files.find(i=>i.name.toLowerCase().includes(e.toLowerCase()));return r?r.isDirectory?(s.launchApp("finder",{initialPath:r.path}),s.playCommandSound(),{output:_.t("apps.terminal.output.openedFolder",{folder:r.name}),isError:!1}):await Bt(r.path,r.name,s):(s.playErrorSound(),{output:_.t("apps.terminal.output.openNotFound",{target:e}),isError:!0})}};async function Bt(n,s,e){const c=St.getState().getItem(n);if(n.startsWith("/Applications/")&&(c!=null&&c.appId))return e.launchApp(c.appId),e.playCommandSound(),{output:_.t("apps.terminal.output.openedApp",{app:c.appId}),isError:!1};if(n.startsWith("/Documents/")){let r="";if(c!=null&&c.uuid)try{const i=await ct.get(nt.DOCUMENTS,c.uuid);i!=null&&i.content&&(i.content instanceof Blob?r=await i.content.text():typeof i.content=="string"&&(r=i.content))}catch(i){console.error("[open] Error reading document:",i)}return e.launchApp("textedit",{initialData:{path:n,content:r}}),e.playCommandSound(),{output:_.t("apps.terminal.output.openedFile",{file:s}),isError:!1}}if(n.startsWith("/Images/")){let r;if(c!=null&&c.uuid)try{const i=await ct.get(nt.IMAGES,c.uuid);(i==null?void 0:i.content)instanceof Blob&&(r=i.content)}catch(i){console.error("[open] Error reading image:",i)}return e.launchApp("paint",{initialData:{path:n,content:r}}),e.playCommandSound(),{output:_.t("apps.terminal.output.openedFile",{file:s}),isError:!1}}if(n.startsWith("/Applets/")&&(n.endsWith(".app")||n.endsWith(".html"))){let r="";if(c!=null&&c.uuid)try{const i=await ct.get(nt.APPLETS,c.uuid);i!=null&&i.content&&(i.content instanceof Blob?r=await i.content.text():typeof i.content=="string"&&(r=i.content))}catch(i){console.error("[open] Error reading applet:",i)}return e.launchApp("applet-viewer",{initialData:{path:n,content:r}}),e.playCommandSound(),{output:_.t("apps.terminal.output.openedApplet",{applet:s.replace(/\.(app|html)$/i,"")}),isError:!1}}return e.launchApp("finder",{initialPath:n.substring(0,n.lastIndexOf("/"))||"/"}),e.playCommandSound(),{output:_.t("apps.terminal.output.openedFile",{file:s}),isError:!1}}const Gt={help:Vn,clear:Bn,pwd:Un,ls:zn,cd:Gn,touch:Kn,rm:qn,mkdir:Jn,echo:Zn,whoami:Xn,date:Yn,cowsay:ts,about:es,ai:Kt,chat:ns,ryo:ss,vim:as,open:os},is=Object.keys(Gt).concat(["cat","edit","history","su","logout"]);function je(n){return n.replace(/([A-Z])/g," $1").replace(/^./,s=>s.toUpperCase()).trim()}function xt(n){return n?Te(n):"app"}function ls({invocation:n,fontSize:s}){const{t:e}=Ne(),{toolName:p,state:c,input:r,output:i}=n;if(p==="aquarium")return null;let d=null,g=null;const w=!c||c==="input-streaming"||c==="input-available";if(w)switch(p){case"list":{const y=typeof(r==null?void 0:r.path)=="string"?r.path:"";y==="/Music"?d=e("apps.chats.toolCalls.loadingMusicLibrary"):y==="/Applets Store"?d=e("apps.chats.toolCalls.listingSharedApplets"):y==="/Applications"?d=e("apps.chats.toolCalls.listingApplications"):d=e("apps.chats.toolCalls.findingFiles");break}case"open":{const y=typeof(r==null?void 0:r.path)=="string"?r.path:"";y.startsWith("/Music/")?d=e("apps.chats.toolCalls.playingSong"):y.startsWith("/Applets Store/")?d=e("apps.chats.toolCalls.openingAppletPreview"):y.startsWith("/Applications/")?d=e("apps.chats.toolCalls.launchingApp"):d=e("apps.chats.toolCalls.openingFile");break}case"read":{(typeof(r==null?void 0:r.path)=="string"?r.path:"").startsWith("/Applets Store/")?d=e("apps.chats.toolCalls.fetchingApplet"):d=e("apps.chats.toolCalls.readingFile");break}case"write":d=e("apps.chats.toolCalls.writingContent");break;case"edit":d=e("apps.chats.toolCalls.editingFile");break;case"launchApp":d=e("apps.chats.toolCalls.launching",{appName:xt(r==null?void 0:r.id)});break;case"closeApp":d=e("apps.chats.toolCalls.closing",{appName:xt(r==null?void 0:r.id)});break;case"ipodControl":{const y=(r==null?void 0:r.action)||"toggle";y==="next"?d=e("apps.chats.toolCalls.skippingToNext"):y==="previous"?d=e("apps.chats.toolCalls.skippingToPrevious"):y==="addAndPlay"?d=e("apps.chats.toolCalls.addingSong"):y==="playKnown"?d=e("apps.chats.toolCalls.playingSong"):d=e("apps.chats.toolCalls.controllingPlayback");break}case"settings":d=e("apps.chats.toolCalls.changingSettings");break;case"generateHtml":d=e("apps.chats.toolCalls.generating");break;default:d=e("apps.chats.toolCalls.running",{toolName:je(p)})}if(c==="output-available")if(p==="list"){if(typeof i=="string"){const y=i.match(/Found (\d+) songs?/),E=i.match(/Found (\d+) (?:shared )?applets?/i),T=i.match(/Found (\d+) documents?/),D=i.match(/Found (\d+) applications?/);if(y){const v=parseInt(y[1],10);g=v===1?e("apps.chats.toolCalls.foundSongs",{count:v}):e("apps.chats.toolCalls.foundSongsPlural",{count:v})}else if(E){const v=parseInt(E[1],10);g=v===1?e("apps.chats.toolCalls.foundApplets",{count:v}):e("apps.chats.toolCalls.foundAppletsPlural",{count:v})}else if(T){const v=parseInt(T[1],10);g=v===1?e("apps.chats.toolCalls.foundDocuments",{count:v}):e("apps.chats.toolCalls.foundDocumentsPlural",{count:v})}else if(D){const v=parseInt(D[1],10);g=v===1?e("apps.chats.toolCalls.foundApplications",{count:v}):e("apps.chats.toolCalls.foundApplicationsPlural",{count:v})}else i.includes("empty")||i.toLowerCase().includes("no ")?g=e("apps.chats.toolCalls.noItemsFound"):g=e("apps.chats.toolCalls.listedItems")}}else if(p==="open")typeof i=="string"&&i.trim().length>0?g=i:g=e("apps.chats.toolCalls.opened");else if(p==="read"){const E=(typeof(r==null?void 0:r.path)=="string"?r.path:"").split("/").filter(Boolean).pop()||"file";g=e("apps.chats.toolCalls.read",{fileName:E})}else if(p==="write")g=e("apps.chats.toolCalls.contentWritten");else if(p==="edit")if(typeof i=="string")if(i.includes("not found"))g=e("apps.chats.toolCalls.textNotFound");else if(i.includes("matches")&&i.includes("locations"))g=e("apps.chats.toolCalls.multipleMatchesFound");else if(i.includes("Successfully")||i.includes("edited")){const E=(typeof(r==null?void 0:r.path)=="string"?r.path:"").split("/").filter(Boolean).pop()||"file";g=e("apps.chats.toolCalls.edited",{fileName:E})}else i.includes("Created")?g=e("apps.chats.toolCalls.fileCreated"):g=i;else g=e("apps.chats.toolCalls.fileEdited");else if(p==="launchApp"&&(r==null?void 0:r.id)==="internet-explorer"){const y=r.url?String(r.url):"",E=r.year&&r.year!==""?String(r.year):"";y&&E?g=e("apps.chats.toolCalls.launchedWithUrlAndYear",{url:y,year:E}):y?g=e("apps.chats.toolCalls.launchedWithUrl",{url:y}):g=e("apps.chats.toolCalls.launched",{appName:xt(r==null?void 0:r.id)})}else if(p==="launchApp")g=e("apps.chats.toolCalls.launched",{appName:xt(r==null?void 0:r.id)});else if(p==="closeApp")g=e("apps.chats.toolCalls.closed",{appName:xt(r==null?void 0:r.id)});else if(p==="ipodControl")if(typeof i=="string"&&i.trim().length>0)g=i;else{const y=(r==null?void 0:r.action)||"toggle";y==="addAndPlay"?g=e("apps.chats.toolCalls.addedAndStartedPlaying"):y==="playKnown"?g=e("apps.chats.toolCalls.playingSongGeneric"):y==="next"?g=e("apps.chats.toolCalls.skippedToNextTrack"):y==="previous"?g=e("apps.chats.toolCalls.skippedToPreviousTrack"):g=e(y==="play"?"apps.chats.toolCalls.playingIpod":y==="pause"?"apps.chats.toolCalls.pausedIpod":"apps.chats.toolCalls.toggledIpodPlayback")}else p==="settings"?typeof i=="string"&&i.trim().length>0?g=i:g=e("apps.chats.toolCalls.settingsUpdated"):typeof i=="string"&&i.trim().length>0&&p!=="generateHtml"&&(g=i);return c==="output-error"&&(g=e("apps.chats.toolCalls.toolExecutionFailed")),w&&!d&&(d=e("apps.chats.toolCalls.running",{toolName:je(p)})),!d&&!g?null:a.jsx("div",{className:"flex items-center gap-1.5 text-gray-400 py-0.5 select-text terminal-tool-invocation",style:s?{fontSize:`${s}px`}:void 0,children:c==="output-available"&&g?a.jsxs(a.Fragment,{children:[a.jsx(pn,{className:"h-3 w-3 text-green-400 flex-shrink-0"}),a.jsx("span",{className:"italic",children:g})]}):c==="output-error"?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-red-400",children:"⚠️"}),a.jsx("span",{className:"italic text-red-400",children:g})]}):d?a.jsxs(a.Fragment,{children:[a.jsx(mn,{className:"h-3 w-3 animate-spin text-purple-400 flex-shrink-0"}),a.jsx("span",{className:"italic shimmer",children:d})]}):null})}function cs({file:n,position:s,vimCursorLine:e,vimCursorColumn:p,vimMode:c}){const r=n.content.split(`
`),i=20,d=r.slice(s,s+i);for(;d.length<i;)d.push("~");const g=r.length>0?Math.min(100,Math.floor((s+i)/r.length*100)):100;return a.jsxs("div",{className:"vim-editor font-monaco text-white",children:[d.map((w,y)=>{const E=s+y,T=E===e;return a.jsxs("div",{className:`vim-line flex ${T?"bg-white/10":""}`,children:[a.jsx("span",{className:"text-gray-500 w-6 text-right mr-2",children:E+1}),T?a.jsxs("span",{className:"select-text flex-1",children:[w.substring(0,p),a.jsx("span",{className:"bg-orange-300 text-black",children:w.charAt(p)||" "}),w.substring(p+1)]}):a.jsx("span",{className:"select-text flex-1",children:w})]},y)}),a.jsxs("div",{className:"vim-status-bar flex text-white text-xs mt-2",children:[a.jsx("div",{className:`px-2 py-1 font-bold ${c==="insert"?"bg-green-600/50":"bg-blue-600/50"}`,children:c==="normal"?"NORMAL":c==="insert"?"INSERT":"COMMAND"}),a.jsxs("div",{className:"flex-1 bg-white/10 px-2 py-1 flex items-center justify-between",children:[a.jsxs("span",{className:"flex-1 mx-2",children:["[",n.name,"]"]}),a.jsxs("span",{children:[g,"%"]}),a.jsxs("span",{className:"ml-4 mr-2",children:[e+1,":",p+1]})]})]})]})}const Et=n=>{if(!n)return[n];let s=[];const e=n,p=/(\*\*.*?\*\*|__.*?__)/g;let c=0,r;for(;(r=p.exec(e))!==null;){r.index>c&&s.push(e.substring(c,r.index));const i=r[0].replace(/^\*\*|\*\*$|^__|__$/g,"");s.push(a.jsx("span",{className:"font-bold",children:i},`bold-${r.index}`)),c=r.index+r[0].length}return c<e.length&&s.push(e.substring(c)),s=s.flatMap((i,d)=>{if(typeof i!="string")return i;const g=[],w=/(\*[^*]+\*|_[^_]+_)/g;let y=0,E;for(;(E=w.exec(i))!==null;){E.index>y&&g.push(i.substring(y,E.index));const T=E[0].replace(/^\*|\*$|^_|_$/g,"");g.push(a.jsx("span",{className:"italic",children:T},`italic-${d}-${E.index}`)),y=E.index+E[0].length}return y<i.length&&g.push(i.substring(y)),g.length>0?g:i}),s};function us({text:n,className:s,speed:e=15,renderMarkdown:p=!1}){const[c,r]=b.useState(""),[i,d]=b.useState(!1),g=b.useRef(n);return b.useEffect(()=>{if(r(""),d(!1),g.current=n,n.length>200){r(n),d(!0);return}const w=n.length>100?e*.7:n.length>50?e*.85:e,y=n.length>100?3:n.length>50?2:1,E=[];for(let F=0;F<n.length;F+=y)E.push(n.substring(F,Math.min(F+y,n.length)));let T=0,D;const v=()=>{if(T<E.length){const F=E[T];r(G=>G+F),T++;const z=/[.,!?;:]$/.test(F)?w*3:w;D=setTimeout(v,z)}else d(!0)};return D=setTimeout(v,w),()=>{D&&clearTimeout(D)}},[n,e]),a.jsxs("span",{className:`select-text cursor-text ${s||""}`,children:[p?Et(c):c,!i&&a.jsx(zt.span,{animate:{opacity:[1,0,1]},transition:{repeat:1/0,duration:.8},children:"_"})]})}function Ie(){const[n,s]=b.useState("");return b.useEffect(()=>{const e=[".","..","...","..",".",".","..","..."];let p=0;const c=setInterval(()=>{s(e[p]),p=(p+1)%e.length},200);return()=>clearInterval(c)},[]),a.jsx("span",{children:n})}function Ut(){const[n,s]=b.useState(0),e=["!   ","!!  ","!!! ","!!  ","!   "];return b.useEffect(()=>{const p=setInterval(()=>{s(c=>(c+1)%e.length)},300);return()=>clearInterval(p)},[]),a.jsx("span",{className:"text-red-400 animate-pulse",children:e[n]})}const ps=()=>{if(typeof navigator>"u")return _.t("apps.terminal.output.unknown");const n=navigator.userAgent,s=navigator.platform||"";return/iPad|iPhone|iPod/.test(n)||s==="MacIntel"&&navigator.maxTouchPoints>1?"iOS":/Android/.test(n)?"Android":/Win/.test(s)?"Windows":/Mac/.test(s)?"macOS":/Linux/.test(s)?"Linux":"Unknown"},Me=()=>{const n=Cn.getState(),{username:s}=lt.getState(),e=kn.getState(),p=bn.getState(),c=vn.getState(),r=An.getState(),i=p.getCurrentVideo(),d=c.tracks&&c.currentIndex>=0&&c.currentIndex<c.tracks.length?c.tracks[c.currentIndex]:null,g=ps(),w=Object.entries(n.instances).filter(([,R])=>R.isOpen).map(([R,L])=>{const Q={instanceId:R,appId:L.appId,isForeground:L.isForeground||!1,title:L.title};if(L.appId==="applet-viewer"&&L.initialData){const V=L.initialData;return{...Q,appletPath:V.path||void 0,appletId:V.shareCode||void 0}}return Q}),y=w.find(R=>R.isForeground)||null,E=w.filter(R=>!R.isForeground),T=new Date,D=Intl.DateTimeFormat().resolvedOptions().timeZone||_.t("apps.terminal.output.unknown"),v=T.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0}),F=T.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"}),z=Object.values(r.instances).map(R=>{let L=null;if(R.contentJson)try{const ut=Pn(R.contentJson,[$n,Dn,Fn.configure({types:["heading","paragraph"]}),On,Hn.configure({nested:!0})]);L=we(ut)}catch(ut){console.error("Failed to convert TextEdit content to markdown:",ut)}const Q=n.instances[R.instanceId],V=(Q==null?void 0:Q.title)||_.t("apps.terminal.output.untitled");return{instanceId:R.instanceId,filePath:R.filePath,title:V,contentMarkdown:L,hasUnsavedChanges:R.hasUnsavedChanges}});let G=null;if(e.aiGeneratedHtml)try{G=we(e.aiGeneratedHtml)}catch(R){console.error("Failed to convert IE HTML to markdown:",R)}return{apps:n.apps,username:s,userOS:g,userLocalTime:{timeString:v,dateString:F,timeZone:D},runningApps:{foreground:y,background:E,instanceWindowOrder:n.instanceOrder},internetExplorer:{url:e.url,year:e.year,status:e.status,currentPageTitle:e.currentPageTitle,aiGeneratedHtml:e.aiGeneratedHtml,aiGeneratedMarkdown:G},video:{currentVideo:i?{id:i.id,url:i.url,title:i.title,artist:i.artist}:null,isPlaying:p.isPlaying,loopAll:p.loopAll,loopCurrent:p.loopCurrent,isShuffled:p.isShuffled},ipod:{currentTrack:d?{id:d.id,url:d.url,title:d.title,artist:d.artist}:null,isPlaying:c.isPlaying,loopAll:c.loopAll,loopCurrent:c.loopCurrent,isShuffled:c.isShuffled,currentLyrics:c.currentLyrics,library:c.tracks.map(R=>({id:R.id,title:R.title,artist:R.artist}))},textEdit:{instances:z}}},rt=n=>n.startsWith("!!!!"),Mt=n=>rt(n)?n.slice(4).trimStart():n;function Ee({htmlContent:n,onInteractionChange:s,isStreaming:e=!1,playElevatorMusic:p,stopElevatorMusic:c,playDingSound:r}){const i=Se(Ce.WINDOW_EXPAND),d=Se(Ce.WINDOW_COLLAPSE);return a.jsx(Tn,{htmlContent:n,onInteractionChange:s,isStreaming:e,playElevatorMusic:p,stopElevatorMusic:c,playDingSound:r,maximizeSound:i,minimizeSound:d,className:"select-text"})}function Ns({onClose:n,isWindowOpen:s,isForeground:e=!0,skipInitialSound:p,instanceId:c,onNavigateNext:r,onNavigatePrevious:i}){const d=dn("terminal",jn||[]),[g,w]=b.useState(!1),[y,E]=b.useState(!1),[T,D]=b.useState(""),[v,F]=b.useState([]),[Z,z]=b.useState(-1),[G,R]=b.useState([]),[L,Q]=b.useState(12),{isInAiMode:V,setIsInAiMode:ut,initialAiPrompt:Nt,setInitialAiPrompt:qt,isInVimMode:Ct,setIsInVimMode:Pe,vimFile:j,setVimFile:K,vimPosition:W,setVimPosition:B,vimCursorLine:x,setVimCursorLine:U,vimCursorColumn:P,setVimCursorColumn:N,vimMode:tt,setVimMode:et,vimClipboard:Jt,setVimClipboard:Lt}=Y(),[Zt,$e]=b.useState(0),[Xt,De]=b.useState(!1),[Yt,kt]=b.useState(!1),bt=["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"],[Qt,te]=b.useState(!0),ee=b.useRef(!0),ne=b.useRef(!1),Tt=b.useRef(0),Pt=b.useRef(0),ot=b.useRef({key:"",time:0}),pt=b.useRef(null),$t=b.useRef(new Set),{messages:st,append:Dt,isLoading:mt,stop:Ft}=Mn(),se=lt(t=>t.setAiMessages),dt=b.useRef(null),at=b.useRef(null),{currentPath:Fe}=Y(),{currentPath:J,files:ht,navigateToPath:Oe,saveFile:ft,moveToTrash:He}=hn(Fe),Ot=fn(),{bringToForeground:We}=gn(),{playCommandSound:Ht,playErrorSound:ae,playAiResponseSound:re,toggleMute:_e,isMuted:Re,playElevatorMusic:oe,stopElevatorMusic:ie,playDingSound:le,playMooSound:Ve}=Nn(),{username:ce}=lt();b.useEffect(()=>{const{commandHistory:t}=Y.getState();R(t.map(f=>f.command))},[]),b.useEffect(()=>{const t=new Date().toLocaleTimeString();F([{command:"",output:`     __  __ 
 _  /  \\(_  
| \\/\\__/__) 
  /         
${_.t("apps.terminal.output.lastLogin",{time:t})}
${_.t("apps.terminal.output.typeHelpForCommands")}

`,path:"welcome-message"}])},[]);const Be=()=>{if(at.current){ne.current=!0;const{scrollTop:t,scrollHeight:f,clientHeight:k}=at.current,M=f-t-k<10;ee.current&&!M&&te(!1),M&&(te(!0),ee.current=!0)}},Wt=b.useCallback(()=>{at.current&&(at.current.scrollTop=at.current.scrollHeight)},[]);b.useEffect(()=>{if(at.current){if(!ne.current){Wt();return}Qt&&Wt(),Tt.current=v.length}},[v,Qt,Wt]),b.useEffect(()=>{dt.current&&e&&!Xt&&dt.current.focus()},[e,v,Xt]),b.useEffect(()=>{Y.getState().setCurrentPath(J)},[J]),b.useEffect(()=>{if(mt){const t=setInterval(()=>{$e(f=>(f+1)%bt.length)},100);return()=>clearInterval(t)}},[mt,bt.length]);const[_t,it]=b.useState(!1),Ue=t=>{if(t.preventDefault(),!T.trim())return;if(Ct){me(T);return}if(V){Ke(T);return}const f=[...G,T];R(f),z(-1),Y.getState().addCommand(T),Ge(T).then(k=>{k.isError?ae():Ht(),vt(new Set),F([...v,{command:T,output:k.output,path:J,isSystemMessage:k.isSystemMessage??k.isError}])}),D("")},ue=t=>{var f,k,M,h,S,$,I;if(Ct){if(tt==="insert"){if(t.key==="Escape"){t.preventDefault(),et("normal");return}if(t.key==="Backspace"){if(t.preventDefault(),!j)return;const o=j.content.split(`
`);if(P===0&&x>0){const l=o[x-1],u=o[x],A=l.length;o[x-1]=l+u,o.splice(x,1),K({...j,content:o.join(`
`)}),U(C=>C-1),N(A);const m=Math.floor(20*.4);x-1-W<m&&W>0&&B(C=>Math.max(C-1,0));return}if(P>0){const l=o[x]||"",u=l.substring(0,P-1)+l.substring(P);o[x]=u,K({...j,content:o.join(`
`)}),N(A=>Math.max(0,A-1))}return}if(t.key==="Enter"){if(t.preventDefault(),!j)return;const o=j.content.split(`
`),l=o[x]||"",u=l.substring(0,P),A=l.substring(P);o[x]=u,o.splice(x+1,0,A),K({...j,content:o.join(`
`)}),U(H=>H+1),N(0);const O=20,m=Math.floor(O*.6),C=Math.max(0,o.length-O);x+1-W>m&&W<C&&B(H=>Math.min(H+1,C));return}if(t.key==="Tab"){if(t.preventDefault(),!j)return;const o=j.content.split(`
`),l=o[x]||"",u=l.substring(0,P)+"  "+l.substring(P);o[x]=u,K({...j,content:o.join(`
`)}),N(A=>A+2);return}if(t.key==="Delete"){if(t.preventDefault(),!j)return;const o=j.content.split(`
`),l=o[x]||"";if(P===l.length&&x<o.length-1){const u=o[x+1];o[x]=l+u,o.splice(x+1,1),K({...j,content:o.join(`
`)});return}if(P<l.length){const u=l.substring(0,P)+l.substring(P+1);o[x]=u,K({...j,content:o.join(`
`)})}return}if(t.key==="Home"){t.preventDefault(),N(0);return}if(t.key==="End"){if(t.preventDefault(),!j)return;const l=j.content.split(`
`)[x]||"";N(l.length);return}if(t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight"){if(t.preventDefault(),!j)return;const o=j.content.split(`
`);if(t.key==="ArrowDown"&&x<o.length-1){const l=x+1;U(l);const u=o[l].length;u<P&&N(Math.max(0,u));const A=20,O=Math.floor(A*.6),m=Math.max(0,o.length-A);l-W>O&&W<m&&B(C=>Math.min(C+1,m))}else if(t.key==="ArrowUp"&&x>0){const l=x-1;U(l);const u=o[l].length;u<P&&N(Math.max(0,u));const O=Math.floor(20*.4);l-W<O&&W>0&&B(m=>Math.max(m-1,0))}else if(t.key==="ArrowLeft"&&P>0)N(l=>l-1);else if(t.key==="ArrowRight"){const l=((f=o[x])==null?void 0:f.length)||0;P<l&&N(u=>u+1)}return}return}if(t.key==="j"||t.key==="k"||t.key==="ArrowUp"||t.key==="ArrowDown"||t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="h"||t.key==="l"||t.key==="0"||t.key==="$"||t.key==="w"||t.key==="b"||t.key==="g"||t.key==="G"||t.key==="a"||t.key==="o"||t.key==="O"||t.key==="d"||t.key==="y"||t.key==="p"||t.key==="d"&&t.ctrlKey||t.key==="u"&&t.ctrlKey){if(t.preventDefault(),!j)return;const o=j.content.split(`
`),l=20,u=Math.max(0,o.length-l),A=Math.floor(l*.4),O=Math.floor(l*.6);if((t.key==="j"||t.key==="ArrowDown")&&x<o.length-1){const m=x+1;U(m);const C=o[m].length;C<P&&N(Math.max(0,C)),m-W>O&&W<u&&B(H=>Math.min(H+1,u))}else if((t.key==="k"||t.key==="ArrowUp")&&x>0){const m=x-1;U(m);const C=o[m].length;C<P&&N(Math.max(0,C)),m-W<A&&W>0&&B(H=>Math.max(H-1,0))}else if((t.key==="ArrowLeft"||t.key==="h")&&P>0)N(m=>m-1);else if(t.key==="ArrowRight"||t.key==="l"){const m=((k=o[x])==null?void 0:k.length)||0;P<m&&N(C=>C+1)}else if(t.key==="0")N(0);else if(t.key==="$"){const m=((M=o[x])==null?void 0:M.length)||0;N(Math.max(0,m))}else if(t.key==="w"){const m=o[x]||"",C=/\b\w/g;C.lastIndex=P+1;const H=C.exec(m);H?N(H.index):x<o.length-1&&(U(q=>q+1),N(0),x+1-W>O&&W<u&&B(q=>Math.min(q+1,u)))}else if(t.key==="b"){const m=o[x]||"";if(P===0&&x>0){U(q=>q-1);const H=((h=o[x-1])==null?void 0:h.length)||0;N(H),x-1-W<A&&W>0&&B(q=>Math.max(q-1,0));return}let C=P-1;for(;C>0;){if(/\w/.test(m[C])&&(C===0||/\W/.test(m[C-1]))){N(C);return}C--}N(0)}else if(t.key==="g"){const m=Date.now(),C=Pt.current;Pt.current=m,m-C<500&&(U(0),N(0),B(0),Pt.current=0)}else if(t.key==="G"){const m=Math.max(0,o.length-1);U(m),N(0),B(Math.max(0,o.length-l))}else if(t.key==="d"&&t.ctrlKey){const m=Math.floor(l/2),C=Math.min(W+m,u);B(C);const H=Math.min(x+m,o.length-1);U(H);const q=((S=o[H])==null?void 0:S.length)||0;P>q&&N(Math.max(0,q))}else if(t.key==="u"&&t.ctrlKey){const m=Math.floor(l/2),C=Math.max(W-m,0);B(C);const H=Math.max(x-m,0);U(H);const q=(($=o[H])==null?void 0:$.length)||0;P>q&&N(Math.max(0,q))}else if(t.key==="a"){et("insert");const m=((I=o[x])==null?void 0:I.length)||0;P<m&&N(C=>C+1)}else if(t.key==="o"){const m=[...o];m.splice(x+1,0,""),K({...j,content:m.join(`
`)}),U(C=>C+1),N(0),et("insert"),x+1-W>O&&W<u&&B(C=>Math.min(C+1,u))}else if(t.key==="O"){const m=[...o];m.splice(x,0,""),K({...j,content:m.join(`
`)}),N(0),et("insert")}else if(t.key==="d"){const m=Date.now(),C=ot.current;if(ot.current={key:"d",time:m},C.key==="d"&&m-C.time<500){if(o.length>1){Lt(o[x]);const H=[...o];H.splice(x,1),K({...j,content:H.join(`
`)}),x>=H.length&&U(Math.max(0,H.length-1)),N(0)}else Lt(o[0]),K({...j,content:[""].join(`
`)}),N(0);ot.current={key:"",time:0}}}else if(t.key==="y"){const m=Date.now(),C=ot.current;ot.current={key:"y",time:m},C.key==="y"&&m-C.time<500&&(Lt(o[x]),ot.current={key:"",time:0})}else if(t.key==="p"&&Jt){const m=[...o];m.splice(x+1,0,Jt),K({...j,content:m.join(`
`)}),U(C=>C+1),N(0),x+1-W>O&&W<u&&B(C=>Math.min(C+1,u))}return}else if(t.key==="i"){t.preventDefault(),et("insert");return}else if(t.key===":"){t.preventDefault(),et("command"),D("");return}else if(t.key==="Escape"&&tt==="command"){et("normal"),D("");return}else if(t.key==="Enter"&&tt==="command"){t.preventDefault();const o=":"+T;me(o);return}}if(t.key==="ArrowUp"){if(t.preventDefault(),G.length>0){const o=Z<G.length-1?Z+1:Z;z(o);const l=G[G.length-1-o]||"",u=Y.getState().commandHistory,A=u[u.length-1-o];!V&&A&&A.command.startsWith("ryo ")&&!l.startsWith("ryo ")?D("ryo "+l):D(l)}}else if(t.key==="ArrowDown")if(t.preventDefault(),Z>0){const o=Z-1;z(o);const l=G[G.length-1-o]||"",u=Y.getState().commandHistory,A=u[u.length-1-o];!V&&A&&A.command.startsWith("ryo ")&&!l.startsWith("ryo ")?D("ryo "+l):D(l)}else Z===0&&(z(-1),D(""));else if(t.key==="Tab"){t.preventDefault();const o=ze(T);D(o)}},ze=t=>{if(t.endsWith(" "))return t;const{cmd:f,args:k}=ve(t);if(t.includes(" ")){if(["cd","cat","rm","edit","vim"].includes(f)){const M=k.length>0?k[k.length-1]:"",h=ht.filter(S=>S.name.toLowerCase().startsWith(M.toLowerCase())).map(S=>S.name);if(h.length===1){const S=h[0],$=S.includes(" "),I=t.split(" ");return I.pop(),$&&!M.startsWith('"')&&!M.startsWith("'")?I.push(`"${S}"`):I.push(S),I.join(" ")}else if(h.length>1)return F([...v,{command:t,output:h.join("  "),path:J}]),t}}else{const M=is.filter(h=>h.startsWith(f));if(M.length===1)return M[0];if(M.length>1)return F([...v,{command:t,output:M.join("  "),path:J}]),t}return t},Ge=async t=>{const{cmd:f,args:k}=ve(t),M={currentPath:J,files:ht,navigateToPath:Oe,saveFile:ft,moveToTrash:He,playCommandSound:Ht,playErrorSound:ae,playMooSound:Ve,launchApp:Ot,setIsAboutDialogOpen:E,username:ce};if(Gt[f]){const h=await Gt[f].handler(k,M);return f==="clear"&&(it(!0),V&&Ft(),setTimeout(()=>{it(!1),F([]),pt.current=null},500)),h}switch(f){case"cat":{if(k.length===0)return{output:"usage: cat <filename>",isError:!0};const h=k[0],S=ht.find(o=>o.name===h);if(!S)return{output:`file not found: ${h}`,isError:!0};if(S.isDirectory)return{output:`${h} is a directory, not a file`,isError:!0};const $=`Loading ${h}...`;class I{async readContent(){try{this.isRealFile()?await this.loadRealFileContent():this.handleVirtualFile()}catch(l){this.handleError(l)}}isRealFile(){return S&&(S.path.startsWith("/Documents/")||S.path.startsWith("/Images/"))}async loadRealFileContent(){if(!S)return;const u=St.getState().getItem(S.path);if(!u||!u.uuid){this.updateOutput(`${h}: file metadata not found`);return}const A=S.path.startsWith("/Documents/")?nt.DOCUMENTS:nt.IMAGES,O=await ct.get(A,u.uuid);if(O&&O.content){let m="";O.content instanceof Blob?m=await O.content.text():typeof O.content=="string"&&(m=O.content),this.updateOutput(m||`${h} is empty`)}else this.updateOutput(`${h} is empty or could not be read`)}handleVirtualFile(){this.updateOutput(`${h} content not available (virtual file)`)}updateOutput(l){F(u=>{const A=u[u.length-1];return A.output===$?[...u.slice(0,-1),{...A,output:l}]:u})}handleError(l){const u=l;console.error("Error reading file content:",u),this.updateOutput(`Error reading file: ${u.message||"Unknown error"}`)}}return setTimeout(()=>{new I().readContent()},100),{output:$,isError:!1}}case"edit":{if(k.length===0)return{output:"usage: edit <filename>",isError:!0};const h=k[0],S=ht.find($=>$.name===h);if(!S)return{output:`file not found: ${h}`,isError:!0};if(S.isDirectory)return{output:`${h} is a directory, not a file`,isError:!0};if(S.path.startsWith("/Documents/"))Ot("textedit",{initialData:{path:S.path,content:""}});else{const $=S.name,I=`/Documents/${$}`;setTimeout(async()=>{try{if(S&&S.path.startsWith("/Images/")){const l=St.getState().getItem(S.path);if(l&&l.uuid){const u=await ct.get(nt.IMAGES,l.uuid);let A="";u&&u.content&&(u.content instanceof Blob?A=await u.content.text():typeof u.content=="string"&&(A=u.content)),await ft({name:$,path:I,content:A||"",type:"text",icon:"/icons/file-text.png"})}else await ft({name:$,path:I,content:"",type:"text",icon:"/icons/file-text.png"})}else await ft({name:$,path:I,content:"",type:"text",icon:"/icons/file-text.png"});Ot("textedit",{initialData:{path:I,content:""}})}catch(o){console.error("Error preparing file for editing:",o)}},100)}return{output:`opening ${h} in textedit...`,isError:!1}}case"history":{const h=Y.getState().commandHistory;if(h.length===0)return{output:"no command history",isError:!1};const S=h.length.toString().length,$=Math.min(25,Math.max(...h.map(I=>I.command.length)));return{output:h.map((I,o)=>{const l=new Date(I.timestamp),u=(o+1).toString().padStart(S," "),O=(I.command.length>25?I.command.substring(0,22)+"...":I.command).padEnd($," "),m=`${(l.getMonth()+1).toString().padStart(2,"0")}/${l.getDate().toString().padStart(2,"0")} ${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return`${u}  ${O}  # ${m}`}).join(`
`),isError:!1}}case"su":{if(k.length===0)return{output:"usage: su <username> [password]",isError:!0};const h=k[0].trim(),S=k[1]?k[1].trim():void 0,$=`switching to ${h}...`;class I{async perform(){try{const l=lt.getState();if(l.username===h){this.updateOutput(`already user ${h}`);return}if(l.username&&l.username!==h&&await l.logout(),S){const A=await fetch("/api/chat-rooms?action=authenticateWithPassword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:h,password:S})});if(A.ok){const O=await A.json();if(O.token){const m=O.username||h;l.setUsername(m),l.setAuthToken(O.token),this.updateOutput(`logged in as ${m}`);return}}}if(!S){this.updateOutput("su failed: password required for new user creation");return}const u=await l.createUser(h,S);u.ok?this.updateOutput(`created and logged in as ${h}`):this.updateOutput(`su failed: ${u.error||"unknown error"}`)}catch(l){const u=l instanceof Error?l.message:"unknown error";this.updateOutput(`su failed: ${u}`)}}updateOutput(l){F(u=>{const A=u[u.length-1];return A.output===$?[...u.slice(0,-1),{...A,output:l}]:u})}}return setTimeout(()=>{new I().perform()},50),{output:$,isError:!1}}case"logout":{if(!ce)return{output:"not logged in",isError:!0};const h="logging out...";class S{async perform(){try{await lt.getState().logout(),this.updateOutput("logged out")}catch(I){const o=I instanceof Error?I.message:"unknown error";this.updateOutput(`logout failed: ${o}`)}}updateOutput(I){F(o=>{const l=o[o.length-1];return l.output===h?[...o.slice(0,-1),{...l,output:I}]:o})}}return setTimeout(()=>{new S().perform()},50),{output:h,isError:!1}}default:return{output:_.t("apps.terminal.output.commandNotFound",{cmd:f}),isError:!0}}},Rt=b.useCallback(t=>t,[]);b.useEffect(()=>{V||$t.current.clear()},[V]),b.useEffect(()=>{V&&Nt&&(Dt({text:Nt},{body:{systemState:Me()}}),qt(void 0))},[V,Nt,Dt,qt]);const pe=b.useCallback(()=>{re()},[re]);b.useEffect(()=>{if(!V||st.length<=1)return;const t=st[st.length-1];if(t.role!=="assistant")return;const f=`${t.id}-${JSON.stringify(t.parts??t.text)}`;if(f===pt.current)return;const k=t.parts,M=[];let h=!1;const S=[];k&&k.length>0?k.forEach(I=>{const o=I.type;if(o==="text"){const l=Rt(I.text);l&&M.push(l)}else if(o.startsWith("tool-")){const l=o.slice(5),u=I;l==="aquarium"?h=!0:S.push({toolName:l,state:u.state,input:u.input,output:u.output})}}):M.push(Rt(t.text||""));const $=M.join(`
`);_t||(F(I=>{const o=I.filter(u=>u.path!=="ai-thinking"),l=o.findIndex(u=>u.path==="ai-assistant"&&u.messageId===t.id);if(l!==-1){const u=o[l];if(u.output===$&&u.hasAquarium===h&&JSON.stringify(u.toolInvocations)===JSON.stringify(S))return I;const A=[...o];return A[l]={command:"",output:$,path:"ai-assistant",messageId:t.id,hasAquarium:h,toolInvocations:S.length>0?S:void 0},A}return pe(),[...o,{command:"",output:$,path:"ai-assistant",messageId:t.id,hasAquarium:h,toolInvocations:S.length>0?S:void 0}]}),pt.current=f)},[st,V,_t,Rt,pe]);const Ke=t=>{const f=t.trim().toLowerCase();Ht();const k=[...G,t];if(R(k),z(-1),Y.getState().addCommand(t.startsWith("ryo ")?t:`ryo ${t}`),vt(new Set),f==="exit"||f==="quit"){yt(wt.CHAT_EXIT),ut(!1),Ft(),se([]),pt.current=null,$t.current.clear(),F([...v,{command:t,output:"Bye! ♥",path:J}]),D("");return}if(f==="clear"){yt(wt.CHAT_CLEAR),Ft(),se([]),it(!0),vt(new Set),pt.current=null,$t.current.clear(),setTimeout(()=>{it(!1),F([{command:"",output:_.t("apps.terminal.output.chatCleared"),path:"ai-assistant"}])},300),D("");return}yt(wt.AI_COMMAND,{prompt:t});const M=v.filter(h=>h.path!=="ai-thinking");F([...M,{command:t,output:"",path:"ai-user"}]),Dt({text:t},{body:{systemState:Me()}}),D("")},me=t=>{if(t.startsWith(":"))if(t===":q"||t===":q!"||t===":wq"){const f=t===":wq"?`"${j==null?void 0:j.name}" written`:"";F([...v,{command:t,output:f,path:J}]),t===":wq"&&j&&qe(j),Pe(!1),K(null),B(0),et("normal")}else F([...v,{command:t,output:`unsupported vim command: ${t}`,path:J}]);else if(t==="j"||t==="k"){if(!j)return;const f=j.content.split(`
`),M=Math.max(0,f.length-20);t==="j"&&W<M?B(h=>h+1):t==="k"&&W>0&&B(h=>h-1)}D("")},qe=async t=>{try{const f=ht.find(k=>k.name===t.name);if(!f){console.error(`Could not find file ${t.name} for saving`);return}await ft({path:f.path,name:t.name,content:t.content,type:"text"}),console.log(`Saved vim file ${t.name} to ${f.path}`)}catch(f){const k=f;console.error(`Error saving vim file: ${k.message||"Unknown error"}`),F(M=>[...M,{command:"",output:`Error saving file: ${k.message||"Unknown error"}`,path:J}])}},Je=t=>{if(!Ct||!j||tt!=="insert")return;const k=t.target.value.slice(-1),M=j.content.split(`
`),h=M[x]||"",S=h.substring(0,P)+k+h.substring(P);M[x]=S,K({...j,content:M.join(`
`)}),N($=>$+1),D("")},Ze=()=>{L<24&&Q(t=>t+2)},Xe=()=>{L>10&&Q(t=>t-2)},[Ye,de]=b.useState(!1),Qe=()=>{Q(12),de(!0),setTimeout(()=>de(!1),300)},tn={initial:{opacity:0,y:10,filter:"blur(2px)"},animate:{opacity:1,y:0,filter:"blur(0px)",transition:{type:"spring",stiffness:100,damping:25,mass:.8}},exit:{opacity:0,transition:{duration:.2}}},[en,vt]=b.useState(new Set);b.useEffect(()=>{if(v.length===0)return;const t=v.length-1,f=v[t];Tt.current!==v.length&&(Tt.current=v.length,vt(k=>{if(k.has(t))return k;const M=new Set(k);return!f.path.startsWith("ai-")&&f.output&&f.output.length>0&&f.output.length<150&&!f.output.startsWith("command not found")&&!f.output.includes("commands")&&!f.output.includes("     __  __")&&!f.output.includes("ask ryo anything.")&&!(f.command&&f.command.trim().startsWith("ls"))&&M.add(t),M}))},[v]);const he=t=>{De(t)};b.useEffect(()=>{if(!document.getElementById("breathing-animation")){const t=document.createElement("style");t.id="breathing-animation",t.innerHTML=`
        @keyframes breathing {
          0%, 100% { opacity: 0.3; }
          50% { opacity: 0.6; }
        }
        
        .shimmer-subtle {
          animation: shimmer-text 2.5s ease-in-out infinite;
        }
        
        @keyframes shimmer-text {
          0% { opacity: 0.5; }
          50% { opacity: 0.8; }
          100% { opacity: 0.5; }
        }

        @keyframes gradient-spin {
          0% { color: #FFB3BA; }  /* Pastel Pink */
          20% { color: #BAFFC9; } /* Pastel Green */
          40% { color: #BAE1FF; } /* Pastel Blue */
          60% { color: #FFFFBA; } /* Pastel Yellow */
          80% { color: #FFE4BA; } /* Pastel Orange */
          100% { color: #FFB3BA; } /* Back to Pastel Pink */
        }

        .gradient-spin {
          animation: gradient-spin 4s ease-in-out infinite;
          text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }
      `,document.head.appendChild(t)}return()=>{const t=document.getElementById("breathing-animation");t&&t.remove()}},[]);const Vt=t=>t==="ai-assistant"||t==="ai-user",nn=()=>Ct&&j?a.jsxs("div",{className:"mb-4",children:[a.jsx(cs,{file:j,position:W,vimCursorLine:x,vimCursorColumn:P,vimMode:tt}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("span",{className:"text-green-400 mr-1 flex-shrink-0",style:{fontSize:`${L}px`,lineHeight:`${Math.round(L*1.5)}px`,height:`${Math.round(L*1.5)}px`,fontFamily:"inherit"},children:tt==="normal"||tt==="insert"?"":":"}),a.jsx("input",{ref:dt,type:"text",value:T,onChange:tt==="insert"?Je:t=>D(t.target.value),onKeyDown:ue,onFocus:()=>kt(!0),onBlur:()=>kt(!1),className:`flex-1 bg-transparent text-white font-monaco focus:outline-none terminal-input ${Yt?"input--focused":""}`,style:{fontSize:`${L}px`,lineHeight:`${Math.round(L*1.5)}px`,height:`${Math.round(L*1.5)}px`,fontFamily:"inherit"},autoFocus:!0})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(Wn,{children:v.map((t,f)=>a.jsxs(zt.div,{className:"mb-1 select-text cursor-text",variants:tn,initial:"initial",animate:_t?{opacity:0,y:-100,filter:"blur(4px)",transition:{duration:.3,delay:.02*(v.length-f)}}:"animate",exit:"exit",children:[t.command&&a.jsxs("div",{className:"flex select-text",children:[t.path==="ai-user"?a.jsxs("span",{className:"text-purple-400 mr-2 select-text cursor-text",children:[a.jsx("span",{className:"inline-block w-2 text-center",children:"→"})," ","ryo"]}):a.jsxs("span",{className:"text-green-400 mr-2 select-text cursor-text",children:[a.jsx("span",{className:"inline-block w-2 text-center",children:"→"})," ",t.path==="/"?"/":t.path]}),a.jsx("span",{className:"select-text cursor-text",children:t.command})]}),(t.output||t.toolInvocations&&t.toolInvocations.length>0)&&a.jsx("div",{className:`ml-0 select-text ${t.path==="ai-thinking"?"text-gray-400":""} ${t.path==="ai-assistant"?"text-purple-100":""} ${t.path==="ai-error"?"text-red-400":""} ${t.path==="welcome-message"?"text-gray-400":""} ${t.output&&rt(t.output)?"text-red-400":""} ${t.isSystemMessage?"text-gray-400":""}`,children:t.path==="ai-thinking"?a.jsxs("div",{children:[a.jsxs("span",{className:"gradient-spin",children:[a.jsx("span",{className:"inline-block w-2 text-center",children:(t.output||"").split(" ")[0]})," ","ryo"]}),a.jsxs("span",{className:"text-gray-500 italic shimmer-subtle",children:[" ",_.t("apps.terminal.output.isThinking"),a.jsx(Ie,{})]})]}):t.path==="ai-assistant"?a.jsx("div",{className:"select-text cursor-text",children:(()=>{const{htmlContent:k,textContent:M,hasHtml:h}=Ln(t.output||""),S=rt(t.output||""),$=S?Mt(M||""):M,I=mt&&st.length>0&&st[st.length-1].id===t.messageId&&f===v.length-1;return a.jsxs(a.Fragment,{children:[t.toolInvocations&&t.toolInvocations.length>0&&a.jsx("div",{className:"space-y-0.5 mb-1",children:t.toolInvocations.map((o,l)=>a.jsx(ls,{invocation:o,fontSize:L},`${t.messageId}-tool-${l}`))}),$&&$.split(`
`).map((l,u)=>{const A=l.trimStart(),O=A.startsWith(":::"),m=A.startsWith("→"),C=O?l.replace(":::",bt[Zt]):l,H=S?"text-red-300":O?"gradient-spin italic":m?"text-gray-400":"text-purple-300";return a.jsxs("span",{className:`select-text cursor-text ${H}`,children:[u>0&&a.jsx("br",{}),u===0&&S&&a.jsx(Ut,{}),Et(C)]},u)}),h&&k&&a.jsx(Ee,{htmlContent:k,onInteractionChange:he,isStreaming:I,playElevatorMusic:oe,stopElevatorMusic:ie,playDingSound:le}),t.hasAquarium&&a.jsx("div",{className:"mt-1",children:a.jsx(En,{})})]})})()}):en.has(f)?a.jsxs(a.Fragment,{children:[rt(t.output)&&a.jsx(Ut,{}),a.jsx(us,{text:rt(t.output)?Mt(t.output):t.output,speed:10,className:"",renderMarkdown:Vt(t.path)})]}):a.jsxs(a.Fragment,{children:[rt(t.output)&&a.jsx(Ut,{}),rt(t.output)?Vt(t.path)?Et(Mt(t.output)):Mt(t.output):Vt(t.path)?Et(t.output):t.output,ke(t.output).isHtml&&a.jsx(Ee,{htmlContent:ke(t.output).content,onInteractionChange:he,isStreaming:!1,playElevatorMusic:oe,stopElevatorMusic:ie,playDingSound:le})]})})]},f))}),a.jsx("div",{className:"relative select-text",children:a.jsxs("form",{onSubmit:Ue,className:"flex items-center transition-all duration-200 select-text",children:[V?a.jsx("span",{className:"text-purple-400 mr-2 whitespace-nowrap select-text cursor-text flex-shrink-0",style:{fontSize:`${L}px`,lineHeight:`${Math.round(L*1.5)}px`,height:`${Math.round(L*1.5)}px`,fontFamily:"inherit"},children:mt?a.jsx("span",{children:a.jsxs("span",{className:"gradient-spin",children:[a.jsx("span",{className:"inline-block w-2 text-center",children:bt[Zt]})," ","ryo"]})}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"inline-block w-2 text-center",children:"→"})," ryo"]})}):a.jsxs("span",{className:"text-green-400 mr-2 whitespace-nowrap select-text cursor-text flex-shrink-0",style:{fontSize:`${L}px`,lineHeight:`${Math.round(L*1.5)}px`,height:`${Math.round(L*1.5)}px`,fontFamily:"inherit"},children:[a.jsx("span",{className:"inline-block w-2 text-center",children:"→"})," ",J==="/"?"/":J]}),a.jsxs("div",{className:"flex-1 relative min-w-0",children:[a.jsx("input",{ref:dt,type:"text",value:T,onChange:t=>D(t.target.value),onKeyDown:ue,onFocus:()=>kt(!0),onBlur:()=>kt(!1),onTouchStart:t=>{t.preventDefault()},className:`w-full text-white font-monaco focus:outline-none bg-transparent terminal-input ${Yt?"input--focused":""}`,style:{fontSize:`${L}px`,lineHeight:`${Math.round(L*1.5)}px`,height:`${Math.round(L*1.5)}px`,fontFamily:"inherit"},autoFocus:!0}),mt&&V&&a.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none flex items-center",children:a.jsxs("span",{className:"text-gray-400/40 opacity-30 shimmer",children:[_.t("apps.terminal.output.isThinking"),a.jsx(Ie,{})]})})]})]})})]}),fe=Le(t=>t.current),ge=fe==="xp"||fe==="win98",xe=a.jsx(_n,{onClose:n,onShowHelp:()=>w(!0),onShowAbout:()=>E(!0),onClear:()=>{it(!0),setTimeout(()=>{it(!1),F([])},500)},onIncreaseFontSize:Ze,onDecreaseFontSize:Xe,onResetFontSize:Qe,onToggleMute:_e,isMuted:Re});return s?a.jsxs(a.Fragment,{children:[!ge&&e&&xe,a.jsx(xn,{appId:"terminal",title:Te("terminal"),onClose:n,isForeground:e,transparentBackground:!0,skipInitialSound:p,instanceId:c,onNavigateNext:r,onNavigatePrevious:i,menuBar:ge?xe:void 0,children:a.jsx(zt.div,{className:"terminal-content flex flex-col h-full w-full bg-black/80 backdrop-blur-lg text-white antialiased font-monaco overflow-hidden select-text",style:{"--terminal-font-size":`${L}px`,fontSize:`${L}px`,fontFamily:'"Monaco", "ArkPixel", "SerenityOS-Emoji", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", "Courier New", monospace'},animate:Ye?{filter:["brightness(1)","brightness(1.5)","brightness(1)"],scale:[1,1.01,1]}:{},transition:{duration:.3,ease:"easeOut"},children:a.jsx("div",{ref:at,className:"flex-1 overflow-auto whitespace-pre-wrap select-text cursor-text p-2",onClick:t=>{var f,k;((f=window.getSelection())==null?void 0:f.toString())===""&&(t.stopPropagation(),(k=dt.current)==null||k.focus(),e||We("terminal"))},onScroll:Be,children:nn()})})}),a.jsx(yn,{isOpen:g,onOpenChange:w,appId:"terminal",helpItems:d}),a.jsx(wn,{isOpen:y,onOpenChange:E,metadata:Sn||{name:"Terminal",version:"1.0",creator:{name:"Ryo Lu",url:"https://ryo.lu"},github:"https://github.com/ryokun6/ryos",icon:"/icons/default/terminal.png"},appId:"terminal"})]}):null}export{Ns as TerminalAppComponent};
