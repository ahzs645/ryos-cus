import{r as f,j as t}from"./ui-core-D0pDhx0h.js";import{u as te,a as ne,M as pe,b as J,d as Q,e as V,f as B,g as Y,S as ce,l as me,m as de,E as ue,n as G,o as F,Z as fe,aD as xe,B as he,H as ge,J as be,b2 as we,G as Me,b3 as ve,b4 as ee}from"./index-CdY3Xrkk.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./motion-DC7C-474.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";function je({onClose:r,onShowHelp:c,onShowAbout:d,onNewGame:b}){var i;const{t:o}=te(),[y,w]=f.useState(!1),x="minesweeper",M=(i=de[x])==null?void 0:i.name,j=ne(C=>C.current),m=j==="xp"||j==="win98";return t.jsxs(pe,{inWindowFrame:m,children:[t.jsxs(J,{children:[t.jsx(Q,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:o("common.menu.file")}),t.jsxs(V,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(B,{onClick:b,className:"text-md h-6 px-3",children:o("apps.minesweeper.menu.newGame")}),t.jsx(Y,{className:"h-[2px] bg-black my-1"}),t.jsx(B,{onClick:r,className:"text-md h-6 px-3",children:o("common.menu.close")})]})]}),t.jsxs(J,{children:[t.jsx(Q,{className:"px-2 py-1 text-md focus-visible:ring-0",children:o("common.menu.help")}),t.jsxs(V,{align:"start",sideOffset:1,className:"px-0",children:[t.jsx(B,{onClick:c,className:"text-md h-6 px-3",children:o("apps.minesweeper.menu.minesweeperHelp")}),t.jsx(B,{onSelect:()=>w(!0),className:"text-md h-6 px-3",children:o("common.menu.shareApp")}),t.jsx(Y,{className:"h-[2px] bg-black my-1"}),t.jsx(B,{onClick:d,className:"text-md h-6 px-3",children:o("apps.minesweeper.menu.aboutMinesweeper")})]})]}),t.jsx(ce,{isOpen:y,onClose:()=>w(!1),itemType:"App",itemIdentifier:x,title:M,generateShareUrl:me})]})}const p=9,H=10;function ye(r,c,{shouldPreventDefault:d=!1,delay:b=500}={}){const[o,y]=f.useState(),w=f.useRef(!1),x=f.useRef(null),M=f.useRef(!1),j=f.useCallback(i=>{if(d&&i.target&&i.preventDefault(),w.current=!1,"touches"in i)M.current=!0,x.current=null;else{const N=i;M.current=!1,x.current=typeof N.button=="number"?N.button:0}const C=setTimeout(()=>{r(i),w.current=!0},b);y(C)},[r,b,d]),m=f.useCallback((i,C=!0)=>{o&&clearTimeout(o),y(void 0);const N=x.current===2;C&&!w.current&&(M.current||!N)&&c(),setTimeout(()=>{w.current=!1,x.current=null,M.current=!1},100)},[c,o]);return{onMouseDown:i=>j(i),onTouchStart:i=>j(i),onMouseUp:i=>m(i),onMouseLeave:i=>m(i,!1),onTouchEnd:i=>m(i)}}function Ce({cell:r,rowIndex:c,colIndex:d,onCellClick:b,onCellRightClick:o,disabled:y}){const x=ye(m=>o(m,c,d),()=>{ee()&&r.isRevealed&&r.neighborMines>0?b(c,d,!0):b(c,d,!1)},{delay:500,shouldPreventDefault:!1}),M=m=>{m.preventDefault(),!ee()&&r.isRevealed&&r.neighborMines>0&&b(c,d,!0)},j=m=>{m.preventDefault(),o(m,c,d)};return t.jsx("button",{className:`w-7 h-7 flex items-center justify-center text-sm font-bold rounded-none select-none touch-none minesweeper-cell
        ${r.isRevealed?"minesweeper-revealed":"minesweeper-hidden"}`,...x,onContextMenu:j,onDoubleClick:M,disabled:y,children:r.isRevealed?r.isMine?"ðŸ’£":r.neighborMines>0?t.jsx("span",{className:`text-${Ne(r.neighborMines)} text-lg`,children:r.neighborMines}):null:r.isFlagged?"ðŸš©":null},`${c}-${d}`)}function $e({isWindowOpen:r,onClose:c,isForeground:d,skipInitialSound:b,instanceId:o,onNavigateNext:y,onNavigatePrevious:w}){const{t:x}=te(),M=ue("minesweeper",ve||[]),[j,m]=f.useState(!1),[i,C]=f.useState(!1),[N,S]=f.useState(!1),[O,T]=f.useState(()=>U()),[D,I]=f.useState(!1),[A,W]=f.useState(!1),[se,_]=f.useState(H),{play:L}=G(F.CLICK,.3),{play:K}=G(F.ALERT_BONK,.3),{play:ae}=G(F.ALERT_INDIGO,.3),{play:ie}=G(F.BUTTON_CLICK,.3),re=`
    .minesweeper-cell {
      font-size: 11px !important;
      box-sizing: border-box !important;
      border: none !important;
      background: #c0c0c0 !important;
      border-radius: 0 !important;
      box-shadow: none !important;
    }
    .minesweeper-hidden {
      border: none !important;
      /* 98.css raised look */
      box-shadow: inset -1px -1px #0a0a0a, inset 1px 1px #ffffff,
        inset -2px -2px grey, inset 2px 2px #dfdfdf !important;
    }
    .minesweeper-hidden:hover {
      background-color: #d0d0d0 !important;
    }
    .minesweeper-hidden:active {
      /* pressed look */
      box-shadow: inset -1px -1px #ffffff, inset 1px 1px #0a0a0a,
        inset -2px -2px #dfdfdf, inset 2px 2px grey !important;
    }
    .minesweeper-cell:focus {
      outline: 1px dotted #000 !important;
      outline-offset: -4px !important;
    }
    .minesweeper-revealed {
      background: #d1d1d1 !important;
      border-top: 1px solid #808080 !important;
      border-left: 1px solid #808080 !important;
      border-right: 1px solid #f0f0f0 !important;
      border-bottom: 1px solid #f0f0f0 !important;
    }
  `;function U(){const n=Array(p).fill(null).map(()=>Array(p).fill(null).map(()=>({isMine:!1,isRevealed:!1,isFlagged:!1,neighborMines:0})));let s=0;for(;s<H;){const a=Math.floor(Math.random()*p),e=Math.floor(Math.random()*p);n[a][e].isMine||(n[a][e].isMine=!0,s++)}for(let a=0;a<p;a++)for(let e=0;e<p;e++)if(!n[a][e].isMine){let l=0;for(let v=-1;v<=1;v++)for(let h=-1;h<=1;h++){const g=a+v,u=e+h;g>=0&&g<p&&u>=0&&u<p&&n[g][u].isMine&&l++}n[a][e].neighborMines=l}return n}function oe(n,s,a=!1){if(D||A||O[n][s].isFlagged)return;const e=[...O.map(l=>[...l])];if(a&&e[n][s].isRevealed&&e[n][s].neighborMines>0){let l=0;for(let v=-1;v<=1;v++)for(let h=-1;h<=1;h++){const g=n+v,u=s+h;g>=0&&g<p&&u>=0&&u<p&&e[g][u].isFlagged&&l++}if(l===e[n][s].neighborMines){L();let v=!1;for(let h=-1;h<=1;h++)for(let g=-1;g<=1;g++){const u=n+h,k=s+g;u>=0&&u<p&&k>=0&&k<p&&!e[u][k].isFlagged&&!e[u][k].isRevealed&&(e[u][k].isMine&&(v=!0),$(e,u,k))}if(v){K(),z(e),I(!0);return}}T(e),P(e);return}if(e[n][s].isMine){K(),z(e),I(!0);return}L(),$(e,n,s),T(e),P(e)}function le(n,s,a){if((n instanceof MouseEvent||"button"in n)&&n.preventDefault(),D||A||O[s][a].isRevealed)return;ie();const e=[...O.map(l=>[...l])];e[s][a].isFlagged=!e[s][a].isFlagged,T(e),_(l=>e[s][a].isFlagged?l-1:l+1)}function $(n,s,a){if(!(s<0||s>=p||a<0||a>=p||n[s][a].isRevealed||n[s][a].isFlagged)&&(n[s][a].isRevealed=!0,n[s][a].neighborMines===0))for(let e=-1;e<=1;e++)for(let l=-1;l<=1;l++)$(n,s+e,a+l)}function z(n){for(let s=0;s<p;s++)for(let a=0;a<p;a++)n[s][a].isMine&&(n[s][a].isRevealed=!0);T(n)}function P(n){n.every(a=>a.every(e=>e.isMine||e.isRevealed))&&(ae(),W(!0))}function q(){T(U()),I(!1),W(!1),S(!1),_(H)}const E=ne(n=>n.current),X=E==="xp"||E==="win98",R=E==="macosx",Z=t.jsx(je,{onClose:c,onShowHelp:()=>m(!0),onShowAbout:()=>C(!0),onNewGame:()=>S(!0)});return r?t.jsxs(t.Fragment,{children:[t.jsx("style",{children:re}),!X&&d&&Z,t.jsxs(fe,{title:xe("minesweeper"),onClose:c,isForeground:d,appId:"minesweeper",skipInitialSound:b,instanceId:o,onNavigateNext:y,onNavigatePrevious:w,menuBar:X?Z:void 0,windowConstraints:{minWidth:270,maxWidth:270,minHeight:360},children:[t.jsxs("div",{className:"flex flex-col h-full bg-[#c0c0c0] p-1.5 w-full",children:[t.jsx("div",{className:"mb-1.5 flex justify-between items-center gap-2 py-1 bg-[#c0c0c0]",children:t.jsx("div",{className:"flex-1 bg-[#8a9a8a] text-[#1a2a1a] text-lg px-2 py-0.5 border border-t-gray-800 border-l-gray-800 border-r-white border-b-white shadow-inner [text-shadow:1px_1px_0px_rgba(0,0,0,0.2)] h-[48px] flex items-center",children:t.jsxs("div",{className:"flex items-center justify-between text-sm relative w-full",children:[t.jsxs("div",{className:"flex flex-col items-start w-[80px]",children:[t.jsx("span",{className:`font-[ChicagoKare] text-lg leading-none ${R?"mt-0 mb-1":"mt-1"}`,children:se}),t.jsx("span",{className:`font-[Geneva-9] ${R?"text-xs":"text-[16px]"} mt-[-6px]`,children:x("apps.minesweeper.lcd.left")})]}),t.jsx("div",{className:"flex flex-col items-center absolute left-1/2 -translate-x-1/2",children:t.jsx(he,{variant:R?"secondary":"default",size:"sm",onClick:()=>D||A?q():S(!0),className:R?"!w-[34px] !h-[34px] aspect-square !rounded-full overflow-hidden flex items-center justify-center text-xl leading-none !p-0":"aspect-square h-[34px] flex items-center justify-center text-xl leading-none bg-[#c0c0c0] hover:bg-[#d0d0d0] border-2 border-t-white border-l-white border-r-gray-800 border-b-gray-800 active:border active:border-gray-600 shadow-none p-0",children:D?"ðŸ’€":A?"ðŸ˜Ž":"ðŸ™‚"})}),t.jsxs("div",{className:"flex flex-col items-end w-[80px]",children:[t.jsx("span",{className:`font-[ChicagoKare] text-lg leading-none ${R?"mt-0 mb-1":"mt-1"}`,children:H}),t.jsx("span",{className:`font-[Geneva-9] ${R?"text-xs":"text-[16px]"} mt-[-6px]`,children:x("apps.minesweeper.lcd.total")})]})]})})}),t.jsx("div",{className:"grid grid-cols-9 gap-0 bg-gray-800 p-[1px] border border-t-gray-800 border-l-gray-800 border-r-white border-b-white  max-w-[250px] m-auto",children:O.map((n,s)=>n.map((a,e)=>t.jsx(Ce,{cell:a,rowIndex:s,colIndex:e,onCellClick:oe,onCellRightClick:le,disabled:D||A},`${s}-${e}`)))})]}),t.jsx(ge,{isOpen:j,onOpenChange:m,helpItems:M,appId:"minesweeper"}),t.jsx(be,{isOpen:i,onOpenChange:C,metadata:we||{name:"Minesweeper",version:"1.0.0",creator:{name:"Ryo Lu",url:"https://ryo.lu"},github:"https://github.com/ryokun6/ryos",icon:"/icons/default/minesweeper.png"},appId:"minesweeper"}),t.jsx(Me,{isOpen:N,onOpenChange:S,onConfirm:q,title:"New Game",description:"Are you sure you want to start a new game?"})]})]}):null}function Ne(r){return["","blue-600","green-600","red-600","purple-600","red-800","cyan-600","black","gray-600"][r]||"black"}export{$e as MinesweeperAppComponent};
