import{j as e,r as i}from"./ui-core-D0pDhx0h.js";import{a as X,u as G,B as pe,a4 as oe,s as Ee,t as Re,v as Te,w as Me,x as Pe,b5 as Fe,aq as Le,b6 as N,b7 as _e,b8 as $e,b9 as ze,a5 as He,a6 as Ue,a7 as ee,a8 as We,a9 as Je,M as Ke,b as W,d as J,e as K,f as O,g as te,k as ue,S as Xe,l as Ge,m as Ve,E as qe,ba as Ze,Z as me,aD as ae,I as Qe,H as Ye,J as et,bb as tt}from"./index-DImvd7fi.js";import{P as at}from"./plus-DyjjL6QD.js";import{T as ot}from"./trash-2-CDeb-GPX.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./motion-DC7C-474.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";function st({boards:n,activeBoardId:s,onBoardSelect:p,onNewBoard:j,selectedDeviceId:v,onDeviceSelect:x,audioDevices:S,micPermissionGranted:h}){const f=X(c=>c.current),l=f==="xp"||f==="win98",{t:r}=G();return e.jsx("div",{className:`w-full bg-neutral-100 flex flex-col max-h-44 overflow-hidden md:w-56 md:max-h-full font-geneva-12 text-[12px] ${l?"border-b border-[#919b9c] md:border-r md:border-b-0":f==="macosx"?"border-b border-black/10 md:border-r md:border-b-0":"border-b border-black md:border-r md:border-b-0"}`,children:e.jsxs("div",{className:"py-3 flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 flex-shrink-0 px-3",children:[e.jsx("h2",{className:"text-[14px] pl-1",children:r("apps.soundboard.soundboards")}),e.jsx(pe,{variant:"ghost",size:"sm",onClick:j,className:"flex items-center text-xs hover:bg-black/5 w-[24px] h-[24px]",children:e.jsx(at,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"space-y-1 overscroll-contain w-full flex-1 overflow-y-auto min-h-0",style:{WebkitOverflowScrolling:"touch"},children:n.map(c=>{const g=c.id===s;return e.jsx("div",{className:oe("group relative py-1 px-5 cursor-pointer",g?"":"hover:bg-black/5"),style:g?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>p(c.id),children:c.name},c.id)})}),h&&e.jsx("div",{className:`mt-auto pt-2 border-t px-3 pb-3 ${l?"border-[#919b9c]":"border-gray-300"}`,children:e.jsxs(Ee,{value:v,onValueChange:x,children:[e.jsx(Re,{className:"w-full h-7 text-xs",children:e.jsx(Te,{placeholder:"Select microphone"})}),e.jsx(Me,{children:S.map(c=>e.jsx(Pe,{value:c.deviceId,className:"text-xs",children:c.label||`Microphone ${c.deviceId.slice(0,4)}...`},c.deviceId))})]})})]})})}function nt({slot:n,isRecording:s,isPlaying:p,onSlotClick:j,onDelete:v,onEmojiClick:x,onTitleClick:S,showWaveform:h,showEmoji:f}){const d=typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&/Mobile|iP(hone|ad|od)/.test(navigator.userAgent)&&!/CriOS|FxiOS|EdgiOS/.test(navigator.userAgent),l=!!n.audioData&&(h||d);return e.jsx("div",{className:"flex flex-col gap-2 min-h-0",children:e.jsxs(pe,{variant:"retro",className:`h-full w-full flex flex-col items-stretch justify-center relative p-2 md:p-2 group min-h-[106px] md:min-h-[110px] focus:outline-none focus:ring-0 ${s?"bg-destructive animate-pulse":""} ${p?"[border-image:url('/assets/button-default.svg')_60_stretch]":""}`,onClick:j,children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{audioData:n.audioData,isPlaying:p,className:"z-10"}),e.jsx("div",{className:"absolute top-1 right-1 flex gap-1 z-10",children:e.jsx("div",{role:"button",className:"hidden md:flex opacity-0 group-hover:opacity-100 transition-opacity h-5 w-5 md:h-6 md:w-6 hover:bg-white/50 rounded-md items-center justify-center cursor-pointer",onClick:r=>{r.stopPropagation(),v()},children:e.jsx(ot,{className:"w-3 h-3 md:w-4 md:h-4"})})})]}),e.jsxs("div",{className:`w-full mb-[-4px] left-2 flex items-center gap-1 md:gap-2 transition-all duration-300 ease-in-out transform origin-left ${p?"opacity-100 scale-100":"opacity-60 scale-90"}`,children:[f&&(n.emoji?e.jsx("span",{className:`text-xl md:text-xl hover:opacity-80 ${n.audioData&&!s?"cursor-pointer hover:bg-black/7 rounded px-0.5":"cursor-default"}`,onClick:r=>{!n.audioData||s||(r.stopPropagation(),x())},children:n.emoji}):e.jsx("span",{className:`invisible group-hover:visible transition-opacity text-xl md:text-xl hover:opacity-80 ${n.audioData&&!s?"cursor-pointer hover:bg-black/7 rounded px-0.5":"cursor-default"}`,onClick:r=>{!n.audioData||s||(r.stopPropagation(),x())},children:n.audioData?"ðŸ’¿":"ðŸŽ™ï¸"})),e.jsx("span",{className:`text-[12px] whitespace-nowrap overflow-hidden pr-5 text-left rounded select-text font-geneva-12 [mask-image:linear-gradient(to_right,black_80%,transparent)] ${n.audioData&&!s?"cursor-pointer hover:bg-black/7 rounded px-0.5 py-2":"cursor-default"}`,onClick:r=>{!n.audioData||s||(r.stopPropagation(),S())},title:n.audioData&&!s?n.title?"Edit title":"Add title":"",children:s?"Recording...":n.title||e.jsx("span",{className:"invisible group-hover:visible opacity-60 hover:opacity-100",children:n.audioData?"Title":"Record"})})]})]})})}function rt({board:n,playbackStates:s,isEditingTitle:p,onTitleChange:j,onTitleBlur:v,onTitleKeyDown:x,onSlotClick:S,onSlotDelete:h,onSlotEmojiClick:f,onSlotTitleClick:d,setIsEditingTitle:l,showWaveforms:r,showEmojis:c}){return e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"py-6 px-4 md:px-8 md:py-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex flex-col",children:[p?e.jsx(Le,{className:"text-[24px] font-bold mb-2 text-left select-text",value:n.name,autoFocus:!0,onChange:g=>j(g.target.value),onBlur:g=>v(g.target.value),onKeyDown:x}):e.jsx("h1",{className:"text-[24px] font-bold mb-2 text-left cursor-text hover:opacity-80 hover:bg-black/7 px-2 -ml-2 transition-all duration-300 ease-in-out transform origin-left rounded select-text",onClick:()=>l(!0),children:n.name}),e.jsx("div",{className:"grid grid-cols-3 gap-2 md:gap-4 flex-1",children:n.slots.map((g,y)=>e.jsx(nt,{slot:g,isRecording:s[y].isRecording,isPlaying:s[y].isPlaying,onSlotClick:()=>S(y),onDelete:()=>h(y),onEmojiClick:()=>f(y),onTitleClick:()=>d(y),showWaveform:r,showEmoji:c},y))})]})})})}const it=()=>{const n=N(a=>a.boards),s=N(a=>a.activeBoardId),p=N(a=>a.playbackStates),j=N(a=>a.addNewBoard),v=N(a=>a.updateBoardName),x=N(a=>a.deleteBoard),S=N(a=>a.setActiveBoardId),h=N(a=>a.updateSlot),f=N(a=>a.deleteSlot),d=N(a=>a.setSlotPlaybackState),l=i.useRef(Array(9).fill(null)),r=n.find(a=>a.id===s),c=i.useCallback(()=>{j()},[j]),g=i.useCallback(a=>{s&&v(s,a)},[s,v]),y=i.useCallback(()=>{s&&n.length>1&&x(s)},[s,n.length,x]),u=i.useCallback((a,w)=>{if(s){const{waveform:B,...R}=w;h(s,a,R)}},[s,h]),P=i.useCallback(a=>{s&&f(s,a)},[s,f]),C=i.useCallback((a,w,B)=>{d(a,w,B)},[d]),E=i.useCallback(a=>{var R;if(!r)return;const w=r.slots[a];if(!w||!w.audioData)return;l.current[a]&&((R=l.current[a])==null||R.pause(),l.current[a]=null);const B=_e(w.audioData);l.current[a]=B,C(a,!0,!1),B.play().catch(_=>{console.error("Error playing sound:",_),C(a,!1,!1)}),B.onended=()=>{C(a,!1,!1),l.current[a]=null}},[r,C]),L=i.useCallback(a=>{const w=l.current[a];w&&(w.pause(),w.currentTime=0,l.current[a]=null,C(a,!1,!1))},[C]);return{boards:n,activeBoard:r||(n.length>0?n[0]:null),activeBoardId:s,playbackStates:p,setActiveBoardId:S,addNewBoard:c,updateBoardName:g,deleteCurrentBoard:y,updateSlot:u,deleteSlot:P,playSound:E,stopSound:L}},lt=({onRecordingComplete:n,selectedDeviceId:s,setRecordingState:p})=>{const[j,v]=i.useState(!1),[x,S]=i.useState(!1),h=i.useRef(null),f=i.useRef([]),d=i.useCallback(async()=>{try{const r=await navigator.mediaDevices.getUserMedia({audio:s?{deviceId:{exact:s}}:!0});S(!0);const c=$e(),g=new MediaRecorder(r,{mimeType:c});f.current=[],g.ondataavailable=y=>{f.current.push(y.data)},g.onstop=async()=>{const y=new Blob(f.current,{type:c}),u=await ze(y);n(u),r.getTracks().forEach(P=>P.stop()),h.current=null,v(!1),p(!1)},h.current=g,v(!0),p(!0),g.start(200)}catch(r){console.error("Error accessing microphone:",r),S(!1),v(!1),p(!1)}},[s,n,p]),l=i.useCallback(()=>{var r;((r=h.current)==null?void 0:r.state)==="recording"&&h.current.stop()},[]);return{isRecording:j,micPermissionGranted:x,startRecording:d,stopRecording:l}},dt=["ðŸŽµ","ðŸŽ¶","ðŸŽ¤","ðŸŽ§","ðŸŽ¼","ðŸ”Š","ðŸ”‰","ðŸ”ˆ","ðŸŽ™","ðŸ“¢","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ·","ðŸ¥","ðŸŽš","ðŸŽ›","ðŸ””","ðŸ“£","ðŸ”•","âœ…","âŒ","â­","ðŸ’«","âœ¨","ðŸ”¥","ðŸ’¥","ðŸ’¢","ðŸ’¡","ðŸ’­","â¤ï¸","ðŸ’€","â˜ ï¸","âš¡","ðŸ’ª","ðŸ‘","ðŸ‘Ž","ðŸ‘","ðŸ™Œ","ðŸ‘‹","ðŸ’©","ðŸŽ‰","ðŸŽŠ","ðŸŒ¸","ðŸŒº","ðŸŒ·","â¬†ï¸","â¬‡ï¸","â¬…ï¸","âž¡ï¸","â†—ï¸","â†˜ï¸","â†™ï¸","â†–ï¸","â†•ï¸","â†”ï¸","ðŸƒ","ðŸƒâ€â™€ï¸","ðŸ’ƒ","ðŸ•º","ðŸš¶","ðŸš¶â€â™€ï¸","ðŸ˜€","ðŸ˜„","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ˜","ðŸ˜®","ðŸ˜±","ðŸ˜­","ðŸ¥º","ðŸ˜¤","ðŸ˜ ","ðŸ˜¡","ðŸ¤¬","ðŸ¤¯","ðŸ¥´","ðŸ˜´","ðŸ˜µ","ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","âš™ï¸","ðŸ”§","ðŸ”¨","ðŸ’»","âŒ¨ï¸","ðŸ–¥ï¸","ðŸ“±","ðŸ”‹","ðŸ”Œ","ðŸ’¾","ðŸ’¿","ðŸ“€","ðŸŽ®","ðŸ•¹ï¸","ðŸŽ²","ðŸŽ¯","ðŸŽ¨","âœ‚ï¸","ðŸ“Ž","ðŸ“Œ","â˜€ï¸","ðŸŒ™","â­","â˜ï¸","ðŸŒˆ","ðŸŒ§ï¸","â›ˆï¸","â„ï¸","ðŸŒªï¸","ðŸ”¥","ðŸ¤”","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜¤","ðŸ˜«","ðŸ˜©","ðŸ¥º","ðŸ˜¢","ðŸ˜­","âœŒï¸","ðŸ¤˜","ðŸ¤™","ðŸ‘†","ðŸ‘‡","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","â™ ï¸","â™£ï¸","â™¥ï¸","â™¦ï¸","ðŸ”„","â©","âª","â«","â¬","ðŸ”¼","ðŸ”½","â¯ï¸","â¹ï¸","âºï¸","âï¸","ðŸŽ¦","ðŸ”…","ðŸ”†","ðŸ“¶","ðŸ“³","ðŸ“´","â™¾ï¸","â™»ï¸","âšœï¸","ðŸ”±","ðŸ“›","ðŸ”°","â­•","âœ…","â˜‘ï¸","âœ”ï¸","âŒ","âŽ","ã€½ï¸","âœ³ï¸","âœ´ï¸","â‡ï¸","Â©ï¸","Â®ï¸","â„¢ï¸"];function ct({isOpen:n,onOpenChange:s,onEmojiSelect:p}){const{t:j}=G(),v=X(h=>h.current),x=v==="xp"||v==="win98",S=e.jsxs("div",{className:x?"p-2 px-4 pt-0":"p-4 py-6",children:[e.jsx("p",{id:"dialog-description",className:oe("mb-2 text-gray-500",x?"font-['Pixelated_MS_Sans_Serif',Arial] text-[11px]":"font-geneva-12 text-[12px]"),style:{fontFamily:x?'"Pixelated MS Sans Serif", "ArkPixel", Arial':void 0,fontSize:x?"11px":void 0},children:j("common.dialog.emoji.chooseEmoji")}),e.jsx("div",{className:"grid grid-cols-10 gap-1 max-h-[300px] overflow-y-auto",children:dt.map((h,f)=>e.jsx("button",{className:"p-1 !text-2xl hover:scale-120 transition-all duration-200 rounded cursor-pointer font-['SerenityOS-Emoji']",onClick:()=>{p(h),s(!1)},children:h},f))})]});return e.jsx(He,{open:n,onOpenChange:s,children:e.jsx(Ue,{className:oe("max-w-[500px]",x&&"p-0 overflow-hidden"),style:x?{fontSize:"11px"}:void 0,children:x?e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:j("common.dialog.emoji.setEmoji")}),e.jsx("div",{className:"window-body",children:S})]}):v==="macosx"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:j("common.dialog.emoji.setEmoji")}),S]}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(We,{className:"font-normal text-[16px]",children:j("common.dialog.emoji.setEmoji")}),e.jsx(Je,{className:"sr-only",children:j("common.dialog.emoji.description")})]}),S]})})})}function ut({onNewBoard:n,onImportBoard:s,onExportBoard:p,onReloadBoard:j,onReloadAllSounds:v,onRenameBoard:x,onDeleteBoard:S,canDeleteBoard:h,onShowHelp:f,onShowAbout:d,showWaveforms:l,onToggleWaveforms:r,showEmojis:c,onToggleEmojis:g,onClose:y}){var _;const{t:u}=G(),[P,C]=i.useState(!1),E="soundboard",L=(_=Ve[E])==null?void 0:_.name,[a,w]=i.useState(!1),B=X(I=>I.current),R=B==="xp"||B==="win98";return i.useEffect(()=>{const I=T=>{T.key==="Alt"&&w(!0)},$=T=>{T.key==="Alt"&&w(!1)};return window.addEventListener("keydown",I),window.addEventListener("keyup",$),()=>{window.removeEventListener("keydown",I),window.removeEventListener("keyup",$)}},[]),e.jsxs(Ke,{inWindowFrame:R,children:[e.jsxs(W,{children:[e.jsx(J,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:u("common.menu.file")}),e.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(O,{onClick:n,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.newSoundboard")}),e.jsx(te,{className:"h-[2px] bg-black my-1"}),e.jsx(O,{onClick:s,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.importSoundboards")}),e.jsx(O,{onClick:p,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.exportSoundboards")}),e.jsx(O,{onClick:j,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.resetSoundboards")}),a&&e.jsx(O,{onClick:v,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.loadSpecialSoundboards")}),e.jsx(te,{className:"h-[2px] bg-black my-1"}),e.jsx(O,{onClick:y,className:"text-md h-6 px-3",children:u("common.menu.close")})]})]}),e.jsxs(W,{children:[e.jsx(J,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("common.menu.edit")}),e.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(O,{onClick:x,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.renameSoundboard")}),e.jsx(O,{onClick:S,disabled:!h,className:h?"text-md h-6 px-3":"text-gray-400 text-md h-6 px-3",children:u("apps.soundboard.menu.deleteSoundboard")})]})]}),e.jsxs(W,{children:[e.jsx(J,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("common.menu.view")}),e.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(ue,{checked:l??!1,onCheckedChange:I=>r==null?void 0:r(I),className:"text-md h-6 px-3",children:u("apps.soundboard.menu.waveforms")}),e.jsx(ue,{checked:c??!1,onCheckedChange:I=>g==null?void 0:g(I),className:"text-md h-6 px-3",children:u("apps.soundboard.menu.emojis")})]})]}),e.jsxs(W,{children:[e.jsx(J,{className:"px-2 py-1 text-md focus-visible:ring-0",children:u("common.menu.help")}),e.jsxs(K,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(O,{onClick:f,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.soundboardHelp")}),e.jsx(O,{onSelect:()=>C(!0),className:"text-md h-6 px-3",children:u("common.menu.shareApp")}),e.jsx(te,{className:"h-[2px] bg-black my-1"}),e.jsx(O,{onClick:d,className:"text-md h-6 px-3",children:u("apps.soundboard.menu.aboutSoundboard")})]})]}),e.jsx(Xe,{isOpen:P,onClose:()=>C(!1),itemType:"App",itemIdentifier:E,title:L,generateShareUrl:Ge})]})}function Ct({onClose:n,isWindowOpen:s,isForeground:p,helpItems:j=[],skipInitialSound:v,instanceId:x,onNavigateNext:S,onNavigatePrevious:h}){const{boards:f,activeBoard:d,activeBoardId:l,playbackStates:r,setActiveBoardId:c,addNewBoard:g,updateBoardName:y,updateSlot:u,deleteSlot:P,playSound:C,stopSound:E}=it(),L=N(t=>t.initializeBoards),a=N(t=>t.hasInitialized),w=X(t=>t.current),B=w==="xp"||w==="win98";i.useEffect(()=>{a||L()},[a,L]);const R=N(t=>t.setSlotPlaybackState),_=()=>{for(let t=0;t<9;t++)R(t,!1,!1)},I=N(t=>t._setBoards_internal),$=N(t=>t.deleteBoard),T=N(t=>t.selectedDeviceId),z=N(t=>t.setSelectedDeviceId),[se,H]=i.useState(!1),[A,F]=i.useState({type:null,isOpen:!1,slotIndex:-1,value:""}),[xe,ne]=i.useState(!1),[he,re]=i.useState(!1),[fe,be]=i.useState([]),ie=i.useRef(null),{t:V}=G(),ge=qe("soundboard",j.length>0?j:Ze),je=typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&/Mobile|iP(hone|ad|od)/.test(navigator.userAgent)&&!/CriOS|FxiOS|EdgiOS/.test(navigator.userAgent),[le,ve]=i.useState(!je),[de,Se]=i.useState(!0),q=i.useRef(null),ye=t=>{const o=q.current;o!==null&&l&&u(o,{audioData:t})},{micPermissionGranted:Z,startRecording:we,stopRecording:ke}=lt({onRecordingComplete:ye,selectedDeviceId:T||"",setRecordingState:t=>{const o=q.current;if(o!==null){const m=r[o];R(o,(m==null?void 0:m.isPlaying)||!1,t)}}});i.useEffect(()=>{Z&&navigator.mediaDevices.enumerateDevices().then(t=>{const o=t.filter(m=>m.kind==="audioinput");if(be(o),T){const m=o.find(b=>b.deviceId==="default"||b.deviceId===T);m&&z(m.deviceId)}else o.length>0&&z(o[0].deviceId)})},[Z,T,r,z]),i.useEffect(()=>{r.forEach((t,o)=>{t.isPlaying&&E(o)}),_()},[l]);const Ne=t=>{q.current=t,we()},De=t=>{var m,b;if(!d)return;const o=d.slots[t];(m=r[t])!=null&&m.isRecording?ke():o!=null&&o.audioData?(b=r[t])!=null&&b.isPlaying?E(t):C(t):Ne(t)},Ce=()=>{!A.type||!l||(u(A.slotIndex,{[A.type]:A.value}),F(t=>({...t,isOpen:!1})))},Be=t=>{var b;const o=(b=t.target.files)==null?void 0:b[0];if(!o)return;const m=new FileReader;m.onload=k=>{var D;try{const M=JSON.parse((D=k.target)==null?void 0:D.result),U=(M.boards||[M]).map(Q=>({id:Q.id||Date.now().toString()+Math.random().toString(36).slice(2),name:Q.name||V("apps.soundboard.importedSoundboard"),slots:(Q.slots||Array(9).fill(null)).map(Y=>({audioData:Y.audioData,emoji:Y.emoji,title:Y.title}))}));I([...f,...U]),U.length>0&&U[0].id&&c(U[0].id)}catch(M){console.error("Failed to import soundboards:",M)}},m.readAsText(o)},Ie=()=>{if(!d)return;const t=f.find(D=>D.id===l)||d,o={boards:[t].map(D=>({id:D.id,name:D.name,slots:D.slots.map(M=>({audioData:M.audioData,emoji:M.emoji,title:M.title}))}))},m=new Blob([JSON.stringify(o)],{type:"application/json"}),b=URL.createObjectURL(m),k=document.createElement("a");k.href=b,k.download=`${t.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_soundboard.json`,k.click(),URL.revokeObjectURL(b)},Oe=async()=>{try{const o=await(await fetch("/data/soundboards.json")).json(),b=(o.boards||[o]).map(k=>({id:k.id||Date.now().toString()+Math.random().toString(36).slice(2),name:k.name||V("apps.soundboard.importedSoundboard"),slots:(k.slots||Array(9).fill(null)).map(D=>({audioData:D.audioData,emoji:D.emoji,title:D.title}))}));I(b),b.length>0&&b[0].id&&c(b[0].id)}catch(t){console.error("Failed to reload soundboards.json:",t)}},Ae=async()=>{try{const o=await(await fetch("/data/all-sounds.json")).json(),b=(o.boards||[o]).map(k=>({id:k.id||Date.now().toString()+Math.random().toString(36).slice(2),name:k.name||V("apps.soundboard.importedSoundboard"),slots:(k.slots||Array(9).fill(null)).map(D=>({audioData:D.audioData,emoji:D.emoji,title:D.title}))}));I(b),b.length>0&&b[0].id&&c(b[0].id)}catch(t){console.error("Failed to reload all-sounds.json:",t)}},ce=e.jsx(ut,{onClose:n,isWindowOpen:s,onNewBoard:g,onImportBoard:()=>{var t;return(t=ie.current)==null?void 0:t.click()},onExportBoard:Ie,onReloadBoard:Oe,onReloadAllSounds:Ae,onRenameBoard:()=>H(!0),onDeleteBoard:()=>{l&&f.length>1&&$(l)},canDeleteBoard:f.length>1,onShowHelp:()=>ne(!0),onShowAbout:()=>re(!0),showWaveforms:le,onToggleWaveforms:ve,showEmojis:de,onToggleEmojis:Se});return i.useEffect(()=>{const t=o=>{var b;if(!p||!d)return;const m=o.keyCode>=97?o.keyCode-97:o.keyCode-49;if(o.keyCode>=97&&o.keyCode<=105||o.keyCode>=49&&o.keyCode<=57){if(m<0||m>=d.slots.length)return;const k=d.slots[m];k!=null&&k.audioData&&((b=r[m])!=null&&b.isPlaying?E(m):C(m))}};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[d,r,C,E,p]),!a||!d||!l?e.jsx(me,{title:ae("soundboard"),onClose:n,isForeground:p,appId:"soundboard",skipInitialSound:v,instanceId:x,onNavigateNext:S,onNavigatePrevious:h,children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:a?"Loading soundboard...":"Initializing soundboard..."})}):e.jsxs(e.Fragment,{children:[!B&&p&&ce,e.jsxs(me,{title:se?ae("soundboard"):(d==null?void 0:d.name)||`${ae("soundboard")} ${l}`,onClose:n,isForeground:p,appId:"soundboard",skipInitialSound:v,instanceId:x,onNavigateNext:S,onNavigatePrevious:h,menuBar:B?ce:void 0,windowConstraints:{minHeight:window.innerWidth>=768?475:625},children:[e.jsxs("div",{className:`h-full w-full flex flex-col md:flex-row ${B?"border-t border-[#919b9c]":""}`,children:[e.jsx("input",{type:"file",ref:ie,className:"hidden",accept:"application/json",onChange:Be}),e.jsx(st,{boards:f,activeBoardId:l,onBoardSelect:c,onNewBoard:g,selectedDeviceId:T||"",onDeviceSelect:z,audioDevices:fe,micPermissionGranted:Z}),e.jsx(rt,{board:d,playbackStates:r,isEditingTitle:se,onTitleChange:t=>y(t),onTitleBlur:t=>{y(t),H(!1)},onTitleKeyDown:t=>{t.key==="Enter"&&(y(t.currentTarget.value),H(!1))},onSlotClick:De,onSlotDelete:P,onSlotEmojiClick:t=>{var o;return F({type:"emoji",isOpen:!0,slotIndex:t,value:((o=d.slots[t])==null?void 0:o.emoji)||""})},onSlotTitleClick:t=>{var o;return F({type:"title",isOpen:!0,slotIndex:t,value:((o=d.slots[t])==null?void 0:o.title)||""})},setIsEditingTitle:H,showWaveforms:le,showEmojis:de})]}),e.jsx(ct,{isOpen:A.isOpen&&A.type==="emoji",onOpenChange:t=>F(o=>({...o,isOpen:t})),onEmojiSelect:t=>{l&&u(A.slotIndex,{emoji:t}),F(o=>({...o,isOpen:!1}))}}),e.jsx(Qe,{isOpen:A.isOpen&&A.type==="title",onOpenChange:t=>F(o=>({...o,isOpen:t})),onSubmit:Ce,title:"Set Title",description:"Enter a title for this sound slot",value:A.value,onChange:t=>F(o=>({...o,value:t}))}),e.jsx(Ye,{isOpen:xe,onOpenChange:ne,helpItems:ge,appId:"soundboard"}),e.jsx(et,{isOpen:he,onOpenChange:re,metadata:tt,appId:"soundboard"})]})]})}export{Ct as SoundboardAppComponent};
