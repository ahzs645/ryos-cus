const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/shiki-BRHH8Llz.js","assets/media-player-Dfptv93o.js","assets/react-CyQK0IK8.js"])))=>i.map(i=>d[i]);
import{_ as wt}from"./media-player-Dfptv93o.js";import{r as s,j as a,k as vt}from"./ui-core-D0pDhx0h.js";import{c as J,bS as xt,u as bt,O as St,X as kt,aC as Ue,Y as ge,a as Mt,n as We,o as Be,bT as Pt,B as jt,at as Ge,I as Et,bK as Ve,am as Ye}from"./index-BxS3VOwZ.js";import{A as Qe,a as Ct}from"./appletAuthBridge-gdg5QSWM.js";import{d as Nt,m as A,A as Xe}from"./motion-DC7C-474.js";import{P as Rt}from"./plus-BNqhTAaD.js";import{R as Ke,h as Je,F as Ne,M as Me,n as ye,c as Y,i as Ze,P as et,j as tt,s as At,C as Tt,a as Ft,S as It}from"./audio-DxkJfdUY.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],ot=J("ArrowDownToLine",$t);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],Lt=J("Code",zt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],nt=J("Copy",Ht);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],Ot=J("GripVertical",Dt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],qt=J("Maximize",_t);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],st=J("Minimize",Ut);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]],at=J("Share",Wt);let Pe=null,je=null;const Bt=()=>(je||(Pe||(Pe=wt(()=>import("./shiki-BRHH8Llz.js"),__vite__mapDeps([0,1,2]))),je=Pe.then(p=>p.createHighlighter({themes:["github-dark"],langs:["html"]}))),je),no=p=>{const E=/```(?:html)?\s*([\s\S]*?)```/,g=p.match(E);if(g&&g[1]){const r=g[1].trim();if(r.startsWith("<")||/<\/?[a-z][\s\S]*>/i.test(r))return{isHtml:!0,content:r}}const M=p.trim();return M.startsWith("<")&&(/<\/[a-z][^>]*>/i.test(M)||/<[a-z][^>]*\/>/i.test(M)||M.includes("<style>")||M.includes("<div>")||M.includes("<span>"))?{isHtml:!0,content:M}:{isHtml:!1,content:""}},Gt=p=>{const E=/```(?:html)?\s*([\s\S]*?)```/g;let g=p;const M=[];let r,O=!1;for(;(r=E.exec(p))!==null;){const I=r[1].trim();I&&(I.startsWith("<")||/<\/?[a-z][\s\S]*>/i.test(I))&&(M.push(I),O=!0,g=g.replace(r[0],""))}const C=/```(?:html)?\s*([\s\S]*?)$/,o=g.match(C);o&&o[1]&&(o[1].trim().startsWith("<")||/<\/?[a-z][\s\S]*>/i.test(o[1].trim()))&&(M.push(o[1].trim()),O=!0,g=g.replace(o[0],""));const F=g.trim();return!O&&F.startsWith("<")&&(/<\/[a-z][^>]*>/i.test(F)||/<[a-z][^>]*\/>/i.test(F)||F.includes("<style>")||F.includes("<div>")||F.includes("<span>"))&&(M.push(F),O=!0,g=""),{htmlContent:M.join(`

`),textContent:g,hasHtml:O}};function so({htmlContent:p,appletTitle:E="",appletIcon:g="",onInteractionChange:M,isStreaming:r=!1,maxHeight:O="800px",minHeight:C="200px",minWidth:o,initialFullScreen:F=!1,className:ne="",playElevatorMusic:I,stopElevatorMusic:_,playDingSound:Q,maximizeSound:Z,minimizeSound:se,isInternetExplorer:j=!1,baseUrlForAiContent:T,mode:L="now"}){const[P,q]=s.useState(F),[ee,de]=s.useState(!1),[H,me]=s.useState(!1),[D,ae]=s.useState(xt()),[t,u]=s.useState(""),[d,i]=s.useState(null),[l,m]=s.useState(!1),[x,b]=s.useState(!1),[h,R]=s.useState(!1);s.useRef(!1),s.useRef(0);const f=s.useRef(null),[$,pe]=s.useState(!1),[it,we]=s.useState(""),{t:S}=bt(),{saveFile:lt}=St("/",{skipLoad:!0}),ct=kt(),ve=Ue(e=>e.username),Re=Ue(e=>e.authToken),xe=s.useRef(null),B=s.useRef(null),G=s.useRef(null),ut=s.useRef(null),Ae=s.useRef(null),Te=s.useRef(`iframe-${Math.random().toString(36).substring(2,9)}`).current,Fe=s.useRef(r),dt=s.useRef(Date.now()),Ie=Nt(),re=s.useRef(null),[te,$e]=s.useState(""),ze=s.useRef(0),he=ge(e=>e.terminalSoundsEnabled),ie=Mt(e=>e.current)==="macosx",U=s.useCallback(e=>{if(e)try{e.postMessage({type:Qe,action:"response",payload:{username:ve??null,authToken:Re??null}},"*")}catch(n){console.warn("[applet-html-preview] Failed to post auth payload:",n)}},[ve,Re]),Le=T?T.startsWith("http")?T:`https://${T}`:null,mt=We(Be.WINDOW_EXPAND),pt=We(Be.WINDOW_COLLAPSE),le=Z||mt,V=se||pt;s.useEffect(()=>{Pt(D)},[D]),s.useEffect(()=>{const e=n=>{var w,y;const k=n==null?void 0:n.data;if(!k||k.type!==Qe||k.action!=="request")return;const c=n.source;if(!c)return;const v=[];(w=B.current)!=null&&w.contentWindow&&v.push(B.current.contentWindow),(y=G.current)!=null&&y.contentWindow&&v.push(G.current.contentWindow),v.includes(c)&&U(c)};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[U]),s.useEffect(()=>{var e,n;U((e=B.current)==null?void 0:e.contentWindow),U((n=G.current)==null?void 0:n.contentWindow)},[U]),s.useEffect(()=>{if(P&&xe.current&&!d){const e=`${xe.current.offsetHeight}px`;i(e)}},[P,d]),s.useEffect(()=>{const e=()=>{m(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),s.useEffect(()=>{const e=n=>{n.key==="Escape"&&P&&(V.play(),q(!1))};return P&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[P,V]);const He=e=>{const n=`<!-- ts=${dt.current} -->`,k=Le?`<base href="${Le}">`:"",c=!e&&ie,v=`
    <link rel="stylesheet" href="/fonts/fonts.css">
    ${n} 
    ${k}
    ${Ct}
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.174.0/three.module.min.js"><\/script>
  <script src="https://cdn.tailwindcss.com/3.4.16"><\/script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: [${c?'"LucidaGrande", "Lucida Grande", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", "Apple Color Emoji", "Noto Color Emoji", "sans-serif"':'"Geneva-12", "ArkPixel", "SerenityOS-Emoji", "sans-serif"'}],
            mono: [${c?'"ui-monospace", "SFMono-Regular", "Menlo", "Consolas", "Liberation Mono", "Courier New", "monospace"':'"Monaco", "ArkPixel", "SerenityOS-Emoji", "ui-monospace", "SFMono-Regular", "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", "monospace"'}],
            serif: [${c?'"Georgia", "Times New Roman", "Times", "serif"':'"Mondwest", "Yu Mincho", "Hiragino Mincho Pro", "Georgia", "Palatino", "SerenityOS-Emoji", "serif"'}],
            emoji: [${c?'"Apple Color Emoji", "Noto Color Emoji"':'"SerenityOS-Emoji", "AppleColorEmoji", "AppleColorEmojiFallback"'}],
            'geneva': [${c?'"LucidaGrande", "Lucida Grande", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "Helvetica", "Arial", "Apple Color Emoji", "Noto Color Emoji", "sans-serif"':'"Geneva-12", "ArkPixel", "SerenityOS-Emoji", "system-ui", "-apple-system", "sans-serif"'}],
            'mondwest': ["Mondwest", "Yu Mincho", "Hiragino Mincho Pro", "Georgia", "Palatino", "Yu Mincho", "Hiragino Mincho Pro", "serif"],
            'neuebit': [${c?'"Helvetica", "Arial", "Hiragino Sans", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "sans-serif"':'"NeueBit", "ArkPixel", "SerenityOS-Emoji", "Helvetica", "Arial", "Hiragino Sans", "sans-serif"'}],
            'monaco': [${c?'"ui-monospace", "SFMono-Regular", "Menlo", "Consolas", "Liberation Mono", "Courier New", "monospace"':'"Monaco", "ArkPixel", "SerenityOS-Emoji", "monospace"'}],
            'jacquard': ["Jacquard", "Yu Mincho", "Hiragino Mincho Pro", "Georgia", "Palatino", "serif"]
          }
        }
      }
    }
  <\/script>
  <style>
    * {
      box-sizing: border-box;
      ${c?"font-family: inherit !important;":""}
    }
    html, body {
      margin: 0;
      overflow-x: auto; /* Allow horizontal scroll if content overflows */
      width: 100%;
      height: 100%;
      max-width: 100%; /* Prevent body from exceeding viewport width */
      ${c?'font-family: "LucidaGrande", "Lucida Grande", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Noto Color Emoji", sans-serif !important;':""}
    }
    ${c?`
    /* Ensure headings and common text elements use Lucida Grande */
    h1,h2,h3,h4,h5,h6,p,div,span,a,li,ul,ol,button,input,select,textarea,label,code,pre,blockquote,small,strong,em,table,th,td {
      font-family: "LucidaGrande", "Lucida Grande", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Noto Color Emoji", sans-serif !important;
    }
    `:""}
    /* Ensure pre doesn't break layout */
    pre {
      white-space: pre-wrap; /* Allow wrapping */
      word-break: break-all; /* Break long words */
    }
  </style>
  
  <!-- Move click interceptor script to head for earlier execution -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.addEventListener('click', function(event) {
        var targetElement = event.target.closest('a');
        // Only intercept if it's a valid link and NOT inside the draggable toolbar
        if (targetElement && targetElement.href && !targetElement.closest('[data-drag-controls]')) {
          event.preventDefault();
          event.stopPropagation();
          try {
            // Resolve relative URLs against the document's base URI (if set) or window location
            const absoluteUrl = new URL(targetElement.getAttribute('href'), document.baseURI || window.location.href).href;
            // Use a specific message type for AI HTML navigation
            window.parent.postMessage({ type: 'aiHtmlNavigation', url: absoluteUrl }, '*');
            console.log('Intercepted link click:', absoluteUrl);
          } catch (e) { console.error("Error resolving/posting URL:", e); }
        }
      }, true); // Use capture phase to intercept early
    });
    
    // Also add immediate execution version for documents that load quickly
    // This helps ensure we don't miss any clicks during initial page load
    (function() {
      document.addEventListener('click', function(event) {
        var targetElement = event.target.closest('a');
        // Only intercept if it's a valid link and NOT inside the draggable toolbar
        if (targetElement && targetElement.href && !targetElement.closest('[data-drag-controls]')) {
          event.preventDefault();
          event.stopPropagation();
          try {
            // Resolve relative URLs against the document's base URI (if set) or window location
            const absoluteUrl = new URL(targetElement.getAttribute('href'), document.baseURI || window.location.href).href;
            // Use a specific message type for AI HTML navigation
            window.parent.postMessage({ type: 'aiHtmlNavigation', url: absoluteUrl }, '*');
            console.log('Intercepted link click (immediate handler):', absoluteUrl);
          } catch (e) { console.error("Error resolving/posting URL:", e); }
        }
      }, true); // Use capture phase to intercept early
    })();
  <\/script>
`;let y=p.trim();y.startsWith("```html")?y=y.substring(7).trim():y.startsWith("```")&&(y=y.substring(3).trim()),y.endsWith("```")&&(y=y.substring(0,y.length-3).trim());const W=y.indexOf("<");W>0?y=y.substring(W):W===-1&&(y="");const oe=y.toLowerCase().indexOf("<html"),fe=y.toLowerCase().lastIndexOf("</html>");if(oe!==-1&&(fe>oe?y=y.substring(oe,fe+7):y=y.substring(oe)),/<!DOCTYPE html>/i.test(y)||/<html[\s>]/i.test(y)){let N=y;const ue=/<\/head>/i.exec(N);if(ue)N=N.slice(0,ue.index)+v+N.slice(ue.index);else{const z=/<head[^>]*>/i.exec(N);if(z)N=N.slice(0,z.index+z[0].length)+v+N.slice(z.index+z[0].length);else{const K=/<html[^>]*>/i.exec(N);K?N=N.slice(0,K.index+K[0].length)+`<head>${v}</head>`+N.slice(K.index+K[0].length):N=`<head>${v}</head>`+N}}return N}else return`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  ${v} 
</head>
<body>
  ${y}
</body>
</html>`},X=He(!1),De=He(!0),ce=s.useCallback(e=>{requestAnimationFrame(()=>{B.current&&(B.current.srcdoc=e,setTimeout(()=>{var n;U(((n=B.current)==null?void 0:n.contentWindow)||null)},0)),G.current&&(G.current.srcdoc=e,setTimeout(()=>{var n;U(((n=G.current)==null?void 0:n.contentWindow)||null)},0))})},[U]);s.useEffect(()=>{if(!r){const e=X;re.current=e,ce(e)}},[r,p,X,ce]),s.useEffect(()=>{let e=!0;return H?t||(async()=>{try{const k=await Bt(),c=re.current||X;if(e&&c){const v=k.codeToHtml(c,{lang:"html",theme:"github-dark"});u(v)}}catch(k){console.error("Failed to highlight code:",k)}})():u(""),()=>{e=!1}},[H,re.current]),s.useEffect(()=>{if(r&&I&&he)return I(L),()=>{_&&_()}},[r,I,_,L,he]),s.useEffect(()=>{Fe.current&&!r&&Q&&_&&he&&(Q(),_()),Fe.current=r},[r,Q,_,he]);const Oe=async e=>{e.stopPropagation();try{await navigator.clipboard.writeText(p),de(!0),setTimeout(()=>{de(!1)},2e3)}catch(n){console.error("Failed to copy: ",n)}},_e=e=>{e.stopPropagation();const n=new Blob([X],{type:"text/html"}),k=URL.createObjectURL(n),c=document.createElement("a"),v=new Date().toISOString().replace(/[:.]/g,"-").substring(0,19);c.href=k,c.download=`ryOS-generated-${v}.html`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(k)},be=async e=>{e.stopPropagation();const n=E||"applet",c=`/Applets/${n.endsWith(".app")||n.endsWith(".html")?n:`${n}.app`}`;if(Ve.getState().getItem(c))we(n),pe(!0);else try{await qe(n)}catch(w){console.error("Quick save applet failed, showing naming dialog:",w),we(n),pe(!0)}},qe=async e=>{if(!e||!e.trim())return;const n=e.trim(),k=n.endsWith(".app")||n.endsWith(".html")?n:`${n}.app`,c=`/Applets/${k}`;try{const v=Ve.getState(),w=v.getItem(c),y=z=>{const K=/^([\u{1F300}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F000}-\u{1F02F}\u{1F0A0}-\u{1F0FF}\u{1F100}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2300}-\u{23FF}\u{2B50}\u{2B55}\u{3030}\u{303D}\u{3297}\u{3299}]+)\s*/u,ke=z.match(K);return ke?{emoji:ke[1],remainingText:z.slice(ke[0].length)}:{emoji:null,remainingText:z}};let W=(w==null?void 0:w.icon)||g;if(!W||W==="/icons/default/app.png"){const{emoji:z}=y(n);z?W=z:W="/icons/default/app.png"}const oe=w==null?void 0:w.shareId,fe=w==null?void 0:w.createdBy,Se=w==null?void 0:w.windowWidth,N=w==null?void 0:w.windowHeight;await lt({path:c,name:k,content:De,type:"html",icon:W,shareId:oe,createdBy:fe||ve||void 0}),Se&&N&&v.updateItemMetadata(c,{windowWidth:Se,windowHeight:N});const ue=new CustomEvent("fileUpdated",{detail:{name:k,path:c}});window.dispatchEvent(ue),pe(!1),Ye.success(S("common.htmlPreview.toastSaved"),{description:k,action:{label:S("common.htmlPreview.toastOpenAction"),onClick:()=>{ct("applet-viewer",{initialData:{path:c,content:De}})}},duration:5e3})}catch(v){console.error("Failed to save applet:",v),Ye.error(S("common.htmlPreview.toastSaveFailed"),{description:S("common.htmlPreview.toastSaveFailedDescription")})}},ht=e=>{if(e.stopPropagation(),P)V.play();else{le.play();const n=re.current||X;ce(n)}q(!P)};s.useEffect(()=>{if(P&&!r){const e=re.current||X;ce(e)}},[P,r,X,ce]);const ft=e=>{e.stopPropagation(),x||(R(!h),h?le.play():V.play())},yt=e=>{e.stopPropagation(),R(!1),le.play()},gt=e=>{if(!e)return e;let n=e.replace(/<style\b[^>]*>([\s\S]*?)<\/style>/gi,(c,v)=>`<style>${v.replace(/(\s|^)(html|body|:root)\s*{[^}]*}/gi,"").replace(/font-family\s*:\s*[^;}]+(;|$)/gi,"").replace(/color\s*:\s*[^;}]+(;|$)/gi,"").replace(/\s*@font-face\s*{[^}]*}/gi,"")}</style>`);n=n.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),n=n.replace(/<link\b[^>]*>/gi,""),n=n.replace(/position\s*:\s*fixed/gi,"position: relative"),n=n.replace(/position\s*:\s*sticky/gi,"position: relative");const k=c=>c.split(/\s+/).map(w=>w==="fixed"||w==="sticky"?"relative":/^(top|bottom|left|right|inset)(-|$)/.test(w)?"":w).filter(Boolean).join(" ");return n=n.replace(/class="([^"]*)"/gi,(c,v)=>`class="${k(v)}"`),n=n.replace(/className="([^"]*)"/gi,(c,v)=>`className="${k(v)}"`),n=n.replace(/(position\s*:\s*relative.*?)(top|left|right|bottom)\s*:\s*[^;]+/gi,"$1$2: auto"),n=n.replace(/z-index\s*:\s*\d+/gi,"z-index: auto"),n};return s.useEffect(()=>{if(r){const e=Date.now();if(e-ze.current>500){ze.current=e;const{htmlContent:n}=Gt(p);if(n&&te!==n){const k=gt(n);$e(k)}}}else $e("")},[p,r,te]),a.jsxs(a.Fragment,{children:[!j&&(E||g)&&a.jsx("style",{children:`
    .applet-icon {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
      line-height: 1;
      display: inline-block;
    }
  `}),a.jsxs(A.div,{ref:xe,className:`${j?"":"rounded"} bg-white m-0 relative ${ne} ${r?"loading-pulse":""} ${!j&&(E||g)?"flex flex-col overflow-hidden":j?"overflow-hidden":"overflow-auto"}`,style:{maxHeight:j?"100%":P?d||C:O,opacity:P?0:1,height:j?"100%":P?d||C:"auto",boxShadow:j||P?"none":"0 0 0 1px rgba(0, 0, 0, 0.3)",visibility:P?"hidden":"visible",minHeight:C,minWidth:o},animate:{opacity:P?0:1},transition:{opacity:{duration:.3,ease:"easeInOut"}},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onMouseEnter:()=>!r&&(M==null?void 0:M(!0)),onMouseLeave:()=>!r&&(M==null?void 0:M(!1)),tabIndex:-1,children:[r&&a.jsx(A.div,{className:"absolute inset-0 bg-gray-300 z-10 pointer-events-none",initial:{opacity:.2},animate:{opacity:[.2,.6,.2]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),!j&&(E||g)&&a.jsxs("div",{className:"flex items-center gap-3 px-3 py-2 bg-gray-100 border-b border-gray-300 flex-shrink-0",children:[a.jsx("div",{className:"!text-2xl flex-shrink-0 applet-icon",style:{fontSize:"1.5rem"},children:g||"ðŸ“±"}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("div",{className:"font-medium text-sm font-geneva-12 truncate",children:E||S("common.htmlPreview.bannerFallbackTitle")})}),a.jsx(jt,{size:"sm",variant:"secondary",onClick:async e=>{e.stopPropagation();try{await be(e)}catch(n){console.error("Failed to save applet:",n)}},className:"w-[60px]",disabled:r,children:S("common.dialog.save")})]}),!j&&!(E||g)&&a.jsxs(A.div,{className:"flex justify-end p-1 absolute top-2 right-4 z-20",animate:{opacity:r?0:1},transition:{duration:.3},style:{pointerEvents:r?"none":"auto"},children:[a.jsx("button",{onClick:be,onMouseDown:e=>e.stopPropagation(),className:"flex items-center justify-center w-6 h-6 hover:bg-black/10 rounded mr-1 group","aria-label":S("common.htmlPreview.saveApplet"),disabled:r,children:a.jsx(ot,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"})}),a.jsx("button",{onClick:_e,onMouseDown:e=>e.stopPropagation(),className:"flex items-center justify-center w-6 h-6 hover:bg-black/10 rounded mr-1 group","aria-label":S("common.htmlPreview.downloadHtml"),disabled:r,children:a.jsx(at,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"})}),a.jsx("button",{onClick:Oe,onMouseDown:e=>e.stopPropagation(),className:"flex items-center justify-center w-6 h-6 hover:bg-black/10 rounded mr-1 group","aria-label":S("common.htmlPreview.copyHtml"),disabled:r,children:ee?a.jsx(Ge,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"}):a.jsx(nt,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"})}),a.jsx("button",{onClick:ht,onMouseDown:e=>e.stopPropagation(),className:"flex items-center justify-center w-6 h-6 hover:bg-black/10 rounded group","aria-label":S(P?"common.htmlPreview.minimizePreview":"common.htmlPreview.maximizePreview"),disabled:r,children:P?a.jsx(st,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"}):a.jsx(qt,{size:16,className:"text-neutral-400/50 group-hover:text-neutral-300"})})]}),r&&p?a.jsx("div",{className:`h-full w-full relative overflow-auto ${!j&&(E||g)?"flex-1":""}`,style:{maxHeight:j?"100%":typeof C=="string"?C:`${C}px`},children:te?a.jsx("div",{className:`generated-html-stream ${ie?"":"font-geneva-12"}`,dangerouslySetInnerHTML:{__html:te}}):a.jsx("pre",{className:`p-2 text-[12px] ${ie?"font-mono":"font-monaco"} antialiased text-gray-700 whitespace-pre-wrap break-words`,children:p.split(`
`).slice(-8).join(`
`)})}):a.jsx(A.iframe,{ref:B,id:Te,title:S("common.htmlPreview.codePreviewTitle"),className:`border-0 block ${!j&&(E||g)?"flex-1":""}`,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-modals allow-pointer-lock allow-downloads allow-storage-access-by-user-activation",style:{width:j?"calc(100% + 1px)":"100%",height:j?"calc(100% + 1px)":!j&&(E||g)?"100%":typeof C=="string"?C:`${C}px`,display:"block",margin:0,padding:0,position:"relative",zIndex:1},onMouseDown:e=>e.stopPropagation(),onLoad:()=>{var e;return U(((e=B.current)==null?void 0:e.contentWindow)||null)}})]}),vt.createPortal(a.jsx(Xe,{mode:"wait",children:P&&a.jsx(A.div,{className:"fixed inset-0 z-[9999] flex flex-col",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>{V.play(),q(!1)},children:a.jsx(A.div,{className:"absolute inset-0 flex flex-col",initial:{y:"15%",opacity:0},animate:{y:0,opacity:1},exit:{y:"15%",opacity:0},transition:{type:"spring",stiffness:250,damping:25},children:a.jsxs("div",{ref:Ae,className:"relative w-full h-full overflow-hidden",children:[a.jsx(Xe,{children:H?a.jsx(A.div,{className:"absolute inset-0 bg-[#24292e] font-geneva-12 overflow-auto p-4 z-10",onClick:e=>e.stopPropagation(),style:{fontSize:"12px"},dangerouslySetInnerHTML:{__html:t},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25}},"code"):null}),a.jsxs(A.div,{className:"absolute z-100 bg-white",initial:!1,animate:{width:D&&H?l?"100%":"50%":"100%",height:D&&H&&l?"50%":"100%",right:0,opacity:H&&!D?0:1},transition:{duration:.3,ease:[.25,.1,.25,1]},style:{position:"absolute",top:H&&D&&l?"50%":0,right:0,overflow:"hidden"},children:[r&&p?a.jsx(A.div,{className:"h-full w-full overflow-auto",initial:{opacity:.8,y:3},animate:{opacity:1,y:0},transition:{duration:.15,ease:"easeOut"},children:te?a.jsx("div",{className:`generated-html-stream ${ie?"":"font-geneva-12"} text-sm p-4`,dangerouslySetInnerHTML:{__html:te}}):a.jsx("pre",{className:`p-4 text-xs ${ie?"font-sans":"font-geneva-12"} text-gray-700 whitespace-pre-wrap break-words`,children:p.split(`
`).slice(-15).join(`
`)})}):a.jsx("iframe",{ref:G,id:`fullscreen-${Te}`,title:S("common.htmlPreview.codePreviewTitleFullscreen"),className:"border-0 bg-white w-full h-full",sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-modals allow-pointer-lock allow-downloads allow-storage-access-by-user-activation",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onLoad:()=>{var e;return U(((e=G.current)==null?void 0:e.contentWindow)||null)},style:{display:"block",margin:0,padding:0,pointerEvents:x?"none":"auto",...j&&{position:"absolute",inset:0}}}),r&&p&&a.jsx("div",{className:"absolute inset-0 bg-gray-100 z-10 pointer-events-none",style:{opacity:.2},children:a.jsx(A.div,{className:"w-full h-full bg-gray-400",animate:{opacity:[.05,.2,.05]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})})]}),a.jsx(A.div,{ref:ut,className:"absolute z-200",initial:!1,drag:!0,dragControls:Ie,dragConstraints:Ae,dragElastic:.2,dragTransition:{bounceStiffness:600,bounceDamping:20},dragSnapToOrigin:!1,whileDrag:{scale:1.05},onDragStart:()=>b(!0),onDragEnd:()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b(!1)},100)},onClick:e=>e.stopPropagation(),style:{top:0,right:0,padding:16,minHeight:"40px",minWidth:"40px"},children:a.jsxs(A.div,{className:"bg-neutral-700/40 backdrop-blur-sm rounded-full overflow-hidden flex items-center justify-center gap-1",layout:!0,onClick:e=>e.stopPropagation(),initial:!1,animate:{width:h?"40px":"auto",height:"40px",padding:h?"0px":"4px"},transition:{duration:.15},children:[a.jsx(A.div,{className:"absolute w-[40px] h-[40px] flex items-center justify-center group hover:scale-110 transition-all duration-200",initial:!1,animate:{opacity:h?1:0},transition:{duration:.2},style:{pointerEvents:h?"auto":"none",cursor:"pointer"},onClick:yt,children:a.jsx(Rt,{size:24,className:"text-white/40 group-hover:text-white transition-all duration-200"})}),a.jsxs(A.div,{className:"flex items-center justify-center",initial:!1,animate:{opacity:h?0:1,width:h?40:"auto"},transition:{duration:.15},style:{pointerEvents:h?"none":"auto",overflow:"hidden"},children:[a.jsx("div",{className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group cursor-move",onPointerDown:e=>{e.stopPropagation(),Ie.start(e)},onClick:e=>{e.stopPropagation(),ft(e)},children:a.jsx(Ot,{size:18,className:"text-white/70 group-hover:text-white"})}),H&&a.jsx("button",{onClick:e=>{e.stopPropagation(),ae(!D),D?le.play():V.play()},className:"flex items-center justify-center px-2 h-8 hover:bg-white/10 rounded-full group text-sm font-geneva-12","aria-label":S("common.htmlPreview.toggleSplitView"),children:a.jsx("span",{className:"text-white/70 group-hover:text-white",children:S(D?"common.htmlPreview.split":"common.htmlPreview.full")})}),a.jsx("button",{onClick:e=>{e.stopPropagation(),H?(me(!1),ae(!1),V.play()):(me(!0),ae(!0),le.play())},className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group","aria-label":S("common.htmlPreview.toggleCode"),children:a.jsx(Lt,{size:20,className:"text-white/70 group-hover:text-white"})}),a.jsx("button",{onClick:be,className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group","aria-label":S("common.htmlPreview.saveApplet"),children:a.jsx(ot,{size:20,className:"text-white/70 group-hover:text-white"})}),a.jsx("button",{onClick:_e,className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group","aria-label":S("common.htmlPreview.downloadHtml"),children:a.jsx(at,{size:20,className:"text-white/70 group-hover:text-white"})}),a.jsx("button",{onClick:Oe,className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group","aria-label":S("common.htmlPreview.copyHtml"),children:ee?a.jsx(Ge,{size:20,className:"text-white/70 group-hover:text-white"}):a.jsx(nt,{size:20,className:"text-white/70 group-hover:text-white"})}),a.jsx("button",{onClick:e=>{e.stopPropagation(),V.play(),q(!1)},className:"flex items-center justify-center w-8 h-8 hover:bg-white/10 rounded-full group","aria-label":S("common.htmlPreview.exitFullscreen"),children:a.jsx(st,{size:20,className:"text-white/70 group-hover:text-white"})})]})]})})]})})})}),document.body),a.jsx(Et,{isOpen:$,onOpenChange:pe,onSubmit:qe,title:S("common.htmlPreview.saveApplet"),description:S("common.htmlPreview.saveAppletDescription"),value:it,onChange:we})]})}const rt={command:{oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:0,release:.1},filter:{frequency:3e3,rolloff:-24},volume:-5,note:"C5",duration:"16n"},error:{oscillator:{type:"square"},envelope:{attack:.01,decay:.3,sustain:.1,release:.2},filter:{frequency:1500,rolloff:-12},volume:-3,note:"E3",duration:"8n"},aiResponse:{oscillator:{type:"sine"},envelope:{attack:.02,decay:.2,sustain:.1,release:.4},filter:{frequency:2e3,rolloff:-24},volume:-8,note:"G4",duration:"16n"}},Ee={oscillator:{type:"sawtooth"},envelope:{attack:.1,decay:.3,sustain:.3,release:.8},filter:{frequency:200,rolloff:-12},volume:-5,note:"C2",duration:"4n"},Vt={oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:.3,release:.5},filter:{frequency:5e3,rolloff:-12},volume:-10,note:"A5",duration:"8n"};function ao(){const[p,E]=s.useState(!1),g=ge(t=>t.terminalSoundsEnabled),M=ge(t=>t.setTerminalSoundsEnabled),r=!g,O=s.useRef(0),C=s.useRef({command:null,error:null,aiResponse:null}),o=s.useRef({isPlaying:!1,timeMode:"now",players:[],generativePlayers:[],notePool:[],melodySequencer:{synth:null,currentMelody:[],currentIndex:0,timeout:null},effects:null,timeoutIds:[]}),F=s.useCallback(()=>{o.current.effects&&o.current.effects.forEach(f=>f.dispose()),o.current.players.forEach(({player:f,interval:$})=>{f&&f.dispose(),$&&$.dispose()}),o.current.generativePlayers.forEach(({synth:f,pattern:$})=>{f&&f.dispose(),$&&$.dispose()}),o.current.timeoutIds.forEach(f=>window.clearTimeout(f)),o.current.melodySequencer.timeout&&window.clearTimeout(o.current.melodySequencer.timeout),o.current.players=[],o.current.generativePlayers=[],o.current.timeoutIds=[];const t=new Ke({decay:10,wet:.8}).toDestination(),u=new Je({delayTime:.7,feedback:.5,wet:.3}).connect(t),d=new Ne({type:"lowpass",frequency:2e3,Q:1}).connect(u),i=["Db3","Eb3","Gb3","Ab3","Bb3","Db4","Eb4","Gb4","Ab4","Bb4","Db5","Eb5"];o.current.notePool=i;const l=new Me().connect(d);l.set({volume:-15,oscillator:{type:"triangle"},envelope:{attack:.02,decay:.2,sustain:.2,release:.8},filterEnvelope:{attack:.01,decay:.1,sustain:.6,release:1.5,baseFrequency:800,octaves:2}}),o.current.melodySequencer={synth:l,currentMelody:[],currentIndex:0,timeout:null};const m=()=>{const f=new et(tt).connect(d);return f.set({volume:-18,harmonicity:3.5,modulationIndex:10,oscillator:{type:"sine"},envelope:{attack:3,decay:2,sustain:.8,release:8},modulation:{type:"sine"},modulationEnvelope:{attack:4,decay:2,sustain:.5,release:10}}),f},x=()=>{const f=new Me().connect(d);return f.set({volume:-20,oscillator:{type:"sine"},envelope:{attack:.1,decay:.8,sustain:.4,release:4},filterEnvelope:{attack:.1,decay:.2,sustain:.1,release:2,baseFrequency:300,octaves:2}}),f},b=m(),h=m(),R=x();o.current.generativePlayers=[{synth:b,pattern:null},{synth:h,pattern:null},{synth:R,pattern:null}],o.current.effects=[d,u,t]},[]),ne=s.useCallback(()=>{o.current.effects&&o.current.effects.forEach(b=>b.dispose()),o.current.players.forEach(({player:b,interval:h})=>{b&&b.dispose(),h&&h.dispose()}),o.current.generativePlayers.forEach(({synth:b,pattern:h})=>{b&&b.dispose(),h&&h.dispose()}),o.current.timeoutIds.forEach(b=>window.clearTimeout(b)),o.current.melodySequencer.timeout&&window.clearTimeout(o.current.melodySequencer.timeout),o.current.players=[],o.current.generativePlayers=[],o.current.timeoutIds=[];const t=new Ke({decay:5,wet:.5}).toDestination(),u=new Je({delayTime:"16n",feedback:.4,wet:.35}).connect(t),d=new Ne({type:"lowpass",frequency:2500,Q:.7}).connect(u),i=["C4","D4","E4","G4","A4","C5","D5","E5","G5","A5"];o.current.notePool=i;const l=new Me().connect(d);l.set({volume:-17,oscillator:{type:"triangle"},envelope:{attack:.02,decay:.15,sustain:.2,release:.6},filterEnvelope:{attack:.02,decay:.1,sustain:.3,release:.5,baseFrequency:1200,octaves:2.5}}),o.current.melodySequencer={synth:l,currentMelody:[],currentIndex:0,timeout:null};const x=(()=>{const b=new et(tt).connect(d);return b.set({volume:-22,harmonicity:1.5,modulationIndex:5,oscillator:{type:"sine"},envelope:{attack:1.5,decay:1,sustain:.4,release:4},modulation:{type:"triangle"},modulationEnvelope:{attack:2,decay:.8,sustain:.2,release:5}}),b})();o.current.generativePlayers=[{synth:x,pattern:null},{synth:null,pattern:null},{synth:null,pattern:null}],o.current.effects=[d,u,t]},[]),I=s.useCallback(()=>{const t=o.current.notePool;return t[Math.floor(Math.random()*t.length)]},[]),_=s.useCallback(()=>{var m;if(!o.current.isPlaying)return;const{generativePlayers:t,timeoutIds:u,timeMode:d}=o.current;if(d==="future"&&Math.random()<.1&&((m=t[0])!=null&&m.synth)){const x=t[0].synth,b=Math.random()<.5?"C":"G",h=4,R=`${b}${h}`,f=b==="C"?`G${h}`:`D${h+1}`;try{x.triggerAttackRelease(R,"2n"),setTimeout(()=>{x.triggerAttackRelease(f,"2n")},200)}catch($){console.debug("Error playing pad chord:",$)}}const i=d==="future"?6e3+Math.random()*6e3:800+Math.random()*2500,l=window.setTimeout(()=>{_()},i);u.push(l)},[I]),Q=s.useCallback(()=>{var m;if(!o.current.isPlaying)return;const{generativePlayers:t,timeoutIds:u,timeMode:d}=o.current;if((m=t[0])!=null&&m.synth){const x=t[0].synth,h=[I()];if(Math.random()<.7){const R=o.current.notePool[Math.floor(Math.random()*o.current.notePool.length)];if(h.push(R),Math.random()<.4){const f=o.current.notePool[Math.floor(Math.random()*o.current.notePool.length)];h.push(f)}}try{const R=d==="future"?"4n":"2n";if(x.triggerAttackRelease(h[0],R),h.length>1)for(let f=1;f<h.length;f++)x.triggerAttackRelease(h[f],R)}catch(R){console.debug("Error playing swell pad:",R)}}const i=d==="future"?2e3+Math.random()*4e3:4e3+Math.random()*8e3,l=window.setTimeout(()=>{Q()},i);u.push(l)},[I]),Z=s.useCallback(()=>{const{notePool:t,timeMode:u}=o.current;if(u==="future"){const d=Math.floor(Math.random()*3),i=[],l=Math.floor(Math.random()*3);switch(i.push(t[l]),d){case 0:for(let m=1;m<5;m++){const x=Math.min(l+m,t.length-1);i.push(t[x])}break;case 1:if(l<t.length-4)i.push(t[l+2]),i.push(t[l+4]),i.push(t[l+4]),i.push(t[l+2]);else for(let m=1;m<5;m++)i.push(t[Math.max(l-m,0)]);break;case 2:if(l<t.length-2)i.push(t[l+2]),i.push(t[l+1]),i.push(t[l+3]),i.push(t[l]);else for(let m=1;m<5;m++){const x=l-m;i.push(t[x>=0?x:0])}break}return i}else{const d=4+Math.floor(Math.random()*4),i=[];Math.random()<.4?i.push("Db4"):i.push(t[Math.floor(Math.random()*t.length)]);for(let l=1;l<d;l++)if(Math.random()<.6){const m=t.indexOf(i[l-1]),x=Math.random()<.5;x&&m<t.length-1?i.push(t[m+1]):!x&&m>0?i.push(t[m-1]):i.push(t[Math.floor(Math.random()*t.length)])}else Math.random()<.25?i.push(i[l-1]):i.push(t[Math.floor(Math.random()*t.length)]);return i}},[]),se=s.useCallback(()=>{if(!o.current.isPlaying)return;const{melodySequencer:t,timeoutIds:u,timeMode:d}=o.current,{synth:i,currentMelody:l,currentIndex:m}=t;if(!(!i||l.length===0))try{const x=l[m],b=d==="future"?"8n":"16n";i.triggerAttackRelease(x,b,ye(),.7);const R=(m+1)%l.length;o.current.melodySequencer.currentIndex=R,R===0&&(t.repeatCount=(t.repeatCount||0)+1,t.repeatCount>=2&&(o.current.melodySequencer.currentMelody=Z(),t.repeatCount=0));const f=d==="future"?200+Math.random()*50:200+Math.random()*150,$=window.setTimeout(()=>{se()},f);t.timeout!==null&&(t.timeout=$),u.push($)}catch(x){console.debug("Error playing melody note:",x)}},[Z]),j=s.useCallback(()=>{if(!o.current.isPlaying)return;const{timeoutIds:t,timeMode:u}=o.current,d=u==="future"?.3:.4;Math.random()<d&&(o.current.melodySequencer.currentMelody=Z(),o.current.melodySequencer.currentIndex=0,o.current.melodySequencer.repeatCount=0,se());const i=u==="future"?4e3+Math.random()*4e3:2e3+Math.random()*5e3,l=window.setTimeout(()=>{j()},i);t.push(l),o.current.melodySequencer.timeout=l},[Z,se]),T=s.useRef(null),L=s.useRef(null),P=async()=>{if(Y.state==="suspended")try{await Y.resume(),console.debug("Audio context resumed")}catch(t){console.error("Failed to resume audio context:",t)}},q=async()=>{if(Y.state==="closed")try{At(new Tt),Object.values(C.current).forEach(t=>{t&&t.dispose()}),C.current={command:null,error:null,aiResponse:null},T.current&&(T.current.dispose(),T.current=null),L.current&&(L.current.dispose(),L.current=null),console.debug("Tone context was closed â€“ created a new context and cleared synth cache")}catch(t){console.error("Failed to reset Tone context:",t)}if(!p||Y.state!=="running")try{return await Ft(),E(!0),Y.state==="suspended"&&await Y.resume(),C.current.command||(Object.entries(rt).forEach(([t,u])=>{C.current[t]=Ce(u)}),T.current=Ce(Vt),L.current=Ce(Ee)),!0}catch(t){return console.debug("Could not initialize Tone.js:",t),!1}return!0};s.useEffect(()=>{const t=()=>{q(),window.removeEventListener("click",t)};window.addEventListener("click",t);const u=async()=>{document.visibilityState==="visible"&&await P()},d=async()=>{await P()};return document.addEventListener("visibilitychange",u),window.addEventListener("focus",d),()=>{window.removeEventListener("click",t),document.removeEventListener("visibilitychange",u),window.removeEventListener("focus",d)}},[]);const ee=s.useCallback(async t=>{if(r||!await q())return;const u=C.current[t];if(!u)return;const d=rt[t],i=ye();if(i-O.current>=.15)try{u.triggerAttackRelease(d.note,d.duration,i),O.current=i}catch(m){console.debug("Skipping sound due to timing",m)}},[r,p]),de=s.useCallback(async(t="now")=>{if(!r&&await q()&&!o.current.isPlaying){if(o.current.isPlaying=!0,o.current.timeMode=t,t==="future"?ne():F(),Y.state!=="running")try{await Y.resume()}catch(u){console.debug("Could not resume audio context:",u);return}_(),Q(),j(),Ze.state!=="started"&&Ze.start()}},[r,p,F,ne,_,Q,j]),H=s.useCallback(()=>{if(o.current.isPlaying=!1,o.current.timeoutIds.forEach(t=>window.clearTimeout(t)),o.current.timeoutIds=[],o.current.generativePlayers.forEach(({synth:t})=>{if(t)try{"releaseAll"in t?t.releaseAll():t.triggerRelease()}catch(u){console.debug("Error releasing synth:",u)}}),o.current.melodySequencer.synth)try{o.current.melodySequencer.synth.triggerRelease()}catch(t){console.debug("Error releasing melody synth:",t)}o.current.melodySequencer.timeout&&(window.clearTimeout(o.current.melodySequencer.timeout),o.current.melodySequencer.timeout=null)},[]),me=s.useCallback(async()=>{if(!r&&await q()&&T.current){const t=ye();try{T.current.triggerAttackRelease("C6","16n",t)}catch(u){console.debug("Error playing ding sound:",u)}}},[r,p]),D=s.useCallback(async()=>{if(!r&&await q()&&L.current){const t=ye();try{L.current.triggerAttackRelease(Ee.note,Ee.duration,t)}catch(u){console.debug("Error playing moo sound:",u)}}},[r,p]),ae=s.useCallback(()=>{M(!ge.getState().terminalSoundsEnabled)},[M]);return s.useEffect(()=>()=>{Object.values(C.current).forEach(t=>{t&&t.dispose()}),T.current&&T.current.dispose(),L.current&&L.current.dispose()},[]),{playCommandSound:()=>ee("command"),playErrorSound:()=>ee("error"),playAiResponseSound:()=>ee("aiResponse"),playElevatorMusic:de,stopElevatorMusic:H,playDingSound:me,playMooSound:D,toggleMute:ae,isMuted:r}}function Ce(p){const E=new Ne({frequency:p.filter.frequency,type:"lowpass",rolloff:p.filter.rolloff}).toDestination(),g=new It({oscillator:p.oscillator,envelope:p.envelope}).connect(E);return g.volume.value=p.volume,g}export{nt as C,so as H,at as S,Gt as e,no as i,ao as u};
