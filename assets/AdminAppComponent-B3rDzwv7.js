import{j as e,r as l}from"./ui-core-D0pDhx0h.js";import{c as te,u as ne,a as ue,M as $e,b as ve,d as ke,e as Ce,f as se,g as Te,n as Ee,o as Pe,a4 as b,af as _e,am as m,B as z,ao as Se,bc as Ue,at as qe,aq as Me,c0 as de,c1 as pe,c2 as P,c3 as v,c4 as me,c5 as k,G as xe,E as Je,c6 as Xe,Z as De,H as Ge,J as We,c7 as Ke}from"./index-DMj1es94.js";import{u as Be}from"./useAuth-BVbAzjSX.js";import{M as Ve}from"./message-square-xs7vsrBL.js";import{T as ae}from"./trash-2-DDV7VR-X.js";import{S as Ae}from"./search-ClACRxdK.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./motion-DC7C-474.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],he=te("Ban",Ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Re=te("Hash",Qe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],es=te("RefreshCw",Ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Oe=te("TriangleAlert",ss);function as({onClose:d,onShowHelp:y,onShowAbout:C,onRefresh:s}){const{t:p}=ne(),h=ue(a=>a.current),r=h==="xp"||h==="win98";return e.jsxs($e,{inWindowFrame:r,children:[e.jsxs(ve,{children:[e.jsx(ke,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:p("common.menu.file")}),e.jsxs(Ce,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(se,{onClick:s,className:"text-md h-6 px-3",children:p("apps.admin.menu.refreshData")}),e.jsx(Te,{className:"h-[2px] bg-black my-1"}),e.jsx(se,{onClick:d,className:"text-md h-6 px-3",children:p("common.menu.close")})]})]}),e.jsxs(ve,{children:[e.jsx(ke,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:p("common.menu.help")}),e.jsxs(Ce,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(se,{onClick:y,className:"text-md h-6 px-3",children:p("apps.admin.menu.adminHelp")}),e.jsx(Te,{className:"h-[2px] bg-black my-1"}),e.jsx(se,{onClick:C,className:"text-md h-6 px-3",children:p("apps.admin.menu.aboutAdmin")})]})]})]})}const ts=({activeSection:d,onSectionChange:y,rooms:C,selectedRoomId:s,onRoomSelect:p,isRoomsExpanded:h,onToggleRoomsExpanded:r,stats:a})=>{const{t:T}=ne(),{play:i}=Ee(Pe.BUTTON_CLICK),o=ue(g=>g.current),S=o==="xp"||o==="win98",M=C.filter(g=>g.type!=="private");return e.jsx("div",{className:b("flex flex-col font-geneva-12 text-[11px] bg-gray-100 w-48 border-r h-full overflow-hidden",S?"border-[#919b9c]":o==="macosx"?"border-black/10":"border-gray-300"),children:e.jsxs("div",{className:"pt-3 flex flex-col flex-1 overflow-hidden",children:[e.jsx("div",{className:"flex justify-between items-center mb-2 flex-shrink-0 px-3",children:e.jsx("h2",{className:"text-[14px] pl-1",children:T("apps.admin.title")})}),e.jsxs("div",{className:"space-y-0.5 flex-1 overflow-y-auto min-h-0",style:{WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:b("py-1.5 px-5 flex items-center gap-2 cursor-pointer",d==="users"&&s===null?"":"hover:bg-black/5"),style:d==="users"&&s===null?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>{i(),y("users"),p(null)},children:[e.jsx("span",{children:T("apps.admin.sidebar.users")}),e.jsx("span",{className:b("text-[10px] ml-auto",d==="users"&&s===null?"text-white/60":"text-black/40"),children:a.totalUsers})]}),e.jsxs("div",{className:b("mt-2 px-4 pt-2 pb-1 w-full flex items-center group cursor-pointer","!text-[11px] uppercase tracking-wide text-black/50"),onClick:()=>{i(),r()},children:[e.jsx("span",{children:T("apps.admin.sidebar.rooms")}),e.jsx("span",{className:"ml-auto opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(_e,{className:b("w-3 h-3 text-black/50 transition-transform",h?"rotate-90":"rotate-0")})})]}),h&&e.jsx(e.Fragment,{children:M.length>0&&e.jsx(e.Fragment,{children:M.map(g=>e.jsxs("div",{className:b("group relative py-1 px-5 flex items-center gap-1.5 cursor-pointer",s===g.id?"":"hover:bg-black/5"),style:s===g.id?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>{i(),y("rooms"),p(g.id)},children:[e.jsx(Re,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:g.name}),e.jsxs("span",{className:b("text-[10px] ml-auto",s===g.id?"text-white/60":"text-black/40"),children:[g.userCount," ",T("apps.admin.sidebar.online")]})]},g.id))})})]})]})})},ns=({username:d,onBack:y,onUserDeleted:C})=>{var w;const{t:s}=ne(),{username:p,authToken:h}=Be(),[r,a]=l.useState(null),[T,i]=l.useState([]),[o,U]=l.useState(!0),[S,M]=l.useState(""),[g,_]=l.useState(!1),[V,q]=l.useState(!1),[J,u]=l.useState(!1),O=l.useCallback(async()=>{if(!(!p||!h))try{const n=await fetch(`/api/admin?action=getUserProfile&username=${encodeURIComponent(d)}`,{headers:{Authorization:`Bearer ${h}`,"x-username":p}});if(n.ok){const j=await n.json();a(j)}}catch(n){console.error("Failed to fetch profile:",n),m.error(s("apps.admin.errors.failedToFetchProfile"))}},[d,h,p,s]),B=l.useCallback(async()=>{if(!(!p||!h))try{const n=await fetch(`/api/admin?action=getUserMessages&username=${encodeURIComponent(d)}&limit=50`,{headers:{Authorization:`Bearer ${h}`,"x-username":p}});if(n.ok){const j=await n.json();i(j.messages||[])}}catch(n){console.error("Failed to fetch messages:",n)}},[d,h,p]);l.useEffect(()=>{U(!0),Promise.all([O(),B()]).finally(()=>{U(!1)})},[O,B]);const re=async()=>{if(!(!p||!h)){try{const n=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`,"x-username":p},body:JSON.stringify({action:"banUser",targetUsername:d,reason:S||void 0})});if(n.ok)m.success(s("apps.admin.messages.userBanned",{username:d})),_(!1),M(""),O();else{const j=await n.json();m.error(j.error||s("apps.admin.errors.failedToBanUser"))}}catch(n){console.error("Failed to ban user:",n),m.error(s("apps.admin.errors.failedToBanUser"))}u(!1)}},X=async()=>{if(!(!p||!h))try{const n=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`,"x-username":p},body:JSON.stringify({action:"unbanUser",targetUsername:d})});if(n.ok)m.success(s("apps.admin.messages.userUnbanned",{username:d})),O();else{const j=await n.json();m.error(j.error||s("apps.admin.errors.failedToUnbanUser"))}}catch(n){console.error("Failed to unban user:",n),m.error(s("apps.admin.errors.failedToUnbanUser"))}},oe=async()=>{if(!(!p||!h)){try{const n=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`,"x-username":p},body:JSON.stringify({action:"deleteUser",targetUsername:d})});if(n.ok)m.success(s("apps.admin.messages.userDeleted",{username:d})),C(),y();else{const j=await n.json();m.error(j.error||s("apps.admin.errors.failedToDeleteUser"))}}catch(n){console.error("Failed to delete user:",n),m.error(s("apps.admin.errors.failedToDeleteUser"))}q(!1)}},x=n=>{const j=Date.now()-n,D=Math.floor(j/6e4),L=Math.floor(j/36e5),Q=Math.floor(j/864e5);return D<1?s("apps.admin.time.now"):D<60?s("apps.admin.time.minutesAgo",{count:D}):L<24?s("apps.admin.time.hoursAgo",{count:L}):s("apps.admin.time.daysAgo",{count:Q})},Z=n=>new Date(n).toLocaleString();if(!o&&!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-2",children:[e.jsx(Oe,{className:"h-8 w-8 text-neutral-400"}),e.jsx("span",{className:"text-[11px] text-neutral-500",children:s("apps.admin.profile.notFound")}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:y,className:"text-[11px]",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),s("apps.admin.profile.back")]})]});const I=d.toLowerCase()==="ryo",N=({className:n})=>e.jsx("div",{className:b("bg-neutral-200 animate-pulse rounded",n)});return e.jsxs("div",{className:"flex flex-col h-full font-geneva-12",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-gray-200 bg-gray-50",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:y,className:"h-6 w-6 p-0",children:e.jsx(Se,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:b("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium text-neutral-600",o?"bg-neutral-200 animate-pulse":"bg-neutral-200"),children:!o&&d[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1.5",children:o?e.jsx(N,{className:"h-4 w-24"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-[12px] font-medium",children:(r==null?void 0:r.username)||d}),(r==null?void 0:r.banned)&&e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] bg-red-100 text-red-700 rounded",children:s("apps.admin.profile.banned")}),I&&e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] bg-blue-100 text-blue-700 rounded",children:s("apps.admin.user.admin")})]})}),o?e.jsx(N,{className:"h-3 w-32 mt-1"}):e.jsxs("span",{className:"text-[10px] text-neutral-500",children:[s("apps.admin.profile.lastActive"),": ",x((r==null?void 0:r.lastActive)||0)]})]})]})]}),e.jsx(Ue,{className:"flex-1",children:e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"px-3 py-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-neutral-500 mb-1",children:[e.jsx(Ve,{className:"h-3 w-3"}),s("apps.admin.profile.messages")]}),o?e.jsx(N,{className:"h-5 w-8"}):e.jsx("span",{className:"text-[14px] font-medium",children:(r==null?void 0:r.messageCount)||0})]}),e.jsxs("div",{className:"px-3 py-2 bg-gray-50 rounded border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-neutral-500 mb-1",children:[e.jsx(Re,{className:"h-3 w-3"}),s("apps.admin.profile.rooms")]}),o?e.jsx(N,{className:"h-5 w-8"}):e.jsx("span",{className:"text-[14px] font-medium",children:((w=r==null?void 0:r.rooms)==null?void 0:w.length)||0})]})]}),!o&&(r==null?void 0:r.banned)&&e.jsxs("div",{className:"p-2 bg-red-50 rounded border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-red-600 mb-1",children:[e.jsx(he,{className:"h-3 w-3"}),s("apps.admin.profile.banDetails")]}),e.jsxs("div",{className:"text-[11px] space-y-1",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[s("apps.admin.profile.reason"),":"]})," ",r.banReason||s("apps.admin.profile.noReason")]}),r.bannedAt&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-neutral-500",children:[s("apps.admin.profile.bannedOn"),":"]})," ",Z(r.bannedAt)]})]})]}),!I&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"!text-[11px] uppercase tracking-wide text-black/50",children:s("apps.admin.profile.actions")}),o?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{className:"h-7 w-24"}),e.jsx(N,{className:"h-7 w-24"})]}):e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r!=null&&r.banned?e.jsxs("button",{onClick:X,className:"aqua-button primary h-7 px-3 text-[11px] flex items-center gap-1",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:s("apps.admin.profile.unban")})]}):e.jsx(e.Fragment,{children:g?e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Me,{placeholder:s("apps.admin.profile.banReasonPlaceholder"),value:S,onChange:n=>M(n.target.value),className:"h-7 text-[11px] flex-1"}),e.jsx("button",{onClick:()=>u(!0),className:"aqua-button orange h-7 px-3 text-[11px]",style:{color:"#000",textShadow:"none"},children:e.jsx("span",{style:{color:"#000"},children:s("apps.admin.profile.confirmBan")})}),e.jsx("button",{onClick:()=>{_(!1),M("")},className:"aqua-button secondary h-7 px-3 text-[11px]",children:e.jsx("span",{children:s("common.dialog.cancel")})})]}):e.jsxs("button",{onClick:()=>_(!0),className:"aqua-button orange h-7 px-3 text-[11px] flex items-center gap-1",style:{color:"#000",textShadow:"none"},children:[e.jsx(he,{className:"h-3 w-3",style:{color:"#000"}}),e.jsx("span",{style:{color:"#000"},children:s("apps.admin.profile.ban")})]})}),e.jsxs("button",{onClick:()=>q(!0),className:"aqua-button secondary h-7 px-3 text-[11px] flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),e.jsx("span",{children:s("apps.admin.profile.delete")})]})]})]}),o?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"!text-[11px] uppercase tracking-wide text-black/50",children:s("apps.admin.profile.activeRooms")}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(N,{className:"h-6 w-16"}),e.jsx(N,{className:"h-6 w-20"})]})]}):(r==null?void 0:r.rooms)&&r.rooms.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"!text-[11px] uppercase tracking-wide text-black/50",children:s("apps.admin.profile.activeRooms")}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.rooms.map(n=>e.jsxs("span",{className:"px-2 py-1 text-[10px] bg-gray-100 rounded",children:["#",n.name]},n.id))})]}),!o&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"!text-[11px] uppercase tracking-wide text-black/50",children:[s("apps.admin.profile.recentMessages")," (",T.length,")"]}),T.length===0?e.jsx("div",{className:"text-[11px] text-neutral-400 text-center py-4",children:s("apps.admin.profile.noMessages")}):e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs(P,{className:"text-[10px] border-none font-normal",children:[e.jsx(v,{className:"font-normal bg-gray-100/50 h-[24px]",children:s("apps.admin.profile.room")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[24px]",children:s("apps.admin.tableHeaders.message")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[24px] whitespace-nowrap",children:s("apps.admin.tableHeaders.time")})]})}),e.jsx(me,{className:"text-[11px]",children:T.map(n=>e.jsxs(P,{className:"border-none hover:bg-gray-100/50 transition-colors cursor-default odd:bg-gray-200/30",children:[e.jsxs(k,{className:"whitespace-nowrap",children:[e.jsx("span",{className:"text-neutral-500",children:"#"}),n.roomName||n.roomId]}),e.jsx(k,{className:"max-w-[200px]",children:e.jsx("span",{className:"truncate block",children:n.content})}),e.jsx(k,{className:"whitespace-nowrap text-neutral-500",children:x(n.timestamp)})]},n.id))})]})]})]})}),e.jsx(xe,{isOpen:V,onOpenChange:q,onConfirm:oe,title:s("apps.admin.dialogs.deleteTitle",{type:"user"}),description:s("apps.admin.dialogs.deleteDescription",{type:"user",name:d})}),e.jsx(xe,{isOpen:J,onOpenChange:u,onConfirm:re,title:s("apps.admin.dialogs.banTitle"),description:s("apps.admin.dialogs.banDescription",{username:d})})]})};function Ns({isWindowOpen:d,onClose:y,isForeground:C,skipInitialSound:s,instanceId:p,onNavigateNext:h,onNavigatePrevious:r}){const{t:a}=ne(),T=Je("admin",Xe),{username:i,authToken:o}=Be(),U=ue(t=>t.current),S=U==="xp"||U==="win98",[M,g]=l.useState(!1),[_,V]=l.useState(!1),[q,J]=l.useState(!1),[u,O]=l.useState(null),[B,re]=l.useState([]),[X,oe]=l.useState([]),[x,Z]=l.useState(null),[I,N]=l.useState([]),[w,n]=l.useState(""),[j,D]=l.useState(!1),[L,Q]=l.useState(20),le=20,[Ie,Fe]=l.useState({totalUsers:0,totalRooms:0,totalMessages:0}),[Y,He]=l.useState("users"),[fe,ze]=l.useState(!0),[G,ge]=l.useState(null),ie=(i==null?void 0:i.toLowerCase())==="ryo",W=X.find(t=>t.id===x)||null,A=l.useCallback(async()=>{if(!(!i||!o))try{const t=await fetch("/api/admin?action=getStats",{headers:{Authorization:`Bearer ${o}`,"x-username":i}});if(t.ok){const c=await t.json();Fe(c)}}catch(t){console.error("Failed to fetch stats:",t)}},[i,o]),F=l.useCallback(async(t="")=>{if(!(!i||!o)){D(!0);try{let R=((await(await fetch("/api/admin?action=getAllUsers",{headers:{Authorization:`Bearer ${o}`,"x-username":i}})).json()).users||[]).sort((H,K)=>H.banned&&!K.banned?-1:!H.banned&&K.banned?1:H.username.toLowerCase().localeCompare(K.username.toLowerCase()));if(t.length>0){const H=t.toLowerCase();R=R.filter(K=>K.username.toLowerCase().includes(H))}re(R),Q(le)}catch(c){console.error("Failed to fetch users:",c),m.error(a("apps.admin.errors.failedToFetchUsers"))}finally{D(!1)}}},[i,o,a,le]),$=l.useCallback(async()=>{if(!(!i||!o)){D(!0);try{const c=await(await fetch(`/api/chat-rooms?action=getRooms&username=${encodeURIComponent(i)}`,{headers:{Authorization:`Bearer ${o}`,"x-username":i}})).json();oe(c.rooms||[])}catch(t){console.error("Failed to fetch rooms:",t),m.error(a("apps.admin.errors.failedToFetchRooms"))}finally{D(!1)}}},[i,o,a]),E=l.useCallback(async t=>{if(!(!i||!o)){D(!0);try{const f=await(await fetch(`/api/chat-rooms?action=getMessages&roomId=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${o}`,"x-username":i}})).json();N(f.messages||[])}catch(c){console.error("Failed to fetch messages:",c),m.error(a("apps.admin.errors.failedToFetchMessages"))}finally{D(!1)}}},[i,o,a]),je=l.useCallback(async t=>{if(!(!i||!o))try{const c=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":i},body:JSON.stringify({action:"deleteUser",targetUsername:t})});if(c.ok)m.success(a("apps.admin.messages.userDeleted",{username:t})),F(w),A();else{const f=await c.json();m.error(f.error||a("apps.admin.errors.failedToDeleteUser"))}}catch(c){console.error("Failed to delete user:",c),m.error(a("apps.admin.errors.failedToDeleteUser"))}},[i,o,w,F,A,a]),be=l.useCallback(async t=>{if(!(!i||!o))try{const c=await fetch("/api/chat-rooms",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":i},body:JSON.stringify({action:"deleteRoom",roomId:t})});if(c.ok)m.success(a("apps.admin.messages.roomDeleted")),$(),A(),Z(null),N([]);else{const f=await c.json();m.error(f.error||a("apps.admin.errors.failedToDeleteRoom"))}}catch(c){console.error("Failed to delete room:",c),m.error(a("apps.admin.errors.failedToDeleteRoom"))}},[i,o,$,A,a]),ye=l.useCallback(async(t,c)=>{if(!(!i||!o))try{const f=await fetch("/api/chat-rooms",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":i},body:JSON.stringify({action:"deleteMessage",roomId:t,messageId:c})});if(f.ok)m.success(a("apps.admin.messages.messageDeleted")),E(t);else{const R=await f.json();m.error(R.error||a("apps.admin.errors.failedToDeleteMessage"))}}catch(f){console.error("Failed to delete message:",f),m.error(a("apps.admin.errors.failedToDeleteMessage"))}},[i,o,E,a]),Le=l.useCallback(()=>{if(u){switch(u.type){case"user":je(u.id);break;case"room":be(u.id);break;case"message":x&&ye(x,u.id);break}O(null),J(!1)}},[u,x,je,be,ye]),ce=(t,c,f)=>{O({type:t,id:c,name:f}),J(!0)};l.useEffect(()=>{ie&&d&&($(),A())},[ie,d,$,A]),l.useEffect(()=>{const t=setTimeout(()=>{F(w)},300);return()=>clearTimeout(t)},[w,F]),l.useEffect(()=>{x&&E(x)},[x,E]);const Ne=l.useCallback(()=>{$(),A(),x&&E(x),F(w),m.success(a("apps.admin.messages.dataRefreshed"))},[$,A,E,F,x,w,a]),we=t=>{const c=Date.now()-t,f=Math.floor(c/6e4),R=Math.floor(c/36e5),H=Math.floor(c/864e5);return f<1?a("apps.admin.time.now"):f<60?a("apps.admin.time.minutesAgo",{count:f}):R<24?a("apps.admin.time.hoursAgo",{count:R}):a("apps.admin.time.daysAgo",{count:H})},ee=e.jsx(as,{onClose:y,onShowHelp:()=>g(!0),onShowAbout:()=>V(!0),onRefresh:Ne});return d?ie?e.jsxs(e.Fragment,{children:[!S&&C&&ee,e.jsxs(De,{title:a("apps.admin.title"),onClose:y,isForeground:C,appId:"admin",skipInitialSound:s,instanceId:p,onNavigateNext:h,onNavigatePrevious:r,menuBar:S?ee:void 0,children:[e.jsxs("div",{className:"flex h-full w-full",children:[e.jsx(ts,{activeSection:Y,onSectionChange:He,rooms:X,selectedRoomId:x,onRoomSelect:Z,isRoomsExpanded:fe,onToggleRoomsExpanded:()=>ze(!fe),stats:Ie}),e.jsxs("div",{className:"flex-1 flex flex-col bg-white overflow-hidden",children:[!G&&e.jsxs("div",{className:b("flex items-center gap-2 px-2 py-1.5 border-b",S?"border-[#919b9c]":U==="macosx"?"border-black/10":"border-black/20"),style:U==="macosx"?{backgroundImage:"var(--os-pinstripe-window)"}:void 0,children:[Y==="users"&&!x&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ae,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-neutral-400"}),e.jsx(Me,{placeholder:a("apps.admin.search.placeholder"),value:w,onChange:t=>n(t.target.value),className:"pl-7 h-7 text-[12px]"})]}),x&&W&&e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-[12px] font-medium",children:["#"," ",W.name]}),e.jsx("span",{className:"text-[11px] text-neutral-500",children:a("apps.admin.room.messagesCount",{count:I.length})})]}),e.jsx(z,{variant:"ghost",size:"sm",onClick:Ne,className:"h-7 w-7 p-0",children:e.jsx(es,{className:b("h-3.5 w-3.5",j&&"animate-spin")})}),x&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>ce("room",x,(W==null?void 0:W.name)||""),className:"h-7 w-7 p-0 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100",children:e.jsx(ae,{className:"h-3.5 w-3.5"})})]}),e.jsxs(Ue,{className:"flex-1",children:[G&&e.jsx(ns,{username:G,onBack:()=>ge(null),onUserDeleted:()=>{F(w),A()}}),Y==="users"&&!x&&!G&&e.jsx("div",{className:"font-geneva-12",children:B.length===0&&!j?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-neutral-400",children:[e.jsx(Ae,{className:"h-8 w-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-[11px]",children:a("apps.admin.search.noResults")})]}):e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs(P,{className:"text-[10px] border-none font-normal",children:[e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px]",children:a("apps.admin.tableHeaders.username")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px]",children:a("apps.admin.tableHeaders.status")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px] whitespace-nowrap",children:a("apps.admin.tableHeaders.lastActive")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px] w-8"})]})}),e.jsx(me,{className:"text-[11px]",children:B.slice(0,L).map(t=>e.jsxs(P,{className:b("border-none hover:bg-gray-100/50 transition-colors cursor-pointer odd:bg-gray-200/50 group",t.banned&&"bg-red-50/50 odd:bg-red-50/70"),onClick:()=>ge(t.username),children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx("div",{className:b("w-4 h-4 rounded-full flex items-center justify-center text-[9px] font-medium",t.banned?"bg-red-200 text-red-700":"bg-neutral-200 text-neutral-600"),children:t.username[0].toUpperCase()}),t.username]}),e.jsx(k,{children:t.banned?e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-[9px] bg-red-100 text-red-700 rounded",children:[e.jsx(he,{className:"h-2.5 w-2.5"}),a("apps.admin.user.banned")]}):t.username.toLowerCase()==="ryo"?e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] bg-blue-100 text-blue-700 rounded",children:a("apps.admin.user.admin")}):e.jsx("span",{className:"px-1.5 py-0.5 text-[9px] bg-green-100 text-green-700 rounded",children:a("apps.admin.user.active")})}),e.jsx(k,{className:"whitespace-nowrap",children:we(t.lastActive)}),e.jsx(k,{children:t.username!=="ryo"&&e.jsx(z,{variant:"ghost",size:"sm",onClick:c=>{c.stopPropagation(),ce("user",t.username,t.username)},className:"h-5 w-5 p-0 md:opacity-0 md:group-hover:opacity-100 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100",children:e.jsx(ae,{className:"h-3 w-3"})})})]},t.username))})]}),B.length>L&&e.jsx("div",{className:"pt-2 pb-1 flex justify-center",children:e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>Q(t=>t+le),className:"h-7 text-[11px] text-neutral-500 hover:text-neutral-700",children:a("apps.admin.loadMore",{remaining:B.length-L})})})]})}),x&&!G&&e.jsx("div",{className:"font-geneva-12",children:I.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-neutral-400",children:e.jsx("span",{className:"text-[11px]",children:a("apps.admin.room.noMessages")})}):e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs(P,{className:"text-[10px] border-none font-normal",children:[e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px]",children:a("apps.admin.tableHeaders.user")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px]",children:a("apps.admin.tableHeaders.message")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px] whitespace-nowrap",children:a("apps.admin.tableHeaders.time")}),e.jsx(v,{className:"font-normal bg-gray-100/50 h-[28px] w-8"})]})}),e.jsx(me,{className:"text-[11px]",children:I.map(t=>e.jsxs(P,{className:"border-none hover:bg-gray-100/50 transition-colors cursor-default odd:bg-gray-200/50 group",children:[e.jsxs(k,{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-neutral-200 flex items-center justify-center text-[9px] font-medium text-neutral-600",children:t.username[0].toUpperCase()}),t.username]}),e.jsx(k,{className:"max-w-[200px]",children:e.jsx("span",{className:"truncate block",children:t.content})}),e.jsx(k,{className:"whitespace-nowrap",children:we(t.timestamp)}),e.jsx(k,{children:e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>ce("message",t.id,t.content.substring(0,30)+"..."),className:"h-5 w-5 p-0 md:opacity-0 md:group-hover:opacity-100 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-100",children:e.jsx(ae,{className:"h-3 w-3"})})})]},t.id))})]})})]}),e.jsxs("div",{className:"os-status-bar os-status-bar-text flex items-center justify-between px-2 py-1 text-[10px] font-geneva-12 bg-gray-100 border-t border-gray-300",children:[e.jsx("span",{children:Y==="users"&&!x?a("apps.admin.statusBar.usersCount",{count:B.length}):x?a("apps.admin.statusBar.messagesCount",{count:I.length}):a("apps.admin.statusBar.roomsCount",{count:X.length})}),e.jsx("span",{children:a("apps.admin.statusBar.loggedInAs",{username:i})})]})]})]}),e.jsx(Ge,{isOpen:M,onOpenChange:g,helpItems:T,appId:"admin"}),e.jsx(We,{isOpen:_,onOpenChange:V,metadata:Ke,appId:"admin"}),e.jsx(xe,{isOpen:q,onOpenChange:J,onConfirm:Le,title:a("apps.admin.dialogs.deleteTitle",{type:u==null?void 0:u.type}),description:a("apps.admin.dialogs.deleteDescription",{type:u==null?void 0:u.type,name:u==null?void 0:u.name})})]})]}):e.jsxs(e.Fragment,{children:[!S&&C&&ee,e.jsx(De,{title:a("apps.admin.title"),onClose:y,isForeground:C,appId:"admin",skipInitialSound:s,instanceId:p,onNavigateNext:h,onNavigatePrevious:r,menuBar:S?ee:void 0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 p-8 text-center bg-white",children:[e.jsx(Oe,{className:"h-10 w-10 text-neutral-400"}),e.jsx("h2",{className:"text-sm font-bold",children:a("apps.admin.accessDenied.title")}),e.jsx("p",{className:"text-xs text-neutral-500 max-w-xs",children:a("apps.admin.accessDenied.description")}),!i&&e.jsx("p",{className:"text-[11px] text-neutral-400",children:a("apps.admin.accessDenied.loginPrompt")})]})})]}):null}export{Ns as AdminAppComponent};
