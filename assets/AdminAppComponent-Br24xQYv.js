import{j as e,r as n}from"./ui-core-D0pDhx0h.js";import{c as A,u as W,a as G,M as be,b as re,d as ne,e as oe,f as F,g as ie,n as ve,o as ke,a4 as h,af as Ne,E as we,c0 as Ce,am as x,Z as le,aq as Me,B as $,bc as Te,H as Se,J as De,c1 as Ae,G as Re}from"./index-CqMK2L8S.js";import{M as Be}from"./message-square-BIPt3BIg.js";import{u as Oe}from"./useAuth-BDHrZYIT.js";import{S as ce}from"./search-Cs3FHwM2.js";import{T as X}from"./trash-2-BrafveBS.js";import"./react-CyQK0IK8.js";import"./media-player-Dfptv93o.js";import"./zustand-CwjPl1Tm.js";import"./motion-DC7C-474.js";import"./tiptap-CPHiBm_b.js";import"./ui-form-Bg85K0S3.js";import"./audio-DxkJfdUY.js";import"./pusher-BvD42uFZ.js";import"./hangul-CIZ_Rl7P.js";import"./three-BOJBN814.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Ie=A("Clock",Ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Fe=A("Hash",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_e=A("Lock",$e);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],He=A("RefreshCw",ze);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],qe=A("TriangleAlert",Le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],Xe=A("Users",Je);function We({onClose:f,onShowHelp:g,onShowAbout:j,onRefresh:d}){const{t:m}=W(),b=G(a=>a.current),N=b==="xp"||b==="win98";return e.jsxs(be,{inWindowFrame:N,children:[e.jsxs(re,{children:[e.jsx(ne,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:m("common.menu.file")}),e.jsxs(oe,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(F,{onClick:d,className:"text-md h-6 px-3",children:m("apps.admin.menu.refreshData")}),e.jsx(ie,{className:"h-[2px] bg-black my-1"}),e.jsx(F,{onClick:f,className:"text-md h-6 px-3",children:m("common.menu.close")})]})]}),e.jsxs(re,{children:[e.jsx(ne,{className:"text-md px-2 py-1 border-none focus-visible:ring-0",children:m("common.menu.help")}),e.jsxs(oe,{align:"start",sideOffset:1,className:"px-0",children:[e.jsx(F,{onClick:g,className:"text-md h-6 px-3",children:m("apps.admin.menu.adminHelp")}),e.jsx(ie,{className:"h-[2px] bg-black my-1"}),e.jsx(F,{onClick:j,className:"text-md h-6 px-3",children:m("apps.admin.menu.aboutAdmin")})]})]})]})}const Ge=({activeSection:f,onSectionChange:g,rooms:j,selectedRoomId:d,onRoomSelect:m,isRoomsExpanded:b,onToggleRoomsExpanded:N,stats:a})=>{const{t:k}=W(),{play:t}=ve(ke.BUTTON_CLICK),o=G(i=>i.current),y=o==="xp"||o==="win98",B=j.filter(i=>i.type!=="private"),R=j.filter(i=>i.type==="private");return e.jsx("div",{className:h("flex flex-col font-geneva-12 text-[12px] bg-neutral-100 w-48 border-r h-full overflow-hidden",y?"border-[#919b9c]":o==="macosx"?"border-black/10":"border-black"),children:e.jsxs("div",{className:"pt-3 flex flex-col flex-1 overflow-hidden",children:[e.jsx("div",{className:"flex justify-between items-center mb-2 flex-shrink-0 px-3",children:e.jsx("h2",{className:"text-[14px] pl-1",children:k("apps.admin.title")})}),e.jsxs("div",{className:"space-y-0.5 flex-1 overflow-y-auto min-h-0",style:{WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:h("py-1.5 px-5 flex items-center gap-2 cursor-pointer",f==="users"&&d===null?"":"hover:bg-black/5"),style:f==="users"&&d===null?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>{t(),g("users"),m(null)},children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:k("apps.admin.sidebar.users")}),e.jsx("span",{className:h("text-[10px] ml-auto",f==="users"&&d===null?"text-white/60":"text-black/40"),children:a.totalUsers})]}),e.jsxs("div",{className:h("mt-2 px-4 pt-2 pb-1 w-full flex items-center group cursor-pointer","!text-[11px] uppercase tracking-wide text-black/50"),onClick:()=>{t(),N()},children:[e.jsx(Be,{className:"w-3 h-3 mr-1.5"}),e.jsx("span",{children:k("apps.admin.sidebar.rooms")}),e.jsxs("span",{className:"text-[10px] ml-1.5 normal-case lowercase",children:["(",a.totalRooms,")"]}),e.jsx("span",{className:"ml-auto opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ne,{className:h("w-3 h-3 text-black/50 transition-transform",b?"rotate-90":"rotate-0")})})]}),b&&e.jsxs(e.Fragment,{children:[B.length>0&&e.jsx(e.Fragment,{children:B.map(i=>e.jsxs("div",{className:h("group relative py-1 px-5 flex items-center gap-1.5 cursor-pointer",d===i.id?"":"hover:bg-black/5"),style:d===i.id?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>{t(),g("rooms"),m(i.id)},children:[e.jsx(Fe,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:i.name}),e.jsx("span",{className:h("text-[10px] ml-auto",d===i.id?"text-white/60":"text-black/40"),children:i.userCount})]},i.id))}),R.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 pt-2 pb-1 !text-[10px] uppercase tracking-wide text-black/40",children:k("apps.admin.sidebar.private")}),R.map(i=>e.jsxs("div",{className:h("group relative py-1 px-5 flex items-center gap-1.5 cursor-pointer",d===i.id?"":"hover:bg-black/5"),style:d===i.id?{background:"var(--os-color-selection-bg)",color:"var(--os-color-selection-text)"}:void 0,onClick:()=>{t(),g("rooms"),m(i.id)},children:[e.jsx(_e,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:i.name})]},i.id))]})]})]}),e.jsx("div",{className:h("px-3 py-2 text-[10px] text-black/50 border-t flex-shrink-0",y?"border-[#919b9c]":o==="macosx"?"border-black/10":"border-black/20"),children:e.jsx("div",{children:k("apps.admin.sidebar.messagesCount",{count:a.totalMessages})})})]})})};function ps({isWindowOpen:f,onClose:g,isForeground:j,skipInitialSound:d,instanceId:m,onNavigateNext:b,onNavigatePrevious:N}){const{t:a}=W(),k=we("admin",Ce),{username:t,authToken:o}=Oe(),w=G(s=>s.current),y=w==="xp"||w==="win98",[B,R]=n.useState(!1),[i,K]=n.useState(!1),[pe,_]=n.useState(!1),[p,P]=n.useState(null),[z,H]=n.useState([]),[L,de]=n.useState([]),[l,V]=n.useState(null),[O,Z]=n.useState([]),[u,me]=n.useState(""),[xe,C]=n.useState(!1),[he,ue]=n.useState({totalUsers:0,totalRooms:0,totalMessages:0}),[U,fe]=n.useState("users"),[Q,ge]=n.useState(!0),q=(t==null?void 0:t.toLowerCase())==="ryo",M=L.find(s=>s.id===l)||null,v=n.useCallback(async()=>{if(!(!t||!o))try{const s=await fetch("/api/admin?action=getStats",{headers:{Authorization:`Bearer ${o}`,"x-username":t}});if(s.ok){const r=await s.json();ue(r)}}catch(s){console.error("Failed to fetch stats:",s)}},[t,o]),T=n.useCallback(async(s="")=>{if(s.length<2){H([]);return}C(!0);try{const c=await(await fetch(`/api/chat-rooms?action=getUsers&search=${encodeURIComponent(s)}`)).json();H(c.users||[])}catch(r){console.error("Failed to fetch users:",r),x.error(a("apps.admin.errors.failedToFetchUsers"))}finally{C(!1)}},[a]),S=n.useCallback(async()=>{if(!(!t||!o)){C(!0);try{const r=await(await fetch(`/api/chat-rooms?action=getRooms&username=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${o}`,"x-username":t}})).json();de(r.rooms||[])}catch(s){console.error("Failed to fetch rooms:",s),x.error(a("apps.admin.errors.failedToFetchRooms"))}finally{C(!1)}}},[t,o,a]),D=n.useCallback(async s=>{if(!(!t||!o)){C(!0);try{const c=await(await fetch(`/api/chat-rooms?action=getMessages&roomId=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${o}`,"x-username":t}})).json();Z(c.messages||[])}catch(r){console.error("Failed to fetch messages:",r),x.error(a("apps.admin.errors.failedToFetchMessages"))}finally{C(!1)}}},[t,o,a]),Y=n.useCallback(async s=>{if(!(!t||!o))try{const r=await fetch("/api/admin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":t},body:JSON.stringify({action:"deleteUser",targetUsername:s})});if(r.ok)x.success(a("apps.admin.messages.userDeleted",{username:s})),T(u),v();else{const c=await r.json();x.error(c.error||a("apps.admin.errors.failedToDeleteUser"))}}catch(r){console.error("Failed to delete user:",r),x.error(a("apps.admin.errors.failedToDeleteUser"))}},[t,o,u,T,v,a]),ee=n.useCallback(async s=>{if(!(!t||!o))try{const r=await fetch("/api/chat-rooms",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":t},body:JSON.stringify({action:"deleteRoom",roomId:s})});if(r.ok)x.success(a("apps.admin.messages.roomDeleted")),S(),v(),V(null),Z([]);else{const c=await r.json();x.error(c.error||a("apps.admin.errors.failedToDeleteRoom"))}}catch(r){console.error("Failed to delete room:",r),x.error(a("apps.admin.errors.failedToDeleteRoom"))}},[t,o,S,v,a]),se=n.useCallback(async(s,r)=>{if(!(!t||!o))try{const c=await fetch("/api/chat-rooms",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,"x-username":t},body:JSON.stringify({action:"deleteMessage",roomId:s,messageId:r})});if(c.ok)x.success(a("apps.admin.messages.messageDeleted")),D(s);else{const E=await c.json();x.error(E.error||a("apps.admin.errors.failedToDeleteMessage"))}}catch(c){console.error("Failed to delete message:",c),x.error(a("apps.admin.errors.failedToDeleteMessage"))}},[t,o,D,a]),je=n.useCallback(()=>{if(p){switch(p.type){case"user":Y(p.id);break;case"room":ee(p.id);break;case"message":l&&se(l,p.id);break}P(null),_(!1)}},[p,l,Y,ee,se]),J=(s,r,c)=>{P({type:s,id:r,name:c}),_(!0)};n.useEffect(()=>{q&&f&&(S(),v())},[q,f,S,v]),n.useEffect(()=>{const s=setTimeout(()=>{u.length>=2?T(u):H([])},300);return()=>clearTimeout(s)},[u,T]),n.useEffect(()=>{l&&D(l)},[l,D]);const ae=n.useCallback(()=>{S(),v(),l&&D(l),u.length>=2&&T(u),x.success(a("apps.admin.messages.dataRefreshed"))},[S,v,D,T,l,u,a]),te=s=>{const r=Date.now()-s,c=Math.floor(r/6e4),E=Math.floor(r/36e5),ye=Math.floor(r/864e5);return c<1?a("apps.admin.time.now"):c<60?a("apps.admin.time.minutesAgo",{count:c}):E<24?a("apps.admin.time.hoursAgo",{count:E}):a("apps.admin.time.daysAgo",{count:ye})},I=e.jsx(We,{onClose:g,onShowHelp:()=>R(!0),onShowAbout:()=>K(!0),onRefresh:ae});return f?q?e.jsxs(e.Fragment,{children:[!y&&j&&I,e.jsxs(le,{title:a("apps.admin.title"),onClose:g,isForeground:j,appId:"admin",skipInitialSound:d,instanceId:m,onNavigateNext:b,onNavigatePrevious:N,menuBar:y?I:void 0,children:[e.jsxs("div",{className:"flex h-full w-full",children:[e.jsx(Ge,{activeSection:U,onSectionChange:fe,rooms:L,selectedRoomId:l,onRoomSelect:V,isRoomsExpanded:Q,onToggleRoomsExpanded:()=>ge(!Q),stats:he}),e.jsxs("div",{className:"flex-1 flex flex-col bg-white overflow-hidden",children:[e.jsxs("div",{className:h("flex items-center gap-2 px-2 py-1.5 border-b",y?"border-[#919b9c]":w==="macosx"?"border-black/10":"border-black/20"),style:w==="macosx"?{backgroundImage:"var(--os-pinstripe-window)"}:void 0,children:[U==="users"&&!l&&e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ce,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-neutral-400"}),e.jsx(Me,{placeholder:a("apps.admin.search.placeholder"),value:u,onChange:s=>me(s.target.value),className:"pl-7 h-7 text-[12px]"})]}),l&&M&&e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-[12px] font-medium",children:[M.type==="private"?"ðŸ”’":"#"," ",M.name]}),e.jsx("span",{className:"text-[11px] text-neutral-500",children:a("apps.admin.room.messagesCount",{count:O.length})})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:ae,className:"h-7 w-7 p-0",children:e.jsx(He,{className:h("h-3.5 w-3.5",xe&&"animate-spin")})}),l&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>J("room",l,(M==null?void 0:M.name)||""),className:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50",children:e.jsx(X,{className:"h-3.5 w-3.5"})})]}),e.jsxs(Te,{className:"flex-1",children:[U==="users"&&!l&&e.jsx("div",{className:"p-2",children:z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-neutral-400",children:[e.jsx(ce,{className:"h-8 w-8 mb-2 opacity-50"}),e.jsx("span",{className:"text-[12px]",children:u.length<2?a("apps.admin.search.minChars"):a("apps.admin.search.noResults")})]}):e.jsx("div",{className:"space-y-0.5",children:z.map(s=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-100 group",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-neutral-200 flex items-center justify-center text-[11px] font-medium text-neutral-600",children:s.username[0].toUpperCase()}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[12px] font-medium truncate",children:s.username}),s.username==="ryo"&&e.jsxs("span",{className:"text-[10px] text-neutral-500",children:["(",a("apps.admin.user.admin"),")"]})]})}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-neutral-400",children:[e.jsx(Ie,{className:"h-3 w-3"}),te(s.lastActive)]}),s.username!=="ryo"&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>J("user",s.username,s.username),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-600 hover:bg-red-50",children:e.jsx(X,{className:"h-3 w-3"})})]},s.username))})}),l&&e.jsx("div",{className:"p-2",children:O.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-neutral-400",children:e.jsx("span",{className:"text-[12px]",children:a("apps.admin.room.noMessages")})}):e.jsx("div",{className:"space-y-1",children:O.map(s=>e.jsxs("div",{className:"flex items-start gap-2 px-2 py-1.5 rounded hover:bg-neutral-50 group",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-neutral-200 flex items-center justify-center text-[10px] font-medium text-neutral-600 flex-shrink-0 mt-0.5",children:s.username[0].toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[11px] font-medium",children:s.username}),e.jsx("span",{className:"text-[10px] text-neutral-400",children:te(s.timestamp)})]}),e.jsx("p",{className:"text-[12px] text-neutral-700 break-words",children:s.content})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>J("message",s.id,s.content.substring(0,30)+"..."),className:"h-5 w-5 p-0 opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-600 hover:bg-red-50 flex-shrink-0",children:e.jsx(X,{className:"h-3 w-3"})})]},s.id))})})]}),e.jsxs("div",{className:h("px-2 py-1 text-[10px] font-geneva-12 border-t flex items-center justify-between",y?"bg-neutral-100 border-[#919b9c]":w==="macosx"?"bg-neutral-100 border-black/10":"bg-neutral-100 border-black/20"),children:[e.jsx("span",{children:U==="users"&&!l?a("apps.admin.statusBar.usersCount",{count:z.length}):l?a("apps.admin.statusBar.messagesCount",{count:O.length}):a("apps.admin.statusBar.roomsCount",{count:L.length})}),e.jsx("span",{className:"text-neutral-500",children:a("apps.admin.statusBar.loggedInAs",{username:t})})]})]})]}),e.jsx(Se,{isOpen:B,onOpenChange:R,helpItems:k,appId:"admin"}),e.jsx(De,{isOpen:i,onOpenChange:K,metadata:Ae,appId:"admin"}),e.jsx(Re,{isOpen:pe,onOpenChange:_,onConfirm:je,title:a("apps.admin.dialogs.deleteTitle",{type:p==null?void 0:p.type}),description:a("apps.admin.dialogs.deleteDescription",{type:p==null?void 0:p.type,name:p==null?void 0:p.name})})]})]}):e.jsxs(e.Fragment,{children:[!y&&j&&I,e.jsx(le,{title:a("apps.admin.title"),onClose:g,isForeground:j,appId:"admin",skipInitialSound:d,instanceId:m,onNavigateNext:b,onNavigatePrevious:N,menuBar:y?I:void 0,children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 p-8 text-center bg-white",children:[e.jsx(qe,{className:"h-10 w-10 text-neutral-400"}),e.jsx("h2",{className:"text-sm font-bold",children:a("apps.admin.accessDenied.title")}),e.jsx("p",{className:"text-xs text-neutral-500 max-w-xs",children:a("apps.admin.accessDenied.description")}),!t&&e.jsx("p",{className:"text-[11px] text-neutral-400",children:a("apps.admin.accessDenied.loginPrompt")})]})})]}):null}export{ps as AdminAppComponent};
